
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Junit4OSGi</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css); 
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css); 
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT> 
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT> 

<SCRIPT type="text/javascript"> 
 
    $(document).ready(function(){ 
        $("ul.sf-menu").supersubs({ 
            minWidth:    14,   // minimum width of sub-menus in em units 
            maxWidth:    30,   // maximum width of sub-menus in em units 
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over 
                               // due to slight rounding differences and font-family 
        }).superfish();  // call supersubs first, then superfish, so that subs are 
                         // not display:none when measuring. Call before initialising 
                         // containing tabs for same reason. 
    }); 
 
</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>							
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>	

<LI class="">			
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">					
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="ipojo-composition-tutorial.html" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="combining-ipojo-and-configuration-admin.html" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="apache-felix-ipojo-api.html" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="ipojo-faq.html" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI> 
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL> 
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>   
</LI><!-- End of tools -->	
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->			
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">


<H1><A name="Junit4OSGi-JUnit4OSGi%3AExecutingUnitaryandIntegrationTestonOSGi"></A>JUnit4OSGi : Executing Unitary and Integration Test on OSGi</H1>

<P>This page is <B>deprecated</B></P>

<HR>
<H2><A name="Junit4OSGi-Goals"></A>Goals</H2>
<P>Executing tests on OSGi became a stringent requirement as several aspects need to be tested. Indeed, modularity, services (and the inherent dynamism) and the business logic need to be tested.  The goal of JUnit4OSGi is to provide an execution gateway in order to test bundles and services.  Instead of injecting mock objects, as provided by regular test frameworks to hide the underlying Executing environment, tests are directly executed on OSGi and so have access to all the features provided by the OSGi framework. This allows developers checking modularity aspect and service dynamism in addition to the business logic.</P>

<H2><A name="Junit4OSGi-Principles"></A>Principles</H2>
<P>Junit4OSGi is split in several pieces. First the core bundle (Junit4OSGi) contains an extended version of Junit (3.8.1). On the top of this framework, several runners are implemented:</P>
<UL>
	<LI>Immediate runner : launch every available test suite</LI>
	<LI>Command line runner : Felix command line allowing to choose the test suite(s) to launch</LI>
	<LI>Swing Runner : a very simple Swing runner</LI>
	<LI>Maven runner: a maven plug-in allowing to automate tests during the project build process</LI>
</UL>


<P>The different runners give a great flexibility to the framework that can be used during the build process or to test an application in a special environment (such as J2ME).<BR>
Test suites and test cases are package inside bundles. Junit4OSGi extend Junit to support OSGi test suite and OSGi test case. These two kinds of test classes are able to use the bundle context of the bundle and so are able to deal with the underlying OSGi framework.</P>

<H2><A name="Junit4OSGi-Installingtheframework"></A>Installing the framework</H2>
<P>Except if you use the maven front end (automating the launch a an OSGi framework (Felix) and deploying required bundles), to launch the Junit framework you need to deploy and start</P>
<UL>
	<LI><A href="http://people.apache.org/~clement/ipojo/binaries/org.apache.felix.ipojo-0.8.0-SNAPSHOT.jar" class="external-link" rel="nofollow">iPOJO 0.8.0-SNASPHOT</A></LI>
	<LI><A href="http://people.apache.org/~clement/ipojo/binaries/org.apache.felix.ipojo.handler.extender.pattern-0.8.0-SNAPSHOT.jar" class="external-link" rel="nofollow">iPOJO Extender Pattern Handler 0.8.0-SNAPSHOT</A></LI>
	<LI><A href="http://people.apache.org/~clement/ipojo/junit4osgi/org.apache.felix.ipojo.junit4osgi-0.8.0-SNAPSHOT.jar" class="external-link" rel="nofollow">The Junit4OSGi bundle</A></LI>
	<LI>One runner such as the <A href="http://people.apache.org/~clement/ipojo/junit4osgi/org.apache.felix.ipojo.junit4osgi.felix-command-0.8.0-SNAPSHOT.jar" class="external-link" rel="nofollow">Felix command</A> one</LI>
</UL>


<P>The archive available <A href="http://people.apache.org/~clement/ipojo/junit4osgi/junit4osgi.tutorial.zip" class="external-link" rel="nofollow">here</A> contains a pre-configured version of Felix with the previously mentionned bundles.</P>

<H2><A name="Junit4OSGi-WritingJunitTestCaseandTestSuite"></A>Writing Junit Test Case and Test Suite</H2>
<P>This section describes briefly how to write test cases and test suites and how they are used by the Junit4OSGi framework. More details are available on the Junit web site <A href="http://www.junit.org/" class="external-link" rel="nofollow">http://www.junit.org/</A>.</P>

<P>The Money class was introduced in the Junit tutorial and was implemented as the following:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> junit.money;

<SPAN class="code-keyword">public</SPAN> class Money {
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">int</SPAN> fAmount;
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> fCurrency;

    <SPAN class="code-keyword">public</SPAN> Money(<SPAN class="code-object">int</SPAN> amount, <SPAN class="code-object">String</SPAN> currency) {
        fAmount= amount;
        fCurrency= currency;
    }

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">int</SPAN> amount() {
        <SPAN class="code-keyword">return</SPAN> fAmount;
    }

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> currency() {
        <SPAN class="code-keyword">return</SPAN> fCurrency;
    }
    
    <SPAN class="code-keyword">public</SPAN> Money add(Money m) {
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">new</SPAN> Money(amount()+m.amount(), currency());
    }
    
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">boolean</SPAN> equals(<SPAN class="code-object">Object</SPAN> anObject) {
        <SPAN class="code-keyword">if</SPAN> (anObject <SPAN class="code-keyword">instanceof</SPAN> Money) {
            Money aMoney= (Money)anObject;
            <SPAN class="code-keyword">return</SPAN> aMoney.currency().equals(currency())
                &amp;&amp; amount() == aMoney.amount();
        }
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">false</SPAN>;
    }
</PRE>
</DIV></DIV>
<P>So, to test this implementation, we decide to write a simple class testing the equals and add methods. This class can be implemented as the following:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class SimpleTestCase <SPAN class="code-keyword">extends</SPAN> TestCase {    
    <SPAN class="code-keyword">private</SPAN> Money f12CHF;
    <SPAN class="code-keyword">private</SPAN> Money f14CHF;   
    <SPAN class="code-keyword">public</SPAN> void setUp() {
        f12CHF= <SPAN class="code-keyword">new</SPAN> Money(12, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>);
        f14CHF= <SPAN class="code-keyword">new</SPAN> Money(14, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>);
    }
     <SPAN class="code-keyword">public</SPAN> void testEquals() {
        assertTrue(!f12CHF.equals(<SPAN class="code-keyword">null</SPAN>));
        assertEquals(f12CHF, f12CHF);
        assertEquals(f12CHF, <SPAN class="code-keyword">new</SPAN> Money(12, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>));
        assertTrue(!f12CHF.equals(f14CHF));
    }
    <SPAN class="code-keyword">public</SPAN> void testSimpleAdd() {
        Money expected= <SPAN class="code-keyword">new</SPAN> Money(26, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>);
        Money result= f12CHF.add(f14CHF);
        assertTrue(expected.equals(result));
    }
}
</PRE>
</DIV></DIV>
<P>Moreover, in order to launch these tests, we create a test suite (declaring the list of test to execute):</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class SimpleTestSuite {
    
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> Test suite() {
        TestSuite suite = <SPAN class="code-keyword">new</SPAN> TestSuite(<SPAN class="code-quote">&quot;Money Simple Test Suite&quot;</SPAN>);
        suite.addTestSuite(SimpleTestCase.class);
        <SPAN class="code-keyword">return</SPAN> suite;
    }
}
</PRE>
</DIV></DIV>
<P>Now, we have to package our tests and the Money class inside a bundle. Of course, it should be packaged in two different bundles but to keep simple we choose to create just one. To create the bundle, launch &quot;ant&quot; at the root of the junit-example directory.<BR>
The resulting bundle contains our three classes. These tests are connected to the junit4osgi framework by specifying a special header in the manifest:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Test-Suite: junit.example.SimpleTestSuite
</PRE>
</DIV></DIV>
<P>This header lists the test suite contained in the bundle. <BR>
Once packaged, we can launch our tests.<BR>
Start the pre-configured Felix with the following command launched from the Felix directory:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
java -jar bin/felix.jar
</PRE>
</DIV></DIV>
<P>Then deploy the created bundle:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
start file:../junit-example/output/junit-example.jar
</PRE>
</DIV></DIV>
<P>Finally, run the test with the junit command</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
junit 8
</PRE>
</DIV></DIV>
<P>The argument indicates the bundle containing the test suite to execute. The &quot;all&quot; special argument runs every available test suites.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; junit 8
Executing [Money Simple Test Suite]
..
Time: 0,001

OK (2 tests)
</PRE>
</DIV></DIV>

<H2><A name="Junit4OSGi-WritingJunitTestCaseandTestSuitespecializedforOSGi"></A>Writing Junit Test Case and Test Suite specialized for OSGi</H2>
<P>The previous example has illustrated how creating thest cases and test suites by using the regular Junit framework. However, junit4osgi has the particularity to support specialized test for OSGi.  For example, imagine the very simple Hello Service implemented by the following class:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class HelloProvider <SPAN class="code-keyword">implements</SPAN> HelloService {

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getHelloMessage() {
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-quote">&quot;hello&quot;</SPAN>;
    }
}
</PRE>
</DIV></DIV>
<P>The bundle containing this implementation should register it. So you can decide to check this and to check the returned hello message.<BR>
Instead of extending TestCase, this test case will extend OSGiTestCase (provided by the Junit4OSGi framework):</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class SimpleTestCase <SPAN class="code-keyword">extends</SPAN> OSGiTestCase {
    
    <SPAN class="code-keyword">public</SPAN> void testHelloAvailability() {
        ServiceReference ref = context.getServiceReference(HelloService.class.getName());
        assertNotNull(<SPAN class="code-quote">&quot;Assert Availability&quot;</SPAN>, ref);
    }
    
    <SPAN class="code-keyword">public</SPAN> void testHelloMessage() {
        ServiceReference ref = 
             context.getServiceReference(HelloService.class.getName());
        assertNotNull(<SPAN class="code-quote">&quot;Assert Availability&quot;</SPAN>, ref);
        HelloService hs = (HelloService) context.getService(ref);
        <SPAN class="code-object">String</SPAN> message = hs.getHelloMessage();
        assertNotNull(<SPAN class="code-quote">&quot;Check the message existence&quot;</SPAN>, message);
        assertEquals(<SPAN class="code-quote">&quot;Check the message&quot;</SPAN>, <SPAN class="code-quote">&quot;hello&quot;</SPAN>, message);
    }   

}
</PRE>
</DIV></DIV>
<P>First, note that this class follows the same rules than regular test cases. All methods with a name starting with <EM>test</EM> will be executed. However, this class can access to the bundle context of its bundle by using the <EM>context</EM> field. By using this field, the class can check the availability of services ...<BR>
OSGi test cases are gathered in OSGi test suite such as:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class SimpleTestSuite {
    
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> Test suite(BundleContext context) {
  OSGiTestSuite suite = <SPAN class="code-keyword">new</SPAN> OSGiTestSuite(
<SPAN class="code-quote">&quot;Hello Service Test Suite&quot;</SPAN>,             
context
  );
        suite.addTestSuite(SimpleTestCase.class);
        <SPAN class="code-keyword">return</SPAN> suite;
    }
}
</PRE>
</DIV></DIV>
<P>Note that the suite method receives the bundle context allowing the creation of an OSGi Test Suite object.<BR>
The execution of these tests follows the same steps than the previous example:</P>
<UL>
	<LI>Compile the tests and create the bundle by launching ant from the junit-osgi-example directory</LI>
	<LI>Start Felix</LI>
	<LI>Deploy the bundle with the following command: <TT>start <A href="file:../junit-osgi-example/output/junit-osgi-example.jar" class="external-link" rel="nofollow">file:../junit-osgi-example/output/junit-osgi-example.jar</A></TT></LI>
	<LI>Execute the test by using the junit command</LI>
</UL>


<H2><A name="Junit4OSGi-Mavenfrontend%3Aautomatingtestsinyourbuildprocess"></A>Maven front end: automating tests in your build process</H2>
<P> <EM>Coming soon</EM>
<BR class="atl-forced-newline">
<BR class="atl-forced-newline"></P>

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on 2009-08-25 01:23:32.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
