
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix SCR Ant Task Use</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">


<P>The SCR Ant Task is implemented in the <TT>org.apache.felix.scr.ant</TT> library which must be registered as an Ant Task in the build file as follows:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;project ...&gt;</SPAN>

  &lt;taskdef
    resource=<SPAN class="code-quote">&quot;scrtask.properties&quot;</SPAN>
    classpath=<SPAN class="code-quote">&quot;org.apache.felix.scr.ant-1.1.4.jar&quot;</SPAN> /&gt;

<SPAN class="code-tag">&lt;/project&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>Of course the value you set in the <TT>classpath</TT> attribute depends on the actual location of the <TT>org.apache.felix.scr.ant</TT> JAR file.</P>

<P>The SCR Ant Task is available for download from the Apache Felix <A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">Downloads</A> page.</P>

<P><B>Notes</B>:</P>
<UL>
	<LI>The name of the task is <TT>scr</TT></LI>
	<LI>The task requires that the source files have already been compiled</LI>
</UL>


<P>The task only generates the descriptor file(s). If you want to use the Declarative Services descriptor &ndash; by default generated in the <TT>OSGI-INF/serviceComponents.xml</TT> &ndash; you must make sure to add a <TT>Service-Components</TT> header to your bundle manifest. Unlike Maven plugin the Ant task cannot automatically generate this header.</P>


<H2><A name="ApacheFelixSCRAntTaskUse-TaskAttributes"></A>Task Attributes</H2>

<P>Like the standard <TT>javac</TT> Ant Task, the SCR Ant Task defines an implicit fileset which defines the source files to be scanned for Java 5 Annotations or JavaDoc Tags. In addition to the child elements available to Ant Fileset as defined for <A href="http://ant.apache.org/manual/dirtasks.html#directorybasedtasks" class="external-link" rel="nofollow">directory-based tasks</A> the following task attributes:</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Attribute </TH>
<TH class="confluenceTh"> Required </TH>
<TH class="confluenceTh"> Default </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> scrdir </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> &ndash; </TD>
<TD class="confluenceTd"> The root directory of the implicitly defined fileset denoting the files to consider for annotation and/or JavaDoc tag processing. </TD>
</TR>
<TR>
<TD class="confluenceTd"> destdir </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> &ndash; </TD>
<TD class="confluenceTd"> The name of the directory where the descriptor files are generated into. This is also used as the directory where the compiled classes from the <TT>srcdir</TT> may be located. This directory is actually added as another element to the classpath as defined by <TT>classpath</TT> and <TT>classpathRef</TT>. </TD>
</TR>
<TR>
<TD class="confluenceTd"> classpath </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> &ndash; </TD>
<TD class="confluenceTd"> The class path used to load classes from to analyse for the descriptor file generation. Generally this will be the same class path as the one used to compile the sources. </TD>
</TR>
<TR>
<TD class="confluenceTd"> classpathRef </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> &ndash; </TD>
<TD class="confluenceTd"> A reference to a class path used to load classes from to analyse for the descriptor file generation. Generally this will be the same class path as the one used to compile the sources. </TD>
</TR>
<TR>
<TD class="confluenceTd"> finalName </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> <TT>serviceComponents.xml</TT> </TD>
<TD class="confluenceTd"> The name of the descriptor file to create. This file is always located inside the <TT>OSGI-INF</TT> folder in the <TT>destdir</TT>. </TD>
</TR>
<TR>
<TD class="confluenceTd"> metaTypeName </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> <TT>metatype.xml</TT> </TD>
<TD class="confluenceTd"> The name of the descriptor file to create. This file is always located inside the <TT>OSGI-INF/metatype</TT> folder in the <TT>destdir</TT>. </TD>
</TR>
<TR>
<TD class="confluenceTd"> generateAccessors </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> <TT>true</TT> </TD>
<TD class="confluenceTd"> If this switch is turned on, the bind and unbind methods for unary references are automatically generated by the plugin. </TD>
</TR>
<TR>
<TD class="confluenceTd"> annotationTagProviders </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> &ndash; </TD>
<TD class="confluenceTd"> List of fully qualified class names providing more Annotation Tag Providers. As of version 1.4.0 of the SCR Annotations library this configuration element is optional if the SCR Annotations library comes with a proper SPI setup (see <A href="extending-scr-annotations.html" title="Extending SCR Annotations">Extending SCR Annotations</A>) </TD>
</TR>
<TR>
<TD class="confluenceTd"> specVersion </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Auto-Detected </TD>
<TD class="confluenceTd"> The plugin will generate a descriptor for the Declarative Service version (either 1.0 or 1.1). If no value is specified, the plugin will detect the version and only use 1.1 if features from this version are used. </TD>
</TR>
<TR>
<TD class="confluenceTd"> strictMode </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> false </TD>
<TD class="confluenceTd"> If set to true, a warning will be considered as an error and the build will fail with warnings generated by this task. </TD>
</TR>
<TR>
<TD class="confluenceTd"> parseJavadoc </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> true </TD>
<TD class="confluenceTd"> If set to true, javadoc based annotations will be processed. </TD>
</TR>
<TR>
<TD class="confluenceTd"> processAnnotations </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> true </TD>
<TD class="confluenceTd"> If set to true, SCR annotations will be processed </TD>
</TR>
</TBODY></TABLE>
</DIV>



<P>The <TT>scr</TT> task must be provided with the same class path as was used to compile the sources. The classes in the class path are used by the task to be able to load compiled classes (mostly for Java 5 annotation processing) and any base classes, which may be extended. The easiest way to share the class path is to define a class path property and refer to it with the <TT>classpathref</TT> attribute of the <TT>scr</TT> task.</P>


<H2><A name="ApacheFelixSCRAntTaskUse-UsingJavaDocTags"></A>Using JavaDoc Tags</H2>

<P>JavaDoc tags are supported natively by the SCR Ant Task. No further configuration and/or libraries are needed.</P>


<H2><A name="ApacheFelixSCRAntTaskUse-Java5Annotations"></A>Java 5 Annotations</H2>

<P>To use Java 5 Annotations make sure the library defining the annotations is available on the class path for both the compilation in the <TT>javac</TT> task and for generating the descriptor in the <TT>scr</TT> task.</P>

<P>No further configuration is required as the SCR Ant Task automatically recognizes SCR Annotation definitions from libraries in the class path provided the annotations are provided in a JAR library with properly setup SPI configuration as documented in <A href="extending-scr-annotations.html" title="Extending SCR Annotations">Extending SCR Annotations</A>.</P>


<H2><A name="ApacheFelixSCRAntTaskUse-Example"></A>Example</H2>

<P>The following is very simple example build file based on the <A href="http://svn.apache.org/repos/asf/sling/trunk/bundles/jcr/webconsole" class="external-link" rel="nofollow">Apache Sling JCR WebConsole</A> bundle:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;project default=<SPAN class="code-quote">&quot;scr&quot;</SPAN> basedir=<SPAN class="code-quote">&quot;.&quot;</SPAN>&gt;</SPAN>

  &lt;taskdef resource=<SPAN class="code-quote">&quot;scrtask.properties&quot;</SPAN>
      classpath=<SPAN class="code-quote">&quot;org.apache.felix.scr.ant-1.0.0-SNAPSHOT.jar&quot;</SPAN> /&gt;

  <SPAN class="code-tag">&lt;target name=<SPAN class="code-quote">&quot;init&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;property name=<SPAN class="code-quote">&quot;src&quot;</SPAN> value=<SPAN class="code-quote">&quot;src/main/java&quot;</SPAN> /&gt;</SPAN>
    <SPAN class="code-tag">&lt;property name=<SPAN class="code-quote">&quot;classes&quot;</SPAN> value=<SPAN class="code-quote">&quot;target/classes&quot;</SPAN> /&gt;</SPAN>
    <SPAN class="code-tag">&lt;property name=<SPAN class="code-quote">&quot;m2Repo&quot;</SPAN> value=<SPAN class="code-quote">&quot;${user.home}/.m2/repository&quot;</SPAN> /&gt;</SPAN>
    <SPAN class="code-tag">&lt;path id=<SPAN class="code-quote">&quot;dependencies&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;fileset dir=<SPAN class="code-quote">&quot;${m2Repo}&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;include name=<SPAN class="code-quote">&quot;javax/jcr/jcr/1.0/jcr-1.0.jar&quot;</SPAN> /&gt;</SPAN>
        <SPAN class="code-tag">&lt;include name=<SPAN class="code-quote">&quot;org/apache/sling/org.apache.sling.jcr.api/2.0.6/org.apache.sling.jcr.api-2.0.6.jar&quot;</SPAN> /&gt;</SPAN>
        <SPAN class="code-tag">&lt;include name=<SPAN class="code-quote">&quot;org/apache/felix/org.apache.felix.webconsole/3.0.0/org.apache.felix.webconsole-3.0.0.jar&quot;</SPAN> /&gt;</SPAN>
        <SPAN class="code-tag">&lt;include name=<SPAN class="code-quote">&quot;javax/servlet/servlet-api/2.4/servlet-api-2.4.jar&quot;</SPAN> /&gt;</SPAN>
        <SPAN class="code-tag">&lt;include name=<SPAN class="code-quote">&quot;org/apache/felix/org.apache.felix.scr.annotations/1.4.0/org.apache.felix.scr.annotations-1.4.0.jar&quot;</SPAN> /&gt;</SPAN>
      <SPAN class="code-tag">&lt;/fileset&gt;</SPAN>
    <SPAN class="code-tag">&lt;/path&gt;</SPAN>
  <SPAN class="code-tag">&lt;/target&gt;</SPAN>

  <SPAN class="code-tag">&lt;target name=<SPAN class="code-quote">&quot;compile&quot;</SPAN> depends=<SPAN class="code-quote">&quot;init&quot;</SPAN>&gt;</SPAN>
      <SPAN class="code-tag">&lt;mkdir dir=<SPAN class="code-quote">&quot;${classes}&quot;</SPAN> /&gt;</SPAN>
      <SPAN class="code-tag">&lt;javac srcdir=<SPAN class="code-quote">&quot;${src}&quot;</SPAN> destdir=<SPAN class="code-quote">&quot;${classes}&quot;</SPAN> classpathref=<SPAN class="code-quote">&quot;dependencies&quot;</SPAN> /&gt;</SPAN>
  <SPAN class="code-tag">&lt;/target&gt;</SPAN>

  <SPAN class="code-tag">&lt;target name=<SPAN class="code-quote">&quot;scr&quot;</SPAN> depends=<SPAN class="code-quote">&quot;compile&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;scr srcdir=<SPAN class="code-quote">&quot;${src}&quot;</SPAN> destdir=<SPAN class="code-quote">&quot;${classes}&quot;</SPAN> classpathref=<SPAN class="code-quote">&quot;dependencies&quot;</SPAN> /&gt;</SPAN>
  <SPAN class="code-tag">&lt;/target&gt;</SPAN>

  <SPAN class="code-tag">&lt;target name=<SPAN class="code-quote">&quot;clean&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;delete dir=<SPAN class="code-quote">&quot;target&quot;</SPAN> /&gt;</SPAN>
  <SPAN class="code-tag">&lt;/target&gt;</SPAN>

<SPAN class="code-tag">&lt;/project&gt;</SPAN>
</PRE>
</DIV></DIV>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by cziegeler@apache.org on Wed Jun 13 09:14:15 EDT 2012
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
