
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Using the OSGi Compliance Tests</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H1><A name="UsingtheOSGiComplianceTests-UsingtheOSGiComplainceTests"></A>Using the OSGi Complaince Tests</H1>

<P>The OSGi Alliance now provides Apache committers access to its Compliance Tests (CT). This page describes how to get access to the CTs and how to use them with Felix subprojects.</P>

<H2><A name="UsingtheOSGiComplianceTests-GainingAccesstoOSGiCTs"></A>Gaining Access to OSGi CTs</H2>

<P>The general process is to send a request to the jcp-open@apache.org mailing requesting access. Since redistributing the OSGi CTs is not allowed, you will need to submit an <A href="http://www.apache.org/jcp/ApacheNDA.pdf" class="external-link" rel="nofollow">NDA</A> to be granted access to the <A href="https://svn.apache.org/repos/tck/osgi-cts" class="external-link" rel="nofollow">SVN repo</A> containing the binaries.</P>

<H2><A name="UsingtheOSGiComplianceTests-OSGiCTOverview"></A>OSGi CT Overview</H2>

<P>The CT is delivered as two JAR files, one for the core CT and one for the compendium CT. Each JAR file is composed of several other JAR files, which are the actual compliance tests. Typically, there is one JAR per specification, except for the OSGi framework. The CT uses BND as its testing harness, which in turn uses the OSGi R4.2 framework launching and embedding API to configure, launch, and install test bundles. Each test JAR file has an associated BND file which supplies the configuration BND needs to run the associated tests.</P>

<H2><A name="UsingtheOSGiComplianceTests-ModifyingtheBNDfiles"></A>Modifying the BND files</H2>

<P>Modifying the BND files is fairly straightforward. A typical BND file looks like this:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE># bnd pack for project org.osgi.test.cases.startlevel
# Mon Aug 31 18:50:18 EDT 2009
build=.

-target = \
    jar/org.osgi.test.cases.startlevel-4.2.0.jar;version=file,

-runpath = \
    jar/org.eclipse.osgi-3.5.1.jar;version=file, \
    jar/com.springsource.junit-3.8.2.jar;version=file;export=&quot;junit.framework;version=3.8&quot;

-runbundles

-runproperties = \
report=&quot;true&quot;, \
osgi.compatibility.bootdelegation=&quot;false&quot;, \
osgi.resolverMode=&quot;strict&quot;
</PRE>
</DIV></DIV>

<P>The important parts are the following settings:</P>

<UL>
	<LI><TT>-target</TT> specifies the bundles containing the tests.</LI>
	<LI><TT>-runpath</TT> specifies the class path used to run the tests.</LI>
	<LI><TT>-runbundles</TT> specifies the bundles to install for the tests.</LI>
	<LI><TT>-runproperties</TT> specifies configuration properties to pass into the framework.</LI>
</UL>


<P>The following two examples show how to edit these files for the Felix framework and Felix bundle subprojects.</P>

<H2><A name="UsingtheOSGiComplianceTests-TestingtheFelixframework"></A>Testing the Felix framework</H2>

<P>The Felix framework is tested against the core CT. The first thing to do is extract the core CT JAR file, which includes test suites for:</P>

<UL>
	<LI>Framework core (mandatory)</LI>
	<LI>Framework security (optional)</LI>
	<LI>Framework launching (mandatory)</LI>
	<LI>Framework launching security (optional)</LI>
	<LI>Package Admin (optional)</LI>
	<LI>Start Level (optional)</LI>
	<LI>URL Handlers (optional)</LI>
	<LI>Permission Admin (optional)</LI>
	<LI>Conditional Permission Admin (optional)</LI>
</UL>


<P>For each of the associated BND files, the <TT>-runpath</TT> needs to be edited to refer to the Felix framework; each one should look something like this after editing:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>-runpath = \
    /path/to/felix/framework/org.apache.felix.framework-2.0.2.jar;version=file, \
    jar/com.springsource.junit-3.8.2.jar;version=file;export=&quot;junit.framework;version=3.8&quot;
</PRE>
</DIV></DIV>

<P>Typically, it is not necessary to change anything else in the BND files and it is normal that the <TT>-runbundles</TT> setting is empty, since there are no additional bundles associated with testing the framework. The exception to this is for the framework test suites for security. To test with security enabled, you will need to add the framework security provider in <TT>-runbundles</TT> like this:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>-runbundles = \
    /path/to/felix/framework.security/org.apache.felix.framework.security-1.0.0.jar.jar;version=file
</PRE>
</DIV></DIV>

<P>After editing the BND files, run the tests using:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>source runtests
</PRE>
</DIV></DIV>

<P>This will run all test suites for all BND files. To run a specific test suite, do the following:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>java -jar jar/bnd.jar runtests -title osgi.ct &lt;bnd-file&gt;
</PRE>
</DIV></DIV>

<P>Where <TT>&lt;bnd-file&gt;</TT> specifies one or more BND files associated with the desired test suites.</P>

<DIV class="panelMacro"><TABLE class="noteMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="https://cwiki.apache.org/confluence/images/icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>Be Aware</B><BR>Tests for native code loading will fail on Java 6, so do not use this JDK for testing the framework.</TD></TR></TABLE></DIV>

<P>Reports for the tests suites are generated in the <TT>reports/</TT> subdirectory and are named after the appropriate test suite.</P>

<H2><A name="UsingtheOSGiComplianceTests-TestingaFelixbundle"></A>Testing a Felix bundle</H2>

<P>The core CT tests the framework implementation and its related services. The compendium CT tests the various non-framework-related specifications, which are implemented as bundles. For the most part, testing a bundle is similar to testing the framework.</P>

<P>Extract the compendium CT JAR file to access the individual test suites. Since most compendium service specification test suites require security, it is necessary to use a framework implementation that supports security. For the Felix framework, you will have to add the security provider to the <TT>-runbundles</TT> to enable security. </P>

<P>For example, to test Felix' Event Admin bundle, edit the <TT>-runbundles</TT> setting in <TT>org.osgi.test.cases.event.bnd</TT> to look something like this:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>-runbundles = \
    /path/to/felix/eventadmin/org.apache.felix.eventadmin-1.0.0.jar;version=file,\
    /path/to/felix/framework.security/org.apache.felix.framework.security-1.0.0.jar.jar;version=file
</PRE>
</DIV></DIV>

<P>After editing the BND files to refer to the appropriate bundles, run the tests using:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>source runtests
</PRE>
</DIV></DIV>

<P>This will run all test suites for all BND files. To run a specific test suite, do the following:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>java -jar jar/bnd.jar runtests -title osgi.ct &lt;bnd-file&gt;
</PRE>
</DIV></DIV>

<P>Where <TT>&lt;bnd-file&gt;</TT> specifies one or more BND files associated with the desired test suites. Reports for the tests suites are generated in the <TT>reports/</TT> subdirectory and are named after the appropriate test suite.</P>

<H2><A name="UsingtheOSGiComplianceTests-Feedback"></A>Feedback</H2>

<P>For any questions or feedback, subscribe to the Felix developers mailing list by sending a message to <A href="mailto:dev-subscribe@felix.apache.org" class="external-link" rel="nofollow">dev-subscribe@felix.apache.org</A>; after subscribing, email questions or feedback to <A href="mailto:dev@felix.apache.org" class="external-link" rel="nofollow">dev@felix.apache.org</A>.</P>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by heavy@ungoverned.org on 2010-08-19 16:47:00.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
