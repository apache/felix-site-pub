
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Developing Camel mediators with iPOJO</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css); 
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css); 
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT> 
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT> 

<SCRIPT type="text/javascript"> 
 
    $(document).ready(function(){ 
        $("ul.sf-menu").supersubs({ 
            minWidth:    14,   // minimum width of sub-menus in em units 
            maxWidth:    30,   // maximum width of sub-menus in em units 
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over 
                               // due to slight rounding differences and font-family 
        }).superfish();  // call supersubs first, then superfish, so that subs are 
                         // not display:none when measuring. Call before initialising 
                         // containing tabs for same reason. 
    }); 
 
</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>							
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>	

<LI class="">			
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">					
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="ipojo-composition-tutorial.html" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="combining-ipojo-and-configuration-admin.html" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="apache-felix-ipojo-api.html" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="ipojo-faq.html" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI> 
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL> 
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>   
</LI><!-- End of tools -->	
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->			
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">

<H1><A name="DevelopingCamelmediatorswithiPOJO-DevelopingCamelmediatorswithiPOJO"></A>Developing Camel mediators with iPOJO</H1>
<P><EM>The <A href="http://activemq.apache.org/camel/tutorial-osgi-camel-part1.html" class="external-link" rel="nofollow">Camel OSGi tutorial </A> provides a very simple and neat overview of Camel. This article mentions the usage of iPOJO to implement the mediator. This document provides this implementation.</EM></P>

<H2><A name="DevelopingCamelmediatorswithiPOJO-Step1%3AInitialprojectsetup"></A>Step 1 : Initial project setup</H2>
<P>Instead of using the 'spring-osgi-bundle-archetype' maven archetype, we will use the iPOJO one to create the iPOJO bundle.<BR>
To create the simple iPOJO service project, execute the following command in your Unix/Dos console.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
mvn archetype:create -DarchetypeGroupId=org.apache.felix -DarchetypeArtifactId=maven-ipojo-plugin -DarchetypeVersion=1.0.0 -DgroupId=demo -DartifactId=demo.service-ipojo-bundle -Dversion=0.1
</PRE>
</DIV></DIV>
<H2><A name="DevelopingCamelmediatorswithiPOJO-Step2%3ADeveloptheinterface"></A>Step 2 : Develop the interface</H2>
<P>So now, it is time to create the interface that we will use in the project. Create a new folder &quot;service&quot; in <TT>src/main/java/demo</TT> tree. Add the interface <TT>TransformService.java</TT> and copy paste the code below:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>TransformService.java</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> demo.service;
<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">interface</SPAN> TransformService {
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">Object</SPAN> transform(<SPAN class="code-object">Object</SPAN> obj);
}
</PRE>
</DIV></DIV>
<H2><A name="DevelopingCamelmediatorswithiPOJO-Step3%3ACreatetheclassimplementingtheinterface"></A>Step 3 : Create the class implementing the interface</H2>
<P>Next, we will create the class <TT>TransformServiceImpl</TT> implementing the interface <TT>TransformService</TT>.<BR>
Create the class <TT>TransformServiceImpl.java</TT> in the folder <TT>src/main/java/demo/service/</TT></P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>TransformServiceImpl.java</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> demo.service;

<SPAN class="code-keyword">import</SPAN> java.util.Date;

<SPAN class="code-keyword">import</SPAN> org.apache.commons.logging.Log;
<SPAN class="code-keyword">import</SPAN> org.apache.commons.logging.LogFactory;

<SPAN class="code-keyword">public</SPAN> class TransformServiceImpl <SPAN class="code-keyword">implements</SPAN> TransformService {
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-keyword">static</SPAN> <SPAN class="code-keyword">final</SPAN> <SPAN class="code-keyword">transient</SPAN> Log LOG = LogFactory.getLog(TransformServiceImpl.class);
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">boolean</SPAN> verbose = <SPAN class="code-keyword">true</SPAN>;
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> prefix = <SPAN class="code-quote">&quot;MyTransform&quot;</SPAN>;

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">Object</SPAN> transform(<SPAN class="code-object">Object</SPAN> body) {
        <SPAN class="code-object">String</SPAN> answer = prefix + <SPAN class="code-quote">&quot; set body:  &quot;</SPAN> + <SPAN class="code-keyword">new</SPAN> Date();
        <SPAN class="code-keyword">if</SPAN> (verbose) {
            <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;&gt;&gt; call &gt;&gt; &quot;</SPAN> + answer);
        }
        LOG.info(<SPAN class="code-quote">&quot;&gt;&gt; call &gt;&gt;&quot;</SPAN> + answer);
        <SPAN class="code-keyword">return</SPAN> answer;
    }

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">boolean</SPAN> isVerbose() {
        <SPAN class="code-keyword">return</SPAN> verbose;
    }

    <SPAN class="code-keyword">public</SPAN> void setVerbose(<SPAN class="code-object">boolean</SPAN> verbose) {
        <SPAN class="code-keyword">this</SPAN>.verbose = verbose;
    }

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">String</SPAN> getPrefix() {
        <SPAN class="code-keyword">return</SPAN> prefix;
    }

    <SPAN class="code-keyword">public</SPAN> void setPrefix(<SPAN class="code-object">String</SPAN> prefix) {
        <SPAN class="code-keyword">this</SPAN>.prefix = prefix;
    }
}
</PRE>
</DIV></DIV>
<H2><A name="DevelopingCamelmediatorswithiPOJO-Step4%3ACreatetheiPOJOconfigurationfiles"></A>Step 4 : Create the iPOJO configuration files</H2>
<P>The next step concerns the creation of the iPOJO configuration file who will allow the registration of the <TT>TranformService</TT> as an OSGi service.<BR>
Create or edit the file metadata.xml in the folder src/main/resources/</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>metadata.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;?xml version=<SPAN class="code-quote">&quot;1.0&quot;</SPAN> encoding=<SPAN class="code-quote">&quot;UTF-8&quot;</SPAN>?&gt;</SPAN>
<SPAN class="code-tag">&lt;ipojo&gt;</SPAN>
	<SPAN class="code-tag">&lt;component classname=<SPAN class="code-quote">&quot;demo.service.TransformServiceImpl&quot;</SPAN> name=<SPAN class="code-quote">&quot;my-ipojo-transformer&quot;</SPAN>&gt;</SPAN>
   		<SPAN class="code-tag">&lt;provides/&gt;</SPAN>
	<SPAN class="code-tag">&lt;/component&gt;</SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;my-ipojo-transformer&quot;</SPAN>/&gt;</SPAN>
<SPAN class="code-tag">&lt;/ipojo&gt;</SPAN>
</PRE>
</DIV></DIV>
<H2><A name="DevelopingCamelmediatorswithiPOJO-Step5%3AGeneratethebundle"></A>Step 5 : Generate the bundle</H2>
<P>Before generating the bundle, we need to edit the <TT>pom.xml</TT> file to describe our bundle.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>pom.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;project&gt;</SPAN>
  <SPAN class="code-tag">&lt;modelVersion&gt;</SPAN>4.0.0<SPAN class="code-tag">&lt;/modelVersion&gt;</SPAN>
  <SPAN class="code-tag">&lt;packaging&gt;</SPAN>bundle<SPAN class="code-tag">&lt;/packaging&gt;</SPAN>
  <SPAN class="code-tag">&lt;groupId&gt;</SPAN>demo<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
  <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>demo.service-ipojo-bundle<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
  <SPAN class="code-tag">&lt;version&gt;</SPAN>0.1<SPAN class="code-tag">&lt;/version&gt;</SPAN>
  <SPAN class="code-tag">&lt;name&gt;</SPAN>demo.service-ipojo-bundle<SPAN class="code-tag">&lt;/name&gt;</SPAN>
  
  <SPAN class="code-tag">&lt;build&gt;</SPAN>
    <SPAN class="code-tag">&lt;plugins&gt;</SPAN>
      <SPAN class="code-tag">&lt;plugin&gt;</SPAN>
        <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
        <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-bundle-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
        <SPAN class="code-tag">&lt;version&gt;</SPAN>1.4.2<SPAN class="code-tag">&lt;/version&gt;</SPAN>
        <SPAN class="code-tag">&lt;extensions&gt;</SPAN>true<SPAN class="code-tag">&lt;/extensions&gt;</SPAN>
        <SPAN class="code-tag">&lt;configuration&gt;</SPAN>
          <SPAN class="code-tag">&lt;instructions&gt;</SPAN>
            <SPAN class="code-tag">&lt;Bundle-SymbolicName&gt;</SPAN>${pom.artifactId}<SPAN class="code-tag">&lt;/Bundle-SymbolicName&gt;</SPAN>
            <SPAN class="code-tag">&lt;Import-Package&gt;</SPAN>*<SPAN class="code-tag">&lt;/Import-Package&gt;</SPAN>
            <SPAN class="code-tag">&lt;Export-Package&gt;</SPAN>*<SPAN class="code-tag">&lt;/Export-Package&gt;</SPAN>
          <SPAN class="code-tag">&lt;/instructions&gt;</SPAN>
        <SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
      <SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
      <SPAN class="code-tag">&lt;plugin&gt;</SPAN>
	      <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
	      <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-ipojo-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
		  <SPAN class="code-tag">&lt;executions&gt;</SPAN>
          	<SPAN class="code-tag">&lt;execution&gt;</SPAN>
            	<SPAN class="code-tag">&lt;goals&gt;</SPAN>
	              <SPAN class="code-tag">&lt;goal&gt;</SPAN>ipojo-bundle<SPAN class="code-tag">&lt;/goal&gt;</SPAN>
               <SPAN class="code-tag">&lt;/goals&gt;</SPAN>
          <SPAN class="code-tag">&lt;/execution&gt;</SPAN>
        <SPAN class="code-tag">&lt;/executions&gt;</SPAN>
      <SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
    <SPAN class="code-tag">&lt;/plugins&gt;</SPAN>
  <SPAN class="code-tag">&lt;/build&gt;</SPAN>
  
  <SPAN class="code-tag">&lt;dependencies&gt;</SPAN>
	  <SPAN class="code-tag">&lt;dependency&gt;</SPAN>
          <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.slf4j<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
          <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>com.springsource.slf4j.org.apache.commons.logging<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
          <SPAN class="code-tag">&lt;version&gt;</SPAN>1.5.0<SPAN class="code-tag">&lt;/version&gt;</SPAN>
          <SPAN class="code-tag">&lt;scope&gt;</SPAN>provided<SPAN class="code-tag">&lt;/scope&gt;</SPAN>
        <SPAN class="code-tag">&lt;/dependency&gt;</SPAN>
        <SPAN class="code-tag">&lt;dependency&gt;</SPAN>
          <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.slf4j<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
          <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>com.springsource.slf4j.api<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
          <SPAN class="code-tag">&lt;version&gt;</SPAN>1.5.0<SPAN class="code-tag">&lt;/version&gt;</SPAN>
          <SPAN class="code-tag">&lt;scope&gt;</SPAN>provided<SPAN class="code-tag">&lt;/scope&gt;</SPAN>
        <SPAN class="code-tag">&lt;/dependency&gt;</SPAN>
        <SPAN class="code-tag">&lt;dependency&gt;</SPAN>
          <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.slf4j<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
          <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>com.springsource.slf4j.log4j<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
          <SPAN class="code-tag">&lt;version&gt;</SPAN>1.5.0<SPAN class="code-tag">&lt;/version&gt;</SPAN>
          <SPAN class="code-tag">&lt;scope&gt;</SPAN>provided<SPAN class="code-tag">&lt;/scope&gt;</SPAN>
          <SPAN class="code-tag">&lt;exclusions&gt;</SPAN>
            <SPAN class="code-tag">&lt;exclusion&gt;</SPAN>
                <SPAN class="code-tag">&lt;groupId&gt;</SPAN>log4j<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
                <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>log4j<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
            <SPAN class="code-tag">&lt;/exclusion&gt;</SPAN>
            <SPAN class="code-tag">&lt;exclusion&gt;</SPAN>
                <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.log4j<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
                <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>com.springsource.org.apache.log4j<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
            <SPAN class="code-tag">&lt;/exclusion&gt;</SPAN>
          <SPAN class="code-tag">&lt;/exclusions&gt;</SPAN>
        <SPAN class="code-tag">&lt;/dependency&gt;</SPAN>
    <SPAN class="code-tag">&lt;/dependencies&gt;</SPAN>
<SPAN class="code-tag">&lt;/project&gt;</SPAN>
</PRE>
</DIV></DIV>
<H2><A name="DevelopingCamelmediatorswithiPOJO-Step6%267%3ACreatetheCamelcontextfileandthebundle"></A>Step 6 &amp; 7: Create the Camel context file and the bundle</H2>
<P>These steps are exactly the same as into the OSGi Camel Tutorial. So refer to the step 6 and 7 of the <A href="http://activemq.apache.org/camel/tutorial-osgi-camel-part1.html" class="external-link" rel="nofollow">article</A>.</P>
<H2><A name="DevelopingCamelmediatorswithiPOJO-Step8%3ADeploythebundles"></A>Step 8: Deploy the bundles</H2>
<P>We will see how to execute the Canel route on ServiceMix Kernel.<BR>
As mentioned in the documentation, <A href="http://servicemix.apache.org/SMX4KNL/index.html" class="external-link" rel="nofollow">Apache ServiceMix Kernel</A> is a small OSGi based runtime which provides a lightweight container onto which various components and applications can be deployed. Moreover, the server provides administration, security, logging and provisioning features that will help you during the deployment and administration steps.<BR>
If this is not yet done, download ServiceMix Kernel 1.0.0 server and install it. Launch the server by executing the command in the bin folder:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
/Users/clement/apache-servicemix-kernel-1.0.0/bin&gt;servicemix
</PRE>
</DIV></DIV>
<P>If this is the first time Servicemix is started, then you will see that a new data folder is created. Notes that this application requires Java 6.<BR>
In order to allow our bundles to work with Camel, execute the following commands to download and install the 'Camel and iPOJO bundles':</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
servicemix&gt; osgi install -s mvn:org.springframework/spring-tx/2.5.5
servicemix&gt; osgi install -s mvn:org.apache.camel/camel-core/1.5.0
servicemix&gt; osgi install -s mvn:org.apache.camel/camel-spring/1.5.0
servicemix&gt; osgi install -s mvn:org.apache.camel/camel-osgi/1.5.0
servicemix&gt; osgi install -s mvn:org.apache.felix/org.apache.felix.ipojo/1.0.0
</PRE>
</DIV></DIV>

<P>Next, copy the two jar files into the deploy folder, first the iPOJO service and next the Camel bundle. After a few seconds, you should see on the Servicemix log console the following text:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
servicemix&gt; &gt;&gt; call &gt;&gt; MyTransform set body:  Sat Dec 27 19:29:16 CET 2008
</PRE>
</DIV></DIV>
<P>Remarks :</P>
<UL>
	<LI>In case of trouble, use the command: osgi list to see if all the deployed bundles are installed correctly and have their status equals to active</LI>
	<LI>To see the log of ServiceMix, use the command: log d
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>
</LI>
</UL>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on 2009-07-26 07:44:01.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
