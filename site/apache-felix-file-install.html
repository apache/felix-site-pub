
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix File Install</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H1><A name="ApacheFelixFileInstall-ApacheFelixFileInstall"></A>Apache Felix File Install</H1>

<P>File Install is a directory based OSGi management agent. It uses a directory in the file system to install and start a bundle when it is first placed there. It updates the bundle when you update the bundle file in the directory and, when the file is deleted, it will stop and uninstall the bundle.</P>

<P>File Install can do the same for configuration configuration files. This surprisingly simple bundle is very powerful because there are so many programs that work with the file system. For example:</P>

<UL>
	<LI>If you use Ant, you can just copy the resulting bundle to the watched directory.</LI>
	<LI>You can download bundles from the web and directly install them without any extra effort.</LI>
	<LI>You can easily drag and drop bundles in and out of the framework.</LI>
</UL>


<H2><A name="ApacheFelixFileInstall-Setup"></A>Setup</H2>

<P>The bundle runs on any framework. For its configuration, it will use the following system properties:</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh">Property</TH>
<TH class="confluenceTh">Default</TH>
<TH class="confluenceTh">Description</TH>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.poll</TT></TD>
<TD class="confluenceTd">2000 ms</TD>
<TD class="confluenceTd">Number of milliseconds between 2 polls of the directory</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.dir</TT></TD>
<TD class="confluenceTd">./load</TD>
<TD class="confluenceTd">The name of the directory to watch. Several directories can be specified by using a comma separated list.</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.log.level</TT></TD>
<TD class="confluenceTd">1</TD>
<TD class="confluenceTd">Threshold of logging information</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.bundles.new.start</TT></TD>
<TD class="confluenceTd">true</TD>
<TD class="confluenceTd">Automatically start newly discovered bundles</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.filter</TT></TD>
<TD class="confluenceTd">&nbsp;</TD>
<TD class="confluenceTd">A regular expression to be used to filter file names</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.tmpdir</TT></TD>
<TD class="confluenceTd">&nbsp;</TD>
<TD class="confluenceTd">The name of the temporary directory to use with exploded or transformed bundles (defaults to the temporary dir for the JVM)</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.noInitialDelay</TT></TD>
<TD class="confluenceTd">false</TD>
<TD class="confluenceTd">Determines if File Install waits <TT>felix.fileinstall.poll</TT> milliseconds before doing an initial scan or not.</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.bundles.startTransient</TT></TD>
<TD class="confluenceTd">false</TD>
<TD class="confluenceTd">If <TT>true</TT>, File Install will start the bundles transiently.</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.bundles.startActivationPolicy</TT></TD>
<TD class="confluenceTd">true</TD>
<TD class="confluenceTd">Start bundles with their default activation policy or not</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.start.level</TT></TD>
<TD class="confluenceTd">0</TD>
<TD class="confluenceTd">If set to a value different from <TT>0</TT>, File Install will set the start level for deployed bundles to that value. If set to <TT>0</TT>, the default framework bundle start level will be used.</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.active.level</TT></TD>
<TD class="confluenceTd">0</TD>
<TD class="confluenceTd">FileInstall won't scan for files unless the active framework start level is greater than this value</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.enableConfigSave</TT></TD>
<TD class="confluenceTd">true</TD>
<TD class="confluenceTd">If <TT>false</TT>, File Install will not write back in the file configurations changes. Note that this setting is global and can not be modified per polled directory.</TD>
</TR>
<TR>
<TD class="confluenceTd"><TT>felix.fileinstall.bundles.updateWithListeners</TT></TD>
<TD class="confluenceTd">false</TD>
<TD class="confluenceTd">If <TT>true</TT>, FileInstall will update managed bundles when a new version of an artifact handler is detected.  This detection is performed based on the last modification date of the bundle registering the handler.</TD>
</TR>
</TBODY></TABLE>
</DIV>



<P>Once started, the values of these properties are printed to the console.</P>

<H2><A name="ApacheFelixFileInstall-Configurations"></A>Configurations</H2>

<P>Configuration files are plain property files (<TT>java.util.Property</TT>). The format is simple:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>file ::= ( header | comment ) *
header ::= &lt;header&gt; ( ':' | '=' ) &lt;value&gt; ( '\&lt;nl&gt; &lt;value&gt; ) *
comment ::= '#' &lt;any&gt;
</PRE>
</DIV></DIV>

<P>Notice that this model only supports string properties. For example:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE># default port
ftp.port = 21
</PRE>
</DIV></DIV>

<P>Configuration file names are related to the PID and factory PID. The structure of the file name is as follows:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>filename ::= &lt;pid&gt; ( '-' &lt;subname&gt; )? '.cfg'
</PRE>
</DIV></DIV>

<P>If the form is <TT>&lt;pid&gt;.cfg</TT>, the file contains the properties for a Managed Service. The <TT>&lt;pid&gt;</TT> is then the PID of the Managed Service. See the Configuration Admin service for details.</P>

<P>When a Managed Service Factory is used, the situation is different. The <TT>&lt;pid&gt;</TT> part then describes the PID of the Managed Service Factory. You can pick any <TT>&lt;subname&gt;</TT>, this bundle will then create an instance for the factory for each unique name. For example:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>com.acme.xyz.cfg // configuration for Managed Service
// com.acme.xyz
com.acme.abc-default.cfg // Managed Service Factory,
// creates an instance for com.acme.abc
</PRE>
</DIV></DIV>

<P>If a configuration managed by File Install is modified, File Install will write the configuration back to a property file to ensure peristence across restarts.</P>

<H2><A name="ApacheFelixFileInstall-Propertysubstitutioninconfigurationfiles"></A>Property substitution in configuration files</H2>

<P>It is possible to use system properties to specify the values of properties in configuration files. This is achieved through system property substitution, which is instigated by using <TT>${&lt;property&gt;</TT>} syntax, where &lt;property&gt; is the name of a system property to substitute.  Bundle context properties will take precedence over system properties if available.<BR>
Example:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>ftp.port = ${system.ftp.port}
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixFileInstall-WatchingmultipledirectorieswithFileInstall"></A>Watching multiple directories with File Install</H2>

<P>Starting with version 3.1.0 it is possible to specify several directories to watch with the system property <TT>felix.fileinstall.dir</TT>; this property can either point to a single directory or a comma separated list of directories. In addition, Apache Felix File Install provides a ManagedServiceFactory to create multiple instances of File Install. Asuming you have a File Install bundle watching a <TT>bundles</TT> folder, creating a new instance is as simple as creating a new configuration file <TT>org.apache.felix.fileinstall-&lt;pid&gt;.cfg</TT> in that folder (substitute &lt;pid&gt; with a unique Id for the new service instance):</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>org.apache.felix.fileinstall-configDir.cfg</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
felix.fileinstall.poll=2000
felix.fileinstall.dir=/configDir
felix.fileinstall.debug=-1
felix.fileinstall.filter=.*\\.cfg
felix.fileinstall.bundles.<SPAN class="code-keyword">new</SPAN>.start=<SPAN class="code-keyword">false</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixFileInstall-Explodedbundles"></A>Exploded bundles</H2>

<P>Apache Felix File Install has the ability to watch for exploded bundles and automatically update such bundles if the content is changed in any way.  If a watched directory contains a sub directory, its content will be jar'ed and deployed to the OSGi framework.  Any change to a file in this directory or one of its subdirectories will result in the directory to be jar'ed again and the corresponding bundle to be updated.</P>

<H2><A name="ApacheFelixFileInstall-Customartifacts"></A>Custom artifacts</H2>

<P>Apache Felix File Install can support deployment of custom artifacts.  By default, configurations and plain OSGi bundles are supported, but other kind of artifacts can be deployed through custom artifact handlers.</P>

<P>To add support for a custom artifact, a service implementing one of <TT>org.apache.felix.fileinstall.ArtifactListener</TT>'s sub interfaces must be registered in the OSGi registry.</P>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by gnodet on Mon Jun 11 11:44:58 EDT 2012
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
