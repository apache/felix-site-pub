
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - apache-felix-ipojo-junit4osgi-maven</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css); 
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css); 
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT> 
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT> 

<SCRIPT type="text/javascript"> 
 
    $(document).ready(function(){ 
        $("ul.sf-menu").supersubs({ 
            minWidth:    14,   // minimum width of sub-menus in em units 
            maxWidth:    30,   // maximum width of sub-menus in em units 
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over 
                               // due to slight rounding differences and font-family 
        }).superfish();  // call supersubs first, then superfish, so that subs are 
                         // not display:none when measuring. Call before initialising 
                         // containing tabs for same reason. 
    }); 
 
</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>							
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>	

<LI class="">			
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">					
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="ipojo-composition-tutorial.html" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="combining-ipojo-and-configuration-admin.html" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="apache-felix-ipojo-api.html" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="ipojo-faq.html" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI> 
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL> 
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>   
</LI><!-- End of tools -->	
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->			
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">

<H1><A name="apache-felix-ipojo-junit4osgi-maven-TheMavenjunit4OSGiplugin"></A>The Maven-junit4OSGi-plugin</H1>

<P><EM>junit4OSGi tests can also be executed automatically during the <TT>integration-test</TT> phase of a maven build process. This page describes the maven-junit4osgi-plugin allowing a seamless maven integration.</EM> </P>

<DIV class="toc"><DIV>
<UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Whatdoesthemavenjunit4osgipluginprovide%253F">What does the maven-junit4osgi-plugin provide?</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Usingtheplugin">Using the plug-in</A></LI>
<UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Downloadandbuildingtheplugin">Download and building the plug-in</A></LI>
</UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Simpleconfiguration">Simple configuration</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Pluginparameter">Plugin parameter</A></LI>
<UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Configuringthesetofbundlestodeploy">Configuring the set of bundles to deploy</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-ConfiguringFelix">Configuring Felix</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Showing%252Fhidingtesttrace">Showing/hiding test trace</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Disabling%252FEnablingtheLogService">Disabling/Enabling the Log Service</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Skippingintegrationtest">Skipping integration-test</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Ignoringfailures">Ignoring failures</A></LI>
</UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Executingtheplugin">Executing the plug-in</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Generatingthereportwebpage">Generating the report web page</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Plugindesign">Plug-in design</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-maven-Conclusion">Conclusion</A></LI>
</UL></DIV></DIV>

<H2><A name="apache-felix-ipojo-junit4osgi-maven-Whatdoesthemavenjunit4osgipluginprovide%3F"></A>What does the maven-junit4osgi-plugin provide?</H2>
<UL>
	<LI>Allows testing OSGi applications</LI>
	<LI>Integrated in a Maven-based build process</LI>
	<LI>Provides the same output as Surefire</LI>
	<LI>Supports Maven site generation</LI>
</UL>


<H2><A name="apache-felix-ipojo-junit4osgi-maven-Usingtheplugin"></A>Using the plug-in</H2>

<H3><A name="apache-felix-ipojo-junit4osgi-maven-Downloadandbuildingtheplugin"></A>Download and building the plug-in</H3>
<P>The plug-in sources are available in the iPOJO trunk.<BR>
However the junit4osgi and iPOJO runtime are also required. So, download the source of iPOJO:<BR>
<TT>svn co <A href="http://svn.apache.org/repos/asf/felix/trunk/ipojo/" class="external-link" rel="nofollow">http://svn.apache.org/repos/asf/felix/trunk/ipojo/</A></TT><BR>
To compile it, run the following commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
cd ipojo
mvn clean install -Pexamples
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-junit4osgi-maven-Simpleconfiguration"></A>Simple configuration</H2>
<P>So, first the project using the plug-in is not the project under test. It's another project containing either only integration-test packaged in a bundle, or is empty (and so depends on other bundles containing integration tests).<BR>
Tests contained in the project are developed with junit4osgi, and are packaged in a bundle with the maven-bundle-plugin.<BR>
In the pom file, add the following plugin configuration to use the maven-junit4osgi-plugin:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;plugin&gt;</SPAN>
<SPAN class="code-tag">&lt;groupid&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupid&gt;</SPAN>
<SPAN class="code-tag">&lt;artifactid&gt;</SPAN>maven-junit4osgi-plugin<SPAN class="code-tag">&lt;/artifactid&gt;</SPAN>
<SPAN class="code-tag">&lt;executions&gt;</SPAN>
<SPAN class="code-tag">&lt;execution&gt;</SPAN>
<SPAN class="code-tag">&lt;goals&gt;</SPAN>
      <SPAN class="code-tag">&lt;goal&gt;</SPAN>test<SPAN class="code-tag">&lt;/goal&gt;</SPAN>
<SPAN class="code-tag">&lt;/goals&gt;</SPAN>
<SPAN class="code-tag">&lt;configuration&gt;</SPAN>
<SPAN class="code-tag">&lt;deployprojectartifact&gt;</SPAN>true<SPAN class="code-tag">&lt;/deployprojectartifact&gt;</SPAN>
<SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
<SPAN class="code-tag">&lt;/execution&gt;</SPAN>
<SPAN class="code-tag">&lt;/executions&gt;</SPAN>
<SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-junit4osgi-maven-Pluginparameter"></A>Plugin parameter</H2>
<P>The plug-in has only one parameter. The <TT>deployProjectArtifact</TT> parameter enables or disables the current artifact deployment. If the current project contains tests, the plug-in can deploy the built artifact (as illustrated in this pom). Otherwise, the current project artifact is not deployed. This can be useful if the project just depends on other test bundles and sets the test configuration (as this pom).</P>

<H3><A name="apache-felix-ipojo-junit4osgi-maven-Configuringthesetofbundlestodeploy"></A>Configuring the set of bundles to deploy</H3>
<P>There is two different ways to configure the plug-in to deploy other bundles. If the bundle to deploy is a maven artifact, just add this artifact as a maven project dependency. Here is an example:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;dependency&gt;</SPAN>  
    <SPAN class="code-tag">&lt;artifactid&gt;</SPAN>tests.manipulation.metadata<SPAN class="code-tag">&lt;/artifactid&gt;</SPAN>  
    <SPAN class="code-tag">&lt;groupid&gt;</SPAN>ipojo.tests<SPAN class="code-tag">&lt;/groupid&gt;</SPAN>  
    <SPAN class="code-tag">&lt;version&gt;</SPAN>1.1.0-SNAPSHOT<SPAN class="code-tag">&lt;/version&gt;</SPAN>  
<SPAN class="code-tag">&lt;/dependency&gt;</SPAN>  
</PRE>
</DIV></DIV>

<P>If your bundle is not a maven artifact, you can configure the plugin with the bundle URL (from where the bundle will be deployed)</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;configuration&gt;</SPAN>
<SPAN class="code-tag">&lt;deployprojectartifact&gt;</SPAN>true<SPAN class="code-tag">&lt;/deployprojectartifact&gt;</SPAN>
<SPAN class="code-tag">&lt;bundles&gt;</SPAN>
<SPAN class="code-tag">&lt;param&gt;</SPAN>file:/Users/clement/bundles/test-metadata.jar<SPAN class="code-tag">&lt;/param&gt;</SPAN>
<SPAN class="code-tag">&lt;/bundles&gt;</SPAN>
<SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>Set bundles are installed and started. You can depend on bundle that does not contain test as well as bundle containing tests.</P>

<H3><A name="apache-felix-ipojo-junit4osgi-maven-ConfiguringFelix"></A>Configuring Felix</H3>
<P>It is also possible to set Felix properties in the configuration:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;configuration&gt;</SPAN>
    <SPAN class="code-tag">&lt;configuration&gt;</SPAN>
	<SPAN class="code-tag">&lt;org.osgi.http.port&gt;</SPAN>8083<SPAN class="code-tag">&lt;/org.osgi.http.port&gt;</SPAN>
    <SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
<SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
</PRE>
</DIV></DIV>

<H3><A name="apache-felix-ipojo-junit4osgi-maven-Showing%2Fhidingtesttrace"></A>Showing/hiding test trace</H3>
<P>The plugin collects System.out, System.err and logged messages to write them in the test report. Moreover, the plugin allows hiding traces when tests are executed. To achieve this just add the <TT>hideOutputs</TT> parameter.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;configuration&gt;</SPAN>
    <SPAN class="code-tag">&lt;hideOutputs&gt;</SPAN>true<SPAN class="code-tag">&lt;/hideOutputs&gt;</SPAN>
<SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
</PRE>
</DIV></DIV>

<H3><A name="apache-felix-ipojo-junit4osgi-maven-Disabling%2FEnablingtheLogService"></A>Disabling/Enabling the Log Service</H3>
<P>The plugin exposed a LogService in the OSGi framework to collects logged messaged. This service enabled by default. You can diable it by launching the plugin with the <TT>logService</TT> property set to <TT>false</TT></P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
mvn clean integration-test -DlogService=false
</PRE>
</DIV></DIV>

<H3><A name="apache-felix-ipojo-junit4osgi-maven-Skippingintegrationtest"></A>Skipping integration-test</H3>
<P>Sometimes you want to skip tests <IMG class="emoticon" src="https://cwiki.apache.org/confluence/images/icons/emoticons/sad.gif" height="20" width="20" align="absmiddle" alt="" border="0">. The plugin uses the <TT>maven.test.skip</TT> property to skip tests such as </P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
mvn clean install -Dmaven.test.skip=true
</PRE>
</DIV></DIV>

<H3><A name="apache-felix-ipojo-junit4osgi-maven-Ignoringfailures"></A>Ignoring failures</H3>
<P>If tests throws errors or have failures, the plugin breaks the Maven build. You can by-pass this behavior by ignoring errors and failures. This is useful during test generation. </P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
mvn clean install -Dmaven.test.failure.ignore=true
</PRE>
</DIV></DIV>
<H2><A name="apache-felix-ipojo-junit4osgi-maven-Executingtheplugin"></A>Executing the plug-in</H2>
<P>To execute test, just launch the <TT>mvn clean integration-test</TT> command.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building iPOJO Primitive Manipulation Test Suite
[INFO]    task-segment: [integration-test]
[INFO] ------------------------------------------------------------------------
[INFO] [resources:resources]
[INFO] Using default encoding to copy filtered resources.
[INFO] [compiler:compile]
[INFO] Nothing to compile - all classes are up to date
[INFO] [resources:testResources]
[INFO] Using default encoding to copy filtered resources.
[INFO] [compiler:testCompile]
[INFO] No sources to compile
[INFO] [surefire:test]
[INFO] No tests to run.
[INFO] [bundle:bundle]
[INFO] [ipojo:ipojo-bundle {execution: default}]
[INFO] Start bundle manipulation
[INFO] Metadata file : /Users/clement/Documents/workspaces/felix-trunk/ipojo/tests/manipulator/primitives/target/classes/metadata.xml
[INFO] Input Bundle File : /Users/clement/Documents/workspaces/felix-trunk/ipojo/tests/manipulator/primitives/target/tests.manipulation.primitives-1.1.0-SNAPSHOT.jar
[INFO] Bundle manipulation - SUCCESS
[INFO] [junit4osgi:test {execution: default}]
Analyzing org.apache.felix.ipojo - compile
Analyzing org.apache.felix.ipojo.metadata - compile
Analyzing org.osgi.core - compile
Analyzing junit - compile
Analyzing org.apache.felix.ipojo.junit4osgi - compile
Analyzing tests.manipulation.metadata - test

-------------------------------------------------------
T E S T S
-------------------------------------------------------
Deploy : /Users/clement/Documents/workspaces/felix-trunk/ipojo/tests/manipulator/primitives/target/tests.manipulation.primitives-1.1.0-SNAPSHOT.jar
Loading org.apache.felix.ipojo.test.scenarios.manipulation.ManipulationTestSuite
Loading org.apache.felix.ipojo.test.scenarios.manipulation.ManipulationTestSuite
Junit Extender starting ...
Running Manipulation Metadata Test Suite
Tests run: 16, Failures: 0, Errors: 0, Time elapsed: 0 sec
Running Primitive Manipulation Test Suite
Tests run: 17, Failures: 0, Errors: 0, Time elapsed: 0 sec

Results :

Tests run: 33, Failures: 0, Errors:0

Unload test suites [class org.apache.felix.ipojo.test.scenarios.manipulation.ManipulationTestSuite]
Unload test suites [class org.apache.felix.ipojo.test.scenarios.manipulation.ManipulationTestSuite]
Cleaning test suites ...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 6 seconds
[INFO] Finished at: Mon Nov 10 21:30:21 CET 2008
[INFO] Final Memory: 9M/18M
[INFO] ------------------------------------------------------------------------
</PRE>
</DIV></DIV>

<P>Failures and errors are reported in the plugin output.</P>

<H2><A name="apache-felix-ipojo-junit4osgi-maven-Generatingthereportwebpage"></A>Generating the report web page</H2>
<P>When test are executed, the plug-in generates XML reports (int the target/junit4osgi-reports directory) using the same convention as Surefire. So, it is possible to configure Surefire to generate the web page with test results.<BR>
To do this, add the following report configuration to the project executing tests:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;reporting&gt;</SPAN>
<SPAN class="code-tag">&lt;plugins&gt;</SPAN>
<SPAN class="code-tag">&lt;plugin&gt;</SPAN>
<SPAN class="code-tag">&lt;groupid&gt;</SPAN>org.apache.maven.plugins<SPAN class="code-tag">&lt;/groupid&gt;</SPAN>
<SPAN class="code-tag">&lt;artifactid&gt;</SPAN>maven-surefire-report-plugin<SPAN class="code-tag">&lt;/artifactid&gt;</SPAN>
<SPAN class="code-tag">&lt;version&gt;</SPAN>2.4.3<SPAN class="code-tag">&lt;/version&gt;</SPAN>
<SPAN class="code-tag">&lt;configuration&gt;</SPAN>
<SPAN class="code-tag">&lt;showsuccess&gt;</SPAN>true<SPAN class="code-tag">&lt;/showsuccess&gt;</SPAN>
<SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
<SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
<SPAN class="code-tag">&lt;/plugins&gt;</SPAN>
<SPAN class="code-tag">&lt;/reporting&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>This snippet configures the maven-surefire-report-plugin to collect results from the 'target/surefire-reports' directory.<BR>
Then execute the plugin with the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-none">
mvn org.apache.maven.plugins:maven-surefire-report-plugin:2.4.3:report
</PRE>
</DIV></DIV>

<P>This command generates the web page with test results in 'target/site'. This page shows an example of page generated with this command.</P>

<H2><A name="apache-felix-ipojo-junit4osgi-maven-Plugindesign"></A>Plug-in design</H2>
<P>The plug-in is quiet simple, it just starts an embedded Felix with a special activator installing and starting the junit4osgi framework and specified bundles.<BR>
Then, before executing test, the plug-in waits for &quot;stability&quot;. Indeed, as bundle activation can be asynchronous, the plug-in need to wait that the configuration is stable. Stability is obtained when all bundles are activated, and no new services appear or disappear on a 500 ms period. If after several second the stability cannot be reached, the plug-in stops.<BR>
Once the stability is reached, the junit4ogsi runner service is used to execute tests. Then results are collected and reports are generated.</P>

<H2><A name="apache-felix-ipojo-junit4osgi-maven-Conclusion"></A>Conclusion</H2>
<P>This page has presented a front-end automating the execution of junit4osgi tests. Now it is possible to integrate OSGi application tests in a build process. The presented maven plugin provides following features:</P>
<UL>
	<LI>An easy integration in a Maven-based build process</LI>
	<LI>A good flexibility allowing reproducing production execution environments to test the application</LI>
	<LI>Test result output is the same as surefire</LI>
	<LI>Is able to generate Surefire-like reports
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>
</LI>
</UL>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on 2010-04-27 01:53:44.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
