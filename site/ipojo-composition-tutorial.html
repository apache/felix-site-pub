
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - iPOJO Composition Tutorial</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css);
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css);
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT>

<SCRIPT type="text/javascript">

    $(document).ready(function(){
        $("ul.sf-menu").supersubs({
            minWidth:    14,   // minimum width of sub-menus in em units
            maxWidth:    30,   // maximum width of sub-menus in em units
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over
                               // due to slight rounding differences and font-family
        }).superfish();  // call supersubs first, then superfish, so that subs are
                         // not display:none when measuring. Call before initialising
                         // containing tabs for same reason.
    });

</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>

<LI class="">
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="combining-ipojo-and-configuration-admin.html" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="apache-felix-ipojo-api.html" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="ipojo-faq.html" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI>
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL>
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>
</LI><!-- End of tools -->
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">

    <div style="
    background-color: #fdf7f7;
    border-color: #d9534f;
    margin: 40px 0;
    padding: 20px;
    border-left: 5px solid #d9534f;">
        <h4 style="margin-top: 0;
        font-size: 18px;
        margin-bottom: 5px;
        margin-top: 0;
        margin-bottom: 10px;
        font-weight: 500;
        line-height: 1.1;
        color: inherit;">The iPOJO documentation has moved </h4>
        <p style="margin-top: 0px; padding-top: 0px; margin-bottom: 0px;">
            The new web site is <a href="http://ipojo.org">here</a>, update your bookmark.</p>
    </div>

<H1><A name="iPOJOCompositionTutorial-iPOJOCompositionTutorial"></A>iPOJO Composition Tutorial</H1>
<P><EM>This page describes how works the composition mechanisms provided by iPOJO and how to use it. this feature allows you to design applications that will natively support the dynamism and the evolution.</EM></P>

<DIV class="toc"><DIV>
<UL>
    <LI><A href="#iPOJOCompositionTutorial-Whyprovidingacompositionlayer%253F">Why providing a composition layer?</A></LI>
<UL>
    <LI><A href="#iPOJOCompositionTutorial-Whataboutprivacy%253F">What about privacy?</A></LI>
</UL>
    <LI><A href="#iPOJOCompositionTutorial-ThedifferenttypesofcompositionintheOSGiworld">The different types of composition in the OSGi world</A></LI>
<UL>
    <LI><A href="#iPOJOCompositionTutorial-Intrabundlecomposition">Intra-bundle composition</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Servicebasedcomposition">Service-based composition</A></LI>
</UL>
    <LI><A href="#iPOJOCompositionTutorial-TheiPOJOcompositiontheoryforthedummies">The iPOJO composition theory for the dummies</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Downloads">Downloads</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Let%2527sstartwithafirstcomposition">Let's start with a first composition</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Importingaserviceinsideacomposite">Importing a service inside a composite</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Abstractingimplementation...Composingservices">Abstracting implementation... Composing services</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Publishingservices">Publishing services</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Hierarchicalcomposites">Hierarchical composites</A></LI>
    <LI><A href="#iPOJOCompositionTutorial-Conclusion">Conclusion</A></LI>
</UL></DIV></DIV>

<H2><A name="iPOJOCompositionTutorial-Whyprovidingacompositionlayer%3F"></A>Why providing a composition layer?</H2>
<P>iPOJO aims to simplify the creation of OSGi (dynamic) applications. Creating such as applications is basically a two steps process:</P>
<UL>
	<LI>Developing services and components</LI>
	<LI>Assembling them together to create the application</LI>
</UL>


<P>To tackle the first step, iPOJO provides an easy-to-use development model. But, this does not help to design the application. To conduct the second step, iPOJO provides a composition language allowing to:</P>
<UL>
	<LI>Assemble components and services together</LI>
	<LI>Assert service isolation inside a composition</LI>
	<LI>Hide/Abstract implementations</LI>
</UL>


<H3><A name="iPOJOCompositionTutorial-Whataboutprivacy%3F"></A>What about privacy?</H3>
<P>Service or component composition has a stringent requirement. How to isolate components and services of an application to avoid side effects as an unexpected access to a used service ...iPOJO composites just provide an isolation mechanism. Services provided inside a composite ARE NOT published globally (inside the OSGi service registry). So, only the component instances living in the same composite can access to those services.<BR>
However, it is also possible to import a service from the parent/global service registry, as well as to export a service to the parent (i.e. superior) composite.</P>

<H2><A name="iPOJOCompositionTutorial-ThedifferenttypesofcompositionintheOSGiworld"></A>The different types of composition in the OSGi world</H2>
<P>Basically there is two types of composition in OSGi:</P>
<UL>
	<LI>The intra-bundle composition</LI>
	<LI>The service-based composition</LI>
</UL>


<H3><A name="iPOJOCompositionTutorial-Intrabundlecomposition"></A>Intra-bundle composition</H3>
<P>The intra-bundle composition is the policy followed by Spring-DM. Each bundle contains components. These components can require and provide services from the global (OSGi) registry. Moreover, these components can collaborate together inside the bundle without providing/requiring services. So the isolation scope of intra-bundle composition is the <B>bundle</B>. This type of composition allows providing coarse-grain services provided by the collaboration of several components. However, it is not possible to update one of those components, as the update unity is the bundle.</P>

<H3><A name="iPOJOCompositionTutorial-Servicebasedcomposition"></A>Service-based composition</H3>
<P>There are two types of service composition. The behavioral service composition is like <A href="http://www.ibm.com/developerworks/library/specification/ws-bpel/" class="external-link" rel="nofollow">BPEL</A> for the web services. An orchestrator supervises the execution and the collaboration of services like:</P>
<OL>
	<LI>Call service A</LI>
	<LI>Call service B</LI>
	<LI>...</LI>
</OL>


<P>The second type of service composition is the structural service composition. This aims to provide a kind of Architecture Description Language for service-based applications. iPOJO follows this trend. This way as several advantages:</P>
<UL>
	<LI>Avoids coupling a composition to specific implementation, and so it supports the dynamic substitution</LI>
	<LI>Allows the evolution of used services and components at runtime<BR>
This is also the way followed by <A href="http://www.ibm.com/developerworks/library/specification/ws-sca/" class="external-link" rel="nofollow">SCA</A>. However, SCA does not specify how the dynamism should be handled.</LI>
</UL>


<H2><A name="iPOJOCompositionTutorial-TheiPOJOcompositiontheoryforthedummies"></A>The iPOJO composition theory for the dummies</H2>
<P>The distinction between component types and instances<BR>
When you declare a <TT>&lt;component&gt;</TT> (or a <TT>&lt;composite&gt;</TT>) in your metadata, you're declaring a component type. Then you declare instances from these component types. This mechanism is critic for the iPOJO composition. Indeed, inside a composite, you're able to create instances from any (public) component types (Refer to the <A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factory</A> web page for further details). <BR>
On the top of this mechanism, we can define the concept of service implementation. A service implementation is just a component type where the instances provide a service. For example, if the instance from a component type provides the service S, the component type is a service implementation of S, and so can be used to create a provider of S. <BR>
The service context concept<BR>
The service context is the concept allowing service isolation. OSGi bundle context allows accessing both to bundle-based functionality (like <TT>loadClass</TT>) and to the service registry. However, OSGi defines only one service registry, accessible by any bundles. iPOJO splits these two interaction types. Instances receive an iPOJO Bundle Context delegating bundle-related methods to the &quot;regular&quot; bundle context, and service-related methods to a service context. This service context can access to the OSGi service registry or to a new one. Each composition instances have a service registry. Instances creates inside the composition used this service registry through received the iPOJO Bundle Context. </P>

<H2><A name="iPOJOCompositionTutorial-Downloads"></A>Downloads</H2>
<P>Download the <A href="http://people.apache.org/~clement/ipojo/tutorials/composite/composite-tutorial.zip" class="external-link" rel="nofollow">archive</A>. This archive contains:</P>
<UL>
	<LI>The different applications and component types implemented in this tutorial</LI>
	<LI>A preconfigured version of Felix</LI>
	<LI>Deployment scripts</LI>
</UL>


<P>Launch <TT>ant</TT> from the base directory of the unzipped archive to create every bundles. Then, you can test the different examples by copying and pasting commands from the <TT>script.txt</TT> file (in the felix folder) in the Felix shell.</P>

<H2><A name="iPOJOCompositionTutorial-Let%27sstartwithafirstcomposition"></A>Let's start with a first composition</H2>
<P>In the <A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A> tutorial, we created an application checking a sentence against dictionaries. We'll reuse this simple application in this tutorial. <BR>
So first, we need to implements several component types:</P>
<UL>
	<LI>The dictionary service implementation, containing words</LI>
	<LI>The Check service implementation, providing methods to check words against dictionaries</LI>
	<LI>And the client GUI, using a Check Service to indicate misspelled words.</LI>
</UL>


<P>We will reuse the same implementation than in the previous tutorial. The current application is designed as follow:<BR>
<SPAN class="image-wrap" style=""><IMG src="ipojo-composition-tutorial.data/app1.png" style="border: 0px solid black"></SPAN><BR>
However, imagine that you want to isolate services provided and required by your application. For example, you want to isolate a stateful service or a critical (private) resource. <BR>
So, let's imagine a second version of our spellchecker application. In this application, the dictionary service, and the checker service are isolated inside a composite. So, those services will be accessible only from instances living in the composite. The GUI will also be instantiated inside the composite. The composition will be something like:<BR>
<SPAN class="image-wrap" style=""><IMG src="ipojo-composition-tutorial.data/app2.png" style="border: 0px solid black"></SPAN><BR>
The descriptor of this application is:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;ipojo&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Declares a composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;composite name=<SPAN class="code-quote">&quot;composition1&quot;</SPAN>&gt;</SPAN>
	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the English dictionary --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.english.EnglishDictionary&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the Checker --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.checker.SpellCheck&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the GUI --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.gui.SpellCheckerGui&quot;</SPAN>/&gt;</SPAN>
<SPAN class="code-tag">&lt;/composite&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of our composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;composition1&quot;</SPAN>/&gt;</SPAN>

<SPAN class="code-tag">&lt;/ipojo&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>First, a composite type is declared inside an iPOJO descriptor. A composite contain always a <TT>name</TT> attribute, which is the component type name. Inside the <TT>&lt;composite&gt;&lt;/composite&gt;</TT>, three instances are declared: the three instances used by our application. Remark that these instances are declared as 'regular' instances. The <TT>component</TT> attribute indicates the component type to use. Instances can be configured as regular iPOJO instances. Finally, an instance of our type is also declared. <BR>
To execute our composition, go in the felix directory and launch the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-none">
java -jar bin/felix.jar
</PRE>
</DIV></DIV>
<P>This version of Felix starts with the iPOJO framework, the iPOJO Arch command and the composite support. So, we just need to install our component types and the composition.<BR>
In the Felix prompt, launch the following commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-none">
start file:../spell.services/output/spell.services.jar
start file:../spell.english/output/spell.english.jar
start file:../spell.checker/output/spell.checker.jar
start file:../spell.checker.gui/output/spell.checker.gui.jar
</PRE>
</DIV></DIV>
<P>Those commands deploy the component types. Remark that no 'functional'  (i.e. neither Check service, nor Dictionary service) services are provided. Deployed bundles provide only iPOJO Factory services:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-none">
-&gt; inspect s c
System Bundle (0) provides:
---------------------------
org.osgi.service.startlevel.StartLevel
org.osgi.service.packageadmin.PackageAdmin
Apache Felix Shell Service (1) provides:
----------------------------------------
...
Apache Felix Bundle Repository (3) provides:
--------------------------------------------
org.osgi.service.obr.RepositoryAdmin
iPOJO (4) provides:
-------------------
...
iPOJO Composite (6) provides:
-----------------------------
...
spell.english (8) provides:
---------------------------
org.apache.felix.ipojo.Factory, org.osgi.service.cm.ManagedServiceFactory
spell.checker (9) provides:
---------------------------
org.apache.felix.ipojo.Factory, org.osgi.service.cm.ManagedServiceFactory
spell.checker.gui (10) provides:
-------------------------------
org.apache.felix.ipojo.Factory, org.osgi.service.cm.ManagedServiceFactory
</PRE>
</DIV></DIV>
<P>Now, when can deploy our composition:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
start file:../example1/output/composition1.jar
</PRE>
</DIV></DIV>
<P>Once deployed and started, the fancy GUI appears:<BR>
<SPAN class="image-wrap" style=""><IMG src="ipojo-composition-tutorial.data/ss.png" style="border: 0px solid black"></SPAN><BR>
Now, you can check that the functional services are not unavailable outside the composite:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-none">
-&gt; inspect s c
System Bundle (0) provides:
---------------------------
org.osgi.service.startlevel.StartLevel
org.osgi.service.packageadmin.PackageAdmin
Apache Felix Shell Service (1) provides:
----------------------------------------
...
Apache Felix Bundle Repository (3) provides:
--------------------------------------------
org.osgi.service.obr.RepositoryAdmin
iPOJO (4) provides:
-------------------
...
iPOJO Composite (6) provides:
-----------------------------
...
spell.english (8) provides:
---------------------------
org.apache.felix.ipojo.Factory, org.osgi.service.cm.ManagedServiceFactory
spell.checker (9) provides:
---------------------------
org.apache.felix.ipojo.Factory, org.osgi.service.cm.ManagedServiceFactory
spell.checker.gui (10) provides:
-------------------------------
org.apache.felix.ipojo.Factory, org.osgi.service.cm.ManagedServiceFactory
Bundle 11 provides:
-------------------
org.apache.felix.ipojo.Factory, org.osgi.service.cm.ManagedServiceFactory
</PRE>
</DIV></DIV>
<P>Of course, if you stop a bundle providing a required service type, the application is stopped:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; stop 8
-&gt; start 8
</PRE>
</DIV></DIV>
<P>Then, the application also supports component type update. However the component type name must not change. We will see later how we can avoid this issue by abstracting implementations.</P>

<H2><A name="iPOJOCompositionTutorial-Importingaserviceinsideacomposite"></A>Importing a service inside a composite</H2>
<P>Let's imagine a second version of the checker service implementation (spell.checker-v2). This implementation removes the trace when wrong words are detected. Indeed, this implementation uses a log service to store such kind of errors. <BR>
If we use this implementation, we need to make a log service available inside the composite. Else, the checker will not be valid. To achieve this, use the following composite:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;ipojo&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Declares a composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;composite name=<SPAN class="code-quote">&quot;composition2&quot;</SPAN>&gt;</SPAN>
	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the English dictionary --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.english.EnglishDictionary&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the Checker --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.checker.SpellCheck&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the GUI --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.gui.SpellCheckerGui&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- Imports the log service --&gt;</SPAN></SPAN>
	&lt;subservice action=<SPAN class="code-quote">&quot;import&quot;</SPAN>
             specification=<SPAN class="code-quote">&quot;org.osgi.service.log.LogService&quot;</SPAN>/&gt;
<SPAN class="code-tag">&lt;/composite&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of our composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;composition2&quot;</SPAN>/&gt;</SPAN>

<SPAN class="code-tag">&lt;/ipojo&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>This composite just adds a <TT>subservice</TT> nested element. This subservice allows importing a service inside the composite. The <TT>action</TT> attribute specifies that we want to import the service from the parent scope (i.e. superior).   The <TT>specification</TT> attribute indicates the required service. <BR>
<SPAN class="image-wrap" style=""><IMG src="ipojo-composition-tutorial.data/app3.png" style="border: 0px solid black"></SPAN><BR>
Now, relaunch Felix and enter another profile name (<TT>composition2</TT> for example). Once started, executes the following commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
start file:../spell.services/output/spell.services.jar
start file:../spell.english/output/spell.english.jar
start file:../spell.checker-v2/output/spell.checker-v2.jar
start file:../spell.checker.gui/output/spell.checker.gui.jar
start file:../example2/output/composition2.jar
</PRE>
</DIV></DIV>
<P>Those commands deploy required component type (note that we deploy spell.checker-v2) and an implementation of the OSGi Log Service.  When you execute the last command, the fancy interface re-appears. <BR>
Try to enter a wrong word (as <TT>composite</TT>), and click on the check button. The trace does no more appear... the message is logged inside the log service. <BR>
Of course, such composite support dynamism. Try the following scenario</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
stop 9
start 9
stop 10
start 10
</PRE>
</DIV></DIV>
<P>When the log service is stopped, the GUI disappears. In fact, the service can no more be imported, and so, the composition becomes invalid. When you stop a bundle containing a used component type, the same behavior occurs.<BR>
Like in the previous example, you can check that only the log service is globally available. Other services are isolated inside the composite.<BR>
In this case the parent scope is the OSGi service registry, but composite can also contain other composite. In such context, the import tracks services from the superior composite. An example of hierarchical composition is described later in this tutorial.</P>

<DIV class="box">
	<DIV class="box-blue-header">
	<DIV class="box-blue-title">
		<IMG src="http://people.apache.org/~clement/ipojo/site/information.gif"> <B>Service Resolution</B>
	</DIV>
	</DIV>
	<DIV class="box-blue-content">
To tackle implementation service dependency resolution issues, iPOJO instances track services inside the composite but also in the global service context (OSGi service registry).  This feature allows avoiding the declaration of common service import published in the OSGi service registry.
	</DIV>
	<DIV class="box-blue-footer"></DIV>
</DIV>


<H2><A name="iPOJOCompositionTutorial-Abstractingimplementation...Composingservices"></A>Abstracting implementation... Composing services</H2>
<P>We saw in the first composition that we depend on specific component types. This can be avoided by specifying the composition in term of services instead of component types. So, every available service implementation can be used. Moreover, if the used one disappears, another one can be immediately used to replace the missing service. Let's illustrate this.<BR>
In the first composition, we create an instance of the English dictionary service implementation. We can remove this coupling to this specific implementation. To do this, we will target any implementation of the dictionary service regardless the language. </P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;ipojo&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Declares a composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;composite name=<SPAN class="code-quote">&quot;composition3&quot;</SPAN>&gt;</SPAN>
	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the English dictionary --&gt;</SPAN></SPAN>
	&lt;subservice action=<SPAN class="code-quote">&quot;instantiate&quot;</SPAN>
             specification=<SPAN class="code-quote">&quot;spell.services.DictionaryService&quot;</SPAN>/&gt;

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the Checker --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.checker.SpellCheck&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the GUI --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.gui.SpellCheckerGui&quot;</SPAN>/&gt;</SPAN>
<SPAN class="code-tag">&lt;/composite&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of our composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;composition3&quot;</SPAN>/&gt;</SPAN>

<SPAN class="code-tag">&lt;/ipojo&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>The previous composition instantiates a dictionary service.  This means that the composite looks for an implementation of the Dictionary service and creates an instance of this implementation (i.e. component type) inside the composition. <BR>
If several implementations are available, the composite chooses one, and switches to another one if the used implementation becomes unavailable.<BR>
<SPAN class="image-wrap" style=""><IMG src="ipojo-composition-tutorial.data/app4.png" style="border: 0px solid black"></SPAN><BR>
To execute this composition, launch Felix and execute the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
start file:../spell.services/output/spell.services.jar
start file:../spell.english/output/spell.english.jar
start file:../spell.checker/output/spell.checker.jar
start file:../spell.checker.gui/output/spell.checker.gui.jar
start file:../example3/output/composition3.jar
</PRE>
</DIV></DIV>
<P>These commands deploy component types and the composition. Only one implementation of the dictionary service is available (English). You can check this by executing the <TT>service 8</TT> command.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; inspect s c 9
spell.english (9) provides:
---------------------------
component.class = spell.english.EnglishDictionary
component.description = &lt;unknown value type&gt;
component.properties = &lt;unknown value type&gt;
component.providedServiceSpecifications = spell.services.DictionaryService
factory.name = spell.english.EnglishDictionary
factory.state = 1
objectClass = org.apache.felix.ipojo.Factory,
              org.osgi.service.cm.ManagedServiceFactory
service.id = 39
service.pid = spell.english.EnglishDictionary
</PRE>
</DIV></DIV>
<P>Note the <TT>component.providedServiceSpecifications</TT> property indicating provided services. <BR>
Now deploy another implementation of the dictionary service, such as the French dictionary service â˜º</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
start file:../spell.french/output/spell.french.jar
</PRE>
</DIV></DIV>
<P>Write  <TT>welcome</TT> in the GUI and then check. The word is correctly spelled. Then, stop the bundle providing the English dictionary.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
stop 9
</PRE>
</DIV></DIV>
<P>Write <TT>welcome</TT> in the GUI, and check. The word is misspelled! Try to write <TT>bienvenue</TT> and check. The word is correctly spelled. This means that the composite has substitutes the previous English dictionary by the French one. This one will be use until it disappears. If you stop the bundle containing this implementation, the composite becomes invalid.</P>

<H2><A name="iPOJOCompositionTutorial-Publishingservices"></A>Publishing services</H2>
<P>A composition can also provide services. iPOJO composites support two methods to provide services :</P>
<UL>
	<LI>The service export: re-export a service from the composite to the parent context</LI>
	<LI>The service implementation: the composite computes a delegation scheme to delegate every method of the provided service on internal entities (services and instances)</LI>
</UL>


<P>This section addresses the export. Exporting a service is the opposite of the service import. It tracks services from the composites to publish it in the parent (superior) context.<BR>
So, let's imagine a fourth version of our application. In this application, the GUI is externalized and lives in the global context (i.e. OSGi). So, the composition exports the spell checker service. </P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;ipojo&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Declares a composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;composite name=<SPAN class="code-quote">&quot;composition4&quot;</SPAN>&gt;</SPAN>
	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the English dictionary --&gt;</SPAN></SPAN>
	&lt;subservice action=<SPAN class="code-quote">&quot;instantiate&quot;</SPAN>
          specification=<SPAN class="code-quote">&quot;spell.services.DictionaryService&quot;</SPAN>/&gt;

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the Checker --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.checker.SpellCheck&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- Export the SpellChecker service --&gt;</SPAN></SPAN>
	&lt;provides action=<SPAN class="code-quote">&quot;export&quot;</SPAN>
            specification=<SPAN class="code-quote">&quot;spell.services.SpellChecker&quot;</SPAN>/&gt;
<SPAN class="code-tag">&lt;/composite&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of our composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;composition4&quot;</SPAN>/&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the GUI in the global context --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.gui.SpellCheckerGui&quot;</SPAN>/&gt;</SPAN>

<SPAN class="code-tag">&lt;/ipojo&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>In the previous composition, the composite exports the spell checker service. Moreover, the GUI is also created but in the global context. At runtime, the result will be as following:<BR>
<SPAN class="image-wrap" style=""><IMG src="ipojo-composition-tutorial.data/app5.png" style="border: 0px solid black"></SPAN><BR>
The composite published the spell checker service in the OSGi service registry. The GUI tracks this service in the OSGi service registry too.<BR>
To execute this composition, launch Felix and execute following the commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
start file:../spell.services/output/spell.services.jar
start file:../spell.english/output/spell.english.jar
start file:../spell.checker/output/spell.checker.jar
start file:../spell.checker.gui/output/spell.checker.gui.jar
start file:../example4/output/composition4.jar
</PRE>
</DIV></DIV>
<P>You can check that the composition exports the service with the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; services 12
Bundle 12 provides:
-------------------
component.description = &lt;unknown value type&gt;
component.properties = &lt;unknown value type&gt;
component.providedServiceSpecifications = spell.services.SpellChecker
factory.name = composition4
factory.state = 1
objectClass = org.apache.felix.ipojo.Factory,
              org.osgi.service.cm.ManagedServiceFactory
service.id = 36
service.pid = composition4
----
factory.name = composition4
instance.name = composition4-0
objectClass = spell.services.SpellChecker
service.id = 37
</PRE>
</DIV></DIV>
<P>So, now you can play with dynamism. Stop the bundle containing the Check service implementation. The GUI disappears. Restart it. The GUI reappears. Now, stop the bundle containing the GUI implementation. The checker service stills available. Indeed, the GUI is no more inside the composition, and so stills valid despite the unavailability of the GUI:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; stop 9
-&gt; start 9
-&gt; stop 11
-&gt; inspect s c 12
Bundle 12 provides:
-------------------
component.description = &lt;unknown value type&gt;
component.properties = &lt;unknown value type&gt;
component.providedServiceSpecifications = spell.services.SpellChecker
factory.name = composition4
factory.state = 1
objectClass = org.apache.felix.ipojo.Factory,
              org.osgi.service.cm.ManagedServiceFactory
service.id = 36
service.pid = composition4
----
factory.name = composition4
instance.name = composition4-0
objectClass = spell.services.SpellChecker
service.id = 41
-&gt;
</PRE>
</DIV></DIV>
<H2><A name="iPOJOCompositionTutorial-Hierarchicalcomposites"></A>Hierarchical composites</H2>
<P>A composition can also contain others compositions. Let's imagine a variation of the latest application. In this case, we define a composite containing the GUI and the previous composite.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;ipojo&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Declares the same composition than the latest one --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;composite name=<SPAN class="code-quote">&quot;composition4&quot;</SPAN>&gt;</SPAN>
	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the English dictionary --&gt;</SPAN></SPAN>
	&lt;subservice action=<SPAN class="code-quote">&quot;instantiate&quot;</SPAN>
            specification=<SPAN class="code-quote">&quot;spell.services.DictionaryService&quot;</SPAN>/&gt;

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the Checker --&gt;</SPAN></SPAN>
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.checker.SpellCheck&quot;</SPAN>/&gt;</SPAN>

	<SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- Exports the SpellChecker service --&gt;</SPAN></SPAN>
	&lt;provides action=<SPAN class="code-quote">&quot;export&quot;</SPAN>
            specification=<SPAN class="code-quote">&quot;spell.services.SpellChecker&quot;</SPAN>/&gt;
<SPAN class="code-tag">&lt;/composite&gt;</SPAN>

&lt;!--  Declares another composition containing an instance of the previous
      composition and an instance of the GUI
 --&gt;
<SPAN class="code-tag">&lt;composite name=<SPAN class="code-quote">&quot;composition5&quot;</SPAN>&gt;</SPAN>
    &lt;!-- Instantiates the previous composition
         You can access to composition by following the
         same way as for other types
     --&gt;
	<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;composition4&quot;</SPAN>/&gt;</SPAN>

    <SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of the GUI in the composite --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;spell.gui.SpellCheckerGui&quot;</SPAN>/&gt;</SPAN>
<SPAN class="code-tag">&lt;/composite&gt;</SPAN>

<SPAN class="code-tag"><SPAN class="code-comment">&lt;!--  Instantiates an instance of our composition --&gt;</SPAN></SPAN>
<SPAN class="code-tag">&lt;instance component=<SPAN class="code-quote">&quot;composition5&quot;</SPAN>/&gt;</SPAN>

<SPAN class="code-tag">&lt;/ipojo&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>The <TT>composition5</TT> contains an instance of the <TT>composition4</TT> and of the GUI. So the spell checker service exported by the composition4 is published inside the service context of the <TT>composite 5</TT> (the parent context). The GUI instance lives in this service context, and so can access to the exported Spell checker service.<BR>
<SPAN class="image-wrap" style=""><IMG src="ipojo-composition-tutorial.data/app6.png" style="border: 0px solid black"></SPAN><BR>
To execute this composition, restart Felix and launch the following commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
start file:../spell.services/output/spell.services.jar
start file:../spell.english/output/spell.english.jar
start file:../spell.checker/output/spell.checker.jar
start file:../spell.checker.gui/output/spell.checker.gui.jar
start file:../example5/output/composition5.jar
</PRE>
</DIV></DIV>
<P>You can check that the composite does no more publish the spell checker service in the OSGi service registry.</P>

<H2><A name="iPOJOCompositionTutorial-Conclusion"></A>Conclusion</H2>

<P>This page has presented how to use iPOJO composition model. Several topics were not addressed and will be added shortly:</P>
<UL>
	<LI>Dynamic service implementation</LI>
	<LI>The dependency model</LI>
	<LI><EM>Composable</EM> services and composition consistency</LI>
	<LI>Context-awareness</LI>
</UL>


<P>Subscribe to the Felix users mailing list by sending a message to <A href="mailto:users-subscribe@felix.apache.org" class="external-link" rel="nofollow">users-subscribe@felix.apache.org</A>; after subscribing, email questions or feedback to <A href="mailto:users@felix.apache.org" class="external-link" rel="nofollow">users@felix.apache.org</A>.
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">
<BR class="atl-forced-newline"></P>

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on 2010-05-01 07:55:53.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
