
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - iPOJO FAQ</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css);
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css);
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT>

<SCRIPT type="text/javascript">

    $(document).ready(function(){
        $("ul.sf-menu").supersubs({
            minWidth:    14,   // minimum width of sub-menus in em units
            maxWidth:    30,   // maximum width of sub-menus in em units
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over
                               // due to slight rounding differences and font-family
        }).superfish();  // call supersubs first, then superfish, so that subs are
                         // not display:none when measuring. Call before initialising
                         // containing tabs for same reason.
    });

</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>

<LI class="">
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="ipojo-composition-tutorial.html" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="combining-ipojo-and-configuration-admin.html" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="apache-felix-ipojo-api.html" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI>
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL>
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>
</LI><!-- End of tools -->
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">

    <div style="
    background-color: #fdf7f7;
    border-color: #d9534f;
    margin: 40px 0;
    padding: 20px;
    border-left: 5px solid #d9534f;">
        <h4 style="margin-top: 0;
        font-size: 18px;
        margin-bottom: 5px;
        margin-top: 0;
        margin-bottom: 10px;
        font-weight: 500;
        line-height: 1.1;
        color: inherit;">The iPOJO documentation has moved </h4>
        <p style="margin-top: 0px; padding-top: 0px; margin-bottom: 0px;">
            The new web site is <a href="http://ipojo.org">here</a>, update your bookmark.</p>
    </div>


<H1><A name="iPOJOFAQ-ApacheFelixiPOJOFAQ"></A>Apache Felix iPOJO FAQ</H1>

<DIV class="toc"><DIV>
<UL>
    <LI><A href="#iPOJOFAQ-InjectingthebundlecontextinaPOJO">Injecting the bundle context in a POJO</A></LI>
    <LI><A href="#iPOJOFAQ-Accessingservicesinsideinnerandanonymousclasses">Accessing services inside inner and anonymous classes</A></LI>
    <LI><A href="#iPOJOFAQ-Usingadifferentversionofthemanipulatorduringthemanipulation">Using a different version of the manipulator during the manipulation</A></LI>
    <LI><A href="#iPOJOFAQ-Callbacksorder.">Callbacks order.</A></LI>
    <LI><A href="#iPOJOFAQ-DisablingproxiesiniPOJO1.6%255C">Disabling proxies in iPOJO 1.6+</A></LI>
    <LI><A href="#iPOJOFAQ-Usedynamicproxiesinsteadofsmartproxies">Use dynamic proxies instead of smart proxies</A></LI>
    <LI><A href="#iPOJOFAQ-CanIuseiPOJOwithotherOSGiimplementations%253F">Can I use iPOJO with other OSGi implementations?</A></LI>
    <LI><A href="#iPOJOFAQ-Detectingoptionalserviceunavailability">Detecting optional service unavailability</A></LI>
    <LI><A href="#iPOJOFAQ-SettingtheiPOJOloglevel">Setting the iPOJO log level</A></LI>
    <LI><A href="#iPOJOFAQ-InstallingiPOJOinServiceMixKernel">Installing iPOJO in Service Mix Kernel</A></LI>
    <LI><A href="#iPOJOFAQ-iPOJOandFileInstall">iPOJO and File Install</A></LI>
    <LI><A href="#iPOJOFAQ-iPOJOhandlerstartlevel">iPOJO handler <EM>start</EM> level</A></LI>
    <LI><A href="#iPOJOFAQ-Whydoesmybundleimportunusedpackages%253F">Why does my bundle import unused packages?</A></LI>
    <LI><A href="#iPOJOFAQ-HowdoesiPOJOcomparetoDeclarativeServicesorBlueprint%253F">How does iPOJO compare to Declarative Services or Blueprint?</A></LI>
</UL></DIV></DIV>

<H2><A name="iPOJOFAQ-InjectingthebundlecontextinaPOJO"></A>Injecting the bundle context in a POJO</H2>

<P>It is sometimes useful to inject the bundle context in your POJO. Then, your POJO is able to deal with the OSGi environment as <EM>regular</EM> OSGi applications. It is possible to a POJO to get its <TT>BundleContext</TT>. A POJO can receive its bundle context as an argument of its constructor. The next code snippet shows an example:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class ASimplePOJO{
	<SPAN class="code-keyword">private</SPAN> BundleContext context;
	<SPAN class="code-keyword">public</SPAN> ASimplePOJO(BundleContext bc) {
		context = bc;
		<SPAN class="code-comment">// <SPAN class="code-keyword">do</SPAN> something...
</SPAN>	}}
</PRE>
</DIV></DIV>
<P>As you see on the previous snippet, the bundle context is injected in the POJO. Then the POJO can use it as a 'normal' bundle context. The POJO code can:</P>
<UL>
	<LI>load classes</LI>
	<LI>register / unregister services</LI>
	<LI>discover, track and use services</LI>
</UL>


<P>However, all these interactions are no more managed by the iPOJO container. So, be careful to manage the dynamism, synchronization, listeners...</P>

<H2><A name="iPOJOFAQ-Accessingservicesinsideinnerandanonymousclasses"></A>Accessing services inside inner and anonymous classes</H2>

<P>An inner class is a class defined inside another class.  This mechanism is useful in order to avoid creating a bunch of small files. So, it is common when creating threads, Swing listeners ... Generally speaking, inner classes are regular classes treated as separate classes. However this is an oversimplification. Some of the information about an inner class is not in its class file.  See section 4.7.5 for further details:<BR>
<A href="http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html" class="external-link" rel="nofollow">http://java.sun.com/docs/books/jvms/second_edition/html/ClassFile.doc.html</A></P>


<P>An inner class can access fields of its outer class. Since the iPOJO 1.0.0 version, fields managed by iPOJO, such as a service dependencies and properties, are also available from the inner class. Indeed, iPOJO manipulation also manipulates inner and nested classes, and accesses to outer class fields are correctly managed.</P>

<H2><A name="iPOJOFAQ-Usingadifferentversionofthemanipulatorduringthemanipulation"></A>Using a different version of the manipulator during the manipulation</H2>

<P>You can configure the version of the manipulator that you want to use when you're using the maven-ipojo-plugin or the iPOJO ant task. This allows to benefit latest improvements.</P>

<P>For Maven, Just declare a dependency on the manipulator that you want to use in the maven-ipojo-plugin plugin section:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Maven</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;plugin&gt;</SPAN>
        <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
        <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-ipojo-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
        <SPAN class="code-tag">&lt;executions&gt;</SPAN>
          <SPAN class="code-tag">&lt;execution&gt;</SPAN>
            <SPAN class="code-tag">&lt;goals&gt;</SPAN>
              <SPAN class="code-tag">&lt;goal&gt;</SPAN>ipojo-bundle<SPAN class="code-tag">&lt;/goal&gt;</SPAN>
            <SPAN class="code-tag">&lt;/goals&gt;</SPAN>
          <SPAN class="code-tag">&lt;/execution&gt;</SPAN>
        <SPAN class="code-tag">&lt;/executions&gt;</SPAN>
        <SPAN class="code-tag">&lt;dependencies&gt;</SPAN>
        	<SPAN class="code-tag">&lt;dependency&gt;</SPAN>
        		<SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
        		<SPAN class="code-tag">&lt;artifactId&gt;</SPAN>org.apache.felix.ipojo.manipulator<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
        		<SPAN class="code-tag">&lt;version&gt;</SPAN>1.6.2<SPAN class="code-tag">&lt;/version&gt;</SPAN>
        	<SPAN class="code-tag">&lt;/dependency&gt;</SPAN>
        <SPAN class="code-tag">&lt;/dependencies&gt;</SPAN>
      <SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>For Ant, just configure the classpath of the iPOJO ant task with the Manipulator that you want to use:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Ant</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;taskdef name=<SPAN class="code-quote">&quot;ipojo&quot;</SPAN>
        classname=<SPAN class="code-quote">&quot;org.apache.felix.ipojo.task.IPojoTask&quot;</SPAN>
                classpath=<SPAN class="code-quote">&quot;../ipojo/manipulator/org.apache.felix.ipojo.manipulator-1.7.0-SNAPSHOT.jar; lib/org.apache.felix.ipojo.ant-1.7.0-SNAPSHOT.jar;&quot;</SPAN> /&gt;
 /&gt;
</PRE>
</DIV></DIV>


<H2><A name="iPOJOFAQ-Callbacksorder."></A>Callbacks order.</H2>

<P>A lot of handlers define callbacks to notify the implementation class. The 'core' callbacks are called in the following order:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
@Component
@Provides
<SPAN class="code-keyword">public</SPAN> class CallbacksOrder <SPAN class="code-keyword">implements</SPAN> MyService {

	<SPAN class="code-keyword">public</SPAN> CallbacksOrder() {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;1 Constructor&quot;</SPAN>);
	}

	@Bind
	<SPAN class="code-keyword">public</SPAN> void bind(LogService log) {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;2 Bind &quot;</SPAN> + log);
	}

	@Property(name=<SPAN class="code-quote">&quot;prop&quot;</SPAN>)
	<SPAN class="code-keyword">public</SPAN> void setProp(<SPAN class="code-object">String</SPAN> v) {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;3 Set prop &quot;</SPAN> + v);
	}


	@Validate
	<SPAN class="code-keyword">public</SPAN> void validate() {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;4 Validate&quot;</SPAN>);
	}

	@PostRegistration
	<SPAN class="code-keyword">public</SPAN> void registered(ServiceReference ref) {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;5 Registered&quot;</SPAN>);
	}

	<SPAN class="code-comment">// --- On Service Departure ---
</SPAN>
	@Unbind
	<SPAN class="code-keyword">public</SPAN> void unbind(LogService log) {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;6 Unbind &quot;</SPAN> + log);
	}

	<SPAN class="code-comment">// Remaining of the flow
</SPAN>

	@PostUnregistration
	<SPAN class="code-keyword">public</SPAN> void unregistered(ServiceReference ref) {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;7 Unregistered&quot;</SPAN>);
	}

	@Invalidate
	<SPAN class="code-keyword">public</SPAN> void invalidate() {
		<SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;8 Invalidate&quot;</SPAN>);
	}

        <SPAN class="code-comment">// --- End of the callback order
</SPAN>
	<SPAN class="code-keyword">public</SPAN> void doNothing() {
		<SPAN class="code-comment">// Do nothing...
</SPAN>	}

}
</PRE>
</DIV></DIV>

<H2><A name="iPOJOFAQ-DisablingproxiesiniPOJO1.6%5C"></A>Disabling proxies in iPOJO 1.6&#43;</H2>

<P>iPOJO 1.6.0 has generalized the proxy usage. However this mechanism can be disabled.</P>

<P>To disable the proxies on the entire framework, just set the property <TT>ipojo.proxy</TT> to <TT>disabled</TT> (this set the default 'proxy' value). This property is either a system property (<TT>&#45;Dipojo.proxy=disabled</TT> in the command line) or a framework property (given to the framework during its initialization).</P>

<P>You can also disable proxies for specific dependencies by using the <TT>proxy</TT> attribute:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
@Requires(proxy=<SPAN class="code-keyword">false</SPAN>)
<SPAN class="code-keyword">private</SPAN> LogService log
</PRE>
</DIV></DIV>
<P>or</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;requires field=<SPAN class="code-quote">&quot;log&quot;</SPAN> proxy=<SPAN class="code-quote">&quot;false&quot;</SPAN>/&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>The default value of the <TT>proxy</TT> attribute is the value of the <TT>ipojo.proxy</TT> property.</P>

<H2><A name="iPOJOFAQ-Usedynamicproxiesinsteadofsmartproxies"></A>Use dynamic proxies instead of smart proxies</H2>

<P>Smart proxies are generated on the fly using bytecode generation. However this mechanism may not be always supported by the VM (like Dalvik (Android)). To disabled smart proxies (used by default) and use dynamic proxy instead, set the property <TT>ipojo.proxy.type</TT> to <TT>dynamic-proxy</TT>. This property is either a system property or a framework property.</P>

<H2><A name="iPOJOFAQ-CanIuseiPOJOwithotherOSGiimplementations%3F"></A>Can I use iPOJO with other OSGi implementations?</H2>

<P>iPOJO relies on the OSGi R4.1 specification, so works on any compliant implementation. Moreover, iPOJO is weekly tested on Apache Felix, Eclipse Equinox and Knopflerfish..<BR>
For further information, refer to the <A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">supported OSGi implementations</A> page and on this <A href="http://ipojo-dark-side.blogspot.com/2008/11/lessons-learned-from-ipojo-testing.html" class="external-link" rel="nofollow">blog</A> post.</P>

<H2><A name="iPOJOFAQ-Detectingoptionalserviceunavailability"></A>Detecting optional service unavailability</H2>

<P>Sometimes it is useful to check if an optional service dependency is fulfilled or not. In order to propose a pretty simple development model, iPOJO injects proxies by default which avoid such check (Because proxies hide such details). By disabling proxies, you can easily check to unavailability.</P>

<UL>
	<LI>First, disable the proxy injection:
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
@Requires(proxy=<SPAN class="code-keyword">false</SPAN>)
<SPAN class="code-keyword">private</SPAN> LogService log;
</PRE>
</DIV></DIV></LI>
</UL>


<UL>
	<LI>The injected object will be a direct reference. By default, iPOJO injects a <TT>Nullable</TT> object, on which you can call service method without checking for <TT>null</TT>. To detect Nullable objects, just use <TT>instanceof</TT>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
@Requires(proxy=<SPAN class="code-keyword">false</SPAN>)
<SPAN class="code-keyword">private</SPAN> LogService log;

<SPAN class="code-keyword">public</SPAN> void doSomething() {
    <SPAN class="code-keyword">if</SPAN> (log <SPAN class="code-keyword">instanceof</SPAN> Nullable) {
        <SPAN class="code-comment">// Service unavailable
</SPAN>    } <SPAN class="code-keyword">else</SPAN> {
       <SPAN class="code-comment">// Service available
</SPAN>    }
}
</PRE>
</DIV></DIV></LI>
</UL>


<UL>
	<LI>If you prefer injecting <TT>null</TT> instead of a <TT>Nullable</TT>, just disable Nullable injection too. However, be care to check for <TT>null</TT> before each invocation.
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
@Requires(proxy=<SPAN class="code-keyword">false</SPAN>, nullable=<SPAN class="code-keyword">false</SPAN>)
<SPAN class="code-keyword">private</SPAN> LogService log;

<SPAN class="code-keyword">public</SPAN> void doSomething() {
    <SPAN class="code-keyword">if</SPAN> (log == <SPAN class="code-keyword">null</SPAN>) {
        <SPAN class="code-comment">// Service unavailable
</SPAN>    } <SPAN class="code-keyword">else</SPAN> {
       <SPAN class="code-comment">// Service available
</SPAN>    }
}
</PRE>
</DIV></DIV></LI>
</UL>


<H2><A name="iPOJOFAQ-SettingtheiPOJOloglevel"></A>Setting the iPOJO log level</H2>

<P>By default, iPOJO logs only warning and error messages. There are two different methods to configure the log level. First, you can set the global log level by setting the <EM>ipojo.log.level</EM> system property. This replaces the default log level (warning). All iPOJO instances will be impacted.  However, each bundle containing component types can specify a different log level. To set this level, add the <EM>ipojo-log-level</EM> header in your manifest. The possible values for these two properties are:</P>
<UL>
	<LI>info</LI>
	<LI>debug</LI>
	<LI>warning (default)</LI>
	<LI>error</LI>
</UL>


<H2><A name="iPOJOFAQ-InstallingiPOJOinServiceMixKernel"></A>Installing iPOJO in Service Mix Kernel</H2>

<P>You can use iPOJO in Service Mix Kernel. To deploy and start it, just execute the following command line in the ServiceMix Kernel Shell.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
osgi install -s mvn:org.apache.felix/org.apache.felix.ipojo/1.2.0
</PRE>
</DIV></DIV>

<P>The iPOJO bundle is downloaded from the central maven repository.</P>

<H2><A name="iPOJOFAQ-iPOJOandFileInstall"></A>iPOJO and File Install</H2>

<P>Thanks to File install you can create, disposed and reconfigure instances from <EM>cfg</EM> files. You can also reconfiguring a creatged instance (configured to expose a <A href="http://felix.apache.org/site/configuration-handler.html#ConfigurationHandler-ExposingaManagedService" class="external-link" rel="nofollow">ManagedService</A>) with <EM>cfg</EM> files too. More information about this topic is available <A href="http://ipojo-dark-side.blogspot.com/2009/04/ipojo-and-file-install-configuring.html" class="external-link" rel="nofollow">here</A>.</P>

<H2><A name="iPOJOFAQ-iPOJOhandlerstartlevel"></A>iPOJO handler <EM>start</EM> level</H2>

<P>iPOJO Handlers have a <EM>start</EM> level. This is <B>not</B> the <TT>OSGi Start Level</TT>. This level is used to determine in which order handler are configured, started and stopped. Handlers with a low level are configured and started before handlers with a high level. Moreover they are stopped after handlers with a high level. By default, handlers have no level. It means that they have the maximum level (<TT>Integer.MAX</TT>).</P>

<P>Here are the levels of core handlers:</P>
<UL>
	<LI>Service Dependency: 0 (minimum level)</LI>
	<LI>Lifecycle Callback: 1</LI>
	<LI>Configuration Properties: 1</LI>
	<LI>Service Providing: 3</LI>
	<LI>Controller Handler: no level (Integer.MAX)</LI>
	<LI>Architecture Handler: no level (Integer.MAX)</LI>
</UL>


<P>From these levels, we can see that bind methods will be called before set methods from configuration properties. So, when a POJO objects, callback are called in this order:</P>
<OL>
	<LI>bind methods</LI>
	<LI>validate method</LI>
	<LI>setter methods from instance configuration</LI>
</OL>


<DIV class="panelMacro"><TABLE class="infoMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="https://cwiki.apache.org/confluence/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>Changes in the 1.3.0-SNAPSHOT</B><BR>iPOJO 1.3.0-SNAPSHOT sets the lifecycle callback handler level to 2. So, setter methods from instance properties are called before the validate method.</TD></TR></TABLE></DIV>

<H2><A name="iPOJOFAQ-Whydoesmybundleimportunusedpackages%3F"></A>Why does my bundle import unused packages?</H2>

<P>If you check iPOJO bundle imported packages, you will see that some packages where added:</P>
<UL>
	<LI>org.apache.felix.ipojo;version= 1.2.0</LI>
	<LI>org.apache.felix.ipojo.architecture;version= 1.2.0</LI>
	<LI>org.osgi.service.cm;version=1.2</LI>
	<LI>org.osgi.service.log;version=1.3</LI>
</UL>


<P>The <TT>org.apache.felix.ipojo</TT> package is the main iPOJO package. Manipulated class use it to get access to injected values. The <TT>org.apache.felix.ipojo.architecture</TT> package is used to expose <EM>Architecture</EM> service (allowing instance introspection). This service is exposed with the bundle context from the bundle declaring the component type.<BR>
The <TT>org.osgi.service.cm</TT> package is imported to publish <EM>ManagedService</EM> and <EM>ManagedServiceFactory</EM> with the bundle context from the bundle declaring the component type. So, if you look for services exposed by a bundle declaring component types, you will see <EM>ManagedServiceFactory</EM> services.<BR>
Finally, the <TT>org.osgi.service.log</TT> is imported because iPOJO delegates log to a log service (if available). This service is get from the bundle context from the bundle declaring the component type. So, to get this service, the package of the service interface is imported.  Then, according to implementations, log services may get the bundle logging the message.</P>

<H2><A name="iPOJOFAQ-HowdoesiPOJOcomparetoDeclarativeServicesorBlueprint%3F"></A>How does iPOJO compare to Declarative Services or Blueprint?</H2>

<P>The following table highlights some of the features of each system, it does not attempt to highlight every feature of each.</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Dependency injection </TH>
<TH class="confluenceTh"> Declarative Services </TH>
<TH class="confluenceTh"> Blueprint </TH>
<TH class="confluenceTh"> iPOJO </TH>
</TR>
<TR>
<TD class="confluenceTd"> Callback injection </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes (public method only) </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Constructor injection </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Field injection </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Setter injection </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Proxy injection </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> List injection </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Nullable injection </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TH class="confluenceTh"> Lifecycle </TH>
<TH class="confluenceTh"> Declarative Services </TH>
<TH class="confluenceTh"> Blueprint </TH>
<TH class="confluenceTh"> iPOJO </TH>
</TR>
<TR>
<TD class="confluenceTd"> Callbacks (activate/deactivate) </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Factory pattern </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Lazy initialization </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Damping </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Field synchronization </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Component lifecycle control </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Partial </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Service lifecycle control </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TH class="confluenceTh"> Configuration </TH>
<TH class="confluenceTh"> Declarative Services </TH>
<TH class="confluenceTh"> Blueprint </TH>
<TH class="confluenceTh"> iPOJO </TH>
</TR>
<TR>
<TD class="confluenceTd"> Property configuration </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Field configuration </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Configuration Admin </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TH class="confluenceTh"> Services </TH>
<TH class="confluenceTh"> Declarative Services </TH>
<TH class="confluenceTh"> Blueprint </TH>
<TH class="confluenceTh"> iPOJO </TH>
</TR>
<TR>
<TD class="confluenceTd"> Custom attribute type </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Lazy initialization </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Composite services </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TH class="confluenceTh"> Component description </TH>
<TH class="confluenceTh"> Declarative Services </TH>
<TH class="confluenceTh"> Blueprint </TH>
<TH class="confluenceTh"> iPOJO </TH>
</TR>
<TR>
<TD class="confluenceTd"> XML </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> Java annotations </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TD class="confluenceTd"> API </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> No </TD>
<TD class="confluenceTd"> Yes </TD>
</TR>
<TR>
<TH class="confluenceTh"> Nonfunctional </TH>
<TH class="confluenceTh"> Declarative Services </TH>
<TH class="confluenceTh"> Blueprint </TH>
<TH class="confluenceTh"> iPOJO </TH>
</TR>
<TR>
<TD class="confluenceTd"> Multiple providers </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> Yes </TD>
<TD class="confluenceTd"> No </TD>
</TR>
</TBODY></TABLE>
</DIV>

<P><BR class="atl-forced-newline">
<BR class="atl-forced-newline"></P>

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on Wed May 25 11:46:39 EDT 2011
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
