
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix Dependency Manager - OSGi Design Patterns</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H2><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-OSGiDesignPatterns"></A>OSGi Design Patterns</H2>

<P>This section lists a couple of design patterns as they can be applied in an OSGi context.</P>

<H3><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-%28Singleton%29Service"></A>(Singleton) Service</H3>

<P>Provides a service as long as its dependencies are resolved.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Motivation"></A>Motivation</H4>

<P>In a dynamic framework, services can come and go. Components that publish a service are often themselves dependent on other services to perform their task. In such cases, they have a dependency on those services and it makes sense to only publish their own services when these dependencies are available. Being able to declare such dependencies in code ensures consistent life cycle behavior.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Structure"></A>Structure</H4>



<MAP name="GLIFFY_MAP_9374247_singleton"></MAP>
<TABLE width="100%">
    <TR>
        <TD align="center">
            <TABLE>
                <CAPTION align="bottom">
                    
                        
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/viewlargediagram.action?name=singleton&ceoid=9374247&key=FELIX&pageId=9374247" target="">Full Size</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/showgliffyeditor.action?name=singleton&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247" target="">Edit Diagram</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/removediagram.action?name=singleton&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247&input=true" target="">Remove Diagram</A>
                                    </CAPTION>
                <TR>
                    <TD>
                        <IMG style="border: none; width: 200px; height: 330px;" usemap="#GLIFFY_MAP_9374247_singleton" src="https://cwiki.apache.org/confluence/plugins/servlet/gliffyapi/clientdiagram?cb=256528259&pk=pub&name=singleton&ceoid=9374247&key=FELIX" alt="A&#32;Gliffy&#32;Diagram&#32;named&#58;&#32;singleton">
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>




<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-CodeExample"></A>Code Example</H4>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Activator <SPAN class="code-keyword">extends</SPAN> DependencyActivatorBase {
    <SPAN class="code-keyword">public</SPAN> void init(BundleContext context, DependencyManager manager) <SPAN class="code-keyword">throws</SPAN> Exception {
        manager.add(createComponent()
            .setInterface(UserStore.class, <SPAN class="code-keyword">new</SPAN> Properties() {{ put(<SPAN class="code-quote">&quot;store.id&quot;</SPAN>, <SPAN class="code-quote">&quot;users&quot;</SPAN>); }})
            .setImplementation(UserStoreImpl.class)
            .add(createServiceDependency()
                .setService(Store.class)
                .setRequired(<SPAN class="code-keyword">true</SPAN>)
            )
            .add(createServiceDependency()
                .setService(LogService.class)
                .setRequired(<SPAN class="code-keyword">false</SPAN>)
            )
        );
    }
    
    <SPAN class="code-keyword">public</SPAN> void destroy(BundleContext context, DependencyManager manager) <SPAN class="code-keyword">throws</SPAN> Exception {}
}
</PRE>
</DIV></DIV>

<H3><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-AspectService"></A>Aspect Service</H3>

<P>Provides an aspect on top of a specific type of service.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Motivation"></A>Motivation</H4>

<P>In aspect oriented programming, supporting functions are isolated from the main application's business logic. This increases modularity at the source level by allowing the separation of cross-cutting concerns. In OSGi we want to extend this modularity to the runtime, therefore we implement aspects to work on certain services, where the aspect itself publishes that same service but (usually) with a higher priority. This allows you to dynamically add and remove aspects.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Structure"></A>Structure</H4>



<MAP name="GLIFFY_MAP_9374247_aspect"></MAP>
<TABLE width="100%">
    <TR>
        <TD align="center">
            <TABLE>
                <CAPTION align="bottom">
                    
                        
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/viewlargediagram.action?name=aspect&ceoid=9374247&key=FELIX&pageId=9374247" target="">Full Size</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/showgliffyeditor.action?name=aspect&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247" target="">Edit Diagram</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/removediagram.action?name=aspect&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247&input=true" target="">Remove Diagram</A>
                                    </CAPTION>
                <TR>
                    <TD>
                        <IMG style="border: none; width: 210px; height: 330px;" usemap="#GLIFFY_MAP_9374247_aspect" src="https://cwiki.apache.org/confluence/plugins/servlet/gliffyapi/clientdiagram?cb=-1671381409&pk=pub&name=aspect&ceoid=9374247&key=FELIX" alt="A&#32;Gliffy&#32;Diagram&#32;named&#58;&#32;aspect">
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>




<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-CodeExample"></A>Code Example</H4>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Activator <SPAN class="code-keyword">extends</SPAN> DependencyActivatorBase {
    <SPAN class="code-keyword">public</SPAN> void init(BundleContext context, DependencyManager manager) <SPAN class="code-keyword">throws</SPAN> Exception {
        manager.add(createAspectService(Manageable.class, <SPAN class="code-quote">&quot;(monitor=<SPAN class="code-keyword">true</SPAN>)&quot;</SPAN>, 50)
            .setImplementation(ManageableMonitor.class)
        );
    }
    
    <SPAN class="code-keyword">public</SPAN> void destroy(BundleContext context, DependencyManager manager) <SPAN class="code-keyword">throws</SPAN> Exception {}
}

<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">interface</SPAN> Manageable {
    <SPAN class="code-keyword">public</SPAN> void setProperty(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">String</SPAN> value);
}

<SPAN class="code-keyword">public</SPAN> class ManageableMonitor <SPAN class="code-keyword">implements</SPAN> Manageable {
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-keyword">volatile</SPAN> Manageable m_manageable;

    <SPAN class="code-keyword">public</SPAN> void setProperty(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">String</SPAN> value) {
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;Someone set &quot;</SPAN> + key + <SPAN class="code-quote">&quot; to &quot;</SPAN> + value);
        m_manageable.setProperty(key, value);
    }
}
</PRE>
</DIV></DIV>

<H3><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-AdapterService"></A>Adapter Service</H3>

<P>Provides an adapter for a specific type of service.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Motivation"></A>Motivation</H4>

<P>Like with aspects, sometimes you want to create adapters for certain services, which add certain behavior that results in the publication of (in this case) a different service. Adapters can dynamically be added and removed and allow you to keep your basic services implementations clean and simple, adding extra features on top of them in a modular way. </P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Structure"></A>Structure</H4>



<MAP name="GLIFFY_MAP_9374247_adapter"></MAP>
<TABLE width="100%">
    <TR>
        <TD align="center">
            <TABLE>
                <CAPTION align="bottom">
                    
                        
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/viewlargediagram.action?name=adapter&ceoid=9374247&key=FELIX&pageId=9374247" target="">Full Size</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/showgliffyeditor.action?name=adapter&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247" target="">Edit Diagram</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/removediagram.action?name=adapter&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247&input=true" target="">Remove Diagram</A>
                                    </CAPTION>
                <TR>
                    <TD>
                        <IMG style="border: none; width: 210px; height: 310px;" usemap="#GLIFFY_MAP_9374247_adapter" src="https://cwiki.apache.org/confluence/plugins/servlet/gliffyapi/clientdiagram?cb=1971892963&pk=pub&name=adapter&ceoid=9374247&key=FELIX" alt="A&#32;Gliffy&#32;Diagram&#32;named&#58;&#32;adapter">
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>




<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-CodeExample"></A>Code Example</H4>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Activator <SPAN class="code-keyword">extends</SPAN> DependencyActivatorBase {
    <SPAN class="code-keyword">public</SPAN> void init(BundleContext context, DependencyManager manager) <SPAN class="code-keyword">throws</SPAN> Exception {
        manager.add(createAdapterService(Manageable.class, <SPAN class="code-quote">&quot;(publish=servlet)&quot;</SPAN>)
            .setInterface(HttpServlet.class.getName(), <SPAN class="code-keyword">null</SPAN>)
            .setImplementation(ManageableServlet.class)
        );
    }
    
    <SPAN class="code-keyword">public</SPAN> void destroy(BundleContext context, DependencyManager manager) <SPAN class="code-keyword">throws</SPAN> Exception {}
}

<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">interface</SPAN> Manageable {
    <SPAN class="code-keyword">public</SPAN> void setProperty(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">String</SPAN> value);
}

<SPAN class="code-keyword">public</SPAN> class ManageableServlet <SPAN class="code-keyword">implements</SPAN> HttpServlet {
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-keyword">volatile</SPAN> Manageable m_manageable;

    <SPAN class="code-keyword">public</SPAN> void doPost(HttpRequest req, HttpResponse response) {
        <SPAN class="code-object">String</SPAN> key = req.getProperty(<SPAN class="code-quote">&quot;key&quot;</SPAN>);
        <SPAN class="code-object">String</SPAN> value = req.getProperty(<SPAN class="code-quote">&quot;value&quot;</SPAN>);
        m_manageable.setProperty(key, value);
    }
}
</PRE>
</DIV></DIV>

<H3><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-ResourceAdapterService"></A>Resource Adapter Service</H3>

<P>Provides an adapter for a specific type of resource.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Motivation"></A>Motivation</H4>

<P>Resource adapters are similar to normal adapters, but instead of requiring a service, they require a resource and provide a service on top of it. Resources are an abstraction that is introduced by the dependency manager, represented as a URL. They can be implemented to serve resources embedded in bundles, somewhere on a file system or in a content repository or database.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Structure"></A>Structure</H4>



<MAP name="GLIFFY_MAP_9374247_resource-adapter"></MAP>
<TABLE width="100%">
    <TR>
        <TD align="center">
            <TABLE>
                <CAPTION align="bottom">
                    
                        
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/viewlargediagram.action?name=resource-adapter&ceoid=9374247&key=FELIX&pageId=9374247" target="">Full Size</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/showgliffyeditor.action?name=resource-adapter&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247" target="">Edit Diagram</A>
                    
                         | 
                        <A href="https://cwiki.apache.org/confluence/plugins/gliffy/removediagram.action?name=resource-adapter&ceoid=9374247&key=FELIX&lastPage=%2Fdisplay%2FFELIX%2FApache%20Felix%20Dependency%20Manager%20-%20OSGi%20Design%20Patterns&pageId=9374247&input=true" target="">Remove Diagram</A>
                                    </CAPTION>
                <TR>
                    <TD>
                        <IMG style="border: none; width: 200px; height: 350px;" usemap="#GLIFFY_MAP_9374247_resource-adapter" src="https://cwiki.apache.org/confluence/plugins/servlet/gliffyapi/clientdiagram?cb=104817805&pk=pub&name=resource-adapter&ceoid=9374247&key=FELIX" alt="A&#32;Gliffy&#32;Diagram&#32;named&#58;&#32;resource&#45;adapter">
                    </TD>
                </TR>
            </TABLE>
        </TD>
    </TR>
</TABLE>




<H3><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-TemporalDependency"></A>Temporal Dependency</H3>

<P>Provides a proxy that hides the service dynamics of a dependency, even if it disappears for a short time.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Motivation"></A>Motivation</H4>

<P>As a service consumer, you sometimes do not want to deal with the dynamics of services and the fact that they tend to go away for short periods of time whilst their hosting bundle gets updated. A temporal dependency provides you with a proxy that hides these dynamics and blocks your calls if you try to invoke a method on a service that is currently &quot;updating&quot;. The maximum time to wait is configurable and you will get an exception if no new service becomes available before that time.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Structure"></A>Structure</H4>

<H3><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-NullObject"></A>Null Object</H3>

<P>Provides an implementation of an object that does nothing and can be used in the absence of the real object.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Motivation"></A>Motivation</H4>

<P>When a component depends on a service, but the dependency is optional, it means that it will use this service when available, but it can still operate if it's not. Constantly checking in your code if a service is actually available tends to lead to code with a lot of &quot;<TT>if (service != null) service.invoke();</TT>&quot; constructions which do not help with code readability. Instead, the dependency manager offers you a mechanism where it will inject null objects for services that are currently not available so you can simply invoke methods on them that &quot;do nothing&quot;.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Structure"></A>Structure</H4>

<H3><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Whiteboard"></A>Whiteboard</H3>

<P>Handles listeners by leveraging the OSGi service registry to publish and look them up.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Motivation"></A>Motivation</H4>

<P>The traditional model for dealing with listeners in Java needlessly complicates things in an OSGi context. Instead of having listeners registering themselves with the component that will invoke them on any change, a listener simply registers itself in the service registry and the component will do a lookup of all relevant services. This is explained in more detail on the OSGi.org wiki in the <A href="http://www.osgi.org/wiki/uploads/Links/whiteboard.pdf" class="external-link" rel="nofollow">&quot;Listeners considered harmful: the 'whiteboard' pattern&quot;</A> article.</P>

<H4><A name="ApacheFelixDependencyManager-OSGiDesignPatterns-Structure"></A>Structure</H4>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by marrs on Wed Jun 08 15:49:27 EDT 2011
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
