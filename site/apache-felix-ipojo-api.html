
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - apache-felix-ipojo-api</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css); 
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css); 
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT> 
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT> 

<SCRIPT type="text/javascript"> 
 
    $(document).ready(function(){ 
        $("ul.sf-menu").supersubs({ 
            minWidth:    14,   // minimum width of sub-menus in em units 
            maxWidth:    30,   // maximum width of sub-menus in em units 
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over 
                               // due to slight rounding differences and font-family 
        }).superfish();  // call supersubs first, then superfish, so that subs are 
                         // not display:none when measuring. Call before initialising 
                         // containing tabs for same reason. 
    }); 
 
</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>							
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>	

<LI class="">			
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">					
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="ipojo-composition-tutorial.html" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="combining-ipojo-and-configuration-admin.html" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="ipojo-faq.html" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI> 
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL> 
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>   
</LI><!-- End of tools -->	
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->			
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">

<H1><A name="apache-felix-ipojo-api-iPOJOAPI"></A>iPOJO API</H1>

<P><EM>The iPOJO API provides a third way to describe iPOJO components and instances. With the API, you can dynamically create new components types and create instances from them. Your component types are described with a Java API. To use the API, deploy and start the iPOJO-API bundle and the iPOJO core bundle.</EM></P>

<DIV class="toc"><DIV>
<UL>
    <LI><A href="#apache-felix-ipojo-api-Asimpleexample">A simple example</A></LI>
    <LI><A href="#apache-felix-ipojo-api-DeployingtheAPI">Deploying the API</A></LI>
    <LI><A href="#apache-felix-ipojo-api-PrimitiveComponentTypebasics">Primitive Component Type basics</A></LI>
    <LI><A href="#apache-felix-ipojo-api-ImmediateComponent%252CValidateandInvalidateMethod">Immediate Component, Validate and Invalidate Method</A></LI>
    <LI><A href="#apache-felix-ipojo-api-Declaringservices">Declaring services</A></LI>
    <LI><A href="#apache-felix-ipojo-api-ServiceDependencies">Service Dependencies</A></LI>
    <LI><A href="#apache-felix-ipojo-api-Properties">Properties</A></LI>
    <LI><A href="#apache-felix-ipojo-api-TemporalDependencies">Temporal Dependencies</A></LI>
    <LI><A href="#apache-felix-ipojo-api-Instancecreation">Instance creation</A></LI>
    <LI><A href="#apache-felix-ipojo-api-ManagedServiceandPropagation">Managed Service and Propagation</A></LI>
    <LI><A href="#apache-felix-ipojo-api-ManagingiPOJOFactory">Managing iPOJO Factory</A></LI>
    <LI><A href="#apache-felix-ipojo-api-AccesstotheintrospectionAPI">Access to the introspection API</A></LI>
    <LI><A href="#apache-felix-ipojo-api-SingletonComponentType">Singleton Component Type</A></LI>
    <LI><A href="#apache-felix-ipojo-api-Usingexternalhandlers">Using external handlers</A></LI>
    <LI><A href="#apache-felix-ipojo-api-CreatingcompositionwiththeAPI">Creating composition with the API</A></LI>
</UL></DIV></DIV>

<H2><A name="apache-felix-ipojo-api-Asimpleexample"></A>A simple example</H2>

<P>Let's imagine a simple component providing a service Foo. The following code is the implementation class of our component:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> org.example.service.impl;

<SPAN class="code-keyword">import</SPAN> org.example.service.Foo;

<SPAN class="code-keyword">public</SPAN> class FooImpl <SPAN class="code-keyword">implements</SPAN> Foo {

    <SPAN class="code-keyword">public</SPAN> void doSomething() {
        <SPAN class="code-comment">// Do something...
</SPAN>    }

}
</PRE>
</DIV></DIV>

<P>To create the component type and an instance of the component type just create a class, get the bundle context (either from a Bundle-Activator, or from an iPOJO component), and write the following code:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">new</SPAN> PrimitiveComponentType()
    .setBundleContext(context)
    .setClassName(FooImpl.class.getName())
    .addService(<SPAN class="code-keyword">new</SPAN> Service()) <SPAN class="code-comment">// Provide the Foo service
</SPAN>    .createInstance(); <SPAN class="code-comment">// Create the instance</SPAN>
</PRE>
</DIV></DIV>

<P>So, now let's imagine another component using this service. The following code is the implementation class of this component type:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> org.example.service.impl;

<SPAN class="code-keyword">import</SPAN> org.example.service.Foo;

<SPAN class="code-keyword">public</SPAN> class MyComponentImpl {
    <SPAN class="code-keyword">private</SPAN> Foo myFoo;

    <SPAN class="code-keyword">public</SPAN> void start() {
        myFoo.doSomething();
    }

}
</PRE>
</DIV></DIV>

<P>It is a regular iPOJO component expecting to get a Foo service in the <TT>myFoo</TT> field. It also has a method executed when the instance is valid using the Foo service. To describe this component, just write the following lines:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">new</SPAN> PrimitiveComponentType()
    .setBundleContext(context)
    .setClassName(MyComponentImpl.class.getName())
    .addDependency(<SPAN class="code-keyword">new</SPAN> Dependency().setField(<SPAN class="code-quote">&quot;myFoo&quot;</SPAN>))
    .setValidateMethod(<SPAN class="code-quote">&quot;start&quot;</SPAN>)
    .createInstance();
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-api-DeployingtheAPI"></A>Deploying the API</H2>
<P>Before being able to create component types at runtime, you need to deploy 3 bundles:</P>
<UL>
	<LI>iPOJO (core)</LI>
	<LI>iPOJO Composite</LI>
	<LI>iPOJO API</LI>
</UL>


<P>You can deploy all these bundles in one step thanks to OBR:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
obr start <SPAN class="code-quote">&quot;Apache Felix iPOJO API&quot;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-api-PrimitiveComponentTypebasics"></A>Primitive Component Type basics</H2>

<P>When you create a new Primitive component type (so, using a Java class as implementation), you must set the bundle context and the class name. Everything else is optional. </P>

<P>Note about inner classes: iPOJO is based on a bytecode manipulation. The API embeds the manipulator. So, when you initialize the component type, the specified class name is manipulated (if not already manipulated). So, as this force using a customized classloader, inner classes cannot be manipulated. So, inner class injection is not supported with the API.</P>

<H2><A name="apache-felix-ipojo-api-ImmediateComponent%2CValidateandInvalidateMethod"></A>Immediate Component, Validate and Invalidate Method</H2>
<P>To set the component type as immediate, just call the <TT>setImmediate(immediate)</TT> method on the primitive component type object. <BR>
To set validate and invalidate methods, just call the <TT>setValidate(method)</TT> and <TT>setInvalidate(method)</TT>. Specify the method name that you want to call in argument. </P>

<H2><A name="apache-felix-ipojo-api-Declaringservices"></A>Declaring services</H2>
<P>To declare that a component provides a service, add a new service to your primitive component type.<BR>
The Service object can be configured. By default, it exposed every implemented interface (regular iPOJO behavior). So, you can:</P>
<UL>
	<LI>Add service property</LI>
	<LI>Set the creation strategy</LI>
	<LI>Set the exposed service specifications</LI>
</UL>


<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">new</SPAN> PrimitiveComponentType()
    .setBundleContext(context)
    .setClassName(org.example.service.impl.MyComponentImpl.class.getName())
    .addService(<SPAN class="code-keyword">new</SPAN> Service()
        .addProperty(<SPAN class="code-keyword">new</SPAN> ServiceProperty()
            .setField(<SPAN class="code-quote">&quot;myServiceProperty&quot;</SPAN>)
            .setName(<SPAN class="code-quote">&quot;sample.myProperty&quot;</SPAN>))
        .setCreationStrategy(Service.INSTANCE_STRATEGY))
    .createInstance();
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-api-ServiceDependencies"></A>Service Dependencies</H2>
<P>To declare a service dependency, create and add a Dependency object. The dependency object offers all the iPOJO service dependency features. You can set the injected field and/or bind/unbind methods. Here is an example:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">new</SPAN> PrimitiveComponentType()
    .setBundleContext(context)
    .setClassName(org.example.service.impl.MyComponentImpl.class.getName())
    .addDependency(
        <SPAN class="code-keyword">new</SPAN> Dependency().setField(<SPAN class="code-quote">&quot;myFoo&quot;</SPAN>)
       .setOptional(<SPAN class="code-keyword">true</SPAN>)
       .setDefaultImplementation(<SPAN class="code-quote">&quot;org.sample.FooDefaultImplementation&quot;</SPAN>)
       )
    .createInstance();
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-api-Properties"></A>Properties</H2>
<P>Thanks to the <TT>addProperty</TT> method, you can create component properties. Here is some example of properties:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">new</SPAN> PrimitiveComponentType()
    .setBundleContext(context)
    .setClassName(MyComponentImpl.class.getName())
    .addProperty(<SPAN class="code-keyword">new</SPAN> Property()
        .setField(<SPAN class="code-quote">&quot;myProperty&quot;</SPAN>)
        .setValue(<SPAN class="code-quote">&quot;<SPAN class="code-keyword">default</SPAN>-value&quot;</SPAN>)
        )
    .addProperty(<SPAN class="code-keyword">new</SPAN> Property()
        .setMethod(<SPAN class="code-quote">&quot;setMethod&quot;</SPAN>)
        .setName(<SPAN class="code-quote">&quot;prop&quot;</SPAN>)
    )
    .createInstance();
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-api-TemporalDependencies"></A>Temporal Dependencies</H2>
<P>Temporal dependencies are also supported: </P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">new</SPAN> PrimitiveComponentType()
        .setBundleContext(context)
        .setClassName(MyComponentImpl.class.getName())
        .addDependency(
             <SPAN class="code-keyword">new</SPAN> TemporalDependency().setField(<SPAN class="code-quote">&quot;myFoo&quot;</SPAN>)
            .setOnTimeoutPolicy(TemporalDependency.NULLABLE)
            .setTimeout(3000)
            .setProxy(<SPAN class="code-keyword">true</SPAN>)
            )
        .createInstance();
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-api-Instancecreation"></A>Instance creation</H2>
<P>The API allows you to create instances from the component type you described. Three differents methods.<BR>
The <TT>createInstance()</TT> method just creates an instance. The <TT>createInstance(String name)</TT> method allows to set the instance name. Finally, the <TT>createInstance(Dictionary configuration)</TT> allows setting the instance configuration. All those methods returns the ComponentInstance object allowing to manage the instance (stop, start, dispose). </P>

<H2><A name="apache-felix-ipojo-api-ManagedServiceandPropagation"></A>Managed Service and Propagation</H2>
<P>You can enable/disable the property propagation thanks to the <TT>setPropagation</TT> method on the PrimitiveComponentType object. <BR>
You can also set the the managed service PID with the <TT>setManagedServicePID</TT> method. This method should be only use to give a default value of for singleton component. In all other case, the managed service pid has to be provided inside the instance configuration.</P>

<H2><A name="apache-felix-ipojo-api-ManagingiPOJOFactory"></A>Managing iPOJO Factory</H2>
<P>Beyond the PrimitiveComponentType, an iPOJO factory is hidden. You can configure this factory to be public or private with the <TT>setPublic</TT> method. You can also set the name of the factory with the <TT>setName</TT> method. </P>

<P>Then, you can access to the Factory object by calling the <TT>getFactory</TT> method.</P>

<H2><A name="apache-felix-ipojo-api-AccesstotheintrospectionAPI"></A>Access to the introspection API</H2>
<P>The API provides bridge to get access to the iPOJO introspection API. The introspection API allows reconfiguring at runtime an instance (properties, service dependencies...). From Service and Dependency, Property and ServiceProperty objects, call the <TT>getXXXDescription</TT> method. You must give the instance that you want to introspect in argument. If the lookup success, you get an object allowing reconfiguring the service, dependency or property. </P>

<H2><A name="apache-felix-ipojo-api-SingletonComponentType"></A>Singleton Component Type</H2>
<P>If you are sure to create only one instance of your component type, you can use the singleton component type class. This is a kind of primitive component type, but when you start it (with the <TT>create</TT> method), it will automatically create an instance.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
 PrimitiveComponentType type = <SPAN class="code-keyword">new</SPAN> SingletonComponentType()
            .setBundleContext(context)
            .setClassName(org.example.service.impl.MyComponentImpl.class.getName())
            .addDependency(<SPAN class="code-keyword">new</SPAN> Dependency().setField(<SPAN class="code-quote">&quot;myFoo&quot;</SPAN>))
            .setValidateMethod(<SPAN class="code-quote">&quot;start&quot;</SPAN>);
        
        ((SingletonComponentType) type)
            .setObject(<SPAN class="code-keyword">new</SPAN> MyComponentImpl(5)) <SPAN class="code-comment">// Inject a pojo object
</SPAN>            .create();<SPAN class="code-comment">// Create an instance</SPAN>
</PRE>
</DIV></DIV> 

<P>The type created with the singleton component type are set to <TT>private</TT> by default. Instead of calling the <TT>start</TT> method, you have to call one of the <TT>create</TT> methods to start the type and create the instance.</P>

<P>You can also set the contained POJO object by using the <TT>setObject</TT> method. The given object MUST be compatible with the component implementation class.</P>

<H2><A name="apache-felix-ipojo-api-Usingexternalhandlers"></A>Using external handlers</H2>
<P>iPOJO is extensible... So, it makes sense that the API is also extensible. So component type provides a method allowing to add external handler configuration:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">new</SPAN> PrimitiveComponentType()
        .setBundleContext(context)
        .setClassName(HostImpl.class.getName())
        .addHandler(<SPAN class="code-keyword">new</SPAN> Whiteboard()
            .onArrival(<SPAN class="code-quote">&quot;arrival&quot;</SPAN>)
            .onDeparture(<SPAN class="code-quote">&quot;departure&quot;</SPAN>)
            .setFilter(<SPAN class="code-quote">&quot;(foo=foo)&quot;</SPAN>)
         );
</PRE>
</DIV></DIV>

<P>The <TT>addHandler</TT> method allows you to add any handler description. A handler description is an object of a class implementing <TT>org.apache.felix.ipojo.api.HandlerConfiguration</TT>. Handler provider willing to support the API have to provide this class. For example, the example above uses <TT>Whiteboard</TT> that is the Whiteboard pattern handler description. This class is very simple, and is shown below:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Whiteboard <SPAN class="code-keyword">implements</SPAN> HandlerConfiguration {
    
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> <SPAN class="code-keyword">final</SPAN> <SPAN class="code-object">String</SPAN> NAME = <SPAN class="code-quote">&quot;wbp&quot;</SPAN>;
    
    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> <SPAN class="code-keyword">final</SPAN> <SPAN class="code-object">String</SPAN> NAMESPACE = <SPAN class="code-quote">&quot;org.apache.felix.ipojo.whiteboard&quot;</SPAN>;
    
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> arrival;
    
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> departure;
    
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> modification;
    
    <SPAN class="code-keyword">private</SPAN> <SPAN class="code-object">String</SPAN> filter;
    
    <SPAN class="code-keyword">public</SPAN> Whiteboard onArrival(<SPAN class="code-object">String</SPAN> method) {
        arrival = method;
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">this</SPAN>;
    }
    
    <SPAN class="code-keyword">public</SPAN> Whiteboard onDeparture(<SPAN class="code-object">String</SPAN> method) {
        departure = method;
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">this</SPAN>;
    }
    
    <SPAN class="code-keyword">public</SPAN> Whiteboard onModification(<SPAN class="code-object">String</SPAN> method) {
        modification = method;
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">this</SPAN>;
    }
    
    <SPAN class="code-keyword">public</SPAN> Whiteboard setFilter(<SPAN class="code-object">String</SPAN> fil) {
        filter = fil;
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">this</SPAN>;
    }

    <SPAN class="code-keyword">public</SPAN> Element getElement() {
        ensureValidity();
        <SPAN class="code-comment">// Create the root element.
</SPAN>        Element element = <SPAN class="code-keyword">new</SPAN> Element(NAME, NAMESPACE);
        <SPAN class="code-comment">// Mandatory attributes
</SPAN>        element.addAttribute(<SPAN class="code-keyword">new</SPAN> Attribute(<SPAN class="code-quote">&quot;onArrival&quot;</SPAN>, arrival));
        element.addAttribute(<SPAN class="code-keyword">new</SPAN> Attribute(<SPAN class="code-quote">&quot;onDeparture&quot;</SPAN>, departure));
        element.addAttribute(<SPAN class="code-keyword">new</SPAN> Attribute(<SPAN class="code-quote">&quot;filter&quot;</SPAN>, filter));
        
        <SPAN class="code-comment">// Optional attribute
</SPAN>        <SPAN class="code-keyword">if</SPAN> (modification != <SPAN class="code-keyword">null</SPAN>) {
            element.addAttribute(<SPAN class="code-keyword">new</SPAN> Attribute(<SPAN class="code-quote">&quot;onModification&quot;</SPAN>, modification));
        }        
        
        <SPAN class="code-keyword">return</SPAN> element;
    }

    <SPAN class="code-keyword">private</SPAN> void ensureValidity() {
        <SPAN class="code-keyword">if</SPAN> (arrival == <SPAN class="code-keyword">null</SPAN>) {
            <SPAN class="code-keyword">throw</SPAN> <SPAN class="code-keyword">new</SPAN> IllegalStateException(<SPAN class="code-quote">&quot;The whiteboard pattern configuration must have a onArrival method&quot;</SPAN>);
        }
        <SPAN class="code-keyword">if</SPAN> (departure == <SPAN class="code-keyword">null</SPAN>) {
            <SPAN class="code-keyword">throw</SPAN> <SPAN class="code-keyword">new</SPAN> IllegalStateException(<SPAN class="code-quote">&quot;The whiteboard pattern configuration must have a onDeparture method&quot;</SPAN>);
        }
        <SPAN class="code-keyword">if</SPAN> (filter == <SPAN class="code-keyword">null</SPAN>) {
            <SPAN class="code-keyword">throw</SPAN> <SPAN class="code-keyword">new</SPAN> IllegalStateException(<SPAN class="code-quote">&quot;The whiteboard pattern configuration must have a filter&quot;</SPAN>);
        }
        
    }
</PRE>
</DIV></DIV>

<P>The only required method is <TT>getElement</TT> returning the Element-Attribute structure representing the handler configuration (this uses the internal iPOJO data format). If the metadata cannot be generated, the class throws IllegalStateExceptions.</P>

<H2><A name="apache-felix-ipojo-api-CreatingcompositionwiththeAPI"></A>Creating composition with the API</H2>
<P>The API also allows you to create iPOJO compositions in a pretty simple way. So you can create compositions:</P>
<UL>
	<LI>containing internal instances</LI>
	<LI>importing services</LI>
	<LI>instantiating sub-services</LI>
	<LI>exporting services</LI>
	<LI>providing services (by delegation)</LI>
</UL>


<P>Here are some examples:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Contained instances</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
 PrimitiveComponentType prov = createAProvider(); <SPAN class="code-comment">// Create a primitive type
</SPAN> PrimitiveComponentType cons = createAConsumer(); <SPAN class="code-comment">// Create another primitive type
</SPAN>       
       CompositeComponentType type = <SPAN class="code-keyword">new</SPAN> CompositeComponentType()
           .setBundleContext(context)
           .setComponentTypeName(<SPAN class="code-quote">&quot;comp1&quot;</SPAN>)
           .addInstance(<SPAN class="code-keyword">new</SPAN> Instance(prov.getFactory().getName())) <SPAN class="code-comment">// Create an instance in the composite
</SPAN>           .addInstance(<SPAN class="code-keyword">new</SPAN> Instance(cons.getFactory().getName())); 
       
       ComponentInstance ci = type.createInstance();
</PRE>
</DIV></DIV>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Importing services</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
 CompositeComponentType type = <SPAN class="code-keyword">new</SPAN> CompositeComponentType()
           .setBundleContext(context)
           .setComponentTypeName(<SPAN class="code-quote">&quot;comp3&quot;</SPAN>)
           .addSubService(<SPAN class="code-keyword">new</SPAN> InstantiatedService() <SPAN class="code-comment">// Importation
</SPAN>              .setSpecification(Foo.class.getName())
              .setOptional(<SPAN class="code-keyword">true</SPAN>));
</PRE>
</DIV></DIV>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Instantiated sub-services</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
  CompositeComponentType type = <SPAN class="code-keyword">new</SPAN> CompositeComponentType()
           .setBundleContext(context)
           .setComponentTypeName(<SPAN class="code-quote">&quot;comp2&quot;</SPAN>)
           .addSubService(<SPAN class="code-keyword">new</SPAN> InstantiatedService()  <SPAN class="code-comment">// Instantiated service
</SPAN>              .setSpecification(Foo.class.getName()))
           .addInstance(<SPAN class="code-keyword">new</SPAN> Instance(cons.getFactory().getName()));
</PRE>
</DIV></DIV>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Exported Services</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
CompositeComponentType type = <SPAN class="code-keyword">new</SPAN> CompositeComponentType()
           .setBundleContext(context)
           .setComponentTypeName(<SPAN class="code-quote">&quot;compExport&quot;</SPAN>)
           .addSubService(<SPAN class="code-keyword">new</SPAN> InstantiatedService().setSpecification(Foo.class.getName()))
           .addService(<SPAN class="code-keyword">new</SPAN> ExportedService()
                .setSpecification(Foo.class.getName())); <SPAN class="code-comment">// Exports a service</SPAN>
</PRE>
</DIV></DIV>
<P><BR class="atl-forced-newline"></P>

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on 2010-04-14 10:31:36.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
