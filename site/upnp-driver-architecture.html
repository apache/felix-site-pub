
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - UPnP Driver architecture</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H1><A name="UPnPDriverarchitecture-OverviewoftheBaseDriverArchitecture%26nbsp%3B"></A>Overview of the Base Driver Architecture&nbsp;</H1>

<P>The Figure 4 shows a simplified component view of the base driver. The driver is composed of two components, the <B>exporter</B> and <B>importer</B>; both using the <EM>CyberDomo</EM> library, which is a modified version of the library released by the <A href="http://www.cybergarage.org/net/upnp/java/index.html" class="external-link" rel="nofollow">&quot;CyberLink for Java&quot; project</A>, maintained by the <A href="http://domoware.isti.cnr.it/" class="external-link" rel="nofollow">Domoware project</A>. The library implements a full UPnP stack. The base driver acts as a bridge between OSGi and the UPnP networks .<BR>
<SPAN class="image-wrap" style=""><IMG src="upnp-driver-architecture.data/BaseDriverArchitecture.jpg" style="border: 0px solid black"></SPAN><BR>
<B>Figure 4</B> The UPnP Base Driver architecture</P>

<P>In order to instantiate UPnP devices, developers must register services implementing the interfaces represented in Figure 5 and provided by the <EM>org.osgi.compendium bundle</EM>. The <EM>exporter</EM> is registered as <A href="http://www.osgi.org/javadoc/r4/org/osgi/framework/ServiceListener.html" class="external-link" rel="nofollow">ServiceListener </A>with the framework and it automatically exposes on the networks each <A href="http://www.osgi.org/javadoc/r4/org/osgi/service/upnp/UPnPDevice.html" class="external-link" rel="nofollow">UPnPDevice </A>service registered with the registration property <A href="http://www.osgi.org/javadoc/r4/org/osgi/service/upnp/UPnPDevice.html#UPNP_EXPORT" class="external-link" rel="nofollow">UPNP_EXPORT</A>. The <EM>importer</EM> listens to the advertisements sent on the networks by external devices and registers with the framework one or more UPnPDevice services. Even if it is not required by the specification, the devices imported by the Felix base driver are labeled with the registration property <A href="http://svn.apache.org/viewvc/felix/trunk/upnp/basedriver/src/main/java/org/apache/felix/upnp/basedriver/util/Constants.java?view=markup" class="external-link" rel="nofollow">UPNP_IMPORT</A>.<BR>
<SPAN class="image-wrap" style=""><IMG src="upnp-driver-architecture.data/UPnPDeviceInterfaces.jpg" style="border: 0px solid black"></SPAN><BR>
<B>Figure 5</B> The UPnP Device interfaces</P>

<P>Working with UPnP Device from the OSGi point of view means to operate with services; the discovery, controlling and eventing phases of the UPnP protocol are naturally mapped to the OSGi service layer, which allows to publish, find, bind and notify events. There are some aspects that make it different to work with UPnP in OSGi with respect to other UPnP libraries, due basically to the centralized nature of the OSGi registry opposed to the distributed approach used in UPnP networks; some hints are provided in the section &quot;Writing UPnP Devices and Control Points&quot;</P>

<P>The Felix base driver comes with some system properties you can use to configure it at startup.</P>

<P>The system properties:<BR>
&bull; <EM>cyberdomo.ssdp.mx</EM> (default 5)<BR>
&bull; <EM>cyberdomo.ssdp.buffersize</EM> (default 2048)<BR>
&bull; <EM>cyberdomo.ssdp.port</EM> (default 1900)</P>

<P>are used by the UPnP stack library during the UPnP discovery process. The paper &quot;<A href="http://w3.antd.nist.gov/~mills/papers/Paper521.pdf" class="external-link" rel="nofollow">Adaptive Jitter Control for UPnP M-Search</A>&quot; [1] provides a good analysis of the tuning of such parameters related to scalability issues. The MX parameter default has been set to 5 sec. Higher values improve the discovery effectiveness but increase the latency for new device discovery. The Intel &quot;<A href="http://www.intel.com/cd/ids/developer/asmo-na/eng/downloads/upnp/index.htm" class="external-link" rel="nofollow">Device Spy</A>&quot; tool uses a delay of 10 sec, the &quot;CyberLink for Java&quot; library 3 sec. The SSDP port in UPnP specification is by default 1900 we allow the modification of such parameter.</P>

<P>The following system properties:<BR>
&bull; <EM>felix.upnpbase.exporter.enabled</EM> (default true)<BR>
&bull; <EM>felix.upnpbase.importer.enabled</EM> (default true)</P>

<P>can be used to enable or disable the two main components of the base driver. For example with small devices (ARM-based processor), disabling the exporting or importing of devices might reduce the resource consumption.</P>

<P>&bull; <EM>felix.upnpbase.log</EM> (default 2)<BR>
&bull; <EM>felix.upnpbase.cyberdomo.log</EM> (default false)</P>

<P>are properties used to enable the different logging facilities offered by the base driver. You can also modify them at run time by using the GUI provided by the UPnP Tester bundle</P>

<P>Finally the following properties are used to set the networking parameters. The loopback interface is usually disabled :</P>

<P>&bull; <EM>felix.upnpbase.cyberdomo.net.loopback</EM> (default false)<BR>
&bull; <EM>felix.upnpbase.cyberdomo.net.onlyIPV4</EM> (default true)<BR>
&bull; <EM>felix.upnpbase.cyberdomo.net.onlyIPV6</EM> (default false)</P>

<H5><A name="UPnPDriverarchitecture-GettingStartedUPnPGettingStarted%3C%3C%5C%3E%3ETestingUPnPDevicesUPnPTestingDevices"></A><A href="upnp-getting-started.html" title="UPnP Getting Started">Getting Started</A> &lt;&lt; &#124; &gt;&gt; <A href="upnp-testing-devices.html" title="UPnP Testing Devices">Testing UPnP Devices</A></H5>


<HR>
<P>[1] K. Mills, C. Dabrowski &quot;Adaptive Jitter Control for UPnP M-Search&quot; IEEE International Conference on Communications, 2003. ICC '03. page(s): 1008&#45; 1013 vol.2 </P>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by francesco.furfari@isti.cnr.it on 2008-04-15 14:33:55.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
