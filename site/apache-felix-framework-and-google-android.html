
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix Framework and Google Android</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H1><A name="ApacheFelixFrameworkandGoogleAndroid-ApacheFelixFrameworkandGoogleAndroid"></A>Apache Felix Framework and Google Android</H1>

<P>The purpose of this document is to explain how to use <A href="http://felix.apache.org/" class="external-link" rel="nofollow">Apache Felix</A> on Google's new mobile phone platform - <A href="http://code.google.com/android" class="external-link" rel="nofollow">Android</A>.</P>

<H2><A name="ApacheFelixFrameworkandGoogleAndroid-DalvikVM"></A>Dalvik VM</H2>

<P>Google Android SDK allows developers to write Java code in order to create Android applications. Instead of a regular Java Virtual Machine that executes this code, a special-purpose virtual machine named Dalvik is being used in order to comply with mobile platform requirements. Dalvik does not use Java bytecode format, but, a tool named dx, included in the Android SDK, transforms the Java class files of Java classes compiled by a regular Java compiler into another class file format (the .dex format) (the conversion is not done at runtime).</P>

<H2><A name="ApacheFelixFrameworkandGoogleAndroid-Preparingbundles"></A>Preparing bundles</H2>

<P>Although Felix, since version 1.0.3, has built in support for Android, there are still some things needed to be done in order to successfully make use of it ( you will need to install <A href="http://code.google.com/android/download.html" class="external-link" rel="nofollow">Android SDK</A> and you should have &lt;android_SDK_HOME&gt;/tools added to system PATH variable). The zip file available for download has been created in the same manner.</P>

<P><B>Step 1</B>: Each JAR file you use, either as a Felix library or as a bundle, should contain its DEX equivalent. This means that you must first create a DEX file for your JAR:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>dx --dex --output=classes.dex JAR_file.jar
</PRE>
</DIV></DIV>

<P>Then you must add the DEX file to your JAR file:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>aapt add JAR_file.jar classes.dex
</PRE>
</DIV></DIV>

<P><B>Step 2</B>: The processed JARs should be made available to Android by transferring them to the emulator:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>emulator &amp;
adb push JAR_file.jar path_emulator/JAR_file.jar
</PRE>
</DIV></DIV>

<P><B>Step 3</B>: Referring to the sample project for a concrete example, these steps are preformed:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>osgi-android: /
\- bin
\- bundle
\- conf
\- felix.sh
</PRE>
</DIV></DIV>

<P>Prepare the Felix JAR:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>export PATH=&lt;path-to-android&gt;/tools:$PATH
cd bin
dx --dex --output=classes.dex felix.jar
aapt add felix.jar classes.dex
</PRE>
</DIV></DIV>

<P>Prepare the bundle JARS:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>cd bundle
dx --dex --output=classes.dex org.apache.felix.shell-1.0.0.jar
aapt add org.apache.felix.shell-1.0.0.jar classes.dex
dx --dex --output=classes.dex org.apache.felix.shell.tui-1.0.0.jar
aapt add org.apache.felix.shell.tui-1.0.0.jar classes.dex
dx --dex --output=classes.dex EnglishDictionary.jar
aapt add EnglishDictionary.jar classes.dex
dx --dex --output=classes.dex FrenchDictionary.jar
aapt add FrenchDictionary.jar classes.dex
dx --dex --output=classes.dex SpellChecker.jar
aapt add SpellChecker.jar classes.dex
</PRE>
</DIV></DIV>

<P>Transfer all of them to the emulator (note that you need some kind of unix-like shell, such as the Mac OS X terminal or Linux):</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>cd osgi-android
emulator &amp;
find * -type f -exec adb push {} /data/felix/{} \;
</PRE>
</DIV></DIV>


<H2><A name="ApacheFelixFrameworkandGoogleAndroid-LaunchingFelix"></A>Launching Felix</H2>

<P>Once you've done that, you should be able to launch Felix and the bundles on Android: start emulator shell, change directory to the location of your Felix files and execute felix.sh.</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>adb shell
cd /data/felix
sh felix.sh
</PRE>
</DIV></DIV>

<P><TT>felix.sh</TT> contains a Unix shell command that launches Felix main class using the actual runtime of the emulator.</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>/system/bin/dalvikvm -Xbootclasspath:/system/framework/core.jar \
  -classpath bin/felix.jar org.apache.felix.main.Main
</PRE>
</DIV></DIV>

<P>If all went well, you should see the Felix command line shell now. Type &quot;help&quot; for further instructions.</P>

<P>You may now install and launch EnglishDictionary, FrenchDictionary, and SpellChecker bundles to test how Felix is working. These are all examples from the Apache Felix OSGi tutorial and correspond to <A href="apache-felix-tutorial-example-2.html" title="Apache Felix Tutorial Example 2">Apache Felix Tutorial Example 2</A>, <A href="apache-felix-tutorial-example-2b.html" title="Apache Felix Tutorial Example 2b">Apache Felix Tutorial Example 2b</A>, and <A href="apache-felix-tutorial-example-5.html" title="Apache Felix Tutorial Example 5">Apache Felix Tutorial Example 5</A> respectively.</P>

<UL>
	<LI><B>EnglishDictionary</B> - supplies a Dictionary service implementation with the following collection of words &quot;welcome&quot;, &quot;to&quot;, &quot;the&quot;, &quot;osgi&quot;, &quot;tutorial&quot;</LI>
	<LI><B>FrenchDictionary</B> - supplies a Dictionary service implementation with the following collection of words &quot;bienvenue&quot;, &quot;au&quot;, &quot;tutoriel&quot;, &quot;osgi&quot;</LI>
	<LI><B>SpellChecker</B> - supplies a spell checker that retrieves the first Dictionary implementation it finds and checks if the word you've entered is in the dictionary or not.</LI>
</UL>


<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>start file:bundle/EnglishDictionary.jar
start file:bundle/FrenchDictionary.jar
start file:bundle/SpellChecker.jar
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixFrameworkandGoogleAndroid-EmbeddingFelix"></A>Embedding Felix</H2>

<P>Apache Felix can also be integrated with an Android application. To achieve this, you need to embed Felix into <TT>onCreate()</TT> method of your Activity class (see Android docs for more details on how to use an Activity) and process your bundles as shown above.</P>

<H2><A name="ApacheFelixFrameworkandGoogleAndroid-Download"></A>Download</H2>

<P>The project zip file <A href="documentation.data/osgi-android%20-%20felix%201.4,%20android%20SDK%201.0.zip">osgi-android.zip</A></P>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by heavy@ungoverned.org on 2009-05-05 09:04:48.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
