
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix Bundle Plugin FAQ</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H1><A name="ApacheFelixBundlePluginFAQ-ApacheFelixBundlePluginFrequentlyAskedQuestions"></A>Apache Felix Bundle Plugin Frequently Asked Questions</H1>

<STYLE type="text/css">/*<![CDATA[*/
div.rbtoc1322871748328 {margin-left: 1.5em;padding: 0px;}
div.rbtoc1322871748328 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1322871748328 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</STYLE><DIV class="rbtoc1322871748328">
<UL>
    <LI><A href="#ApacheFelixBundlePluginFAQ-ApacheFelixBundlePluginFrequentlyAskedQuestions">Apache Felix Bundle Plugin Frequently Asked Questions</A></LI>
<UL>
    <LI><A href="#ApacheFelixBundlePluginFAQ-WhenIembedadependencywhydoIseeduplicatedcontent%253F">When I embed a dependency why do I see duplicated content?</A></LI>
    <LI><A href="#ApacheFelixBundlePluginFAQ-WhydoIseemoreclassesinmybundleafterupgradingtomavenbundleplugin2.0.0%253F">Why do I see more classes in my bundle after upgrading to maven-bundle-plugin 2.0.0?</A></LI>
    <LI><A href="#ApacheFelixBundlePluginFAQ-WhydoIgetanexception%2528Unsupportedmajor.minorversion49.0%2529whenIbuildwitha1.4orearlierJDK%253F">Why do I get an exception (Unsupported major.minor version 49.0) when I build with a 1.4 or earlier JDK?</A></LI>
    <LI><A href="#ApacheFelixBundlePluginFAQ-WhenIbuildabundle%252Csomeclassesarebuiltin%2522target%252Fclasses%2522butthey%2527renotincludedinthefinaljar.">When I build a bundle, some classes are built in &quot;target/classes&quot; but they're not included in the final jar.</A></LI>
    <LI><A href="#ApacheFelixBundlePluginFAQ-HowdoIremovethegeneratedMaveninformationfromtheresultingbundleJARfile%253F">How do I remove the generated Maven information from the resulting bundle JAR file?</A></LI>
    <LI><A href="#ApacheFelixBundlePluginFAQ-Whydosomegeneratedresources%2528suchasDeclarativeServicesXMLfiles%2529appearinthefinaljar%252Cbutothersdon%2527t%253F">Why do some generated resources (such as Declarative Services XML files) appear in the final jar, but others don't?</A></LI>
</UL>
</UL></DIV>

<H2><A name="ApacheFelixBundlePluginFAQ-WhenIembedadependencywhydoIseeduplicatedcontent%3F"></A>When I embed a dependency why do I see duplicated content?</H2>

<P>Having two copies of classes, both unpacked and embedded as jars, is a sign that your Embed-Dependency and Export-Package instructions are overlapping. Export-Package tells BND to pull in classes found in the named packages from the build classpath and add them to the bundle, Embed-Dependency tells BND to embed (or inline if enabled) whole artifacts in the bundle.</P>

<P>so say I have:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>Export-Package: org.objectweb.asm.*
</PRE>
</DIV></DIV>

<P>and I have the asm artifact as a compile scope dependency, then I would see the org.objectweb.asm classes unpacked in the bundle, ie. pulled in by BND.</P>

<P>say I now decide to embed asm as a jar, for example with:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>Embed-Dependency: *;scope=compile|runtime
</PRE>
</DIV></DIV>

<P>I would now see the asm artifact embedded inside bundle - but I would also see the unpacked classes from before, because I'm still asking BND to pull them in (you will probably also see split package warnings during the build).</P>

<P>ok - so how do I embed asm as a jar, but mark its packages as exported without pulling in the unpacked classes... well, there is another export instruction added for exactly this reason:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>-exportcontents: org.objectweb.asm.*
</PRE>
</DIV></DIV>

<P>(this is &lt;_exportcontents&gt; in the POM because a tag can't start with '-')</P>

<P>this instruction is merged with Export-Package, after BND has decided on the content of the bundle - that is, it works just like Export-Package except that it won't alter the content of the bundle.</P>

<P>So by removing org.objectweb.asm.* from Export-Package and using the -exportcontents instruction instead along with Embed-Dependency, I can now embed the asm artifact in my bundle and export its packages:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>Embed-Dependency: *;scope=compile|runtime
-exportcontents: org.objectweb.asm.*
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixBundlePluginFAQ-WhydoIseemoreclassesinmybundleafterupgradingtomavenbundleplugin2.0.0%3F"></A>Why do I see more classes in my bundle after upgrading to maven-bundle-plugin 2.0.0?</H2>

<P>Before 2.0.0 the maven-bundle-plugin only passed local classes and compile scope dependencies to bnd. This was because the main BundlePlugin mojo used &quot;@requiresDependencyResolution runtime&quot; which asks Maven to only resolve dependencies of compile or runtime scope (the maven-bundle-plugin also explicitly filtered runtime scope dependencies from the classpath passed to bnd). Because bnd only had a fraction of the original classpath used to compile the bundle classes it meant that imported packages weren't augmented with additional information (such as versions and attributes) available from the complete classpath.</P>

<P>In 2.0.0 a conscious decision was made to pass the complete classpath to bnd so it would have the complete set of information used during compilation. To do this the @requiresDependencyResolution setting was changed to &quot;test&quot; so all dependencies will now be resolved. Furthermore only test scope artifacts are now filtered from the final classpath passed to bnd.</P>

<P>For most users passing more of the original compilation classpath to bnd simply means you get more accurate and consistent results. However, if you happened to rely on the old behaviour (perhaps by setting Private-Package: * to pull in all local and compile scope classes) then you will see more classes added to your bundle as the wildcard matches against additional content in the classpath.</P>

<P>There are two solutions when this happens:</P>

<UL>
	<LI>Change your Private-Package / Export-Package instructions to more accurately describe what you want in your bundle</LI>
	<LI>Add the following setting to remove provided and runtime scope dependencies from the classpath passed to bnd:
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
  &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;excludeDependencies&gt;*;scope=provided|runtime&lt;/excludeDependencies&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;
</PRE>
</DIV></DIV></LI>
</UL>


<P>This second option effectively switches the maven-bundle-plugin back to the old 1.X behaviour.</P>

<P>Please also note that since 2.0.0 the maven-bundle-plugin also sets default Export-Package and Private-Package instructions based on your local source files, so you might well find that simply removing any Private-Package and/or Export-Package instructions from your pom.xml will actually produce the correct result.</P>

<H2><A name="ApacheFelixBundlePluginFAQ-WhydoIgetanexception%28Unsupportedmajor.minorversion49.0%29whenIbuildwitha1.4orearlierJDK%3F"></A>Why do I get an exception (Unsupported major.minor version 49.0) when I build with a 1.4 or earlier JDK?</H2>

<P>The latest maven-bundle-plugin (2.0.0) uses a new release of bnd which requires Java5. This means you now have to build your bundle projects using a Java5 (or later) JDK. Note that you can still compile classes for earlier releases of the JVM by setting the appropriate source and target levels in your pom.xml:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>&lt;plugin&gt;
  &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
  &lt;configuration&gt;
    &lt;source&gt;1.4&lt;/source&gt;
    &lt;target&gt;1.4&lt;/target&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixBundlePluginFAQ-WhenIbuildabundle%2Csomeclassesarebuiltin%22target%2Fclasses%22butthey%27renotincludedinthefinaljar."></A>When I build a bundle, some classes are built in &quot;target/classes&quot; but they're not included in the final jar.</H2>

<P>The only classes that will appear in the bundle are the ones you ask it to include using Export-Package, Private-Package, Include-Resource, and Embed-Dependency - so just because a file exists under target/classes does NOT mean it will end up in the bundle. This is because this is the way the underlying <A href="http://aqute.biz/Code/Bnd" class="external-link" rel="nofollow">BND</A> tool works (it is primarily pull-based).</P>

<P>Now the bundleplugin will look at your Maven project and add appropriate BND instructions to pull in resource files - and version 2.0.0 will also look at your source directory to set reasonable defaults for Export-Package and Private-Package (unless you set these yourself). So when using bundleplugin 2.0.0 I'd use the default Private-Package and Export-Package to begin with - I would then move towards using an explicit list of packages in Export-Package to add versioning, directives, etc.</P>

<P>The only time I would set Private-Package would be to have more control over what ends up in the bundle - either to remove certain packages or perhaps pull in additional packages not found by the source scanner. Also note that both Export-Package and Private-Package accept wildcards such as &quot;org.example.&#42;&quot; which can reduce the number of entries in the list, but you should be careful not to set either the export or private instruction to &quot;&#42;&quot; as this would pull in the entire classpath... dependencies and all!</P>

<H2><A name="ApacheFelixBundlePluginFAQ-HowdoIremovethegeneratedMaveninformationfromtheresultingbundleJARfile%3F"></A>How do I remove the generated Maven information from the resulting bundle JAR file?</H2>

<P>Use the following archive setting:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>&lt;configuration&gt;
  &lt;archive&gt;
    &lt;addMavenDescriptor&gt;false&lt;/addMavenDescriptor&gt;
  &lt;/archive&gt;
&lt;/configuration&gt;
</PRE>
</DIV></DIV>

<P>Put this in either the JAR or bundle plugin configuration.</P>

<H2><A name="ApacheFelixBundlePluginFAQ-Whydosomegeneratedresources%28suchasDeclarativeServicesXMLfiles%29appearinthefinaljar%2Cbutothersdon%27t%3F"></A>Why do some generated resources (such as Declarative Services XML files) appear in the final jar, but others don't?</H2>

<P>When you use the Service-Component instruction to specify Declarative Services the BND tool scans the project classpath for components and automatically adds its generated XML to the final bundle, therefore Include-Resource is not necessary. But if you generate files under OSGI-INF using another mechanism then they won't end up in the bundle unless you add that directory using Include-Resource (this goes back to the core design decision that BND pulls classes and resources into the bundle, rather than just taking everything under target/classes). We try to provide reasonable defaults on the Maven side in the bundleplugin so local classes and resources will end up in the bundle without additional configuration, but we do this by looking at the effective pom and src/ folder rather than the generated target/classes content.</P>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by mcculls on Fri Dec 02 19:22:26 EST 2011
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
