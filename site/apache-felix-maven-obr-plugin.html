
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix Maven OBR Plugin</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<DIV class="panelMacro"><TABLE class="warningMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="https://cwiki.apache.org/confluence/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD>The <B>maven-obr-plugin</B> is <B>deprecated</B> and its features have been <B>merged</B> into the <B>1.4.0</B> release of the <B><A href="apache-felix-maven-bundle-plugin-bnd.html" title="Apache Felix Maven Bundle Plugin (BND)">maven-bundle-plugin</A></B></TD></TR></TABLE></DIV>

<P>This Maven plug-in aims to automate OBR (OSGi Bundle Repository) management. It helps manage a local OBR for your local Maven repository, and also supports remote OBRs for bundle distribution. The plug-in automatically computes bundle capabilities and requirements, using a combination of Bindex and Maven metadata.</P>

<H2><A name="ApacheFelixMavenOBRPlugin-Features"></A>Features</H2>

<P>The maven-obr-plugin supports:</P>
<UL>
	<LI>Management of both local and remote OBRs</LI>
	<LI>Registering Maven and non-Maven artifacts with OBRs</LI>
	<LI>Automatically discovering bundle capabilities and requirements</LI>
	<LI>Customizing bundle descriptions</LI>
</UL>


<H2><A name="ApacheFelixMavenOBRPlugin-Howtousethemavenobrplugin%3F"></A>How to use the maven-obr-plugin?</H2>

<P>The plug-in offers five Maven goals:</P>
<UL>
	<LI><B>install</B> adds the current bundle project to the local OBR</LI>
	<LI><B>install-file</B> adds a local bundle file to the local OBR</LI>
	<LI><B>deploy</B> adds the current bundle project to a remote OBR</LI>
	<LI><B>deploy-file</B> adds a local bundle file to a remote OBR</LI>
	<LI><B>clean</B> cleans the local OBR, removing missing bundles</LI>
</UL>


<P>Any of these goals can be disabled by setting <TT>&#45;DobrRepository=NONE</TT></P>

<H2><A name="ApacheFelixMavenOBRPlugin-obr%3Ainstall"></A>obr:install</H2>

<P>The <B>install</B> goal updates the local OBR with the details of the installed bundle from the local Maven repository.</P>

<P>(If the project has an <TT>obr.xml</TT> file somewhere in its resources, then it will be automatically detected and applied.)</P>

<P>configuration:</P>
<UL>
	<LI><EM>obrRepository</EM> path to local OBR, defaults to <EM>&lt;local-maven-repository&gt;</EM><TT>/repository.xml</TT></LI>
</UL>


<P>To attach this goal to your project's lifecycle, use:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;plugin&gt;</SPAN>
  <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
  <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-obr-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
  <SPAN class="code-tag">&lt;version&gt;</SPAN>1.2.0<SPAN class="code-tag">&lt;/version&gt;</SPAN>
  <SPAN class="code-tag">&lt;executions&gt;</SPAN>
    <SPAN class="code-tag">&lt;execution&gt;</SPAN>
      <SPAN class="code-tag">&lt;goals&gt;</SPAN>
        <SPAN class="code-tag">&lt;goal&gt;</SPAN>install<SPAN class="code-tag">&lt;/goal&gt;</SPAN>
      <SPAN class="code-tag">&lt;/goals&gt;</SPAN>
    <SPAN class="code-tag">&lt;/execution&gt;</SPAN>
  <SPAN class="code-tag">&lt;/executions&gt;</SPAN>
<SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixMavenOBRPlugin-obr%3Ainstallfile"></A>obr:install-file</H2>

<P>The <B>install-file</B> goal updates the local OBR with the details of a bundle from the local filesystem.</P>

<P>configuration:</P>
<UL>
	<LI><EM>obrRepository</EM> path to local OBR, defaults to <EM>&lt;local-maven-repository&gt;</EM><TT>/repository.xml</TT></LI>
	<LI><EM>groupId</EM> Maven groupId for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>artifactId</EM> Maven artifactId for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>version</EM> Maven version for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>packaging</EM> Maven packaging type for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>classifier</EM> Maven classifier type, defaults to none</LI>
	<LI><EM>pomFile</EM> optional Pom file describing the bundle</LI>
	<LI><EM>file</EM> bundle file, defaults to the bundle from the local Maven repository</LI>
	<LI><EM>obrXml</EM> optional additional properties for the bundle</LI>
</UL>


<P>Example:</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>mvn org.apache.felix:maven-obr-plugin:1.2.0:install-file \
  -DpomFile=myPom.xml -Dfile=foo-1.0.jar
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixMavenOBRPlugin-obr%3Adeploy"></A>obr:deploy</H2>

<P>The <B>deploy goal</B> updates the remote OBR with the details of the deployed bundle from the local Maven repository. The remote OBR is found by querying the <TT>&lt;distributionManagement&gt;</TT> section of the project, unless <TT>&#45;DaltDeploymentRepository</TT> is set. See <A href="http://maven.apache.org/plugins/maven-deploy-plugin/deploy-mojo.html" class="external-link" rel="nofollow">http://maven.apache.org/plugins/maven-deploy-plugin/deploy-mojo.html</A> for more details about these particular settings.</P>

<P>(If the project has an <TT>obr.xml</TT> file somewhere in its resources, then it will be automatically detected and applied.)</P>

<P>configuration:</P>
<UL>
	<LI><EM>obrRepository</EM> name of remote OBR, defaults to <TT>repository.xml</TT></LI>
	<LI><EM>altDeploymentRepository</EM> alternative remote repository, <EM>id::layout::url</EM></LI>
	<LI><EM>ignoreLock</EM> ignore remote locking when updating the OBR</LI>
</UL>


<P>To attach this goal to your project's lifecycle, use:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;plugin&gt;</SPAN>
  <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
  <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-obr-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
  <SPAN class="code-tag">&lt;version&gt;</SPAN>1.2.0<SPAN class="code-tag">&lt;/version&gt;</SPAN>
  <SPAN class="code-tag">&lt;executions&gt;</SPAN>
    <SPAN class="code-tag">&lt;execution&gt;</SPAN>
      <SPAN class="code-tag">&lt;goals&gt;</SPAN>
        <SPAN class="code-tag">&lt;goal&gt;</SPAN>deploy<SPAN class="code-tag">&lt;/goal&gt;</SPAN>
      <SPAN class="code-tag">&lt;/goals&gt;</SPAN>
    <SPAN class="code-tag">&lt;/execution&gt;</SPAN>
  <SPAN class="code-tag">&lt;/executions&gt;</SPAN>
<SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixMavenOBRPlugin-obr%3Adeployfile"></A>obr:deploy-file</H2>

<P>The <B>deploy-file</B> goal updates the remote OBR with the details of a deployed bundle from the local filesystem. The remote OBR is found using the <TT>&#45;DrepositoryId</TT> and <TT>&#45;Durl</TT> parameters. See <A href="http://maven.apache.org/plugins/maven-deploy-plugin/deploy-file-mojo.html" class="external-link" rel="nofollow">http://maven.apache.org/plugins/maven-deploy-plugin/deploy-file-mojo.html</A> for more details about these particular settings.</P>

<P>You can use the <TT>&#45;DbundleUrl</TT> parameter to give the public location of the deployed bundle, which may differ from the remote OBR location.</P>

<P>configuration:</P>
<UL>
	<LI><EM>obrRepository</EM> name of remote OBR, defaults to <TT>repository.xml</TT></LI>
	<LI><EM>repositoryId</EM> optional repository id, used to lookup authentication settings</LI>
	<LI><EM>url</EM> remote repository transport URL, like
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>scpexe://host/path/to/obr
</PRE>
</DIV></DIV></LI>
	<LI><EM>bundleUrl</EM> public URL of deployed bundle, like
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>http://www.foo.org/bundles/foo.jar
</PRE>
</DIV></DIV></LI>
	<LI><EM>groupId</EM> Maven groupId for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>artifactId</EM> Maven artifactId for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>version</EM> Maven version for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>packaging</EM> Maven packaging type for the bundle, taken from <EM>pomFile</EM> if given</LI>
	<LI><EM>classifier</EM> Maven classifier type, defaults to none</LI>
	<LI><EM>pomFile</EM> optional Pom file describing the bundle</LI>
	<LI><EM>file</EM> bundle file, defaults to the bundle from the local Maven repository</LI>
	<LI><EM>obrXml</EM> optional additional properties for the bundle</LI>
	<LI><EM>ignoreLock</EM> ignore remote locking when updating the OBR</LI>
</UL>


<P>Example:</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>mvn org.apache.felix:maven-obr-plugin:1.2.0:deploy-file \
  -DpomFile=myPom.xml -Dfile=foo-1.0.jar -Durl=file:/tmp/example/OBR \
  -DbundleUrl=http://www.foo.org/bundles/foo.jar
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixMavenOBRPlugin-obr%3Aclean"></A>obr:clean</H2>

<P>Sometimes you would like to clean your local OBR because it contains bundles that are no longer in your local Maven repository. This case often occurs when artifacts were deleted manually. The maven-obr-plugin provides a simple goal to check for missing bundles, and remove them from the local OBR.</P>

<P>configuration:</P>
<UL>
	<LI><EM>obrRepository</EM> path to local OBR, defaults to <EM>&lt;local-maven-repository&gt;</EM>{<TT>}</TT><TT>/repository.xml</TT></LI>
</UL>


<P>To attach this goal to your project's lifecycle, use:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;plugin&gt;</SPAN>
  <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
  <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-obr-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
  <SPAN class="code-tag">&lt;version&gt;</SPAN>1.2.0<SPAN class="code-tag">&lt;/version&gt;</SPAN>
  <SPAN class="code-tag">&lt;executions&gt;</SPAN>
    <SPAN class="code-tag">&lt;execution&gt;</SPAN>
      <SPAN class="code-tag">&lt;goals&gt;</SPAN>
        <SPAN class="code-tag">&lt;goal&gt;</SPAN>clean<SPAN class="code-tag">&lt;/goal&gt;</SPAN>
      <SPAN class="code-tag">&lt;/goals&gt;</SPAN>
    <SPAN class="code-tag">&lt;/execution&gt;</SPAN>
  <SPAN class="code-tag">&lt;/executions&gt;</SPAN>
<SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixMavenOBRPlugin-Concurrentupdates"></A>Concurrent updates</H2>

<P>With a remote OBR, several uploads may occur at the same time. However, the remote OBR is centralized in one file, so concurrent modification must be avoided. To achieve this, the plug-in implements a locking system. Each time the plug-in tries to modify the file it sets a file based lock. If it can't take the lock, it will wait and retry. After 3 attempts the upload process fails. To bypass this lock add <TT>&#45;DignoreLock</TT> to the command-line (or add <TT>&lt;ignoreLock&gt;true&lt;ignoreLock&gt;</TT> to the configuration section of your Pom).</P>

<H2><A name="ApacheFelixMavenOBRPlugin-FTPprotocol"></A>FTP protocol</H2>

<P>Not all protocols are supported by Maven out of the box. For example the ftp protocol requires the <B>wagon-ftp</B> component. To enable the ftp protocol add this to your Pom:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;build&gt;</SPAN>
  <SPAN class="code-tag">&lt;extensions&gt;</SPAN>
    <SPAN class="code-tag">&lt;extension&gt;</SPAN>
      <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.maven.wagon<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
      <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>wagon-ftp<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
      <SPAN class="code-tag">&lt;version&gt;</SPAN>1.0-alpha-6<SPAN class="code-tag">&lt;/version&gt;</SPAN>
    <SPAN class="code-tag">&lt;/extension&gt;</SPAN>
  <SPAN class="code-tag">&lt;/extensions&gt;</SPAN>
<SPAN class="code-tag">&lt;/build&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixMavenOBRPlugin-Howtheplugincomputesthedescriptionofthebundle"></A>How the plug-in computes the description of the bundle</H2>

<P>The description of the bundle comes from three different sources:</P>
<UL>
	<LI>Bindex : Bindex is a tool that analyzes a bundle manifest to generate OBR description</LI>
	<LI>pom.xml : by analyzing the pom file, various information is collected (symbolic name ...)</LI>
	<LI>obr.xml : this file contains customized description and capabilities for the bundle</LI>
</UL>


<P>These sources are merged together using the following precedence:</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>Bindex
| (overrides)
pom.xml
| (overrides)
obr.xml
</PRE>
</DIV></DIV>
<P>A warning message is displayed when existing information is overridden.</P>

<H2><A name="ApacheFelixMavenOBRPlugin-Knownissues%26limitations"></A>Known issues &amp; limitations</H2>

<OL>
	<LI>obr.xml (file given by the user to add properties not found by Bindex) must be correct, because the plug-in does not check its syntax.</LI>
</OL>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by heavy@ungoverned.org on 2008-03-09 15:07:37.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
