
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Karaf Users' Guide in one page</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="license.html" title="license">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<DIV class="title"><P><SPAN class="image-wrap" style=""><IMG src="karaf-users-guide-in-one-page.data/karaf-logos.png" style="border: 0px solid black"></SPAN>
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">
Apache Felix Karaf<BR>
Users' Guide
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">
<BR class="atl-forced-newline">
<BR class="atl-forced-newline"></P></DIV>

<DIV class="copyright-section"><P>Copyright 2009 The Apache Software Foundation</P></DIV>


<DIV class="toc-title"><P>Table of contents</P></DIV>

<DIV>
<UL>
    <LI><A href="#KarafUsers%2527Guideinonepage-1.Overview">1. Overview</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-2.Quickstart">2. Quick start</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-2.1.QuickStart%2528Source%2529">2.1. Quick Start (Source)</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-3.Installation">3. Installation</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.UnderstandingKaraf">4. Understanding Karaf</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.1.ConsoleandCommands">4.1. Console and Commands</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.2.RemoteConsole">4.2. Remote Console</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.3.Loggingsystem">4.3. Logging system</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.4.Deployer">4.4. Deployer</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.5.Securityframework">4.5. Security framework</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.6.Provisioning">4.6. Provisioning</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.7.Administration">4.7. Administration</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-4.8.Configuration">4.8. Configuration</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-5.UsingKaraf">5. Using Karaf</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-5.1.Troubleshooting%252CDebuggingandProfiling">5.1. Troubleshooting, Debugging and Profiling</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-5.2.Developpingapplications">5.2. Developping applications</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-5.3.Creatingbundlesforthirdpartydependencies">5.3. Creating bundles for third party dependencies</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.Advanceduses">6. Advanced uses</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.1.Extendingtheconsole">6.1. Extending the console</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.2.Buildingcustomdistributions">6.2. Building custom distributions</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.3.Programmaticallyconnecttotheconsole">6.3. Programmatically connect to the console</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.4.EmbeddingKaraf">6.4. Embedding Karaf</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.5.Deployingsecurityproviders">6.5. Deploying security providers</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.6.Installingadditionalfeatures">6.6. Installing additional features</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-6.7.ConfiguringFailoverDeployments">6.7. Configuring Failover Deployments</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-7.OptionalFeatures">7. Optional Features</A></LI>
    <LI><A href="#KarafUsers%2527Guideinonepage-7.1.EnablingColorizedConsoleOutputOnWindows">7.1. Enabling Colorized Console Output On Windows</A></LI>
</UL></DIV>

<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="2-quick-start.html">2. Quick Start</A></TD><TD class="ScrollbarNextIcon"><A href="2-quick-start.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-1.Overview"></A>1. Overview</H1>

<P>Apache Felix Karaf is a small OSGi based runtime which provides a lightweight container onto which various components and applications can be deployed.</P>

<P>Here is a short list of features supported by the Karaf:</P>
<UL>
	<LI><B>Hot deployment</B>: Karaf supports hot deployment of OSGi bundles by monitoring jar files inside the <TT>[home]/deploy</TT> directory.  Each time a jar is copied in this folder, it will be installed inside the runtime.  You can then update or delete it and changes will be handled automatically.  In addition, the Karaf also supports exploded bundles and custom deployers (blueprint and spring ones are included by default).</LI>
	<LI><B>Dynamic configuration</B>: Services are usually configured through the ConfigurationAdmin OSGi service.  Such configuration can be defined in Karaf using property files inside the <TT>[home]/etc</TT> directory.  These configurations are monitored and changes on the properties files will be propagated to the services.</LI>
	<LI><B>Logging System</B>: using a centralized logging back end supported by Log4J, Karaf supports a number of different APIs (JDK 1.4, JCL, SLF4J, Avalon, Tomcat, OSGi)</LI>
	<LI><B>Provisioning</B>: Provisioning of libraries or applications can be done through a number of different ways, by which they will be downloaded locally, installed and started.</LI>
	<LI><B>Native OS integration</B>: Karaf can be integrated into your own Operating System as a service so that the lifecycle will be bound to your Operating System.</LI>
	<LI><B>Extensible Shell console</B>: Karaf features a nice text console where you can manage the services, install new applications or libraries and manage their state.  This shell is easily extensible by deploying new commands dynamically along with new features or applications.</LI>
	<LI><B>Remote access</B>: use any SSH client to connect to Karaf and issue commands in the console</LI>
	<LI><B>Security framework</B> based on JAAS</LI>
	<LI><B>Managing instances</B>: Karaf provides simple commands for managing multiple instances. You can easily create, delete, start and stop instances of Karaf through the console.</LI>
	<LI>Supports the latest OSGi 4.2 containers: Apache Felix Framework 2.0.0 and Eclipse Equinox 3.5</LI>
</UL>


<P><SPAN class="image-wrap" style=""><IMG src="karaf-overview.data/karaf2.png" style="border: 0px solid black"></SPAN></P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="2-quick-start.html">2. Quick Start</A></TD><TD class="ScrollbarNextIcon"><A href="2-quick-start.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="1-overview.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="1-overview.html">1. Overview</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="3-installation.html">3. Installation</A></TD><TD class="ScrollbarNextIcon"><A href="3-installation.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-2.Quickstart"></A>2. Quick start</H1>

<P>If you are in a hurry to have Apache Felix Karaf up and running right away, this section will provide you with some basic steps for downloading, building (when needed) and running the server in no time. This is clearly not a complete guide so you may want to check other sections of this guide for further information.</P>

<P>All you need is 5 to 10 minutes and to follow these basic steps.</P>
<UL>
	<LI><A href="#KarafUsers%2527Guideinonepage-Background">Background</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Gettingthesoftware">Getting the software</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Starttheserver">Start the server</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Deployasampleapplication">Deploy a sample application</A></LI>
</UL>


<H2><A name="KarafUsers%27Guideinonepage-Background"></A>Background</H2>

<P>Apache Felix Karaf is a small and lightweight OSGi based runtime.  This provides a small lightweight container onto which various bundles can be deployed.</P>
<DIV class="panelMacro"><TABLE class="tipMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD>Apache Felix Karaf started life as the <A href="http://servicemix.apache.org/" class="external-link" rel="nofollow">Apache ServiceMix </A> kernel.<BR>
Don't be surprised by any transitional references which remain.</TD></TR></TABLE></DIV>
<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-Gettingthesoftware"></A>Getting the software</H2>

<P>At this time you have one option to get the software. The fastest and easiest way is to get the binary directly from the Apache site. Since this article is intended to help you to have Apache Felix Karaf up and running in the fastest way only the binary download will be covered at this time.</P>

<H3><A name="KarafUsers%27Guideinonepage-Prerequisites"></A>Prerequisites</H3>

<P>Although this installation path is the fastest one, still you will need to install some software before installing Karaf.</P>

<P>Karaf requires a Java 5 environment to run. Refer to <A href="http://java.sun.com/" class="external-link" rel="nofollow">http://java.sun.com</A> for details on how to download and install J2SE 1.5 or greater.</P>

<H3><A name="KarafUsers%27Guideinonepage-Downloadbinaries"></A>Download binaries</H3>

<P>Depending on the platform you plan to install and run Karaf you will select the appropriate installation image. Open a Web browser and access the following URL, there you will find the available packages for download (binaries and source code).</P>

<P><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">http://felix.apache.org/site/downloads.cgi</A></P>

<P>Select the file compression format compatible with your system (zip for windows, tar.gz for unixes) by clicking directly on the link, download it and expand the binary to your hard drive in a new directory; for example in z:\servicemix - from now on this directory will be referenced as &lt;KARAF_HOME&gt;. Please remember the restrictions concerning illegal characters in Java paths, e.g. &#33;, % etc.</P>

<P>The installation of Karaf is as simple as uncompressing the .zip or .tar files. The next step is to start the server.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-Starttheserver"></A>Start the server</H2>

<P>With Karaf already installed, open a command line console and change directory to &lt;SERVICEMIX_HOME&gt;. To start the server, run the following command in Windows:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin\karaf.bat
</PRE>
</DIV></DIV>
<P>respectively on Unix:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin/karaf
</PRE>
</DIV></DIV>
<P>You should see the following informations on the command line console:</P>
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
        __ __                  ____      
       / <SPAN class="code-comment">//_/____ __________ _/ __/      
</SPAN>      / ,&lt;  / __ `/ ___/ __ `/ /_        
     / /| |/ /_/ / /  / /_/ / __/        
    /_/ |_|\__,_/_/   \__,_/_/         

  Apache Felix Karaf (1.0.0)

Hit '&lt;tab&gt;' <SPAN class="code-keyword">for</SPAN> a list of available commands
and '[cmd] --help' <SPAN class="code-keyword">for</SPAN> help on a specific command.

karaf@root&gt; 
</PRE>
</DIV></DIV>
<P>You can now run your first command.  Simply type the <TT>&lt;tab&gt;</TT> key in the console.</P>
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root&gt; 

admin:change-port        admin:connect            admin:create             admin:destroy            admin:list               admin:start
admin:stop               config:cancel            config:edit              config:list              config:propappend        config:propdel
config:proplist          config:propset           config:update            features:addUrl          features:install         features:list
features:listUrl         features:refreshUrl      features:removeUrl       features:uninstall       log:display              log:display-exception
log:get                  log:set                  osgi:bundle-level        osgi:headers             osgi:install             osgi:list
osgi:ls                  osgi:refresh             osgi:resolve             osgi:restart             osgi:shutdown            osgi:start
osgi:start-level         osgi:stop                osgi:uninstall           osgi:update              packages:exports         packages:imports
shell:cat                shell:echo               shell:exec               shell:grep               shell:info               shell:java
shell:printf             shell:sleep              shell:sort               shell:tac                ssh:ssh                  ssh:sshd
karaf@root&gt; 
</PRE>
</DIV></DIV>

<P>You can then grab more specific help for a given command using the <TT>--help</TT> option for this command:</P>

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root&gt; admin:create --help
DESCRIPTION
	admin:create

	Create a <SPAN class="code-keyword">new</SPAN> instance.

SYNTAX
	admin:create [options] [VAL]

ARGUMENTS
	VAL	Name of the <SPAN class="code-keyword">new</SPAN> Karaf instance

OPTIONS
	-p, --port
		Port number <SPAN class="code-keyword">for</SPAN> remote shell connection
	--help
		Display <SPAN class="code-keyword">this</SPAN> help message
	-l, --location
		Location of the <SPAN class="code-keyword">new</SPAN> instance on the file system

karaf@root&gt; 
</PRE>
</DIV></DIV>

<P>Note that the console supports tab completion, so you just need to enter <TT>ad &lt;tab&gt; cr &lt;tab&gt;</TT> instead of <TT>admin:create</TT>.<BR>
<A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-Deployasampleapplication"></A>Deploy a sample application</H2>

<P>While you will learn in the remainder of this guide how to use and leverage Apache Felix Karaf, we will just use the pre-built packaging for now.</P>

<P>In the console, run the following commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
features:install spring-dm
osgi:install -s mvn:org.apache.geronimo.specs/geronimo-activation_1.1_spec/1.0.2
osgi:install -s mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.stax-api-1.0/1.1.0
osgi:install -s mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.jaxb-api-2.1/1.1.0
osgi:install -s mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxb-impl/2.1.6_1
osgi:install -s mvn:org.apache.camel/camel-core/1.4.0
osgi:install -s mvn:org.springframework/spring-tx/2.5.6.SEC01
osgi:install -s mvn:org.apache.camel/camel-spring/1.4.0
osgi:install -s mvn:org.apache.camel/camel-osgi/1.4.0
osgi:install -s mvn:org.apache.camel/camel-example-osgi/1.4.0
</PRE>
</DIV></DIV>
<P>This commands will download, install and start the specified jars.</P>

<P>The example installed is using <A href="http://activemq.apache.org/camel" class="external-link" rel="nofollow">Camel</A> to start a timer every 2 seconds and output a message on the console.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&gt;&gt;&gt;&gt; MyTransform set body:  Wed Jan 02 23:34:19 CET 2008
&gt;&gt;&gt;&gt; MyTransform set body:  Wed Jan 02 23:34:21 CET 2008
</PRE>
</DIV></DIV>

<H3><A name="KarafUsers%27Guideinonepage-Stoppinganduninstallingthesampleapplication"></A>Stopping and uninstalling the sample application</H3>

<P>To stop this demo, run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:list | grep example
</PRE>
</DIV></DIV>
<P>In the output, locate the line containing <TT>camel-example-osgi</TT> and note the id of the bundle in the first column.  Then launch the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:stop [id]
</PRE>
</DIV></DIV>
<P>If you wish, you can start again the sample by using the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:start [id]
</PRE>
</DIV></DIV>
<P>To uninstall the demo, run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:uninstall [id]
</PRE>
</DIV></DIV>

<H3><A name="KarafUsers%27Guideinonepage-CommonProblems"></A>Common Problems</H3>

<OL>
	<LI>Launching Karaf can result in a deadlock in Felix during module dependency resolution.  This is often a result of sending a SIGINT (control-C) to the process when it will not cleanly exit.  This can corrupt the caches and cause startup problems in the very next launch. It is fixed by emptying the component cache:
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
rm -rf data/cache/*
</PRE>
</DIV></DIV></LI>
</OL>


<H2><A name="KarafUsers%27Guideinonepage-StoppingKaraf"></A>Stopping Karaf</H2>

<P>To stop Karaf from the console, enter <TT>^D</TT> in the console:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
^D
</PRE>
</DIV></DIV>
<P>Alternatively, you can also run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:shutdown
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Summary"></A>Summary</H2>

<P>This document showed you how simple it is to have Apache Felix Karaf up and running. The overall time for getting the server running should be less than five minutes if you have the prerequisite (Java 1.5) already installed. Additionally, this article also showed you how to deploy and test a simple Apache Camel application in less than five minutes.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="1-overview.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="1-overview.html">1. Overview</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="3-installation.html">3. Installation</A></TD><TD class="ScrollbarNextIcon"><A href="3-installation.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="2-quick-start.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="2-quick-start.html">2. Quick Start</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-2.1.QuickStart%28Source%29"></A>2.1. Quick Start (Source)</H1>

<P>If you are in a hurry to have Apache Felix Karaf up and running right away, this section will provide you with some basic steps for checking out, building and running the server in no time. This is clearly not a complete guide so you may want to check other sections of this guide for further information.</P>

<P>All you need is 15 minutes and to follow these basic steps.</P>
<UL>
	<LI><A href="#KarafUsers%2527Guideinonepage-Background">Background</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Gettingthesoftware">Getting the software</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Starttheserver">Start the server</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Deployasampleapplication">Deploy a sample application</A></LI>
</UL>


<H2><A name="KarafUsers%27Guideinonepage-Background"></A>Background</H2>

<P>Apache Felix Karaf is a small and lightweight OSGi based runtime.  This provides a small lightweight container onto which various bundles can be deployed.</P>
<DIV class="panelMacro"><TABLE class="tipMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD>Apache Felix Karaf started life as the <A href="http://servicemix.apache.org/" class="external-link" rel="nofollow">Apache ServiceMix </A> kernel.<BR>
Don't be surprised by any transitional references which remain.</TD></TR></TABLE></DIV>
<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-Gettingthesoftware"></A>Getting the software</H2>

<P>This document describes how to build the server from the latest Karaf source. </P>

<H3><A name="KarafUsers%27Guideinonepage-Prerequisites"></A>Prerequisites</H3>

<P>Although this installation path is the fastest one, still you will need to install some software before installing Karaf.</P>

<P>Karaf requires a Java 5 environment to run. Refer to <A href="http://java.sun.com/" class="external-link" rel="nofollow">http://java.sun.com</A> for details on how to download and install J2SE 1.5 or greater.</P>

<P><A href="http://subversion.tigris.org/" class="external-link" rel="nofollow">Subversion </A> is required to checkout the source.</P>

<P><A href="http://maven.apache.org/" class="external-link" rel="nofollow">Maven 2</A> is required to build Karaf.</P>

<H3><A name="KarafUsers%27Guideinonepage-CheckoutSource"></A>Checkout Source</H3>

<P>The Karaf source is found at <A href="http://svn.apache.org/repos/asf/felix/trunk/karaf/" class="external-link" rel="nofollow">http://svn.apache.org/repos/asf/felix/trunk/karaf/</A>. To check out with a command line client:</P>

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
$ svn co http:<SPAN class="code-comment">//svn.apache.org/repos/asf/felix/trunk/karaf/</SPAN>
</PRE>
</DIV></DIV> 

<H3><A name="KarafUsers%27Guideinonepage-Build"></A>Build</H3>

<P>Change directory to the top level of the source checkout. Build Karaf using Maven as follows:</P>

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
$ mvn -Pfastinstall
</PRE>
</DIV></DIV>

<P>Distributions will be created in assembly/target. Select the file compression format compatible with your system (apache-felix-karaf-1.0.0.zip for windows, apache-felix-karaf-1.0.0.tar.gz for unixes) and expand the binary in a new directory; for example in z:\karaf - from now on this directory will be referenced as &lt;KARAF_HOME&gt;. Please remember the restrictions concerning illegal characters in Java paths, e.g. &#33;, % etc.</P>

<P>The installation of Karaf is as simple as uncompressing the .zip or .tar files. The next step is to start the server.</P>

<DIV class="panelMacro"><TABLE class="tipMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD>To generate Eclipse projects for all modules, in KARAF_HOME type:

<P>mvn -Psetup.eclipse </P>

<P>Then add each module location, prefixing each name with <EM>org.apache.felix.karaf</EM> (for example <EM>org.apache.felix.karaf.shell.core</EM>)</P></TD></TR></TABLE></DIV>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-Starttheserver"></A>Start the server</H2>

<P>With Karaf already installed, open a command line console and change directory to &lt;KARAF_HOME&gt;. To start the server, run the following command in Windows:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin\karaf.bat
</PRE>
</DIV></DIV>
<P>respectively on Unix:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin/karaf
</PRE>
</DIV></DIV>
<P>You should see the following informations on the command line console:</P>
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
        __ __                  ____      
       / <SPAN class="code-comment">//_/____ __________ _/ __/      
</SPAN>      / ,&lt;  / __ `/ ___/ __ `/ /_        
     / /| |/ /_/ / /  / /_/ / __/        
    /_/ |_|\__,_/_/   \__,_/_/         

  Apache Felix Karaf (1.0.0)

Hit '&lt;tab&gt;' <SPAN class="code-keyword">for</SPAN> a list of available commands
and '[cmd] --help' <SPAN class="code-keyword">for</SPAN> help on a specific command.

karaf@root&gt; 
</PRE>
</DIV></DIV>
<P>You can now run your first command.  Simply type the <TT>&lt;tab&gt;</TT> key in the console.</P>
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root&gt; 

admin:change-port        admin:connect            admin:create             admin:destroy            admin:list               admin:start
admin:stop               config:cancel            config:edit              config:list              config:propappend        config:propdel
config:proplist          config:propset           config:update            features:addUrl          features:install         features:list
features:listUrl         features:refreshUrl      features:removeUrl       features:uninstall       log:display              log:display-exception
log:get                  log:set                  osgi:bundle-level        osgi:headers             osgi:install             osgi:list
osgi:ls                  osgi:refresh             osgi:resolve             osgi:restart             osgi:shutdown            osgi:start
osgi:start-level         osgi:stop                osgi:uninstall           osgi:update              packages:exports         packages:imports
shell:cat                shell:echo               shell:exec               shell:grep               shell:info               shell:java
shell:printf             shell:sleep              shell:sort               shell:tac                ssh:ssh                  ssh:sshd
karaf@root&gt; 
</PRE>
</DIV></DIV>
<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-Deployasampleapplication"></A>Deploy a sample application</H2>

<P>While you will learn in the remainder of this guide how to use and leverage Apache Felix Karaf, we will just use the pre-built packaging for now.</P>

<P>In the console, run the following commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
features:install spring-dm
osgi:install -s mvn:org.apache.geronimo.specs/geronimo-activation_1.1_spec/1.0.2
osgi:install -s mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.stax-api-1.0/1.1.0
osgi:install -s mvn:org.apache.servicemix.specs/org.apache.servicemix.specs.jaxb-api-2.1/1.1.0
osgi:install -s mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxb-impl/2.1.6_1
osgi:install -s mvn:org.apache.camel/camel-core/1.4.0
osgi:install -s mvn:org.springframework/spring-tx/2.5.6.SEC01
osgi:install -s mvn:org.apache.camel/camel-spring/1.4.0
osgi:install -s mvn:org.apache.camel/camel-osgi/1.4.0
osgi:install -s mvn:org.apache.camel/camel-example-osgi/1.4.0
</PRE>
</DIV></DIV>
<P>This commands will download, install and start the specified jars.</P>

<P>The example installed is using <A href="http://activemq.apache.org/camel" class="external-link" rel="nofollow">Camel</A> to start a timer every 2 seconds and output a message on the console.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&gt;&gt;&gt;&gt; MyTransform set body:  Wed Jan 02 23:34:19 CET 2008
&gt;&gt;&gt;&gt; MyTransform set body:  Wed Jan 02 23:34:21 CET 2008
</PRE>
</DIV></DIV>

<H3><A name="KarafUsers%27Guideinonepage-Stoppinganduninstallingthesampleapplication"></A>Stopping and uninstalling the sample application</H3>

<P>To stop this demo, run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:list | grep example
</PRE>
</DIV></DIV>
<P>In the output, locate the line containing <TT>camel-example-osgi</TT> and note the id of the bundle in the first column.  Then launch the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:stop [id]
</PRE>
</DIV></DIV>
<P>If you wish, you can start again the sample by using the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:start [id]
</PRE>
</DIV></DIV>
<P>To uninstall the demo, run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:uninstall [id]
</PRE>
</DIV></DIV>

<H3><A name="KarafUsers%27Guideinonepage-CommonProblems"></A>Common Problems</H3>

<OL>
	<LI>Launching SMX4 can result in a deadlock in Felix during module dependency resolution.  This is often a result of sending a SIGINT (control-C) to the process when it will not cleanly exit.  This can corrupt the caches and cause startup problems in the very next launch. It is fixed by emptying the component cache:
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
rm -rf data/cache/*
</PRE>
</DIV></DIV></LI>
</OL>


<H2><A name="KarafUsers%27Guideinonepage-StoppingKaraf"></A>Stopping Karaf</H2>

<P>To stop Karaf from the console, enter <TT>^D</TT> in the console:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
^D
</PRE>
</DIV></DIV>
<P>Alternatively, you can also run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:shutdown
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Summary"></A>Summary</H2>

<P>This document showed you how simple it is to have Apache Felix Karaf up and running. The overall time for getting the server running should be less than five minutes if you have the prerequisite (Java 1.5) already installed. Additionally, this article also showed you how to deploy and test a simple Apache Camel application in less than five minutes.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="2-quick-start.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="2-quick-start.html">2. Quick Start</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="2-quick-start.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="2-quick-start.html">2. Quick Start</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD class="ScrollbarNextIcon"><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-3.Installation"></A>3. Installation</H1>

<P>This document describes how to install and configure Apache Felix Karaf for both Unix and Windows' platforms.<BR>
Here you will find information about what are pre requisite software, where to download Karaf from and how to customize the installation to use custom ports other than the defaults.</P>

<P>This article contains the following sections:</P>
<DIV>
<UL>
    <LI><A href="#3.Installation-PreInstallationRequirements">Pre-Installation Requirements</A></LI>
    <LI><A href="#3.Installation-InstallationProcedureforWindows">Installation Procedure for Windows</A></LI>
<UL>
    <LI><A href="#3.Installation-WindowsBinaryInstallation">Windows Binary Installation</A></LI>
    <LI><A href="#3.Installation-WindowsSourceInstallation">Windows Source Installation</A></LI>
</UL>
    <LI><A href="#3.Installation-InstallationProcedureForUnix">Installation Procedure For Unix</A></LI>
<UL>
    <LI><A href="#3.Installation-UnixBinaryInstallation">Unix Binary Installation</A></LI>
    <LI><A href="#3.Installation-UnixSourceInstallation">Unix Source Installation</A></LI>
</UL>
    <LI><A href="#3.Installation-StartingKaraf">Starting Karaf</A></LI>
<UL>
    <LI><A href="#3.Installation-OnWindows">On Windows</A></LI>
    <LI><A href="#3.Installation-OnUnix">On Unix</A></LI>
</UL>
    <LI><A href="#3.Installation-TestingtheInstallation">Testing the Installation</A></LI>
    <LI><A href="#3.Installation-StoppingKaraf">Stopping Karaf</A></LI>
</UL></DIV>

<H2><A name="KarafUsers%27Guideinonepage-PreInstallationRequirements"></A>Pre-Installation Requirements</H2>

<P><B>Hardware:</B></P>
<UL>
	<LI>5 MB of free disk space for the Apache Felix Karaf x.y binary distribution.</LI>
	<LI>3 MB of free disk space for the Apache Felix Karaf x.y source distributions or SVN checkout. The Maven build requires roughly 57 MB disk space and for the dependencies Maven downloads during building further 76 MB are required. As a lot of small files are produced, the exact space demands depend greatly on your cluster utilization ratio.</LI>
</UL>


<P><B>Operating Systems:</B></P>
<UL>
	<LI>Windows: Windows XP SP2, Windows 2000.</LI>
	<LI>Unix: Ubuntu Linux, Powerdog Linux, MacOS, AIX, HP-UX, Solaris, any Unix platform that supports Java.</LI>
</UL>


<P><B>Environment:</B></P>
<UL>
	<LI>Java Developer Kit (JDK) 1.5.x or greater (<A href="http://java.sun.com/" class="external-link" rel="nofollow">http://java.sun.com/</A>).</LI>
	<LI>The JAVA_HOME environment variable must be set to the directory where the JDK is installed, e.g., <TT>c:\Program Files\jdk.1.5.0_06</TT>. To accomplish that, press Windows key and Break key together, switch to &quot;Advanced&quot; tab and click on &quot;Environment Variables&quot;. Here, check for the variable and, if necessary, add it.</LI>
	<LI>Apache Maven 2.0.8 (<A href="http://maven.apache.org/download.html" class="external-link" rel="nofollow">http://maven.apache.org/download.html</A>).</LI>
</UL>


<H2><A name="KarafUsers%27Guideinonepage-InstallationProcedureforWindows"></A>Installation Procedure for Windows</H2>

<P>This section of the Getting Started guide explains how to install binary and source distributions of Karaf on a Windows system.</P>
<DIV class="panelMacro"><TABLE class="tipMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>Handy Hint</B><BR>In case you have to install Karaf into a very deep path or a path containing illegal characters for Java paths, e.g. &#33;, % etc., you may add a bat file to <EM>start &#45;&gt; startup</EM> that executes
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>subst S: &quot;C:\your very % problematic path!\KARAF&quot;
</PRE>
</DIV></DIV>
<P>so your Karaf root directory is S: &mdash; which works for sure and is short to type.</P></TD></TR></TABLE></DIV>

<H3><A name="KarafUsers%27Guideinonepage-WindowsBinaryInstallation"></A>Windows Binary Installation</H3>

<P>This procedure explains how to download and install the binary distribution on a Windows system.</P>
<OL>
	<LI>From a browser, navigate to <A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">http://felix.apache.org/site/downloads.cgi</A>.</LI>
	<LI>Scroll down to the &quot;Apache Felix Karaf&quot; section and select the desired distribution.<BR>
For a binary distribution, the filename will be similar to: <TT>apache-felix-karaf-x.y.zip</TT>.</LI>
	<LI>Extract the files from the ZIP file into a directory of your choice. Please remember the restrictions concerning illegal characters in Java paths, e.g. &#33;, % etc.</LI>
	<LI>Proceed to the <A href="#KarafUsers%2527Guideinonepage-StartingKaraf">Starting Karaf</A> section of this document.</LI>
	<LI>Following start-up, go to the <A href="#KarafUsers%2527Guideinonepage-TestingtheInstallation">Testing the Installation</A> section of this document.</LI>
	<LI>Optional: see <A href="71-enabling-colorized-console-output-on-windows.html" title="7.1. Enabling Colorized Console Output On Windows">7.1. Enabling Colorized Console Output On Windows</A></LI>
</OL>


<H3><A name="KarafUsers%27Guideinonepage-WindowsSourceInstallation"></A>Windows Source Installation</H3>

<P>This procedure explains how to download and install the source distribution on a Windows system. <B>NOTE:</B> Karaf requires Java 5 is compile, build and run.</P>
<OL>
	<LI>From a browser, navigate to <A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">http://felix.apache.org/site/downloads.cgi</A>.</LI>
	<LI>Scroll down to the &quot;Apache Felix Karaf&quot; section and select the desired distribution.<BR>
For a source distribution, the filename will be similar to: <TT>apache-felix-karaf-x.y-src.zip</TT>.</LI>
	<LI>Extract Karaf from the ZIP file into a directory of your choice. Please remember the restrictions concerning illegal characters in Java paths, e.g. &#33;, % etc.</LI>
	<LI><A name="KarafUsers%27Guideinonepage-WindowsSourceInstallation"></A> Build Karaf using Maven 2.0.8 or greater and Java 5.<BR>
The recommended method of building Karaf is the following:
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
cd [karaf_install_dir]\\src
</PRE>
</DIV></DIV>
<P> where <TT>[karaf_install_dir]</TT> is the directory in which Karaf was installed.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
mvn
</PRE>
</DIV></DIV>
<P>Both steps take around 10 to 15 minutes.</P></LI>
	<LI>Unzip the distribution using your favorite zip tool. The windows distribution is available at
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
[karaf_install_dir]\assembly\target\apache-felix-karaf-x.y.zip
</PRE>
</DIV></DIV></LI>
	<LI>Proceed to the <A href="#KarafUsers%2527Guideinonepage-StartingKaraf">Starting Karaf</A> section of this document.</LI>
	<LI>Following start-up, go to the <A href="#KarafUsers%2527Guideinonepage-TestingtheInstallation">Testing the Installation</A> section of this document.</LI>
	<LI>Optional: see <A href="71-enabling-colorized-console-output-on-windows.html" title="7.1. Enabling Colorized Console Output On Windows">7.1. Enabling Colorized Console Output On Windows</A></LI>
</OL>


<H2><A name="KarafUsers%27Guideinonepage-InstallationProcedureForUnix"></A>Installation Procedure For Unix</H2>

<H3><A name="KarafUsers%27Guideinonepage-UnixBinaryInstallation"></A>Unix Binary Installation</H3>

<P>This procedure explains how to download and install the binary distribution on a Unix system.</P>
<OL>
	<LI>From a browser, navigate to <A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">http://felix.apache.org/site/downloads.cgi</A>.</LI>
	<LI>Scroll down to the &quot;Apache Felix Karaf&quot; section and select the desired distribution.<BR>
For a binary Unix distribution, the filename will be similar to: apache-felix-karaf-x.y.tar.gz.</LI>
	<LI>Extract the files from the gzip file into a directory of your choice. For example:
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
gunzip apache-felix-karaf-x.y.tar.gz
tar xvf apache-felix-karaf-x.y.tar
</PRE>
</DIV></DIV>
<P>Please remember the restrictions concerning illegal characters in Java paths, e.g. &#33;, % etc.</P></LI>
	<LI>Proceed to the <A href="#KarafUsers%2527Guideinonepage-StartingKaraf">Starting Karaf</A> section of this document.</LI>
	<LI>Following start-up, go to the <A href="#KarafUsers%2527Guideinonepage-TestingtheInstallation">Testing the Installation</A> section.</LI>
</OL>


<H3><A name="KarafUsers%27Guideinonepage-UnixSourceInstallation"></A>Unix Source Installation</H3>

<P>This procedure explains how to download and install the source distribution on a Unix system. This procedure assumes the Unix machine has a browser. Please see the previous <A href="#KarafUsers%2527Guideinonepage-UnixBinaryInstallation">Unix Binary Installation</A> section for ideas on how to install Karaf without a browser. <B>NOTE:</B> Karaf requires Java 5 to compile, build and run.</P>
<OL>
	<LI>From a browser, navigate to <A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">http://felix.apache.org/site/downloads.cgi</A>.</LI>
	<LI>Scroll down to the &quot;Apache Felix Karaf&quot; section and select the desired distribution.<BR>
For a source distribution, the filename will be similar to: <TT>apache-felix-karaf-x.y-src.tar.gz</TT>.</LI>
	<LI>Extract the files from the ZIP file into a directory of your choice. For example:
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
gunzip apache-felix-karaf-x.y-src.tar.gz
tar xvf apache-felix-karaf-x.y-src.tar
</PRE>
</DIV></DIV>
<P>Please remember the restrictions concerning illegal characters in Java paths, e.g. &#33;, % etc.</P></LI>
	<LI>Build Karaf using Maven 2.0.8 or greater and Java 5:
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
The preferred method of building Karaf is the following:
cd [karaf_install_dir]/src
 where [karaf_install_dir] is the directory in which Karaf was installed.
mvn
</PRE>
</DIV></DIV></LI>
	<LI>Uncompress the distribution that has just been created
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
cd [karaf_install_dir]/assembly/target
gunzip apache-felix-karaf-x.y.tar.gz
tar xvf apache-felix-karaf-x.y.tar
</PRE>
</DIV></DIV></LI>
	<LI>Proceed to the <A href="#KarafUsers%2527Guideinonepage-StartingKaraf">Starting Karaf</A> section of this document.</LI>
	<LI>Following start-up, go to the <A href="#KarafUsers%2527Guideinonepage-TestingtheInstallation">Testing the Installation</A> section.</LI>
</OL>



<H2><A name="KarafUsers%27Guideinonepage-StartingKaraf"></A>Starting Karaf</H2>


<H3><A name="KarafUsers%27Guideinonepage-OnWindows"></A>On Windows</H3>

<P>From a console window, change to the installation directory and run <TT>Karaf</TT>. For the binary distribution, go to</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
cd [karaf_install_dir]
</PRE>
</DIV></DIV>
<P>and for the source distribution go to the target directory, for example:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
cd [karaf_install_dir]\src\assembly\target\apache-felix-karaf-x.y-SNAPSHOT
</PRE>
</DIV></DIV>
<P>where <TT>karaf_install_dir</TT> is the directory in which Karaf was installed, e.g., <TT>c:\Program Files\apache-felix-karaf-x.y</TT>.</P>

<P>Then type:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin\karaf.bat
</PRE>
</DIV></DIV>
<P><EM>Note:</EM> Working directories get created relative to the current directory. For the working directories to be created in the proper place, Karaf must be launched from its home/installation directory.</P>

<H3><A name="KarafUsers%27Guideinonepage-OnUnix"></A>On Unix</H3>

<P>From a command shell, change to the installation directory and run <TT>Karaf</TT>. For the binary distribution, go to</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
cd [karaf_install_dir]
</PRE>
</DIV></DIV>
<P>and for the source distribution go to the target directory, for example:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
cd [karaf_install_dir]/src/assembly/target/apache-felix-karaf-x.y
</PRE>
</DIV></DIV>
<P>where <TT>karaf_install_dir</TT> is the directory in which Karaf was installed, e.g., <TT>/usr/local/apache-felix-karaf-x.y</TT>.</P>

<P>Then type:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin/karaf.sh
</PRE>
</DIV></DIV>

<DIV class="panelMacro"><TABLE class="warningMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>Warning</B><BR>Do NOT close the console or shell in which Karaf was started, as that will terminate Karaf (unless Karaf was started with nohup).</TD></TR></TABLE></DIV>

<H2><A name="KarafUsers%27Guideinonepage-TestingtheInstallation"></A>Testing the Installation</H2>

<P>If Karaf is up and running without problems, the Window's console window or the Unix command shell will display something similar to the following log line:</P>
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
        __ __                  ____      
       / <SPAN class="code-comment">//_/____ __________ _/ __/      
</SPAN>      / ,&lt;  / __ `/ ___/ __ `/ /_        
     / /| |/ /_/ / /  / /_/ / __/        
    /_/ |_|\__,_/_/   \__,_/_/         

  Apache Felix Karaf (1.0.0)

Hit '&lt;tab&gt;' <SPAN class="code-keyword">for</SPAN> a list of available commands
and '[cmd] --help' <SPAN class="code-keyword">for</SPAN> help on a specific command.

karaf@root&gt; 
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-StoppingKaraf"></A>Stopping Karaf</H2>

<P>For both Windows and Unix installations, you can perform a clean shutdown of Karaf Kernel by using the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:shutdown
</PRE>
</DIV></DIV>

<P>If Karaf was started in the background on Unix, the process can be killed, with the following:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
ps -ef | grep karaf
kill [PID]
 where [PID] is the process id of the Karaf process.
</PRE>
</DIV></DIV>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="2-quick-start.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="2-quick-start.html">2. Quick Start</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD class="ScrollbarNextIcon"><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="3-installation.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="3-installation.html">3. Installation</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="5-using-karaf.html">5. Using Karaf</A></TD><TD class="ScrollbarNextIcon"><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.UnderstandingKaraf"></A>4. Understanding Karaf</H1>
<UL><LI><A href="41-console-and-commands.html" title="4.1. Console and Commands">4.1. Console and Commands</A></LI><LI><A href="42-remote-console.html" title="4.2. Remote Console">4.2. Remote Console</A></LI><LI><A href="43-logging-system.html" title="4.3. Logging system">4.3. Logging system</A></LI><LI><A href="44-deployer.html" title="4.4. Deployer">4.4. Deployer</A></LI><LI><A href="45-security-framework.html" title="4.5. Security framework">4.5. Security framework</A></LI><LI><A href="46-provisioning.html" title="4.6. Provisioning">4.6. Provisioning</A></LI><LI><A href="47-administration.html" title="4.7. Administration">4.7. Administration</A></LI><LI><A href="48-configuration.html" title="4.8. Configuration">4.8. Configuration</A></LI></UL>


<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="3-installation.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="3-installation.html">3. Installation</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="5-using-karaf.html">5. Using Karaf</A></TD><TD class="ScrollbarNextIcon"><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="42-remote-console.html">4.2. Remote Console</A></TD><TD class="ScrollbarNextIcon"><A href="42-remote-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.1.ConsoleandCommands"></A>4.1. Console and Commands</H1>

<H2><A name="KarafUsers%27Guideinonepage-Overview"></A>Overview</H2>

<P>Karaf provides a powerful console and a set of commands that can be used to perform various tasks.  Commands can be located in the root shell or in a sub-shell.  A sub-shell is a group of related commands, like commands related to the OSGi framework or the log system.</P>

<P>The following shells are available out-of-the-box, but the console can be <A href="61-extending-the-console.html" title="6.1. Extending the console">easily extended</A>:</P>
<UL>
	<LI><A href="#KarafUsers%2527Guideinonepage-Adminshell">admin</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Configshell">config</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Featuresshell">features</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Logshell">log</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-OBRshell">obr</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-OSGishell">osgi</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Packageshell">package</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Shellshell">shell</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-SSHshell">ssh</A></LI>
	<LI><A href="#KarafUsers%2527Guideinonepage-Wrappershell">wrapper</A></LI>
</UL>


<H2><A name="KarafUsers%27Guideinonepage-Adminshell"></A>Admin shell</H2>

<P>This shell is described extensively in section <A href="47-administration.html" title="4.7. Administration">4.7. Administration</A>.</P>

<H2><A name="KarafUsers%27Guideinonepage-Configshell"></A>Config shell</H2>

<P>This shell is described extensively in section <A href="48-configuration.html" title="4.8. Configuration">4.8. Configuration</A>.</P>

<H2><A name="KarafUsers%27Guideinonepage-Featuresshell"></A>Features shell</H2>

<P>The features shell contains a few commands to provision entire applications easily.<BR>
More information is available on the chapter <A href="46-provisioning.html" title="4.6. Provisioning">4.6. Provisioning</A>.</P>

<H2><A name="KarafUsers%27Guideinonepage-Logshell"></A>Log shell</H2>

<P>The log shell contains a few commands to display the log entries, retrieve or change the log levels:</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command         </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> display           </TD>
<TD class="confluenceTd"> Display log entries. </TD>
</TR>
<TR>
<TD class="confluenceTd"> display-exception </TD>
<TD class="confluenceTd"> Display the last exception from the log. </TD>
</TR>
<TR>
<TD class="confluenceTd"> get               </TD>
<TD class="confluenceTd"> Show log level. </TD>
</TR>
<TR>
<TD class="confluenceTd"> set               </TD>
<TD class="confluenceTd"> Set log level. </TD>
</TR>
</TBODY></TABLE>
</DIV>


<P>See the documentation on the <A href="43-logging-system.html#4.3.Loggingsystem-Commands">logging system</A> for more informations.</P>

<H2><A name="KarafUsers%27Guideinonepage-OBRshell"></A>OBR shell</H2>

<P>OBR (<A href="http://www2.osgi.org/Repository" class="external-link" rel="nofollow">OSGi Bundle Repository</A>) is a proposed specification that defines an xml format for repositories of OSGi bundles and an associated service to access it.  Karaf proposes a number of commands that can be used to deal with such repositories.</P>

<P>Note that this feature is not installed by default.  To install it, you must run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root:/&gt; features:install obr
</PRE>
</DIV></DIV>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command  </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> addUrl     </TD>
<TD class="confluenceTd"> Add a list of repository URLs to the repository service </TD>
</TR>
<TR>
<TD class="confluenceTd"> deploy     </TD>
<TD class="confluenceTd"> Deploy </TD>
</TR>
<TR>
<TD class="confluenceTd"> info       </TD>
<TD class="confluenceTd"> Display the meta-data for the specified bundles. </TD>
</TR>
<TR>
<TD class="confluenceTd"> list       </TD>
<TD class="confluenceTd"> List </TD>
</TR>
<TR>
<TD class="confluenceTd"> listUrl    </TD>
<TD class="confluenceTd"> Display the repository URLs currently associated with the repository service. </TD>
</TR>
<TR>
<TD class="confluenceTd"> removeUrl  </TD>
<TD class="confluenceTd"> Remove a list of repository URLs from the repository service </TD>
</TR>
<TR>
<TD class="confluenceTd"> source     </TD>
<TD class="confluenceTd"> Source </TD>
</TR>
<TR>
<TD class="confluenceTd"> start      </TD>
<TD class="confluenceTd"> Start </TD>
</TR>
</TBODY></TABLE>
</DIV>


<H2><A name="KarafUsers%27Guideinonepage-OSGishell"></A>OSGi shell</H2>

<P>The OSGi sub-shell provides commands for managing the OSGi framework: listing OSGi bundles, services, managing bundle lifecycles.<BR>
Look at the online help (launch <TT>osgi help</TT> command) for more informations.</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command           </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> bundle-level        </TD>
<TD class="confluenceTd"> Get or set the start level of a given bundle </TD>
</TR>
<TR>
<TD class="confluenceTd"> headers             </TD>
<TD class="confluenceTd"> Display headers </TD>
</TR>
<TR>
<TD class="confluenceTd"> install             </TD>
<TD class="confluenceTd"> Install bundle </TD>
</TR>
<TR>
<TD class="confluenceTd"> list                </TD>
<TD class="confluenceTd"> List bundles </TD>
</TR>
<TR>
<TD class="confluenceTd"> ls                  </TD>
<TD class="confluenceTd"> List services </TD>
</TR>
<TR>
<TD class="confluenceTd"> refresh             </TD>
<TD class="confluenceTd"> Refresh bundle </TD>
</TR>
<TR>
<TD class="confluenceTd"> update              </TD>
<TD class="confluenceTd"> Update bundle </TD>
</TR>
<TR>
<TD class="confluenceTd"> resolve             </TD>
<TD class="confluenceTd"> Resolve bundle </TD>
</TR>
<TR>
<TD class="confluenceTd"> shutdown            </TD>
<TD class="confluenceTd"> Shutdown </TD>
</TR>
<TR>
<TD class="confluenceTd"> start               </TD>
<TD class="confluenceTd"> Start bundle </TD>
</TR>
<TR>
<TD class="confluenceTd"> start-level         </TD>
<TD class="confluenceTd"> Get or set the start level </TD>
</TR>
<TR>
<TD class="confluenceTd"> stop                </TD>
<TD class="confluenceTd"> Stop bundle </TD>
</TR>
<TR>
<TD class="confluenceTd"> uninstall           </TD>
<TD class="confluenceTd"> Uninstall bundle </TD>
</TR>
</TBODY></TABLE>
</DIV>


<H2><A name="KarafUsers%27Guideinonepage-Packageshell"></A>Package shell</H2>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command      </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> imports        </TD>
<TD class="confluenceTd"> Display imported packages </TD>
</TR>
<TR>
<TD class="confluenceTd"> exports        </TD>
<TD class="confluenceTd"> Display exported packages </TD>
</TR>
</TBODY></TABLE>
</DIV>


<H2><A name="KarafUsers%27Guideinonepage-Shellshell"></A>Shell shell</H2>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command  </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> cat        </TD>
<TD class="confluenceTd"> Displays the content of a file or url </TD>
</TR>
<TR>
<TD class="confluenceTd"> echo       </TD>
<TD class="confluenceTd"> Echoes or prints arguments to STDOUT </TD>
</TR>
<TR>
<TD class="confluenceTd"> exec       </TD>
<TD class="confluenceTd"> Executes system processes </TD>
</TR>
<TR>
<TD class="confluenceTd"> grep       </TD>
<TD class="confluenceTd"> Prints lines matching the given pattern </TD>
</TR>
<TR>
<TD class="confluenceTd"> info       </TD>
<TD class="confluenceTd"> Prints system informations </TD>
</TR>
<TR>
<TD class="confluenceTd"> java       </TD>
<TD class="confluenceTd"> Execute a Java standard application </TD>
</TR>
<TR>
<TD class="confluenceTd"> printf     </TD>
<TD class="confluenceTd"> Format and print arguments </TD>
</TR>
<TR>
<TD class="confluenceTd"> sleep      </TD>
<TD class="confluenceTd"> Sleeps for a bit then wakes up </TD>
</TR>
<TR>
<TD class="confluenceTd"> sort       </TD>
<TD class="confluenceTd"> Write sorted concatenation of all files to standard output. </TD>
</TR>
<TR>
<TD class="confluenceTd"> tac        </TD>
<TD class="confluenceTd"> Captures the STDIN and returns it as a string. Optionally writes the content to a file </TD>
</TR>
</TBODY></TABLE>
</DIV>



<P>Examples:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
cat mvn:org.apache.servicemix/servicemix/3.2.1/pom
</PRE>
</DIV></DIV>
<P>or</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
log:display | grep error
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-SSHshell"></A>SSH shell</H2>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command  </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> ssh        </TD>
<TD class="confluenceTd"> Connects to a remote SSH server </TD>
</TR>
<TR>
<TD class="confluenceTd"> sshd       </TD>
<TD class="confluenceTd"> Creates a SSH server </TD>
</TR>
</TBODY></TABLE>
</DIV>


<H2><A name="KarafUsers%27Guideinonepage-Wrappershell"></A>Wrapper shell</H2>

<P>Note that this feature is not installed by default.  To install it, you must run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root:/&gt; features:install wrapper
</PRE>
</DIV></DIV>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command  </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd"> install    </TD>
<TD class="confluenceTd"> Install the container as a system service in the OS. </TD>
</TR>
</TBODY></TABLE>
</DIV>


<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="42-remote-console.html">4.2. Remote Console</A></TD><TD class="ScrollbarNextIcon"><A href="42-remote-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="41-console-and-commands.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="41-console-and-commands.html">4.1. Console and Commands</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="43-logging-system.html">4.3. Logging system</A></TD><TD class="ScrollbarNextIcon"><A href="43-logging-system.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.2.RemoteConsole"></A>4.2. Remote Console</H1>

<P>The remote console feature allows to connect to a running Karaf instance from a remote computer and perform all the operations that are usually accessible from the local console.</P>

<H2><A name="KarafUsers%27Guideinonepage-Launchoptions"></A>Launch options</H2>

<P>The Karaf shell scripts supports a number of options to control the remote console:</P>
<UL>
	<LI><B><TT>console</TT></B>: launch Karaf in the default mode (both local and remote console activated).  This is the default mode</LI>
	<LI><B><TT>server</TT></B>: launch Karaf in with a remote console but no local console</LI>
	<LI><B><TT>client</TT></B>: launch Karaf in with a local console only</LI>
</UL>


<P>These options affect two system properties that can be set if you don't use the standard shell scripts:</P>
<UL>
	<LI><TT>karaf.startLocalConsole</TT></LI>
	<LI><TT>karaf.startRemoteShell</TT></LI>
</UL>


<H2><A name="KarafUsers%27Guideinonepage-Usingtheclientjar"></A>Using the client jar</H2>

<P>It is also possible to use a more lightweight way to connect to a Karaf instance using the following command line:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
java -jar lib/karaf-client.jar
</PRE>
</DIV></DIV>

<P>There are a few parameters that can be set on the command line to change the URL used to connect to the Kernel, the user or the password.<BR>
All these parameters are detailed in the help screen:</P>

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&gt; java -jar lib/karaf-client.jar --help
Apache Felix Karaf client
  -a [address]  specify the URL to connect to
  -h [host]     specify the host to connect to
  -u [user]     specify the user name
  -p [password] specify the password
  --help        shows <SPAN class="code-keyword">this</SPAN> help message
  [commands]    commands to run
If no commands are specified, the client will be put in an interactive mode
</PRE>
</DIV></DIV>

<P>For example, to shut down the Kernel from the command line, you can run the following command:</P>

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&gt; java -jar lib/karaf-client.jar 
smx@root:/&gt; osgi:shutdown
smx@root:/&gt;
&gt;
</PRE>
</DIV></DIV>

<P>The client jar also supports passing command line arguments to the remote Karaf.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&gt; java -jar lib/karaf-client.jar osgi:shutdown
&gt;
</PRE>
</DIV></DIV>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-UsinganSSHclient"></A>Using an SSH client</H2>

<P>You can use any standard SSH client to connect to a Karaf instance.  The default port is 8101.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&gt; ssh -p 8101 -l karaf localhost
karaf@localhost's password: karaf
karaf@root:/&gt;
</PRE>
</DIV></DIV>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-UsinganotherKarafinstance"></A>Using another Karaf instance</H2>

<P>First, open a terminal and launch Karaf in server mode (you could use a Karaf instance in console mode too):</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin/karaf server
</PRE>
</DIV></DIV>

<P>On another terminal, start another Karaf instance in client mode:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin/karaf client
</PRE>
</DIV></DIV>

<DIV class="panelMacro"><TABLE class="tipMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>User another Karaf instance to start the client</B><BR>At this point in time, you can not use the same Karaf installation to start both the server and the client, so you need to create a new instance using the 'admin create xxx' command and use that one to start the client.  If you are on a different host or already use another copy of Karaf, this requirement does not hold.</TD></TR></TABLE></DIV>

<P>Once the console appears, you can run the <TT>remote rsh</TT> command to connect to the other Kernel:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
remote rsh tcp:<SPAN class="code-comment">//localhost:8101/ -u karaf -p karaf </SPAN>
</PRE>
</DIV></DIV>

<P>You can also do that in a single command line from the prompt by appending the previous ServiceMix command to the shell command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
bin/karaf client remote rsh tcp:<SPAN class="code-comment">//localhost:8101/ -u karaf -p karaf </SPAN>
</PRE>
</DIV></DIV>

<P>To verify that your are connected to the remote instance, run the following command:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
info
</PRE>
</DIV></DIV>
<P>and check the system informations.</P>

<H3><A name="KarafUsers%27Guideinonepage-Configuration"></A>Configuration</H3>

<P>The TCP port is configured at the following location:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
[KARAF]/etc/org.apache.felix.karaf.shell.cfg
</PRE>
</DIV></DIV>

<P>The defaut configuration is as below:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
startLocalConsole=${karaf.startLocalConsole}
startRemoteShell=${karaf.startRemoteShell}
sshPort=8101
sshRealm=karaf
hostKey=${karaf.base}/etc/host.key
</PRE>
</DIV></DIV>

<P>The port used can easily be changed by changing the default port <TT>8101</TT> in the <TT>sshPort</TT> property.</P>

<P>The security realm used by the console when authenticating remote users is named <TT>karaf</TT>, so you can override this realm as explained in the <A href="45-security-framework.html" title="4.5. Security framework">security section</A>.  </P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="41-console-and-commands.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="41-console-and-commands.html">4.1. Console and Commands</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="43-logging-system.html">4.3. Logging system</A></TD><TD class="ScrollbarNextIcon"><A href="43-logging-system.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>

<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="42-remote-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="42-remote-console.html">4.2. Remote Console</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="44-deployer.html">4.4. Deployer</A></TD><TD class="ScrollbarNextIcon"><A href="44-deployer.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.3.Loggingsystem"></A>4.3. Logging system</H1>

<P>Karaf provides a powerful logging system based on <A href="http://wiki.ops4j.org/confluence/display/ops4j/Pax%20Logging" class="external-link" rel="nofollow">OPS4j Pax Logging</A>. </P>

<P>In addition to being a standard OSGi Log service, it supports the following APIs:</P>
<UL>
	<LI>Apache Commons Logging</LI>
	<LI>SLF4J</LI>
	<LI>Apache Log4j</LI>
	<LI>Java Util Logging</LI>
</UL>


<P>Karaf also comes with a set of console commands that can be used to display, view and change the log levels.</P>

<H2><A name="KarafUsers%27Guideinonepage-Configuration"></A>Configuration</H2>

<P>The configuration of the logging system uses a <A href="http://logging.apache.org/log4j/1.2/manual.html" class="external-link" rel="nofollow">standard Log4j configuration file</A> at the following location:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
[karaf]/etc/org.ops4j.pax.logging.cfg
</PRE>
</DIV></DIV>

<P>You can edit this file at runtime and any change will be reloaded and be effective immediately.</P>

<H2><A name="KarafUsers%27Guideinonepage-Commands"></A>Commands</H2>

<P>The log subshell comes with 3 commands:</P>
<UL>
	<LI><TT>log:display</TT>: display the last log entries</LI>
	<LI><TT>log:display-exception</TT>: display the last exception from the log</LI>
	<LI><TT>log:get</TT>: show the log levels</LI>
	<LI><TT>log:set</TT>: set the log levels</LI>
</UL>


<P>For example, if you want to debug something, you might want to run the following commands:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&gt; log:set DEBUG
... <SPAN class="code-keyword">do</SPAN> something ...
&gt; log:display
</PRE>
</DIV></DIV>

<P>Note that the log levels set using the <TT>log:set</TT> commands are not persistent and will be lost upon restart.<BR>
To configure those in a persistent way, you should edit the configuration file mentioned above.<BR>
<A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="42-remote-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="42-remote-console.html">4.2. Remote Console</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="44-deployer.html">4.4. Deployer</A></TD><TD class="ScrollbarNextIcon"><A href="44-deployer.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="43-logging-system.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="43-logging-system.html">4.3. Logging system</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="45-security-framework.html">4.5. Security framework</A></TD><TD class="ScrollbarNextIcon"><A href="45-security-framework.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.4.Deployer"></A>4.4. Deployer</H1>

<P>The following picture describes the architecture of the deployer.</P>

<P><SPAN class="image-wrap" style=""><IMG src="44-deployer.data/smx4-deployer.png" style="border: 0px solid black"></SPAN></P>

<H2><A name="KarafUsers%27Guideinonepage-Springdeployer"></A>Spring deployer</H2>

<P>Karaf includes a deployer that is able to deploy plain spring / spring-dm configuration files.<BR>
The deployer will transform on the fly any spring configuration file dropped into the <TT>deploy</TT> folder into a valid OSGi bundle.</P>

<P>The generated OSGi manifest will contain the following headers:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Manifest-Version: 2
Bundle-SymbolicName: [name of the file]
Bundle-Version: [version of the file]
Spring-Context: *;publish-context:=<SPAN class="code-keyword">false</SPAN>;create-asynchronously:=<SPAN class="code-keyword">true</SPAN>
Import-Package: [required packages]
DynamicImport-Package: *
</PRE>
</DIV></DIV>

<P>The <TT>name</TT> and <TT>version</TT> of the file are extracted using a heuristic that will match common patterns.  For example <TT>my-config-1.0.1.xml</TT> will lead to <TT>name = my-config</TT> and <TT>version = 1.0.1</TT>.<BR>
The default imported packages are extracted from the spring file definition and includes all classes referenced directly.</P>

<P>If you need to customize the generated manifest, you can do so by including an xml element in your spring configuration:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;spring:beans ...&gt;</SPAN>
  <SPAN class="code-tag">&lt;manifest&gt;</SPAN>
    Require-Bundle= my-bundle
  <SPAN class="code-tag">&lt;/manifest&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Featuresdeployer"></A>Features deployer</H2>

<P>To be able to hot deploy features from the deploy folder, you can just drop a feature descriptor on that folder.  A bundle will be created and its installation (automatic) will trigger the installation of all features contained in the descriptor.  Removing the file from the deploy folder will uninstall the features.<BR>
If you want to install a single feature, you can do so by writing a feature descriptor like the following:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;features&gt;</SPAN>
  <SPAN class="code-tag">&lt;repository&gt;</SPAN>mvn:org.apache.servicemix.nmr/apache-servicemix-nmr/1.0.0/xml/features<SPAN class="code-tag">&lt;/repository&gt;</SPAN>
  <SPAN class="code-tag">&lt;feature name=<SPAN class="code-quote">&quot;nmr-only&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;feature&gt;</SPAN>nmr<SPAN class="code-tag">&lt;/feature&gt;</SPAN>
  <SPAN class="code-tag">&lt;/feature&gt;</SPAN>
<SPAN class="code-tag">&lt;/features&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>For more informations about features, see the <A href="46-provisioning.html" title="4.6. Provisioning">provisioning section</A>.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="43-logging-system.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="43-logging-system.html">4.3. Logging system</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="45-security-framework.html">4.5. Security framework</A></TD><TD class="ScrollbarNextIcon"><A href="45-security-framework.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="44-deployer.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="44-deployer.html">4.4. Deployer</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="46-provisioning.html">4.6. Provisioning</A></TD><TD class="ScrollbarNextIcon"><A href="46-provisioning.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.5.Securityframework"></A>4.5. Security framework</H1>

<P>Karaf supports <A href="http://java.sun.com/j2se/1.4.2/docs/guide/security/jaas/JAASRefGuide.html" class="external-link" rel="nofollow">JAAS</A> with some enhancements to allow JAAS to work nicely in an OSGi environment.  This framework also features an OSGi keystore manager with the ability to deploy new keystores or truststores at runtime.  </P>

<H2><A name="KarafUsers%27Guideinonepage-Overview"></A>Overview</H2>

<P>This feature allow the deployment at runtime of JAAS based configuration for use in various parts of the application. This includes the remote console login, which uses the <TT>karaf</TT> realm, but which is configured with a dummy login module by default.  These realms can also be used by the NMR, JBI components or the JMX server to authenticate users logging in or sending messages into the bus.</P>

<P>In addition to JAAS realms, you can also deploy keystores and truststores to secure the remote shell console, setting up HTTPS connectors or using certificates for WS-Security.</P>

<P>A very simple XML schema for spring has been defined, allowing the deployment of a new realm or a new keystore very easily.</P>

<H2><A name="KarafUsers%27Guideinonepage-Schema"></A>Schema</H2>

<P>To deploy a new realm, you can use the following XSD which is supported by a Spring namespace handler and can thus be defined in a spring xml configuration file.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>JAAS XSD Schema</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;xs:schema elementFormDefault='qualified'
           targetNamespace='http://felix.apache.org/karaf/xmlns/jaas/v1.0.0'
           <SPAN class="code-keyword">xmlns:xs</SPAN>='http://www.w3.org/2001/XMLSchema'
           <SPAN class="code-keyword">xmlns:bp</SPAN>=<SPAN class="code-quote">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</SPAN>
           <SPAN class="code-keyword">xmlns:tns</SPAN>='http://felix.apache.org/karaf/xmlns/jaas/v1.0.0'&gt;

    <SPAN class="code-tag">&lt;xs:import namespace=<SPAN class="code-quote">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</SPAN>/&gt;</SPAN>

    <SPAN class="code-tag">&lt;xs:element name=<SPAN class="code-quote">&quot;config&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;xs:complexType&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:sequence&gt;</SPAN>
                <SPAN class="code-tag">&lt;xs:element name=<SPAN class="code-quote">&quot;module&quot;</SPAN> minOccurs=<SPAN class="code-quote">&quot;0&quot;</SPAN> maxOccurs=<SPAN class="code-quote">&quot;unbounded&quot;</SPAN>&gt;</SPAN>
                    <SPAN class="code-tag">&lt;xs:complexType mixed=<SPAN class="code-quote">&quot;true&quot;</SPAN>&gt;</SPAN>
                        <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;className&quot;</SPAN> use=<SPAN class="code-quote">&quot;required&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:string&quot;</SPAN> /&gt;</SPAN>
                        <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;flags&quot;</SPAN> default=<SPAN class="code-quote">&quot;required&quot;</SPAN>&gt;</SPAN>
                            <SPAN class="code-tag">&lt;xs:simpleType&gt;</SPAN>
                                <SPAN class="code-tag">&lt;xs:restriction base=<SPAN class="code-quote">&quot;xs:NMTOKEN&quot;</SPAN>&gt;</SPAN>
                                    <SPAN class="code-tag">&lt;xs:enumeration value=<SPAN class="code-quote">&quot;required&quot;</SPAN>/&gt;</SPAN>
                                    <SPAN class="code-tag">&lt;xs:enumeration value=<SPAN class="code-quote">&quot;requisite&quot;</SPAN>/&gt;</SPAN>
                                    <SPAN class="code-tag">&lt;xs:enumeration value=<SPAN class="code-quote">&quot;sufficient&quot;</SPAN>/&gt;</SPAN>
                                    <SPAN class="code-tag">&lt;xs:enumeration value=<SPAN class="code-quote">&quot;optional&quot;</SPAN>/&gt;</SPAN>
                                <SPAN class="code-tag">&lt;/xs:restriction&gt;</SPAN>
                            <SPAN class="code-tag">&lt;/xs:simpleType&gt;</SPAN>
                        <SPAN class="code-tag">&lt;/xs:attribute&gt;</SPAN>
                    <SPAN class="code-tag">&lt;/xs:complexType&gt;</SPAN>
                <SPAN class="code-tag">&lt;/xs:element&gt;</SPAN>
            <SPAN class="code-tag">&lt;/xs:sequence&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;name&quot;</SPAN> use=<SPAN class="code-quote">&quot;required&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:string&quot;</SPAN> /&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;rank&quot;</SPAN> use=<SPAN class="code-quote">&quot;optional&quot;</SPAN> default=<SPAN class="code-quote">&quot;0&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:int&quot;</SPAN> /&gt;</SPAN>
        <SPAN class="code-tag">&lt;/xs:complexType&gt;</SPAN>
    <SPAN class="code-tag">&lt;/xs:element&gt;</SPAN>

    <SPAN class="code-tag">&lt;xs:element name=<SPAN class="code-quote">&quot;keystore&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;xs:complexType&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;name&quot;</SPAN> use=<SPAN class="code-quote">&quot;required&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:string&quot;</SPAN> /&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;rank&quot;</SPAN> use=<SPAN class="code-quote">&quot;optional&quot;</SPAN> default=<SPAN class="code-quote">&quot;0&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:int&quot;</SPAN> /&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;path&quot;</SPAN> use=<SPAN class="code-quote">&quot;required&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:string&quot;</SPAN> /&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;keystorePassword&quot;</SPAN> use=<SPAN class="code-quote">&quot;optional&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:string&quot;</SPAN> /&gt;</SPAN>
            <SPAN class="code-tag">&lt;xs:attribute name=<SPAN class="code-quote">&quot;keyPasswords&quot;</SPAN> use=<SPAN class="code-quote">&quot;optional&quot;</SPAN> type=<SPAN class="code-quote">&quot;xs:string&quot;</SPAN> /&gt;</SPAN>
        <SPAN class="code-tag">&lt;/xs:complexType&gt;</SPAN>
    <SPAN class="code-tag">&lt;/xs:element&gt;</SPAN>
    
<SPAN class="code-tag">&lt;/xs:schema&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>You can find the schema at the following <A href="https://svn.apache.org/repos/asf/felix/releases/karaf-1.0.0/jaas/config/src/main/resources/org/apache/felix/karaf/jaas/config/karaf-jaas.xsd" class="external-link" rel="nofollow">location</A>.</P>

<P>Here are two example using this schema:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>JAAS realm example</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;blueprint xmlns=<SPAN class="code-quote">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</SPAN>
           <SPAN class="code-keyword">xmlns:jaas</SPAN>=<SPAN class="code-quote">&quot;http://felix.apache.org/karaf/xmlns/jaas/v1.0.0&quot;</SPAN>
           <SPAN class="code-keyword">xmlns:ext</SPAN>=<SPAN class="code-quote">&quot;http://geronimo.apache.org/blueprint/xmlns/blueprint-ext/v1.0.0&quot;</SPAN>&gt;

    <SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- Bean to allow the $[karaf.base] property to be correctly resolved --&gt;</SPAN></SPAN>
    <SPAN class="code-tag">&lt;ext:property-placeholder placeholder-prefix=<SPAN class="code-quote">&quot;$[&quot;</SPAN> placeholder-suffix=<SPAN class="code-quote">&quot;]&quot;</SPAN>/&gt;</SPAN>

    <SPAN class="code-tag">&lt;jaas:config name=<SPAN class="code-quote">&quot;karaf&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;jaas:module className=<SPAN class="code-quote">&quot;org.apache.felix.karaf.jaas.modules.properties.PropertiesLoginModule&quot;</SPAN> flags=<SPAN class="code-quote">&quot;required&quot;</SPAN>&gt;</SPAN>
            users = $[karaf.base]/etc/users.properties
        <SPAN class="code-tag">&lt;/jaas:module&gt;</SPAN>
    <SPAN class="code-tag">&lt;/jaas:config&gt;</SPAN>

<SPAN class="code-tag">&lt;/blueprint&gt;</SPAN>
</PRE>
</DIV></DIV>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Keystore example</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;jaas:keystore <SPAN class="code-keyword">xmlns:jaas</SPAN>=<SPAN class="code-quote">&quot;http://felix.apache.org/karaf/xmlns/jaas/v1.0.0&quot;</SPAN>
               id=<SPAN class="code-quote">&quot;keystore&quot;</SPAN>
               name=<SPAN class="code-quote">&quot;ks&quot;</SPAN>
               rank=<SPAN class="code-quote">&quot;1&quot;</SPAN>
               path=<SPAN class="code-quote">&quot;classpath:privatestore.jks&quot;</SPAN>
               keystorePassword=<SPAN class="code-quote">&quot;keyStorePassword&quot;</SPAN>
               keyPasswords=<SPAN class="code-quote">&quot;myalias=myAliasPassword&quot;</SPAN>&gt;
<SPAN class="code-tag">&lt;/jaas:keystore&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>The <TT>id</TT> attribute is the blueprint id of the bean, but it will be used by default as the name of the realm if no <TT>name</TT> attribute is specified.   Additional attributes on the <TT>config</TT> elements are a <TT>rank</TT>, which is an integer.  When the LoginContext looks for a realm for authenticating a given user, the realms registered in the OSGi registry are matched against the required name.  If more than one realm is found, the one with the highest rank will be used, thus allowing the override of some realms with new values.  The last attribute is <TT>publish</TT> which can be set to false to not publish the realm in the OSGi registry, hereby disabling the use of this realm.</P>

<P>Each realm can contain one or more module definition.  Each module identify a LoginModule and the <TT>className</TT> attribute must be set to the class name of the login module to use.   Note that this login module must be available from the bundle classloader, so either it has to be defined in the bundle itself, or the needed package needs to be correctly imported. The <TT>flags</TT> attribute can take one of four values that are explained on the <A href="http://svn.apache.org/repos/asf/felix/releases/karaf-1.0.0/jaas/boot/src/main/java/org/apache/felix/karaf/jaas/boot/ProxyLoginModule.java" class="external-link" rel="nofollow">JAAS documentation</A>.<BR>
The content of the <TT>module</TT> element is parsed as a properties file and will be used to further configure the login module.</P>

<P>Deploying such a code will lead to a <A href="http://svn.apache.org/repos/asf/felix/releases/karaf-1.0.0/jaas/config/src/main/java/org/apache/felix/karaf/jaas/config/JaasRealm.java" class="external-link" rel="nofollow">JaasRealm</A> object in the OSGi registry, which will then be used when using the JAAS login module.</P>

<H2><A name="KarafUsers%27Guideinonepage-Architecture"></A>Architecture</H2>

<P>Due to constraints in the JAAS specification, one class has to be available for all bundles.  This class is called <A href="http://svn.apache.org/repos/asf/felix/releases/karaf-1.0.0/jaas/boot/src/main/java/org/apache/felix/karaf/jaas/boot/ProxyLoginModule.java" class="external-link" rel="nofollow">ProxyLoginModule</A> and is a LoginModule that acts as a proxy for an OSGi defines LoginModule.  If you plan to integrate this feature into another OSGi runtime, this class must be made available from the system classloader and the related package be part of the boot delegation classpath (or be deployed as a fragment attached to the system bundle).</P>

<P>The xml schema defined above allow the use of a simple xml (leveraging spring xml extensibility) to configure and register a JAAS configuration for a given realm.  This configuration will be made available into the OSGi registry as a <A href="http://svn.apache.org/repos/asf/felix/releases/karaf-1.0.0/jaas/config/src/main/java/org/apache/felix/karaf/jaas/config/JaasRealm.java" class="external-link" rel="nofollow">JaasRealm</A> and the OSGi specific Configuration will look for such services.  Then the proxy login module will be able to use the information provided by the realm to actually load the class from the bundle containing the real login module.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="44-deployer.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="44-deployer.html">4.4. Deployer</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="46-provisioning.html">4.6. Provisioning</A></TD><TD class="ScrollbarNextIcon"><A href="46-provisioning.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="45-security-framework.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="45-security-framework.html">4.5. Security framework</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="47-administration.html">4.7. Administration</A></TD><TD class="ScrollbarNextIcon"><A href="47-administration.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.6.Provisioning"></A>4.6. Provisioning</H1>

<P>Karaf provides a simple, yet flexible, way to provision applications or &quot;features&quot;.  Such a mechanism is mainly provided by a set of commands available in the <TT>features</TT> shell.  The provisioning system uses xml &quot;repositories&quot; that define a set of features.</P>

<H2><A name="KarafUsers%27Guideinonepage-Repositories"></A>Repositories</H2>

<P>The xml repositories use the following Relax NG Compact syntax:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>Repository schema</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
element features {
  element repository { text }*
  element feature {
    attribute name { text },
    attribute version { text },
    element feature { 
      attribute version { text },
      text 
    }*,
    element config {
      attribute name { text },
      text
    }*,
    element bundle { text }*
  }*
}
</PRE>
</DIV></DIV>

<P>Here is an example of such a repository:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;features&gt;</SPAN>
    <SPAN class="code-tag">&lt;feature name=<SPAN class="code-quote">&quot;spring&quot;</SPAN> version=<SPAN class="code-quote">&quot;2.5.6.SEC01&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;bundle&gt;</SPAN>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.aopalliance/1.0_1<SPAN class="code-tag">&lt;/bundle&gt;</SPAN>
        <SPAN class="code-tag">&lt;bundle&gt;</SPAN>mvn:org.springframework/spring-core/2.5.6.SEC01<SPAN class="code-tag">&lt;/bundle&gt;</SPAN>
        <SPAN class="code-tag">&lt;bundle&gt;</SPAN>mvn:org.springframework/spring-beans/2.5.6.SEC01<SPAN class="code-tag">&lt;/bundle&gt;</SPAN>
        <SPAN class="code-tag">&lt;bundle&gt;</SPAN>mvn:org.springframework/spring-aop/2.5.6.SEC01<SPAN class="code-tag">&lt;/bundle&gt;</SPAN>        
        <SPAN class="code-tag">&lt;bundle&gt;</SPAN>mvn:org.springframework/spring-context/2.5.6.SEC01<SPAN class="code-tag">&lt;/bundle&gt;</SPAN>
        <SPAN class="code-tag">&lt;bundle&gt;</SPAN>mvn:org.springframework/spring-context-support/2.5.6.SEC01<SPAN class="code-tag">&lt;/bundle&gt;</SPAN>
    <SPAN class="code-tag">&lt;/feature&gt;</SPAN>
<SPAN class="code-tag">&lt;/features&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>A repository includes a list of <TT>feature</TT> elements, each one representing an application that can be installed.  The feature is identified by its <TT>name</TT> which must be unique amongst all the repositories used and consists of a set of bundles that need to be installed along with some optional dependencies on other features and some optional configurations for the Configuration Admin OSGi service.</P>

<H3><A name="KarafUsers%27Guideinonepage-Bundles"></A>Bundles</H3>

<P>The main information provided by a feature is the set of OSGi bundles that defines the application.  Such bundles are URLs pointing to the actual bundle jars.  For example, one would write the following definition:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;bundle&gt;</SPAN>http://repo1.maven.org/maven2/org/apache/servicemix/nmr/org.apache.servicemix.nmr.api/1.0.0-m2/org.apache.servicemix.nmr.api-1.0.0-m2.jar<SPAN class="code-tag">&lt;/bundle&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>Doing this will make sure the above bundle is installed while installing the feature.</P>

<P>However, Karaf provides several URL handlers, in addition to the usual ones (file, http, etc...). One of these is the maven URL handler, which allow reusing maven repositories to point to the bundles. </P>

<H4><A name="KarafUsers%27Guideinonepage-MavenURLHandler"></A>Maven URL Handler</H4>

<P>The equivalent of the above bundle would be:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
&lt;bundle&gt;mvn:org.apache.servicemix.nmr/org.apache.servicemix.nmr.api/1.0.0-m2&lt;/bundle&gt;
</PRE>
</DIV></DIV>
<P>In addition to being less verbose, the maven url handlers can also resolve snapshots and can use a local copy of the jar if one is available in your maven local repository.</P>

<P>The <TT>org.ops4j.pax.url.mvn</TT> bundle resolves <TT>mvn</TT> URLs. This flexible tool can be configured through the configuration service. For example, to find the current repositories type:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root:/&gt; config:list
...
----------------------------------------------------------------
Pid:            org.ops4j.pax.url.mvn
BundleLocation: mvn:org.ops4j.pax.url/pax-url-mvn/0.3.3
Properties:
   service.pid = org.ops4j.pax.url.mvn
   org.ops4j.pax.url.mvn.defaultRepositories = file:/opt/development/karaf/assembly/target/apache-felix-karaf-1.2.0-SNAPSHOT/system@snapshots
   org.ops4j.pax.url.mvn.repositories = http:<SPAN class="code-comment">//repo1.maven.org/maven2, 
</SPAN>                                         http:<SPAN class="code-comment">//people.apache.org/repo/m2-snapshot-repository@snapshots@noreleases, 
</SPAN>                                         http:<SPAN class="code-comment">//repository.ops4j.org/maven2, 
</SPAN>                                         http:<SPAN class="code-comment">//svn.apache.org/repos/asf/servicemix/m2-repo 
</SPAN>   below = list of repositories and even before the local repository
</PRE>
</DIV></DIV>

<P>The repositories checked are controlled by these configuration properties. </P>

<P>For example, <TT>org.ops4j.pax.url.mvn.repositories</TT> is a comma separate list of repository URLs specifying those remote repositories to be checked. So, to replace the defaults with a new repository at <TT><A href="http://www.example.org/repo" class="external-link" rel="nofollow">http://www.example.org/repo</A></TT> on the local machine:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root:/&gt; config:edit org.ops4j.pax.url.mvn
karaf@root:/&gt; config:proplist                  
   service.pid = org.ops4j.pax.url.mvn
   org.ops4j.pax.url.mvn.defaultRepositories = file:/opt/development/karaf/assembly/target/apache-felix-karaf-1.2.0-SNAPSHOT/system@snapshots
   org.ops4j.pax.url.mvn.repositories = http:<SPAN class="code-comment">//repo1.maven.org/maven2,
</SPAN>                                        http:<SPAN class="code-comment">//people.apache.org/repo/m2-snapshot-repository@snapshots@noreleases,
</SPAN>                                        http:<SPAN class="code-comment">//repository.ops4j.org/maven2,
</SPAN>                                        http:<SPAN class="code-comment">//svn.apache.org/repos/asf/servicemix/m2-repo
</SPAN>   below = list of repositories and even before the local repository
karaf@root:/&gt; config:propset org.ops4j.pax.url.mvn.repositories http:<SPAN class="code-comment">//www.example.org/repo
</SPAN>karaf@root:/&gt; config:update
</PRE>
</DIV></DIV>

<P>By default, snapshots are disable. To enable an URL for snapshots append @snapshots. For example</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
http:<SPAN class="code-comment">//www.example.org/repo@snapshots</SPAN>
</PRE>
</DIV></DIV>

<P>Repositories on the local are supported through <TT><A href="file:///" class="external-link" rel="nofollow">file:/</A></TT> URLs</P>

<H3><A name="KarafUsers%27Guideinonepage-Dependantfeatures"></A>Dependant features</H3>

<P>Dependant features are usefull when a given feature depends on another feature to be installed.  Such a dependency can be expressed easily in the feature definition:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;feature name=<SPAN class="code-quote">&quot;jbi&quot;</SPAN>&gt;</SPAN>
  <SPAN class="code-tag">&lt;feature&gt;</SPAN>nmr<SPAN class="code-tag">&lt;/feature&gt;</SPAN>
  ...
<SPAN class="code-tag">&lt;/feature&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>The effect of such a dependency is to automatically install the required <TT>nmr</TT> feature when the <TT>jbi</TT> feature will be installed.</P>

<H3><A name="KarafUsers%27Guideinonepage-Configurations"></A>Configurations</H3>

<P>The configuration section allows to deploy configuration for the OSGi Configuration Admin service along a set of bundles.<BR>
Here is an example of such a configuration:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;config name=<SPAN class="code-quote">&quot;com.foo.bar&quot;</SPAN>&gt;</SPAN>
  myProperty = myValue
<SPAN class="code-tag">&lt;/config&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>The <TT>name</TT> attribute of the <TT>configuration</TT> element will be used as the ManagedService PID for the configuration set in the Configuration Admin service.  When using a ManagedServiceFactory, the <TT>name</TT> attribute is <EM>servicePid</EM>-<EM>aliasId</EM>, where <EM>servicePid</EM> is the PID of the ManagedServiceFactory and <EM>aliasId</EM> is a label used to uniquely identify a particular service (an alias to the factory generated service PID).</P>

<P>Deploying such a configuration has the same effect than dropping a file named <TT>com.foo.bar.cfg</TT> into the <TT>etc</TT> folder.  </P>

<P>The content of the <TT>configuration</TT> element is set of properties parsed using the <A href="http://java.sun.com/j2se/1.5.0/docs/api/java/util/Properties.html#load(java.io.InputStream)" class="external-link" rel="nofollow">standard java property mechanism</A>.</P>

<P>Such configuration as usually used with Spring-DM or Blueprint support for the Configuration Admin service, as in the following example, but using plain OSGi APIs will of course work the same way:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;bean ...&gt;</SPAN>
    <SPAN class="code-tag">&lt;property name=<SPAN class="code-quote">&quot;propertyName&quot;</SPAN> value=<SPAN class="code-quote">&quot;${myProperty}&quot;</SPAN> /&gt;</SPAN>
<SPAN class="code-tag">&lt;/bean&gt;</SPAN>

<SPAN class="code-tag">&lt;osgix:cm-properties id=<SPAN class="code-quote">&quot;cmProps&quot;</SPAN> persistent-id=<SPAN class="code-quote">&quot;com.foo.bar&quot;</SPAN>&gt;</SPAN>
    <SPAN class="code-tag">&lt;prop key=<SPAN class="code-quote">&quot;myProperty&quot;</SPAN>&gt;</SPAN>myValue<SPAN class="code-tag">&lt;/prop&gt;</SPAN>
<SPAN class="code-tag">&lt;/osgix:cm-properties&gt;</SPAN>
<SPAN class="code-tag">&lt;ctx:property-placeholder properties-ref=<SPAN class="code-quote">&quot;cmProps&quot;</SPAN> /&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>For more informations about using the Configuration Admin service in Spring-DM, see the <A href="http://static.springframework.org/osgi/docs/1.2.0-m2/reference/html/compendium.html#compendium:cm:props" class="external-link" rel="nofollow">Spring-DM documentation</A>.</P>


<H2><A name="KarafUsers%27Guideinonepage-Commands"></A>Commands</H2>

<H3><A name="KarafUsers%27Guideinonepage-Repositorymanagement"></A>Repository management</H3>

<P>The following commands can be used to manage the list of descriptors known by Karaf.  They use URLs pointing to features descriptors.  These URLs can use any protocol known to the ServiceMix Kernel, the most common ones being http, file and mvn.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
features:addUrl      Add a list of repository URLs to the features service
features:removeUrl   Remove a list of repository URLs from the features service
features:listUrl     Display the repository URLs currently associated with the features service.
features:refreshUrl  Reload the repositories to obtain a fresh list of features
</PRE>
</DIV></DIV>

<P>Karaf maintains a persistent list of these repositories so that if you add one URL and restart Karaf, the features will still be available.</P>

<P>The <TT>refreshUrl</TT> command is mostly used when developing features descriptors: when changing the descriptor, it can be handy to reload it in the Kernel without having to restart it or to remove then add again this URL.</P>

<H3><A name="KarafUsers%27Guideinonepage-Featuresmanagement"></A>Features management</H3>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
features:install
features:uninstall
features:list
</PRE>
</DIV></DIV>

<H3><A name="KarafUsers%27Guideinonepage-Examples"></A>Examples</H3>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
features/addUrl mvn:org.apache.servicemix.nmr/apache-servicemix-nmr/1.0.0-m2/xml/features
features/install nmr
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Serviceconfiguration"></A>Service configuration</H2>

<P>A simple configuration file located in <TT>[karaf]/etc/org.apache.servicemix.features.cfg</TT> can be modified to customize the behavior when starting the Kernel for the first time.<BR>
This configuration file contains two properties:</P>
<UL>
	<LI><TT>featuresBoot</TT>: a comma separated list of features to install at startup</LI>
	<LI><TT>featuresRepositories</TT>: a comma separated list of feature repositories to load at startup</LI>
</UL>


<P>This configuration file is of interest if you plan to distribute a ServiceMix Kernel distribution which includes pre-installed features.  Such a process is detailed in the <A href="62-building-custom-distributions.html" title="6.2. Building custom distributions">6.2. Building custom distributions</A> section.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="45-security-framework.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="45-security-framework.html">4.5. Security framework</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="47-administration.html">4.7. Administration</A></TD><TD class="ScrollbarNextIcon"><A href="47-administration.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="46-provisioning.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="46-provisioning.html">4.6. Provisioning</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="48-configuration.html">4.8. Configuration</A></TD><TD class="ScrollbarNextIcon"><A href="48-configuration.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.7.Administration"></A>4.7. Administration</H1>

<P>Karaf provides some commands to administer multiple instances.  An instance of Karaf is a copy that you can launch separately and deploy applications onto.  An instance does not contain a full copy of Karaf, but only a copy of the configuration files and <TT>data</TT> folder which contains all runtime informations, logs and temporary files.</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Commands     </TH>
<TH class="confluenceTh"> Description </TH>
</TR>
<TR>
<TD class="confluenceTd">  change-port   </TD>
<TD class="confluenceTd"> Changes the port of an existing container instance. </TD>
</TR>
<TR>
<TD class="confluenceTd">  connect       </TD>
<TD class="confluenceTd"> Connects to an existing container instance. </TD>
</TR>
<TR>
<TD class="confluenceTd">  create        </TD>
<TD class="confluenceTd"> Creates a new container instance. </TD>
</TR>
<TR>
<TD class="confluenceTd">  destroy       </TD>
<TD class="confluenceTd"> Destroys an existing container instance. </TD>
</TR>
<TR>
<TD class="confluenceTd">  list          </TD>
<TD class="confluenceTd"> List all existing container instances. </TD>
</TR>
<TR>
<TD class="confluenceTd">  start         </TD>
<TD class="confluenceTd"> Starts an existing container instance. </TD>
</TR>
<TR>
<TD class="confluenceTd">  stop          </TD>
<TD class="confluenceTd"> Stops an existing container instance. </TD>
</TR>
</TBODY></TABLE>
</DIV>


<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="46-provisioning.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="46-provisioning.html">4.6. Provisioning</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="48-configuration.html">4.8. Configuration</A></TD><TD class="ScrollbarNextIcon"><A href="48-configuration.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="47-administration.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="47-administration.html">4.7. Administration</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-4.8.Configuration"></A>4.8. Configuration</H1>

<P>The files in the <TT>etc</TT> directory are used to set the startup configuration.  </P>

<P>For dynamic configuration, Karaf provides a suite of command to administer the configuration service grouped under <TT>config</TT>. To learn about all currently supported configuration commands type:</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Command </TH>
<TH class="confluenceTh"> Description   </TH>
</TR>
<TR>
<TD class="confluenceTd"> cancel   </TD>
<TD class="confluenceTd"> Change the changes to the configuration being edited. </TD>
</TR>
<TR>
<TD class="confluenceTd"> edit     </TD>
<TD class="confluenceTd"> Create or edit a configuration. </TD>
</TR>
<TR>
<TD class="confluenceTd"> list     </TD>
<TD class="confluenceTd"> List existing configurations. </TD>
</TR>
<TR>
<TD class="confluenceTd"> propdel  </TD>
<TD class="confluenceTd"> Delete a property from the edited configuration. </TD>
</TR>
<TR>
<TD class="confluenceTd"> proplist </TD>
<TD class="confluenceTd"> List properties from the edited configuration. </TD>
</TR>
<TR>
<TD class="confluenceTd"> propset  </TD>
<TD class="confluenceTd"> Set a property on the edited configuration. </TD>
</TR>
<TR>
<TD class="confluenceTd"> update   </TD>
<TD class="confluenceTd"> Save and propagate changes from the configuration being edited. </TD>
</TR>
</TBODY></TABLE>
</DIV>



<H2><A name="KarafUsers%27Guideinonepage-Editing"></A>Editing</H2>

<H3><A name="KarafUsers%27Guideinonepage-SelectConfigurationToEdit"></A>Select Configuration To Edit</H3>

<P>For example to edit configuration <TT>foo.bar</TT>:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root:/&gt; config:edit foo.bar
</PRE>
</DIV></DIV>

<H3><A name="KarafUsers%27Guideinonepage-ModifyProperties"></A>Modify Properties</H3>

<P>Use:</P>

<UL>
	<LI><TT>config:proplist</TT> to list existing properties</LI>
	<LI><TT>config:propdel</TT> to delete existing properties</LI>
	<LI><TT>config:propset</TT> to set a new value for a property</LI>
</UL>


<P>Any number of properties can be modified within a single editing session. </P>

<H3><A name="KarafUsers%27Guideinonepage-CommitOrRollbackChanges"></A>Commit Or Rollback Changes</H3>

<P>Use</P>

<UL>
	<LI><TT>config:update</TT> to commit all changes made in the current session</LI>
	<LI><TT>config:cancel</TT> to roll back any changes made in the current session</LI>
</UL>


<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="47-administration.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="47-administration.html">4.7. Administration</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="4-understanding-karaf.html">4. Understanding Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="4-understanding-karaf.html">4. Understanding Karaf</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD class="ScrollbarNextIcon"><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-5.UsingKaraf"></A>5. Using Karaf</H1>

<UL><LI><A href="51-troubleshooting-debugging-and-profiling.html" title="5.1. Troubleshooting, Debugging and Profiling">5.1. Troubleshooting, Debugging and Profiling</A></LI><LI><A href="52-developping-applications.html" title="5.2. Developping applications">5.2. Developping applications</A></LI><LI><A href="53-creating-bundles-for-third-party-dependencies.html" title="5.3. Creating bundles for third party dependencies">5.3. Creating bundles for third party dependencies</A></LI><LI><A href="54-writing-integration-tests.html" title="5.4. Writing integration tests">5.4. Writing integration tests</A></LI></UL>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="4-understanding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="4-understanding-karaf.html">4. Understanding Karaf</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD class="ScrollbarNextIcon"><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="5-using-karaf.html">5. Using Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="52-developping-applications.html">5.2. Developping applications</A></TD><TD class="ScrollbarNextIcon"><A href="52-developping-applications.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-5.1.Troubleshooting%2CDebuggingandProfiling"></A>5.1. Troubleshooting, Debugging and Profiling</H1>

<H2><A name="KarafUsers%27Guideinonepage-Troubleshooting"></A>Troubleshooting</H2>

<H3><A name="KarafUsers%27Guideinonepage-Logging"></A>Logging</H3>

<P>Logging is easy to control through the console, with commands grouped under <EM>log</EM> shell. To learn about the available logging commands type:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root&gt; log&lt;tab&gt;

log:display              log:display-exception    log:get                  log:set
karaf@root&gt;
</PRE>
</DIV></DIV>

<P>Typical usage is:</P>

<OL>
	<LI>Use <TT>log:set</TT> to dynamically change the global log level</LI>
	<LI>Execute the problematic operation</LI>
	<LI>Use <TT>log:display</TT> (or <TT>log:display-exception</TT> to display the log</LI>
</OL>




<H3><A name="KarafUsers%27Guideinonepage-WorstCaseScenario"></A>Worst Case Scenario</H3>

<P>If you end up with a Karaf in a really bad state (i.e. you can not boot it anymore) or you just want to revert to a clean state quickly, you can safely remove the <TT>data</TT> directory just in the installation directory.  This folder contains transient data and will be recreated if you remove it and relaunch Karaf.<BR>
You may also want to remove the files in the <TT>deploy</TT> folder to avoid them being automatically installed when Karaf is started the first time.</P>

<H2><A name="KarafUsers%27Guideinonepage-Debugging"></A>Debugging</H2>

<P>Usually, the easiest way to debug Karaf or any application deployed onto it is to use remote debugging.<BR>
Remote debugging can be easily activated by setting the <TT>KARAF_DEBUG</TT> environment variable to <TT>TRUE</TT>.</P>

<P>This can be done using the following command on Unix systems:</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>export KARAF_DEBUG=true
</PRE>
</DIV></DIV>

<P>On Windows, use the following command</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>set KARAF_DEBUG=true
</PRE>
</DIV></DIV>

<P>Then, you can launch Karaf using the usual way:</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>bin/karaf
</PRE>
</DIV></DIV>
<P>or</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>bin\karaf.bat
</PRE>
</DIV></DIV>

<P>Last, inside your IDE, connect to the remote application (the default port to connect to is 5005).</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<H2><A name="KarafUsers%27Guideinonepage-Profiling"></A>Profiling</H2>

<H3><A name="KarafUsers%27Guideinonepage-YourKit"></A>YourKit</H3>

<P>You need a few steps to be able to profile Karaf using YourKit.<BR>
The first one is to edit the <TT>etc/config.properties</TT> configuration file and add the following property:</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>org.osgi.framework.bootdelegation=com.yourkit.*
</PRE>
</DIV></DIV>

<P>Then, set the <TT>JAVA_OPTS</TT> environment variable:</P>
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>export JAVA_OPTS='-Xmx512M -agentlib:yjpagent'
</PRE>
</DIV></DIV>

<P>or, on Windows</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>set JAVA_OPTS='-Xmx512M -agentlib:yjpagent'
</PRE>
</DIV></DIV>

<P>Run Karaf from the console, and you should now be able to connect using YourKit standalone or from your favorite IDE.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="5-using-karaf.html">5. Using Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="52-developping-applications.html">5.2. Developping applications</A></TD><TD class="ScrollbarNextIcon"><A href="52-developping-applications.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="51-troubleshooting-debugging-and-profiling.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="51-troubleshooting-debugging-and-profiling.html">5.1. Troubleshooting, Debugging and Profiling</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="5-using-karaf.html">5. Using Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="53-creating-bundles-for-third-party-dependencies.html">5.3. Creating bundles for third party dependencies</A></TD><TD class="ScrollbarNextIcon"><A href="53-creating-bundles-for-third-party-dependencies.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-5.2.Developpingapplications"></A>5.2. Developping applications</H1>

<P>TODO</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="51-troubleshooting-debugging-and-profiling.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="51-troubleshooting-debugging-and-profiling.html">5.1. Troubleshooting, Debugging and Profiling</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="5-using-karaf.html">5. Using Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="53-creating-bundles-for-third-party-dependencies.html">5.3. Creating bundles for third party dependencies</A></TD><TD class="ScrollbarNextIcon"><A href="53-creating-bundles-for-third-party-dependencies.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="52-developping-applications.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="52-developping-applications.html">5.2. Developping applications</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="5-using-karaf.html">5. Using Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="54-writing-integration-tests.html">5.4. Writing integration tests</A></TD><TD class="ScrollbarNextIcon"><A href="54-writing-integration-tests.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-5.3.Creatingbundlesforthirdpartydependencies"></A>5.3. Creating bundles for third party dependencies</H1>

<P>TODO</P>

<P>Some infos available at <A href="http://gnodet.blogspot.com/2008/09/id-like-to-talk-bit-about-third-party.html" class="external-link" rel="nofollow">http://gnodet.blogspot.com/2008/09/id-like-to-talk-bit-about-third-party.html</A>, <A href="http://blog.springsource.com/2008/02/18/creating-osgi-bundles/" class="external-link" rel="nofollow">http://blog.springsource.com/2008/02/18/creating-osgi-bundles/</A> and <A href="http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html" class="external-link" rel="nofollow">http://felix.apache.org/site/apache-felix-maven-bundle-plugin-bnd.html</A>.</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="52-developping-applications.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="52-developping-applications.html">5.2. Developping applications</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="5-using-karaf.html">5. Using Karaf</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="54-writing-integration-tests.html">5.4. Writing integration tests</A></TD><TD class="ScrollbarNextIcon"><A href="54-writing-integration-tests.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="5-using-karaf.html">5. Using Karaf</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="7-optional-features.html">7. Optional Features</A></TD><TD class="ScrollbarNextIcon"><A href="7-optional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-6.Advanceduses"></A>6. Advanced uses</H1>

<UL><LI><A href="61-extending-the-console.html" title="6.1. Extending the console">6.1. Extending the console</A></LI><LI><A href="62-building-custom-distributions.html" title="6.2. Building custom distributions">6.2. Building custom distributions</A></LI><LI><A href="63-programmatically-connect-to-the-console.html" title="6.3. Programmatically connect to the console">6.3. Programmatically connect to the console</A></LI><LI><A href="64-embedding-karaf.html" title="6.4. Embedding Karaf">6.4. Embedding Karaf</A></LI><LI><A href="65-deploying-security-providers.html" title="6.5. Deploying security providers">6.5. Deploying security providers</A></LI><LI><A href="66-installing-additional-features.html" title="6.6. Installing additional features">6.6. Installing additional features</A></LI><LI><A href="67-configuring-failover-deployments.html" title="6.7. Configuring Failover Deployments">6.7. Configuring Failover Deployments</A></LI></UL>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="5-using-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="5-using-karaf.html">5. Using Karaf</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="7-optional-features.html">7. Optional Features</A></TD><TD class="ScrollbarNextIcon"><A href="7-optional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="62-building-custom-distributions.html">6.2. Building custom distributions</A></TD><TD class="ScrollbarNextIcon"><A href="62-building-custom-distributions.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-6.1.Extendingtheconsole"></A>6.1. Extending the console</H1>

<P>This chapter will guide you through the steps needed to extend the console and create a new shell.  We will leverage Maven, Blueprint and OSGi, so you will need some knowledge of those products.</P>

<P>You may also find some information about the console at <A href="rfc-147-overview.html" title="RFC 147 Overview">RFC 147 Overview</A>.</P>

<H2><A name="KarafUsers%27Guideinonepage-Createtheprojectusingmaven"></A>Create the project using maven</H2>

<P>We first need to create the project using maven.  Let's leverage maven archetypes for that.</P>

<H3><A name="KarafUsers%27Guideinonepage-Commandline"></A>Command line</H3>

<P>Using the command line, we can create our project:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
mvn archetype:create \
  -DarchetypeArtifactId=maven-archetype-quickstart \
  -DgroupId=org.apache.felix.karaf.shell.samples \
  -DartifactId=shell-sample-commands \
  -Dversion=1.0-SNAPSHOT
</PRE>
</DIV></DIV>

<P>This generate the main <TT>pom.xml</TT> and some additional packages.</P>

<H3><A name="KarafUsers%27Guideinonepage-Interactiveshell"></A>Interactive shell</H3>

<P>You can also use the interactive mode for creating the skeleton project:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
mvn archetype:generate
</PRE>
</DIV></DIV>
<P>Use the following values when prompted:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Choose a number:  (1/2/3/4/5/6/7/8/9/10/11/12/13/14/15/16/17/18/19/20/21/22/23/24/25/26/27/28/29/30/31/32/33/34/35/36) 15: : 15
Define value <SPAN class="code-keyword">for</SPAN> groupId: : org.apache.felix.karaf.shell.samples
Define value <SPAN class="code-keyword">for</SPAN> artifactId: : shell-sample-commands
Define value <SPAN class="code-keyword">for</SPAN> version:  1.0-SNAPSHOT: : 
Define value <SPAN class="code-keyword">for</SPAN> <SPAN class="code-keyword">package</SPAN>: : org.apache.felix.karaf.shell.samples
</PRE>
</DIV></DIV>

<H3><A name="KarafUsers%27Guideinonepage-Manualcreation"></A>Manual creation</H3>

<P>Alternatively, you can simply create the directory <TT>shell-sample-commands</TT> and create the <TT>pom.xml</TT> file inside it:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>pom.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;project xmlns=<SPAN class="code-quote">&quot;http://maven.apache.org/POM/4.0.0&quot;</SPAN> <SPAN class="code-keyword">xmlns:xsi</SPAN>=<SPAN class="code-quote">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</SPAN>
  xsi:schemaLocation=<SPAN class="code-quote">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</SPAN>&gt;
  <SPAN class="code-tag">&lt;modelVersion&gt;</SPAN>4.0.0<SPAN class="code-tag">&lt;/modelVersion&gt;</SPAN>
  <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix.karaf.shell.samples<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
  <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>shell-sample-commands<SPAN class="code-tag">&lt;artifactId&gt;</SPAN>
  <SPAN class="code-tag">&lt;packaging&gt;</SPAN>jar<SPAN class="code-tag">&lt;/packaging&gt;</SPAN>
  <SPAN class="code-tag">&lt;version&gt;</SPAN>1.0-SNAPSHOT<SPAN class="code-tag">&lt;/version&gt;</SPAN>
  <SPAN class="code-tag">&lt;name&gt;</SPAN>shell-sample-commmands<SPAN class="code-tag">&lt;/name&gt;</SPAN>
  <SPAN class="code-tag">&lt;url&gt;</SPAN>http://maven.apache.org<SPAN class="code-tag">&lt;/url&gt;</SPAN>
  <SPAN class="code-tag">&lt;dependencies&gt;</SPAN>
    <SPAN class="code-tag">&lt;dependency&gt;</SPAN>
      <SPAN class="code-tag">&lt;groupId&gt;</SPAN>junit<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
      <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>junit<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
      <SPAN class="code-tag">&lt;version&gt;</SPAN>3.8.1<SPAN class="code-tag">&lt;/version&gt;</SPAN>
      <SPAN class="code-tag">&lt;scope&gt;</SPAN>test<SPAN class="code-tag">&lt;/scope&gt;</SPAN>
    <SPAN class="code-tag">&lt;/dependency&gt;</SPAN>
  <SPAN class="code-tag">&lt;/dependencies&gt;</SPAN>
<SPAN class="code-tag">&lt;/project&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Dependencies"></A>Dependencies</H2>

<P>We need to tell maven which libraries our project depends on.  In the <TT>dependencies</TT> section of the pom, add the following one:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
  <SPAN class="code-tag">&lt;dependency&gt;</SPAN>
    <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix.karaf.shell<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
    <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>org.apache.felix.karaf.shell.console<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
    <SPAN class="code-tag">&lt;version&gt;</SPAN>1.0.0<SPAN class="code-tag">&lt;/version&gt;</SPAN>
  <SPAN class="code-tag">&lt;/dependency&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>This dependency is needed to have access to the base classes that are used to define commands.</P>

<H2><A name="KarafUsers%27Guideinonepage-ConfiguringforJava5"></A>Configuring for Java 5</H2>

<P>We are using annotations to define commands, so we need to ensure maven will actually use JDK 1.5 to compile the jar.<BR>
Just add the following snippet after the <TT>dependencies</TT> section.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;build&gt;</SPAN>
  <SPAN class="code-tag">&lt;plugins&gt;</SPAN>
    <SPAN class="code-tag">&lt;plugin&gt;</SPAN>
      <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.maven.plugins<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
      <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-compiler-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
      <SPAN class="code-tag">&lt;configuration&gt;</SPAN>
        <SPAN class="code-tag">&lt;target&gt;</SPAN>1.5<SPAN class="code-tag">&lt;/target&gt;</SPAN>
        <SPAN class="code-tag">&lt;source&gt;</SPAN>1.5<SPAN class="code-tag">&lt;/source&gt;</SPAN>
      <SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
    <SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
  <SPAN class="code-tag">&lt;/plugins&gt;</SPAN>
<SPAN class="code-tag">&lt;/build&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-LoadingtheprojectinyourIDE"></A>Loading the project in your IDE</H2>

<P>We can use maven to generate the needed files for your IDE:</P>

<P>Inside the project, run the following command</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
mvn eclipse:eclipse
</PRE>
</DIV></DIV>
<P>or</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
mvn idea:idea
</PRE>
</DIV></DIV>

<P>The project files for your IDE should now be created.  Just open the IDE and load the project.</P>

<H2><A name="KarafUsers%27Guideinonepage-Creatingabasiccommandclass"></A>Creating a basic command class</H2>

<P>We can now create the command class <TT>HelloShellCommand.java</TT></P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>HelloShellCommand.java</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> org.apache.felix.karaf.shell.samples;

<SPAN class="code-keyword">import</SPAN> org.apache.felix.gogo.commands.Command;
<SPAN class="code-keyword">import</SPAN> org.apache.felix.gogo.commands.Option;
<SPAN class="code-keyword">import</SPAN> org.apache.felix.gogo.commands.Argument;
<SPAN class="code-keyword">import</SPAN> org.apache.felix.karaf.shell.console.OsgiCommandSupport;

@Command(scope = <SPAN class="code-quote">&quot;test&quot;</SPAN>, name = <SPAN class="code-quote">&quot;hello&quot;</SPAN>, description=<SPAN class="code-quote">&quot;Says hello&quot;</SPAN>)
<SPAN class="code-keyword">public</SPAN> class HelloShellCommand <SPAN class="code-keyword">extends</SPAN> OsgiCommandSupport {

    @Override
    <SPAN class="code-keyword">protected</SPAN> <SPAN class="code-object">Object</SPAN> doExecute() <SPAN class="code-keyword">throws</SPAN> Exception {
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;Executing Hello command&quot;</SPAN>);
        <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">null</SPAN>;
    }
}
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Creatingtheassociatedblueprintconfigurationfiles"></A>Creating the associated blueprint configuration files</H2>

<P>The blueprint configuration file will be used to create the command and register it in the OSGi registry, which is the way to make the command available to Karaf console.  This blueprint file must be located in the <TT>OSGI-INF/blueprint/</TT> directory inside the bundle.</P>

<P>If you don't have the <TT>src/main/resources</TT> directory yet, create it.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
mkdir src/main/resources
</PRE>
</DIV></DIV>

<P>Then, re-generate the IDE project files and reload it so that this folder is now recognized as a source folder.</P>

<P>Inside this directory, create the <TT>OSGI-INF/blueprint/</TT> directory and put the following file inside (the name of this file has no impact at all):</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;"><B>shell-config.xml</B></DIV><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;blueprint xmlns=<SPAN class="code-quote">&quot;http://www.osgi.org/xmlns/blueprint/v1.0.0&quot;</SPAN>&gt;</SPAN>

    <SPAN class="code-tag">&lt;command-bundle xmlns=<SPAN class="code-quote">&quot;http://felix.apache.org/karaf/xmlns/shell/v1.0.0&quot;</SPAN>&gt;</SPAN>
        <SPAN class="code-tag">&lt;command name=<SPAN class="code-quote">&quot;test/hello&quot;</SPAN>&gt;</SPAN>
            <SPAN class="code-tag">&lt;action class=<SPAN class="code-quote">&quot;org.apache.felix.karaf.shell.samples.HelloShellCommand&quot;</SPAN>/&gt;</SPAN>
        <SPAN class="code-tag">&lt;/command&gt;</SPAN>
    <SPAN class="code-tag">&lt;/command-bundle&gt;</SPAN>

<SPAN class="code-tag">&lt;/blueprint&gt;</SPAN>
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Compilingthejar"></A>Compiling the jar</H2>

<P>Let's try to build the jar.  Remove the test classes and sample classes if you used the artifact, then from the command line, run:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
mvn install
</PRE>
</DIV></DIV>

<P>The end of the maven output should look like:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
[SMX4KNL:INFO] ------------------------------------------------------------------------
[SMX4KNL:INFO] BUILD SUCCESSFUL
[SMX4KNL:INFO] ------------------------------------------------------------------------
</PRE>
</DIV></DIV>

<H2><A name="KarafUsers%27Guideinonepage-TurningthejarintoanOSGibundle"></A>Turning the jar into an OSGi bundle</H2>

<P>OSGi bundles are jars but they require some manifest headers to be correctly recognized.  We will leverage Felix's manven plugin to easily generate those.  </P>

<P>Lets turn it into a bundle: modify the line in the <TT>pom.xml</TT> to adjust the packaging:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
  <SPAN class="code-tag">&lt;packaging&gt;</SPAN>bundle<SPAN class="code-tag">&lt;/packaging&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>Add the following section at the bottom of the <TT>pom.xml</TT>, in the existing <TT>build/plugins</TT> section:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
      <SPAN class="code-tag">&lt;plugin&gt;</SPAN>
        <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
        <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-bundle-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
        <SPAN class="code-tag">&lt;version&gt;</SPAN>2.0.1<SPAN class="code-tag">&lt;/version&gt;</SPAN>
        <SPAN class="code-tag">&lt;extensions&gt;</SPAN>true<SPAN class="code-tag">&lt;/extensions&gt;</SPAN>
        <SPAN class="code-tag">&lt;configuration&gt;</SPAN>
            <SPAN class="code-tag">&lt;instructions&gt;</SPAN>
                <SPAN class="code-tag">&lt;Import-Package&gt;</SPAN>org.osgi.service.command,*<SPAN class="code-tag">&lt;/Import-Package&gt;</SPAN>
            <SPAN class="code-tag">&lt;/instructions&gt;</SPAN>
        <SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
      <SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>The <TT>Import-Package</TT> is required to make sure our bundle will import the <TT>org.osgi.service.command</TT> package so that the service will be correctly seen in Felix.</P>

<P>Let's compiled it again using the <TT>mvn install</TT> command.</P>

<H2><A name="KarafUsers%27Guideinonepage-TestinKaraf"></A>Test in Karaf</H2>

<P>Launch a Karaf instance and run the following command to install the newly created bundle:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root&gt; osgi:install -s mvn:org.apache.felix.karaf.shell.samples/shell-sample-commands/1.0-SNAPSHOT
</PRE>
</DIV></DIV>

<P>Let's try running the command:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
karaf@root&gt; test:hello
Executing Hello command
</PRE>
</DIV></DIV>

<P>and for the link:</P>

<P>Yeah <IMG class="emoticon" src="http://cwiki.apache.org/confluence/images/icons/emoticons/smile.gif" height="20" width="20" align="absmiddle" alt="" border="0"></P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="62-building-custom-distributions.html">6.2. Building custom distributions</A></TD><TD class="ScrollbarNextIcon"><A href="62-building-custom-distributions.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="61-extending-the-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="61-extending-the-console.html">6.1. Extending the console</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="63-programmatically-connect-to-the-console.html">6.3. Programmatically connect to the console</A></TD><TD class="ScrollbarNextIcon"><A href="63-programmatically-connect-to-the-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-6.2.Buildingcustomdistributions"></A>6.2. Building custom distributions</H1>

<P>TODO</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="61-extending-the-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="61-extending-the-console.html">6.1. Extending the console</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="63-programmatically-connect-to-the-console.html">6.3. Programmatically connect to the console</A></TD><TD class="ScrollbarNextIcon"><A href="63-programmatically-connect-to-the-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="62-building-custom-distributions.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="62-building-custom-distributions.html">6.2. Building custom distributions</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="64-embedding-karaf.html">6.4. Embedding Karaf</A></TD><TD class="ScrollbarNextIcon"><A href="64-embedding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-6.3.Programmaticallyconnecttotheconsole"></A>6.3. Programmatically connect to the console</H1>

<P>A connection to Karaf console can also be done programmatically.<BR>
The following code is a simplified version of the code from the client library.</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">import</SPAN> org.apache.sshd.ClientChannel;
<SPAN class="code-keyword">import</SPAN> org.apache.sshd.ClientSession;
<SPAN class="code-keyword">import</SPAN> org.apache.sshd.SshClient;
<SPAN class="code-keyword">import</SPAN> org.apache.sshd.client.<SPAN class="code-keyword">future</SPAN>.ConnectFuture;

<SPAN class="code-keyword">public</SPAN> class Main {

    <SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> void main(<SPAN class="code-object">String</SPAN>[] args) <SPAN class="code-keyword">throws</SPAN> Exception {
        <SPAN class="code-object">String</SPAN> host = <SPAN class="code-quote">&quot;localhost&quot;</SPAN>;
        <SPAN class="code-object">int</SPAN> port = 8101;
        <SPAN class="code-object">String</SPAN> user = <SPAN class="code-quote">&quot;karaf&quot;</SPAN>;
        <SPAN class="code-object">String</SPAN> password = <SPAN class="code-quote">&quot;karaf&quot;</SPAN>;

        SshClient client = <SPAN class="code-keyword">null</SPAN>;
        <SPAN class="code-keyword">try</SPAN> {
            client = SshClient.setUpDefaultClient();
            client.start();
            ConnectFuture <SPAN class="code-keyword">future</SPAN> = client.connect(host, port);
            <SPAN class="code-keyword">future</SPAN>.await();
            ClientSession session = <SPAN class="code-keyword">future</SPAN>.getSession();
            session.authPassword(user, password);
            ClientChannel channel = session.createChannel(<SPAN class="code-quote">&quot;shell&quot;</SPAN>);
            channel.setIn(<SPAN class="code-object">System</SPAN>.in);
            channel.setOut(<SPAN class="code-object">System</SPAN>.out);
            channel.setErr(<SPAN class="code-object">System</SPAN>.err);
            channel.open();
            channel.waitFor(ClientChannel.CLOSED, 0);
        } <SPAN class="code-keyword">catch</SPAN> (Throwable t) {
            t.printStackTrace();
            <SPAN class="code-object">System</SPAN>.exit(1);
        } <SPAN class="code-keyword">finally</SPAN> {
            <SPAN class="code-keyword">try</SPAN> {
                client.stop();
            } <SPAN class="code-keyword">catch</SPAN> (Throwable t) { }
        }
        <SPAN class="code-object">System</SPAN>.exit(0);
    }

}
</PRE>
</DIV></DIV>

<P>You can find a more complete example at the <A href="http://svn.apache.org/repos/asf/felix/trunk/karaf/client/src/main/java/org/apache/felix/karaf/client/Main.java" class="external-link" rel="nofollow">following location</A>.</P>



<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="62-building-custom-distributions.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="62-building-custom-distributions.html">6.2. Building custom distributions</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="64-embedding-karaf.html">6.4. Embedding Karaf</A></TD><TD class="ScrollbarNextIcon"><A href="64-embedding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="63-programmatically-connect-to-the-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="63-programmatically-connect-to-the-console.html">6.3. Programmatically connect to the console</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="65-deploying-security-providers.html">6.5. Deploying security providers</A></TD><TD class="ScrollbarNextIcon"><A href="65-deploying-security-providers.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-6.4.EmbeddingKaraf"></A>6.4. Embedding Karaf</H1>

<P>TODO: an example of embedding Karaf inside a web application is provided in the distribution</P>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="63-programmatically-connect-to-the-console.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="63-programmatically-connect-to-the-console.html">6.3. Programmatically connect to the console</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="65-deploying-security-providers.html">6.5. Deploying security providers</A></TD><TD class="ScrollbarNextIcon"><A href="65-deploying-security-providers.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="64-embedding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="64-embedding-karaf.html">6.4. Embedding Karaf</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="66-installing-additional-features.html">6.6. Installing additional features</A></TD><TD class="ScrollbarNextIcon"><A href="66-installing-additional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-6.5.Deployingsecurityproviders"></A>6.5. Deploying security providers</H1>

<P>Some applications require specific security providers to be available, such as <A href="http://www.bouncycastle.org/" class="external-link" rel="nofollow">BouncyCastle</A>.  The JVM impose some restrictions about the use of such jars: they have to be signed and be available on the boot classpath.  One way to deploy those providers is to put them in the JRE folder at <TT>$JAVA_HOME/jre/lib/ext</TT> and modify the security policy configuration (<TT>$JAVA_HOME/jre/lib/security/java.security</TT>) in order to register such providers.</P>

<P>While this approach works fine, it has a global effect and require you to configure all your servers accordingly.</P>

<P>Karaf offers a simple way to configure additional security providers:</P>
<UL>
	<LI>put your provider jar in <TT>[KARAF]/lib</TT></LI>
	<LI>modify the <TT>[KARAF]/etc/config.properties</TT> configuration file to add the following property</LI>
</UL>


<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
org.apache.felix.karaf.security.providers = xxx,yyy
</PRE>
</DIV></DIV>

<P>The value of this property is a comma separated list of the provider class names to register.<BR>
For example:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
org.apache.felix.karaf.security.providers = org.bouncycastle.jce.provider.BouncyCastleProvider
</PRE>
</DIV></DIV>

<P>In addition, you may want to provide access to the classes from those providers from the system bundle so that all bundles can access those.  It can be done by modifying the <TT>org.osgi.framework.bootdelegation</TT> property in the same configuration file:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
org.osgi.framework.bootdelegation = ...,org.bouncycastle*
</PRE>
</DIV></DIV>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="64-embedding-karaf.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="64-embedding-karaf.html">6.4. Embedding Karaf</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="66-installing-additional-features.html">6.6. Installing additional features</A></TD><TD class="ScrollbarNextIcon"><A href="66-installing-additional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="65-deploying-security-providers.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="65-deploying-security-providers.html">6.5. Deploying security providers</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="67-configuring-failover-deployments.html">6.7. Configuring Failover Deployments</A></TD><TD class="ScrollbarNextIcon"><A href="67-configuring-failover-deployments.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<DIV class="panelMacro"><TABLE class="warningMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/forbidden.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>Outdated documentation</B><BR></TD></TR></TABLE></DIV>

<H1><A name="KarafUsers%27Guideinonepage-6.6.Installingadditionalfeatures"></A>6.6. Installing additional features</H1>

<P>This chapter will demonstrate how to add additional features from a remote maven repository to a default installation of Karaf.</P>

<DIV class="panelMacro"><TABLE class="infoMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="http://cwiki.apache.org/confluence/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD>Last updated January 13, 2009 using smx4knl 1.1.0-SNAPSHOT</TD></TR></TABLE></DIV>

<H2><A name="KarafUsers%27Guideinonepage-Addingadditionalmavenrepositories"></A>Adding additional maven repositories</H2>

<P>The following steps will add in the missing OPS4J and Apache Snapshot maven repositories.  <B>Note</B> - this has been fixed in the 1.1.0 release and can be skipped.</P>
<OL>
	<LI>Edit the following file -
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>etc/org.ops4j.pax.url.mvn.cfg
</PRE>
</DIV></DIV></LI>
	<LI>Update <EM>org.ops4j.pax.url.mvn.repositories</EM> to include the OPS4J and Apache Snapshot repos -
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>org.ops4j.pax.url.mvn.repositories=file:${user.home}/.m2/repository@snapshots,http://repo1.maven.org/maven2,http://repository.ops4j.org/maven2,http://people.apache.org/repo/m2-snapshot-repository@snapshots@noreleases
</PRE>
</DIV></DIV></LI>
</OL>


<H2><A name="KarafUsers%27Guideinonepage-Addingadditionalfeaturerepositories"></A>Adding additional feature repositories</H2>

<P>The following steps will add in the URLs for the ServiceMix NMR and Features locations.</P>
<OL>
	<LI>Start Karaf
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>cd bin
./servicemix or servicemix.bat
</PRE>
</DIV></DIV></LI>
	<LI>Add the following feature install locations
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>servicemix&gt; features/addUrl mvn:org.apache.servicemix.nmr/apache-servicemix-nmr/1.0.0-m4/xml/features
servicemix&gt; features/addUrl mvn:org.apache.servicemix.features/apache-servicemix/4.0-m2-SNAPSHOT/xml/features
</PRE>
</DIV></DIV></LI>
	<LI>Verify the feature URLs were added -
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>servicemix&gt; features/listUrl
mvn:org.apache.servicemix.nmr/apache-servicemix-nmr/1.0.0-m4-SNAPSHOT/xml/features
mvn:org.apache.servicemix.kernel/apache-servicemix-kernel/1.1.0-SNAPSHOT/xml/features
mvn:org.apache.servicemix.features/apache-servicemix/4.0-m2-SNAPSHOT/xml/features
</PRE>
</DIV></DIV></LI>
</OL>


<H2><A name="KarafUsers%27Guideinonepage-Installinganewfeature%28web%29"></A>Installing a new feature (web)</H2>

<P>The following steps will install the &quot;web&quot; feature (support for deploying WAR files with Servlet and JSPs into a Jetty server) into your Karaf instance.</P>
<OL>
	<LI>List the available features -
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>servicemix&gt; features/list
 State        Name
. . .
[SMX4KNL:uninstalled] web
. . .
</PRE>
</DIV></DIV></LI>
	<LI>Install the web feature (and the sub-features it requires) -
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>servicemix&gt; features/install web
</PRE>
</DIV></DIV></LI>
	<LI>Verify the features were installed
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>servicemix&gt; features/list
 State        Name
. . .
[SMX4KNL:installed  ] web-core
[SMX4KNL:installed  ] web
. . .
</PRE>
</DIV></DIV></LI>
	<LI>Verify the installed bundles were started
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>servicemix&gt; osgi/list
START LEVEL 100
   ID   State         Level  Name
. . .
[SMX4KNL:  29] [SMX4KNL:Active     ] [SMX4KNL:   50] Apache ServiceMix Bundles: jetty-6.1.14 (6.1.14.SNAPSHOT)
[SMX4KNL:  30] [SMX4KNL:Active     ] [SMX4KNL:   50] OPS4J Pax Web - Web Container (0.4.1)
[SMX4KNL:  31] [SMX4KNL:Active     ] [SMX4KNL:   50] OPS4J Pax Web - Jsp Support (0.4.1)
[SMX4KNL:  32] [SMX4KNL:Active     ] [SMX4KNL:   50] OPS4J Pax Web Extender - WAR (0.3.0)
[SMX4KNL:  33] [SMX4KNL:Active     ] [SMX4KNL:   50] OPS4J Pax Web Extender - Whiteboard (0.3.0)
[SMX4KNL:  34] [SMX4KNL:Active     ] [SMX4KNL:   50] OPS4J Pax Url - war:, war-i: (0.3.2)
[SMX4KNL:  35] [SMX4KNL:Active     ] [SMX4KNL:   50] Apache ServiceMix WAR Deployer (4.0.0.m2-SNAPSHOT)
. . .
</PRE>
</DIV></DIV></LI>
	<LI>The Jetty server should now be listening on <A href="http://localhost:8080/" class="external-link" rel="nofollow">http://localhost:8080/</A>, but with no published applications available.
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>HTTP ERROR: 404
NOT_FOUND
RequestURI=/
Powered by jetty://
</PRE>
</DIV></DIV></LI>
</OL>


<H2><A name="KarafUsers%27Guideinonepage-DeployingaWARtotheinstalledwebfeature"></A>Deploying a WAR to the installed web feature</H2>

<P>The following steps will describe how to install a simple WAR file (with JSPs or Servlets) to the just installed web feature.</P>
<OL>
	<LI>To deploy a WAR (JSP or Servlet) to Jetty, update its MANIFEST.MF to include the required OSGi headers as described here - <BR class="atl-forced-newline">
<A href="http://wiki.ops4j.org/confluence/display/ops4j/Pax%20Web%20Extender%20-%20War%20-%20OSGi-fy" class="external-link" rel="nofollow">http://wiki.ops4j.org/confluence/display/ops4j/Pax+Web+Extender+-+War+-+OSGi-fy</A></LI>
	<LI>Copy the updated WAR (archive or extracted files) to the <EM>deploy</EM> directory.</LI>
</OL>


<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="65-deploying-security-providers.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="65-deploying-security-providers.html">6.5. Deploying security providers</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;<A href="67-configuring-failover-deployments.html">6.7. Configuring Failover Deployments</A></TD><TD class="ScrollbarNextIcon"><A href="67-configuring-failover-deployments.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/forwd_16.gif" width="16" height="16"></A></TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="66-installing-additional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="66-installing-additional-features.html">6.6. Installing additional features</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>

<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-6.7.ConfiguringFailoverDeployments"></A>6.7. Configuring Failover Deployments</H1>

<P>This chapter will demonstrate how to configure failover deployments.</P>

<H2><A name="KarafUsers%27Guideinonepage-Simplelockfile"></A>Simple lock file</H2>

<P>The simple lock file mechanism is intended for failover configurations where instances reside on the same host machine.</P>

<P>To use this feature, edit the <TT>$KARAF_HOME/etc/system.properties</TT> file as follows on each system in the master/slave setup:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>karaf.lock=true
karaf.lock.class=org.apache.felix.karaf.main.SimpleFileLock
karaf.lock.dir=&lt;PathToLockFileDirectory&gt;
karaf.lock.delay=10
</PRE>
</DIV></DIV>

<P><B>Note</B>: Ensure that the <TT>karaf.lock.dir</TT> property points to the same directory for both the master and slave instance, so that the slave can only acquire the lock when the master releases it.</P>


<H2><A name="KarafUsers%27Guideinonepage-JDBClocking"></A>JDBC locking</H2>

<P>The JDBC locking mechanism is intended for failover configurations where instances exist on separate machines. In this deployment, the master instance holds a lock on a Karaf locking table hosted on a database. If the master loses the lock, a waiting slave process gains access to the locking table and fully starts its container. </P>

<P>To use this feature, do the following on each system in the master/slave setup:</P>

<UL>
	<LI>Update the classpath to include the JDBC driver</LI>
	<LI>Update the <TT>$KARAF_HOME/bin/karaf</TT> script to have unique JMX remote port set if instances reside on the same host</LI>
	<LI>Update the <TT>$KARAF_HOME/etc/system.properties</TT> file as follows:</LI>
</UL>


<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>karaf.lock=true
karaf.lock.class=org.apache.felix.karaf.main.DefaultJDBCLock
karaf.lock.level=50
karaf.lock.delay=10
karaf.lock.jdbc.url=jdbc:derby://dbserver:1527/sample
karaf.lock.jdbc.driver=org.apache.derby.jdbc.ClientDriver
karaf.lock.jdbc.user=user
karaf.lock.jdbc.password=password
karaf.lock.jdbc.table=KARAF_LOCK
karaf.lock.jdbc.clustername=karaf
karaf.lock.jdbc.timeout=30
</PRE>
</DIV></DIV>

<P><B>Note</B>:</P>

<UL>
	<LI>Will fail if JDBC driver is not on classpath.</LI>
	<LI>The database name &quot;sample&quot; will be created if it does not exist on the database.</LI>
	<LI>The first Karaf instance to acquire the locking table is the master instance.</LI>
	<LI>If the connection to the database is lost, the master instance tries to gracefully shutdown, allowing a slave instance to become master when the database service is restored. The former master will require manual restart.</LI>
</UL>


<H3><A name="KarafUsers%27Guideinonepage-JDBClockingonOracle"></A>JDBC locking on Oracle</H3>

<P>If you are using Oracle as your database in a JDBC locking scenario, the <TT>karaf.lock.class</TT> property in the <TT>$KARAF_HOME/etc/system.properties</TT> file must point to <TT>org.apache.felix.karaf.main.OracleJDBCLock</TT>.</P>

<P>Otherwise, configure the system.properties file as normal for your setup, for example:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>karaf.lock=true
karaf.lock.class=org.apache.felix.karaf.main.OracleJDBCLock
karaf.lock.jdbc.url=jdbc:oracle:thin:@hostname:1521:XE
karaf.lock.jdbc.driver=oracle.jdbc.OracleDriver
karaf.lock.jdbc.user=user
karaf.lock.jdbc.password=password
karaf.lock.jdbc.table=KARAF_LOCK
karaf.lock.jdbc.clustername=karaf
karaf.lock.jdbc.timeout=30
</PRE>
</DIV></DIV>

<P>As with the default JDBC locking setup, the Oracle JDBC driver JAR file must be in your classpath. You can ensure this by copying the <TT>ojdbc14.jar</TT> into Karaf's <TT>lib</TT> folder before starting Karaf.</P>

<P><B>Note</B>: The <TT>karaf.lock.jdbc.url</TT> requires an active SID, which means you must manually create a database instance before using this particular lock.</P>

<P><A name="KarafUsers%27Guideinonepage-locklevel"></A></P>

<H2><A name="KarafUsers%27Guideinonepage-Containerlevellocking"></A>Container-level locking</H2>

<P>Container-level locking allows bundles to be preloaded into the slave kernel instance in order to provide faster failover performance. Container-level locking is supported in both the simple file and JDBC locking mechanisms.</P>

<P>To implement container-level locking, add the following to the <TT>$KARAF_HOME/etc/system.properties</TT> file on each system in the master/slave setup:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>karaf.lock=true
karaf.lock.level=50
karaf.lock.delay=10
</PRE>
</DIV></DIV>

<P>The <TT>karaf.log.level</TT> property tells the Karaf instance how far up the boot process to bring the OSGi container. Bundles assigned the same start level or lower will then also be started in that Karaf instance.</P>

<P>Bundle start levels are specified in <TT>$KARAF_HOME/etc/startup.properties</TT>, in the format <TT>jar.name=level</TT>. The core system bundles have levels below 50, where as user bundles have levels greater than 50.</P>

<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TH class="confluenceTh"> Level </TH>
<TH class="confluenceTh"> Behavior </TH>
</TR>
<TR>
<TD class="confluenceTd"> 1 </TD>
<TD class="confluenceTd"> A 'cold' standby instance. Core bundles are not loaded into container. Slaves will wait until lock acquired to start server. </TD>
</TR>
<TR>
<TD class="confluenceTd"> &lt;50 </TD>
<TD class="confluenceTd"> A 'hot' standby instance. Core bundles are loaded into the container. Slaves will wait until lock acquired to start user level bundles. The console will be accessible for each slave instance at this level. </TD>
</TR>
<TR>
<TD class="confluenceTd"> &gt;50 </TD>
<TD class="confluenceTd"> This setting is not recommended as user bundles will be started. </TD>
</TR>
</TBODY></TABLE>
</DIV>


<P><B>Note</B>: When using a 'hot' spare on the same host you need to set the JMX remote port to a unique value to avoid bind conflicts. You can edit the Karaf start script to include the following:</P>

<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>DEFAULT_JAVA_OPTS=&quot;-server $DEFAULT_JAVA_OPTS -Dcom.sun.management.jmxremote.port=1100 -Dcom.sun.management.jmxremote.authenticate=false&quot;
</PRE>
</DIV></DIV>


<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>

<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="66-installing-additional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="66-installing-additional-features.html">6.6. Installing additional features</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="6-advanced-uses.html">6. Advanced uses</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="6-advanced-uses.html">6. Advanced uses</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-7.OptionalFeatures"></A>7. Optional Features</H1>

<UL><LI><A href="71-enabling-colorized-console-output-on-windows.html" title="7.1. Enabling Colorized Console Output On Windows">7.1. Enabling Colorized Console Output On Windows</A></LI></UL>

<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD class="ScrollbarPrevIcon"><A href="6-advanced-uses.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/back_16.gif" width="16" height="16"></A></TD><TD width="33%" class="ScrollbarPrevName"><A href="6-advanced-uses.html">6. Advanced uses</A>&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="karaf-users-guide.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="karaf-users-guide.html">Karaf Users' Guide</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="7-optional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="7-optional-features.html">7. Optional Features</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
<P><A name="KarafUsers%27Guideinonepage-top"></A></P>

<H1><A name="KarafUsers%27Guideinonepage-7.1.EnablingColorizedConsoleOutputOnWindows"></A>7.1. Enabling Colorized Console Output On Windows</H1>

<P>The default Karaf installation does not produce colorized console output on Windows like it does on Unix based systems.  To enable it, you must install LGPL licensed library <A href="https://jna.dev.java.net/" class="external-link" rel="nofollow">JNA</A>.  This can be done using a few simple commands in the Karaf console:</P>

<P>You first need to install the JNA library:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:install wrap:mvn:http:<SPAN class="code-comment">//download.java.net/maven/2!net.java.dev.jna/jna/3.1.0</SPAN>
</PRE>
</DIV></DIV>

<P>Next you need either restart karaf or you run the following Karaf commands to refresh the Karaf Console:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:list | grep <SPAN class="code-quote">&quot;Apache Felix Karaf :: Shell Console&quot;</SPAN>
</PRE>
</DIV></DIV>

<P>Take note of the ID of the bundle, in my case it was 14 and then run:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
osgi:refresh 14
</PRE>
</DIV></DIV>


<P><A href="#KarafUsers%2527Guideinonepage-top">top</A></P>
<STYLE type="text/css">/*<![CDATA[*/
table.ScrollbarTable  {border: none;padding: 3px;width: 100%;padding: 3px;margin: 0px;background-color: #f0f0f0}
table.ScrollbarTable td.ScrollbarPrevIcon {text-align: center;width: 16px;border: none;}
table.ScrollbarTable td.ScrollbarPrevName {text-align: left;border: none;}
table.ScrollbarTable td.ScrollbarParent {text-align: center;border: none;}
table.ScrollbarTable td.ScrollbarNextName {text-align: right;border: none;}
table.ScrollbarTable td.ScrollbarNextIcon {text-align: center;width: 16px;border: none;}

/*]]>*/</STYLE><DIV class="Scrollbar"><TABLE class="ScrollbarTable"><TR><TD width="33%" class="ScrollbarPrevName">&nbsp;</TD><TD width="33%" class="ScrollbarParent"><SUP><A href="7-optional-features.html"><IMG border="0" align="middle" src="http://cwiki.apache.org/confluence/images/icons/up_16.gif" width="8" height="8"></A></SUP><A href="7-optional-features.html">7. Optional Features</A></TD><TD width="33%" class="ScrollbarNextName">&nbsp;</TD></TR></TABLE></DIV>
    </DIV>
  </BODY>
</HTML>
