
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix Maven SCR Plugin Use</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">


<P>Support for automatic generation of the compenent and metadata descriptors is embeded in the <TT>org.apache.felix:maven-scr-plugin</TT> plugin. To use this plugin, it has to be declared in the project descriptor as a <TT>&lt;plugin&gt;</TT> element: </P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml"> 
<SPAN class="code-tag">&lt;project&gt;</SPAN>
  ...
  <SPAN class="code-tag">&lt;build&gt;</SPAN>
    ...
    <SPAN class="code-tag">&lt;plugins&gt;</SPAN>
      ...
      <SPAN class="code-tag">&lt;plugin&gt;</SPAN>
        <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
        <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-scr-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
        <SPAN class="code-tag">&lt;executions&gt;</SPAN>
          <SPAN class="code-tag">&lt;execution&gt;</SPAN>
            <SPAN class="code-tag">&lt;id&gt;</SPAN>generate-scr-scrdescriptor<SPAN class="code-tag">&lt;/id&gt;</SPAN>
            <SPAN class="code-tag">&lt;goals&gt;</SPAN>
              <SPAN class="code-tag">&lt;goal&gt;</SPAN>scr<SPAN class="code-tag">&lt;/goal&gt;</SPAN>
            <SPAN class="code-tag">&lt;/goals&gt;</SPAN>
          <SPAN class="code-tag">&lt;/execution&gt;</SPAN>
        <SPAN class="code-tag">&lt;/executions&gt;</SPAN>
      <SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
      ...
    <SPAN class="code-tag">&lt;/plugins&gt;</SPAN>
    ...
  <SPAN class="code-tag">&lt;/build&gt;</SPAN>
  ...
<SPAN class="code-tag">&lt;/project&gt;</SPAN>
</PRE>
</DIV></DIV> 

<P>The <TT>scr</TT> goal is bound to the <TT>generate-resources</TT> phase and will generate a single descriptor file as well as meta type file for all components found in the project. </P>

<P>The plugin may be configured with the following properties (Check the version column to make sure you use at least this version for the mentioned feature): </P>
<DIV class="table-wrap">
<TABLE class="confluenceTable"><TBODY>
<TR>
<TD class="confluenceTd"> <B>Property</B> </TD>
<TD class="confluenceTd"> <B>Description</B> </TD>
<TD class="confluenceTd"> <B>Version</B> </TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>specVersion</TT> </TD>
<TD class="confluenceTd"> The plugin will generate a descriptor for the Declarative Service version (either 1.0 or 1.1). If no value is specified, the plugin will detect the version and only use 1.1 if features from this version are used. </TD>
<TD class="confluenceTd"> &gt;= 1.4.0 </TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>generateAccessors</TT> </TD>
<TD class="confluenceTd"> If this switch is turned on, the bind and unbind methods for unary references are automatically generated by the plugin. By default this is set to <TT>true</TT>. </TD>
<TD class="confluenceTd">&nbsp;</TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>parseJavadoc</TT> </TD>
<TD class="confluenceTd"> If this switch is turned on, the java source code and its javadoc tags are scanned for the scr tags (see below). The default value is <TT>true</TT>. </TD>
<TD class="confluenceTd">&nbsp;</TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>processAnnotations</TT> </TD>
<TD class="confluenceTd"> If this switch is turned on, the java code is scanned for the scr annotations (see below). The default value is <TT>true</TT>. </TD>
<TD class="confluenceTd"> &gt;= 1.2.0 </TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>sourceExcludes</TT> </TD>
<TD class="confluenceTd"> Comma separated list of classes to exclude when processing the source. </TD>
<TD class="confluenceTd">&nbsp;</TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>strictMode</TT> </TD>
<TD class="confluenceTd"> The plugin distinguishes between errors and warnings. In strict mode warnings are treated as errors and cause the plugin to fail. The default value is <TT>false</TT>. </TD>
<TD class="confluenceTd">&nbsp;</TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>properties</TT> </TD>
<TD class="confluenceTd"> A map of predefined properties. These properties are set to each component (if the component does not define the property already). This is a map where the property name is made up by the included element name and the value is the value of the element.</TD>
<TD class="confluenceTd"> &gt;= 1.2.0 </TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>finalName</TT> </TD>
<TD class="confluenceTd"> The name of the descriptor file to create. This property defaults to the value of the <TT>scr.descriptor.name</TT> property if defined. Otherwise the default is <TT>serviceComponents.xml</TT>. </TD>
<TD class="confluenceTd">&nbsp;</TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>metaTypeName</TT> </TD>
<TD class="confluenceTd"> The name of the descriptor file to create. This property defauls to <TT>metatype.xml</TT>. </TD>
<TD class="confluenceTd">&nbsp;</TD>
</TR>
<TR>
<TD class="confluenceTd"> <TT>outputDirectory</TT> </TD>
<TD class="confluenceTd"> The directory where all files are generated in. This defaults to <TT>scr-plugin-generated</TT> inside the build output directory. </TD>
<TD class="confluenceTd">&nbsp;</TD>
</TR>
</TBODY></TABLE>
</DIV>

<P>The meta type file is generated in the <TT>OSGI-INF/metatype/</TT> directory and the scr descriptor file in the <TT>OSGI-INF</TT> directory. <BR>
<EM>Note</EM>: The location of the meta type descriptor may not be changed as the OSGi Metatype Service Specification prescribes the location of the descriptors. </P>

<P>The plugin will look for component definition tags in all Java files found in the source directories of the project. </P>

<H3><A name="ApacheFelixMavenSCRPluginUse-Usingthedescriptor"></A>Using the descriptor </H3>

<P>Currently the <TT>maven-scr-plugin</TT> only creates the component descriptor file. Adding the descriptor to the bundle and setting the <TT>Service-Component</TT> manifest header accordingly is a different task. However, if you're using the <TT>org.apache.felix:maven-bundle-plugin</TT> to construct the bundle and its manifest, then the <TT>maven-scr-plugin</TT> will add the following settings automatically for the <TT>org.apache.felix:maven-bundle-plugin</TT> (given default <TT>maven-scr-plugin</TT> configuration), so you don't have to configure this yourself: </P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml"> 
...
<SPAN class="code-tag">&lt;Include-Resource&gt;</SPAN>
    src/main/resources,
    target/scr-plugin-generated
<SPAN class="code-tag">&lt;/Include-Resource&gt;</SPAN>
<SPAN class="code-tag">&lt;Service-Component&gt;</SPAN>
  OSGI-INF/serviceComponents.xml
<SPAN class="code-tag">&lt;/Service-Component&gt;</SPAN>
...
</PRE>
</DIV></DIV> 
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by cziegeler@apache.org on Wed May 11 15:11:37 EDT 2011
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
