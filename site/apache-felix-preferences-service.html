
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix Preferences Service</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H1><A name="ApacheFelixPreferencesService-ApacheFelixPreferencesService"></A>Apache Felix Preferences Service</H1>

<P>The OSGi service compendium specification defines a general purpose service to store data persistently, so that they can survive the restart of a bundle or of the whole OSGi container. This service is not intended to be a full-featured persistence layer for OSGi bundles, rather a simple tool to store informations that can be used in various stages of the bundle lifecycle.</P>

<P>The service supports the storage of scalar values (boolan, double, float, int, long and strings) and byte arrays, arranged in a hierarchical model. While there is no limitations on the size of data objects stored, the specification clearly states that the Preferences Service is intended to store only small objects.</P>

<P>The entry point to the Preferences Service API is the <B>PreferencesService</B> interface. It provides access to different roots of Preferences trees:</P>
<UL>
	<LI>a <B>system root</B></LI>
	<LI>any number of <B>user roots</B><BR>
The <B>user root</B> for a specific user is automatically created the first time it is requested.</LI>
</UL>


<P>User roots and system root are bundle specific, and cannot be accessed by other bundles. </P>

<H2><A name="ApacheFelixPreferencesService-AccessingthePreferencesService"></A>Accessing the Preferences Service</H2>

<P>If the OSGi platform provides a Preferences Service, getting a reference to it is as simple as doing a normal OSGi service lookup:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Activator <SPAN class="code-keyword">implements</SPAN> BundleActivator
{
	<SPAN class="code-keyword">public</SPAN> void start(BundleContext context) <SPAN class="code-keyword">throws</SPAN> Exception 
	{	
		ServiceReference ref = context.getServiceReference(PreferencesService.class.getName());
		<SPAN class="code-keyword">if</SPAN> (ref != <SPAN class="code-keyword">null</SPAN>)
		{
			PreferencesService service = (PreferencesService) context.getService(ref);
	
			<SPAN class="code-comment">//...
</SPAN>		}
	}

	<SPAN class="code-comment">//..</SPAN>
</PRE>
</DIV></DIV>

<P>To access the <B>system root</B></P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
		Preferences systemRoot = service.getSystemPreferences();
</PRE>
</DIV></DIV>

<P>To access a <B>user root</B></P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
		Preferences mickeyRoot = service.getUserPreferences(<SPAN class="code-quote">&quot;mickey&quot;</SPAN>);
</PRE>
</DIV></DIV>

<H2><A name="ApacheFelixPreferencesService-StoreandretrievevalueinPreferences"></A>Store and retrieve value in Preferences </H2>

<P>The <B>Preferences</B> interface offers some simple methods to store key/value pairs:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> void put(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">String</SPAN> value);

<SPAN class="code-keyword">public</SPAN> void putInt(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">int</SPAN> value);
                   
<SPAN class="code-keyword">public</SPAN> void putLong(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">long</SPAN> value);
                    
<SPAN class="code-keyword">public</SPAN> void putBoolean(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">boolean</SPAN> value);
                       
<SPAN class="code-keyword">public</SPAN> void putFloat(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">float</SPAN> value);
                     
<SPAN class="code-keyword">public</SPAN> void putDouble(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">double</SPAN> value);
                      
<SPAN class="code-keyword">public</SPAN> void putByteArray(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">byte</SPAN>[] value);
</PRE>
</DIV></DIV>

<P>For each of these methods, a correspondent <B>get</B> method exists. Get methods always accept two arguments: the first to specify the key of the property to retrieve, the second a default value in case of not-existent property (or in case of errors). For instance:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> <SPAN class="code-object">float</SPAN> getFloat(<SPAN class="code-object">String</SPAN> key, <SPAN class="code-object">float</SPAN> def)
</PRE>
</DIV></DIV>

<P>As mentioned before, data can be stored in a hierarchical way. The following example shows how to create nodes under the system root to store data:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Preferences colorPreferences = service.getSystemPreferences().node(<SPAN class="code-quote">&quot;color&quot;</SPAN>);
colorPreferences.setString(<SPAN class="code-quote">&quot;background&quot;</SPAN>, <SPAN class="code-quote">&quot;#eeeeee&quot;</SPAN>);
colorPreferences.setString(<SPAN class="code-quote">&quot;font&quot;</SPAN>, <SPAN class="code-quote">&quot;#000000&quot;</SPAN>);
</PRE>
</DIV></DIV>

<P>The Preferences interface offers different method to navigate the preference tree, like <TT>childrenNames(), parent() and node(String name)</TT>. Check the <A href="http://www.osgi.org/javadoc/r4v41/org/osgi/service/prefs/Preferences.html" class="external-link" rel="nofollow">Preferences interface Javadoc</A> for a complete list.</P>

<H2><A name="ApacheFelixPreferencesService-flush%28%29andsync%28%29"></A>flush() and sync()</H2>

<P>Two additional methods of the <B>Preferences</B> interface can be useful.</P>
<UL>
	<LI><B>flush()</B> forces any change of the Preferences object to be saved in the persistent storage</LI>
	<LI><B>sync()</B> reload the content of the Preferences object from the persistent storage; before reloading, all the contents are saved</LI>
</UL>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by fdiotalevi on 2009-07-12 12:26:00.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
