
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Apache Felix Dependency Manager - Using Annotations - Composition</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<H1><A name="ApacheFelixDependencyManager-UsingAnnotations-Composition-AnnotationsComposition"></A>Annotations - Composition</H1>

<P>When implementing more complex services, you often find yourself using more than one instance for a given service. However, several of these instances might want to have dependencies injected. In such cases you need to tell the dependency manager which instances to consider. Within a Component (or an Aspect/Adapter), you can annotate a method with the @Composition annotation. This method is meant to return such composition of service instances, and the objects will be considered as part of the service implementation. So, all  dependencies, as well as lifecycle annotations (@Init, @Start, @Stop, @Destroy) will be applied on every objects returned by the method annotated with the @Composition annotation.</P>

<P>The following example illustrates a composition of two object instances, which are part of the implementation of a <EM>MyService</EM> service:</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">/**
 * Main implementation <SPAN class="code-keyword">for</SPAN> the MyService Service
 */
@Component
<SPAN class="code-keyword">public</SPAN> class MyServiceImpl <SPAN class="code-keyword">implements</SPAN> MyService {
  <SPAN class="code-comment">// This object instance is also used to implement the service.
</SPAN>&nbsp; <SPAN class="code-keyword">private</SPAN> Helper helper = <SPAN class="code-keyword">new</SPAN> Helper();

  <SPAN class="code-comment">// MyServiceImpl, and Helper objects are part of the composition
</SPAN>&nbsp; @Composition
&nbsp; <SPAN class="code-object">Object</SPAN>[] getComposition() {
&nbsp;&nbsp;&nbsp; <SPAN class="code-keyword">return</SPAN> <SPAN class="code-keyword">new</SPAN> <SPAN class="code-object">Object</SPAN>[] { <SPAN class="code-keyword">this</SPAN>, helper };
&nbsp; }

  <SPAN class="code-comment">// This dependency is also applied to the Helper
</SPAN>&nbsp; @ServiceDependency
&nbsp; Dependency dep;

  <SPAN class="code-comment">// Same thing <SPAN class="code-keyword">for</SPAN> <SPAN class="code-keyword">this</SPAN> dependency
</SPAN>  @ServiceDependency
  void bind(Dependency2 dep2) {}

  <SPAN class="code-comment">// Lifecycle callbacks also applied on the Helper ...
</SPAN>  @Init
  void init() {}

  @Start
  void start() {}

  @Stop
  void stop() {}

  @Destroy()
  void destroy() {}
}

<SPAN class="code-keyword">public</SPAN> class Helper {
  <SPAN class="code-comment">// Also injected, since we are part of the composition
</SPAN>&nbsp; Dependency dep;

  <SPAN class="code-comment">// But since we are not interested by the Dependency2, we don't have to declare the bind(Dependency2) method ...
</SPAN>
  <SPAN class="code-comment">// We only specify the start lifecycle callback because we need to <SPAN class="code-keyword">return</SPAN> some extra service properties which will be published
</SPAN>  <SPAN class="code-comment">// along with the provided service ...
</SPAN>
  Map start() {
     Map extraServiceProperties = <SPAN class="code-keyword">new</SPAN> HashMap();
     extraServiceProperties.add(<SPAN class="code-quote">&quot;foo&quot;</SPAN>, <SPAN class="code-quote">&quot;bar&quot;</SPAN>);
     <SPAN class="code-keyword">return</SPAN> extraServiceProperties;
  }
}

</PRE>
</DIV></DIV>
<P>Here, MyServiceImpl is the main component implementation, but is   composed of the Helper object instance. So all Dependencies defined in  MyServiceImpl will be also injected to the Helper (if the Helper  declares the fields or methods). The Helper may also declare lifecycle  callbacks (optionally).</P>
        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by pderop on 2010-09-08 16:29:21.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
