
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - Combining iPOJO and Configuration Admin</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css); 
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css); 
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT> 
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT> 

<SCRIPT type="text/javascript"> 
 
    $(document).ready(function(){ 
        $("ul.sf-menu").supersubs({ 
            minWidth:    14,   // minimum width of sub-menus in em units 
            maxWidth:    30,   // maximum width of sub-menus in em units 
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over 
                               // due to slight rounding differences and font-family 
        }).superfish();  // call supersubs first, then superfish, so that subs are 
                         // not display:none when measuring. Call before initialising 
                         // containing tabs for same reason. 
    }); 
 
</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>							
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>	

<LI class="">			
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">					
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="ipojo-composition-tutorial.html" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="apache-felix-ipojo-api.html" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="ipojo-faq.html" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI> 
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL> 
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>   
</LI><!-- End of tools -->	
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->			
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">

<H1><A name="CombiningiPOJOandConfigurationAdmin-CombiningiPOJOandConfigurationAdmin"></A>Combining iPOJO and Configuration Admin</H1>

<P><EM>This page presents how creating, reconfiguring and destroying iPOJO component instance with the OSGi Configuration Admin.</EM></P>

<DIV class="toc"><DIV>
<UL>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-ConfigurationAdmin">Configuration Admin</A></LI>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-WhyusingConfigurationAdminwithiPOJO">Why using Configuration Admin with iPOJO</A></LI>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-CombiningiPOJOandtheConfigurationAdmin">Combining iPOJO and the Configuration Admin</A></LI>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-Examples">Examples</A></LI>
<UL>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-Prerequisites">Prerequisites</A></LI>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-SimpleInstantiation">Simple Instantiation</A></LI>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-ReconfiguringinstanceswiththeConfigurationAdmin">Reconfiguring instances with the Configuration Admin</A></LI>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-PropertyPropagation">Property Propagation</A></LI>
</UL>
    <LI><A href="#CombiningiPOJOandConfigurationAdmin-Conclusion">Conclusion</A></LI>
</UL></DIV></DIV>

<H2><A name="CombiningiPOJOandConfigurationAdmin-ConfigurationAdmin"></A>Configuration Admin</H2>

<P>The Configuration Admin service is a configuration manager describe in the OSGi R4 Compendium. It allows an operator to set the configuration information of deployed applications The Configuration Admin defines the Configuration as the process of defining the configuration data of applications and assuring that those applications receive that data when they are running. The Configuration Admin is becoming an important piece on OSGi Gateway. It is become the standard way to configure applications on OSGi gateways.</P>

<H2><A name="CombiningiPOJOandConfigurationAdmin-WhyusingConfigurationAdminwithiPOJO"></A>Why using Configuration Admin with iPOJO</H2>

<P>As the configuration admin offer an administration support, it seems reasonable to combine iPOJO and the Configuration Admin to control the gateway. Indeed, thanks to the configuration admin it should be possible to:</P>
<UL>
	<LI>Create new component instances</LI>
	<LI>Configuring / reconfiguring these instances</LI>
	<LI>Destroying these instances</LI>
	<LI>Reconfiguring instances by using Managed Services (not addressed in this page, see <A href="configuration-handler.html" title="Configuration Handler">here</A> for further information)</LI>
</UL>


<P>The configuration admin is persistent, so stored configuration will be reload it the framework restarts.<BR>
Moreover, using the configuration admin allows avoiding describing instances inside iPOJO metadata file. These instances are created by inserting new configurations in the configuration admin.</P>

<H2><A name="CombiningiPOJOandConfigurationAdmin-CombiningiPOJOandtheConfigurationAdmin"></A>Combining iPOJO and the Configuration Admin</H2>

<P>iPOJO has a component type concept. For each (public) component type, a <TT>ManagedServiceFactory</TT> is published. For each configurations matching with the component type from the Configuration Admin, a new component instance is created. Moreover, when this configuration is updated, the instance is dynamically reconfigured. If the configuration is removed, the instance is disposed.</P>

<P>If a new Configuration is created:</P>
<UL>
	<LI>If the factory is available or an instance is create immediately,</LI>
	<LI>Else the factory is not available and the instance will be created as soon as the factory appears.</LI>
</UL>


<H2><A name="CombiningiPOJOandConfigurationAdmin-Examples"></A>Examples</H2>

<P>This section presents 3 examples about the management of iPOJO instances with the configuration admin:</P>
<UL>
	<LI>A simple instantiation example and destruction</LI>
	<LI>An instantiation with property injection and dynamic reconfiguration</LI>
	<LI>A property propagation example</LI>
</UL>


<P>All these examples are downloadable <A href="http://people.apache.org/~clement/ipojo/tutorials/ca/config.admin.tutorial.zip" class="external-link" rel="nofollow">here</A>. The archive contains both the project sources and a pre-configured version of felix.<BR>
To compile the project, launch ant from the <EM>config.admin.tutorial</EM> directory<BR>
Then, you can launch Felix by launching the following command from the <TT>felix</TT> directory:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Java -jar bin/felix.jar
</PRE>
</DIV></DIV>

<H3><A name="CombiningiPOJOandConfigurationAdmin-Prerequisites"></A>Prerequisites</H3>

<P>Let's take 4 Felix shell commands to manage configuration admin configurations (available in the example archive):</P>
<UL>
	<LI><TT>create_conf &lt;type&gt;  &lt;property-key=property-value&gt;&#42;</TT> allows to create a new Factory Configuration attached to the given type. The configuration contains the given properties.</LI>
	<LI><TT>update_conf &lt;configuration_name&gt; &lt; property-key=property-value&gt;&#42;</TT> allows to update the configuration with the given name with the given properties.</LI>
	<LI><TT>delete_conf &lt;configuration_name&gt;</TT> allows deleting the configuration with the given name. If the name is 'all', delete all stored configurations.</LI>
	<LI><TT>list_conf</TT> allows listing all stored configuration.</LI>
</UL>


<P>Moreover iPOJO and an implementation of the Configuration Admin must be deployed on the gateway:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; ps
START LEVEL 1
   ID   State         Level  Name
[   0] [Active     ] [    0] <SPAN class="code-object">System</SPAN> Bundle (1.0.3)
[   1] [Active     ] [    1] Apache Felix Shell Service (1.0.0)
[   2] [Active     ] [    1] Apache Felix Shell TUI (1.0.0)
[   3] [Active     ] [    1] Apache Felix Bundle Repository (1.0.2)
[   4] [Active     ] [    1] Apache Felix Configuration Admin Service (1.0.10) 
[   5] [Active     ] [    1] Apache Felix iPOJO (1.2.0) 
[   6] [Active     ] [    1] Apache Felix iPOJO Arch Command (1.2.0) 
</PRE>
</DIV></DIV>

<H3><A name="CombiningiPOJOandConfigurationAdmin-SimpleInstantiation"></A>Simple Instantiation</H3>

<P>Imagine the following very simple component implementation:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Hello1 {
    <SPAN class="code-keyword">public</SPAN> Hello1() {
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;Hello&quot;</SPAN>);
    }
}
</PRE>
</DIV></DIV>
<P>The component type is defined with following metadata:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;component 
    classname=<SPAN class="code-quote">&quot;org.apache.felix.ipojo.example.ca.component.Hello1&quot;</SPAN> 
    factory=<SPAN class="code-quote">&quot;hello1&quot;</SPAN> immediate=<SPAN class="code-quote">&quot;true&quot;</SPAN> architecture=<SPAN class="code-quote">&quot;true&quot;</SPAN>/&gt;
</PRE>
</DIV></DIV>
<P>The defined component type (<B>Hello1</B>) just creates a Hello1 object when the instance is created (thanks to the <EM>immediate</EM> attribute).<BR>
So if we deploy this bundle and add a consistent configuration we obtain (note that bundle need to be already compiled):</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; start file:..\config.admin.tutorial\output\config.admin.tutorial.jar
-&gt; create_conf org.apache.felix.ipojo.example.ca.component.Hello1 
Insert the configuration : {org.apache.felix.ipojo.example.ca.component.Hello1}
-&gt; Hello
</PRE>
</DIV></DIV>
<P><EM>Note</EM>: Debug messages from the configuration admin were removed<BR>
So as predicted, the Hello message appears. To be really sure of the creating, we can ask for the instance architecture (the component type allows architecture introspection thank to the architecture attribute):</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; arch 
Instance ArchCommand -&gt; valid 
Instance org.apache.felix.ipojo.example.ca.component.Hello1.e40fe80a-2c0d-4c51-b00b-a82565874cd8 -&gt; valid 
-&gt; 
-&gt; arch -instance 
org.apache.felix.ipojo.example.ca.component.Hello1.e40fe80a-2c0d-4c51-b00b-a82565874cd8 
instance name=
    <SPAN class="code-quote">&quot;org.apache.felix.ipojo.example.ca.component.Hello1.e40fe80a-2c0d-4c51-b00b-a82565874cd8&quot;</SPAN> 
        component.type=<SPAN class="code-quote">&quot;hello1&quot;</SPAN> 
        state=<SPAN class="code-quote">&quot;valid&quot;</SPAN> bundle=<SPAN class="code-quote">&quot;7&quot;</SPAN> 
    object name=<SPAN class="code-quote">&quot;org.apache.felix.ipojo.example.ca.component.Hello1@120cc56&quot;</SPAN> 
    handler 
        name=<SPAN class="code-quote">&quot;org.apache.felix.ipojo.handlers.lifecycle.callback.LifecycleCallbackHandler&quot;</SPAN> 
        state=<SPAN class="code-quote">&quot;valid&quot;</SPAN> 
    handler 
        name=<SPAN class="code-quote">&quot;org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler&quot;</SPAN> 
        state=<SPAN class="code-quote">&quot;valid&quot;</SPAN> 
-&gt;
</PRE>
</DIV></DIV>
<P>So, the instance is correctly created. The name of the instance was created by the configuration admin. It could change according to your configuration admin implementation.<BR>
Then, we can delete the instance by removing the configuration from the configuration admin:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; delete_conf 
org.apache.felix.ipojo.example.ca.component.Hello1.e40fe80a-2c0d-4c51-b00b-a82565874cd8 
Delete the configuration : 
org.apache.felix.ipojo.example.ca.component.Hello1.e40fe80a-2c0d-4c51-b00b-a82565874cd8 
-&gt; arch 
Instance ArchCommand -&gt; valid
</PRE>
</DIV></DIV>
<P>So, arch does no more displayed any <EM>hello</EM> instances, the created instance was disposed.</P>

<H3><A name="CombiningiPOJOandConfigurationAdmin-ReconfiguringinstanceswiththeConfigurationAdmin"></A>Reconfiguring instances with the Configuration Admin</H3>

<P>Imagine the following component implementation:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class Hello2 {
     <SPAN class="code-object">String</SPAN> m_name;
    <SPAN class="code-keyword">public</SPAN> void stop() {
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;Good by &quot;</SPAN> + m_name);
    }
    <SPAN class="code-keyword">public</SPAN> void setName(<SPAN class="code-object">String</SPAN> newName) {
        m_name = newName;
        <SPAN class="code-object">System</SPAN>.out.println(<SPAN class="code-quote">&quot;Hello &quot;</SPAN> + m_name);
    }
</PRE>
</DIV></DIV>
<P>And the following metadata:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;component 
        classname=<SPAN class="code-quote">&quot;org.apache.felix.ipojo.example.ca.component.Hello2&quot;</SPAN> 
        factory=<SPAN class="code-quote">&quot;hello2&quot;</SPAN> immediate=<SPAN class="code-quote">&quot;true&quot;</SPAN> architecture=<SPAN class="code-quote">&quot;true&quot;</SPAN>&gt;
	<SPAN class="code-tag">&lt;callback transition=<SPAN class="code-quote">&quot;validate&quot;</SPAN> method=<SPAN class="code-quote">&quot;stop&quot;</SPAN>/&gt;</SPAN>
	<SPAN class="code-tag">&lt;properties&gt;</SPAN>
		<SPAN class="code-tag">&lt;property field=<SPAN class="code-quote">&quot;m_name&quot;</SPAN> name=<SPAN class="code-quote">&quot;to&quot;</SPAN> method=<SPAN class="code-quote">&quot;setName&quot;</SPAN>/&gt;</SPAN>
	<SPAN class="code-tag">&lt;/properties&gt;</SPAN>
<SPAN class="code-tag">&lt;/component&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>The defined component type (<B>Hello2</B>) write &quot;Hello + $name&quot; when the property 'to' (attached to the field m_name) receive a new value. A value is necessary insert in the instance configuration. Moreover when killed, the instance will display a &quot;Good By&quot; message.<BR>
Let's play a simple scenario:</P>
<UL>
	<LI>Create a Hello2 instance</LI>
	<LI>Update the instance configuration</LI>
	<LI>Kill the created instance</LI>
</UL>


<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; create_conf org.apache.felix.ipojo.example.ca.component.Hello2 to=ipojo 
Insert the configuration : 
{service.factoryPid=org.apache.felix.ipojo.example.ca.component.Hello2, to=ipojo} 
Created configuration: 
org.apache.felix.ipojo.example.ca.component.Hello2.75082279-9b4b-4c49-b0e0-8efb38b67aa3 
Hello ipojo 
-&gt; list_conf 
org.apache.felix.ipojo.example.ca.component.Hello2.75082279-9b4b-4c49-b0e0-8efb38b67aa3 : 
 {service.pid=org.apache.felix.ipojo.example.ca.component.Hello2.75082279-9b4b-4c49-b0e0-8efb38b67aa3, 
  service.factorypid=org.apache.felix.ipojo.example.ca.component.Hello2, 
to=ipojo} 
-&gt; update_conf 
org.apache.felix.ipojo.example.ca.component.Hello2.75082279-9b4b-4c49-b0e0-8efb38b67aa3 to=felix 
Update: 
pid=org.apache.felix.ipojo.example.ca.component.Hello2.75082279-9b4b-4c49-b0e0-8efb38b67aa3 
Update the configuration : {to=felix} 
Hello felix 
-&gt; delete_conf 
org.apache.felix.ipojo.example.ca.component.Hello2.75082279-9b4b-4c49-b0e0-8efb38b67aa3 
Delete the configuration : 
org.apache.felix.ipojo.example.ca.component.Hello2.75082279-9b4b-4c49-b0e0-8efb38b67aa3 
Good by felix-&gt; list_conf
</PRE>
</DIV></DIV>
<P>In this simple scenario, we see that when the configuration is updated, the instance receives the new value. The <EM>setName</EM> method is immediately invoked to inject the new value. Moreover, when the configuration is deleted, the instance is going to be killed: the &quot;Good Bye&quot; message appears and the instance is disposed.<BR>
Obviously it is possible to create several instance of the same type:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; create_conf org.apache.felix.ipojo.example.ca.component.Hello2 to=ipojo 
Insert the configuration : 
{service.factoryPid=org.apache.felix.ipojo.example.ca.component.Hello2, to=ipojo} 
Hello ipojo 
-&gt; create_conf org.apache.felix.ipojo.example.ca.component.Hello2 to=felix 
Insert the configuration : 
{service.factoryPid=org.apache.felix.ipojo.example.ca.component.Hello2, to=felix} 
Hello felix 
-&gt; arch 
Instance ArchCommand -&gt; valid 
Instance org.apache.felix.ipojo.example.ca.component.Hello2.aaf1927c-1a81-490d-bd7b-21b13d454987 -&gt; valid 
Instance org.apache.felix.ipojo.example.ca.component.Hello2.9344fdbe-c35e-4afc-b839-f7ad0ea59a9d -&gt; valid
</PRE>
</DIV></DIV>
<P>The 'arch' command displays the two created instances.</P>

<DIV class="panelMacro"><TABLE class="infoMacro"><COLGROUP><COL width="24"><COL></COLGROUP><TR><TD valign="top"><IMG src="https://cwiki.apache.org/confluence/images/icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></TD><TD><B>Delete configurations</B><BR>you can delete all created configurations with the <EM>delete_conf all</EM> command</TD></TR></TABLE></DIV>

<H3><A name="CombiningiPOJOandConfigurationAdmin-PropertyPropagation"></A>Property Propagation</H3>

<P>It is possible to propagate the instance configuration to the published service properties. To activate property propagation you need to write the <B>'propagation'</B> attribute in the 'properties' element as in</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
&lt;component 
    classname=<SPAN class="code-quote">&quot;org.apache.felix.ipojo.example.ca.component.Hello3&quot;</SPAN>
    factory=<SPAN class="code-quote">&quot;hello3&quot;</SPAN> architecture=<SPAN class="code-quote">&quot;true&quot;</SPAN>&gt;
	<SPAN class="code-tag">&lt;provides/&gt;</SPAN>
	<SPAN class="code-tag">&lt;properties propagation=<SPAN class="code-quote">&quot;true&quot;</SPAN>&gt;</SPAN>
		<SPAN class="code-tag">&lt;property field=<SPAN class="code-quote">&quot;m_name&quot;</SPAN> value=<SPAN class="code-quote">&quot;clement&quot;</SPAN>/&gt;</SPAN>
	<SPAN class="code-tag">&lt;/properties&gt;</SPAN>
<SPAN class="code-tag">&lt;/component&gt;</SPAN>
</PRE>
</DIV></DIV>
<P>The defined type provides a service. Moreover it supports properties propagation. So all property, except listed one (m_name), will be published inside the provided services.<BR>
So create an instance of the Hello3 component type as follow:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; create_conf  org.apache.felix.ipojo.example.ca.component.Hello3 
Insert the configuration : 
{service.factoryPid=org.apache.felix.ipojo.example.ca.component.Hello3}
</PRE>
</DIV></DIV>
<P>Then, you can check provided services with the <EM>services 7</EM> command</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; services 7 
<SPAN class="code-comment">// Factories and Managed Service factories // 
</SPAN>---- 
factory.name = org.apache.felix.ipojo.example.ca.component.Hello3 
instance.name = 
org.apache.felix.ipojo.example.ca.component.Hello3.a5ca5901-6e20-4636-8805-fbca2db1d68b 
objectClass = org.apache.felix.ipojo.example.ca.service.Hello 
service.factoryPid = org.apache.felix.ipojo.example.ca.component.Hello3 
service.id = 69 
-&gt; 
</PRE>
</DIV></DIV>
<P>Now, we update the instance configuration with a new property 'p1':</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; update_conf 
org.apache.felix.ipojo.example.ca.component.Hello3.a5ca5901-6e20-4636-8805-fbca2db1d68b p1=v1 
Update the configuration : {p1=v1} 
-&gt; services 7 
config.admin.tutorial (7) provides: 
<SPAN class="code-comment">// Factories and Managed Service factories // 
</SPAN>---- 
factory.name = org.apache.felix.ipojo.example.ca.component.Hello3 
instance.name = 
org.apache.felix.ipojo.example.ca.component.Hello3.a5ca5901-6e20-4636-8805-fbca2db1d68b 
objectClass = org.apache.felix.ipojo.example.ca.service.Hello 
p1 = v1 
service.factoryPid = org.apache.felix.ipojo.example.ca.component.Hello3 
service.id = 69 
</PRE>
</DIV></DIV>
<P>Remark that the new property p1 is published. <BR>
Now we can remove this property by reconfiguring the instance with an empty configuration:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; update_conf 
org.apache.felix.ipojo.example.ca.component.Hello3.a5ca5901-6e20-4636-8805-fbca2db1d68b 
Update the configuration : {} 
-&gt; services 7 
ConfigAdminExample (8) provides: 
<SPAN class="code-comment">// Factories and Managed Service factories // 
</SPAN>---- 
factory.name = org.apache.felix.ipojo.example.ca.component.Hello3 
instance.name = 
org.apache.felix.ipojo.example.ca.component.Hello3.a5ca5901-6e20-4636-8805-fbca2db1d68b 
objectClass = org.apache.felix.ipojo.example.ca.service.Hello 
service.factoryPid = org.apache.felix.ipojo.example.ca.component.Hello3 
service.id = 69 
</PRE>
</DIV></DIV>
<P>The service does no more publish the <TT>p1</TT> property.</P>

<H2><A name="CombiningiPOJOandConfigurationAdmin-Conclusion"></A>Conclusion</H2>

<P>This page has presented how to combine the configuration admin and iPOJO. You can also use <A href="http://ipojo-dark-side.blogspot.com/2009/04/ipojo-and-file-install-configuring.html" class="external-link" rel="nofollow">FileInstall in combination with iPOJO and the Configuration Admin</A>. Subscribe to the Felix users mailing list by sending a message to <A href="mailto:users-subscribe@felix.apache.org" class="external-link" rel="nofollow">users-subscribe@felix.apache.org</A>; after subscribing, email questions or feedback to <A href="mailto:users@felix.apache.org" class="external-link" rel="nofollow">users@felix.apache.org</A>
<BR class="atl-forced-newline">
<BR class="atl-forced-newline"></P>

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on 2009-12-27 09:01:19.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
