
<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<HTML>
  <HEAD>
    <TITLE>Apache Felix - apache-felix-ipojo-junit4osgi-tutorial</TITLE>
    <LINK rel="stylesheet" href="http://felix.apache.org/site/media.data/site.css" type="text/css" media="all">
    <META http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </HEAD>
  <BODY>
    <DIV class="title"><DIV class="logo"><A href="http://felix.apache.org/site/index.html"><IMG border="0" alt="Apache Felix" src="http://felix.apache.org/site/media.data/logo.png"></A></DIV><DIV class="header"><A href="http://www.apache.org/"><IMG border="0" alt="Apache" src="http://felix.apache.org/site/media.data/apache.png"></A></DIV></DIV>
    <DIV class="menu">
<UL>
	<LI><A href="news.html" title="news">news</A></LI>
	<LI><A href="http://www.apache.org/licenses/" class="external-link" rel="nofollow">license</A></LI>
	<LI><A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">downloads</A></LI>
	<LI><A href="documentation.html" title="documentation">documentation</A></LI>
	<LI><A href="mailinglists.html" title="mailinglists">mailing lists</A></LI>
	<LI><A href="contributing.html" title="Contributing">contributing</A></LI>
	<LI><A href="http://www.apache.org/" class="external-link" rel="nofollow">asf</A></LI>
	<LI><A href="http://www.apache.org/security/" class="external-link" rel="nofollow">security</A></LI>
	<LI><A href="http://www.apache.org/foundation/sponsorship.html" class="external-link" rel="nofollow">sponsorship</A></LI>
	<LI><A href="http://www.apache.org/foundation/thanks.html" class="external-link" rel="nofollow">sponsors</A>
<!-- ApacheCon Ad -->
<IFRAME src="http://www.apache.org/ads/button.html" style="border-width:0; float: left" frameborder="0" scrolling="no" width="135" height="135"></IFRAME>
<P style="height: 100px">
<!-- ApacheCon Ad --></LI>
</UL>
    </DIV>
    <DIV class="main">
<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/superfish.css); 
</STYLE>

<STYLE type="text/css">
 @import url(http://felix.apache.org/ipojo/site/style.css); 
</STYLE>

<P>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shCore.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushCSharp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPhp.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJScript.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushVb.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushSql.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushXml.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushShell.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushDelphi.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushPython.js"></SCRIPT>
<SCRIPT class="javascript" src="http://cwiki.apache.org/confluence/download/resources/confluence.ext.code:code/shBrushJava.js"></SCRIPT>

<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/jquery-1.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/hoverIntent.js"></SCRIPT>
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/superfish.js"></SCRIPT> 
<SCRIPT type="text/javascript" src="http://felix.apache.org/ipojo/site/supersubs.js"></SCRIPT> 

<SCRIPT type="text/javascript"> 
 
    $(document).ready(function(){ 
        $("ul.sf-menu").supersubs({ 
            minWidth:    14,   // minimum width of sub-menus in em units 
            maxWidth:    30,   // maximum width of sub-menus in em units 
            extraWidth:  1     // extra width can ensure lines don't sometimes turn over 
                               // due to slight rounding differences and font-family 
        }).superfish();  // call supersubs first, then superfish, so that subs are 
                         // not display:none when measuring. Call before initialising 
                         // containing tabs for same reason. 
    }); 
 
</SCRIPT>
<DIV class="main">
<DIV class="page-header">
<IMG src="http://felix.apache.org/ipojo/site/header.png" class="header">
<A href="http://ipojo.org/"><IMG src="http://felix.apache.org/ipojo/site/ipojo.png" width="225" class="header-logo"></A>
<UL class="sf-menu sf-js-enabled sf-shadow" id="ipojo-menu">
<LI class="current">
<!-- Menu Overview -->
<A href="" class="sf-with-ul">Overview<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
	<LI>
	<A href="apache-felix-ipojo.html" title="Apache Felix iPOJO">Home</A>							
	</LI>
	<LI>
	<A href="apache-felix-ipojo-why-choose-ipojo.html" title="apache-felix-ipojo-why-choose-ipojo">Why choose iPOJO</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-successstories.html" title="apache-felix-ipojo-successstories">Success stories</A>
	</LI>
	<LI>
	<A href="apache-felix-ipojo-feature-overview.html" title="Apache Felix iPOJO Feature Overview">Features</A>
	</LI>
</UL>
</LI>	

<LI class="">			
<!-- Menu download -->
<LI>
<A href="download.html" title="Download">Download </A>
</LI>

<LI class="">					
<!-- Menu Documentation -->
<A href="" class="sf-with-ul">Documentation<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
    <!-- sub- menu : getting started -->
    <LI class="">
    <A href="" class="sf-with-ul">Getting Started<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
    <UL>
     <LI><A href="ipojo-in-10-minutes.html" title="iPOJO in 10 minutes">iPOJO in 10 minutes</A></LI>
     <LI><A href="how-to-use-ipojo-annotations.html" title="How to use iPOJO Annotations">Using Annotations</A></LI>
     <LI><A href="ipojo-hello-word-maven-based-tutorial.html" title="iPOJO Hello Word (Maven-Based) tutorial">Maven tutorial</A></LI>
     <LI><A href="ipojo-advanced-tutorial.html" title="iPOJO Advanced Tutorial">Advanced tutorial</A></LI>
     <LI><A href="apache-felix-ipojo-dosgi.html" title="apache-felix-ipojo-dosgi">Using Distributed OSGi</A></LI>
     <LI><A href="ipojo-composition-tutorial.html" title="iPOJO Composition Tutorial">Application Composition</A></LI>
    </UL>
    </LI> <!-- end of getting started -->
    <!-- sub menu : Describing Components -->
     <LI class="">
        <A href="http://felix.apache.org/site/describing-components.html" class="sf-with-ul">Describing components<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="service-requirement-handler.html" title="Service Requirement Handler">Requiring a service</A></LI>
        <LI><A href="providing-osgi-services.html" title="Providing OSGi services">Providing a service</A></LI>
        <LI><A href="lifecycle-callback-handler.html" title="Lifecycle Callback Handler">Lifecycle management</A></LI>
        <LI><A href="configuration-handler.html" title="Configuration Handler">Configuration</A></LI>
        <LI><A href="architecture-handler.html" title="Architecture Handler">Introspection</A></LI>
        <LI><A href="controller-lifecycle-handler.html" title="Controller Lifecycle Handler">Impacting the lifecycle</A></LI>
        <LI><A href="event-admin-handlers.html" title="Event Admin Handlers">Asynchronous communication</A></LI>
        <LI><A href="ipojo-jmx-handler.html" title="iPOJO JMX Handler">JMX management</A></LI>
        <LI><A href="extender-pattern-handler.html" title="Extender Pattern Handler">Extender pattern</A></LI>
        <LI><A href="white-board-pattern-handler.html" title="White Board Pattern Handler">Whiteboard pattern</A></LI>
        <LI><A href="temporal-service-dependency.html" title="Temporal Service Dependency">Temporal dependencies</A></LI>
        </UL>
     </LI> <!-- End of describing components -->
    <!-- sub- menu : User Guide -->
    <LI class="">
    <A href="" class="sf-with-ul">User Guide<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
        <UL>
        <LI><A href="combining-ipojo-and-configuration-admin.html" title="Combining iPOJO and Configuration Admin">iPOJO and config admin</A></LI>
        <LI><A href="how-to-use-ipojo-factories.html" title="How-to use iPOJO factories">Factories and Instances</A></LI>
        <LI><A href="using-xml-schemas.html" title="Using XML Schemas">XML Schemas</A></LI>
        <LI><A href="apache-felix-ipojo-api.html" title="apache-felix-ipojo-api">API</A></LI>
        <LI><A href="apache-felix-ipojo-testing-components.html" title="apache-felix-ipojo-testing-components">Testing components</A></LI>
        <LI><A href="apache-felix-ipojo-eclipse-integration.html" title="apache-felix-ipojo-eclipse-integration">Eclipse Integration</A></LI>
        <LI><A href="ipojo-faq.html" title="iPOJO FAQ">FAQ</A></LI>
        <LI><A href="ipojo-reference-card.html" title="iPOJO-Reference-Card">Reference Card</A></LI>
        </UL>
    </LI> <!-- end of user guide -->
    <!-- sub- menu : Dev Guide -->
    <LI> 
    <A href="" class="sf-with-ul">Advanced Topics<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
       <UL>
        <LI><A href="http://felix.apache.org/ipojo/api/1.6.0" class="external-link" rel="nofollow">Javadoc</A></LI>
        <LI><A href="how-to-write-your-own-handler.html" title="How to write your own handler">Handler development</A></LI>
        <LI><A href="how-to-use-ipojo-manipulation-metadata.html" title="How to use iPOJO Manipulation Metadata">Manipulation Metadata </A></LI>
        <LI><A href="dive-into-the-ipojo-manipulation-depths.html" title="Dive into the iPOJO Manipulation depths">Dive into the iPOJO Manipulation depths</A></LI>
       </UL>
    </LI> <!-- End of Dev guide -->
</UL> 
</LI> <!-- End of doc -->
<!-- Menu 4 : Tools -->
<LI class="">
<A href="" class="sf-with-ul">Tools<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="ipojo-ant-task.html" title="iPOJO Ant Task">Ant Task</A></LI>
   <LI><A href="ipojo-eclipse-plug-in.html" title="iPOJO Eclipse Plug-in">Eclipse Plugin</A></LI>
   <LI><A href="ipojo-maven-plug-in.html" title="iPOJO Maven Plug-in">Maven Plugin</A></LI>
   <LI><A href="ipojo-arch-command.html" title="iPOJO-Arch-Command"><TT>arch</TT> shell command</A></LI>
   <LI><A href="apache-felix-ipojo-online-manipulator.html" title="apache-felix-ipojo-online-manipulator">Online Manipulator</A></LI>
   <LI><A href="ipojo-webconsole-plugin.html" title="iPOJO Webconsole Plugin">Webconsole plugin</A></LI>
   <LI><A href="apache-felix-ipojo-junit4osgi.html" title="apache-felix-ipojo-junit4osgi">Junit4OSGi</A></LI>
</UL>   
</LI><!-- End of tools -->	
<!-- Menu 5 : Support -->
<LI>
<A href="ipojo-support.html" title="ipojo-support">Support </A>
</LI>
<!-- End of the menu 5 -->			
<!-- Menu 6 : Misc -->
<LI class="">
<A href="" class="sf-with-ul">Misc<SPAN class="sf-sub-indicator"> &raquo;</SPAN><SPAN class="sf-sub-indicator"> &raquo;</SPAN></A>
<UL>
   <LI><A href="apache-felix-ipojo-supportedvms.html" title="apache-felix-ipojo-supportedVMs">Supported JVMs</A></LI>
   <LI><A href="apache-felix-ipojo-supportedosgi.html" title="apache-felix-ipojo-supportedOSGi">Supported OSGi Implementations</A></LI>
   <LI><A href="http://ipojo-dark-side.blogspot.com/" class="external-link" rel="nofollow">iPOJO's Dark Side Blog</A></LI>
   <LI><A href="article-presentations.html" title="Article & Presentations">Article &amp; Presentations</A></LI>
   <LI><A href="http://www.apache.org/">ASF</A></LI>
   <LI><A href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</A></LI>
   <LI><A href="http://www.apache.org/foundation/thanks.html">Sponsors</A></LI>
</UL>
</LI><!-- End of misc -->
</UL> <!-- End of the menu -->
</DIV> <!-- Page header -->
</P>

<DIV class="content">


<H1><A name="apache-felix-ipojo-junit4osgi-tutorial-junit4osgiquickstart"></A>junit4osgi quick start</H1>

<P><EM>This page describes how using the junit4osgi framework. With the archive tutorial, a pre-configured version of Felix (with the test framework already installed) is also provided.</EM></P>

<DIV class="toc"><DIV>
<UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-GettingJUnit4OSGi">Getting JUnit4OSGi</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-Howtoruntest%253F">How to run test?</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-TestCase%252CTestSuite">TestCase, TestSuite</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-OSGiTestCaseandOSGiTestSuite">OSGiTestCase and OSGiTestSuite</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-Howtodeclaretestsuites">How to declare test suites</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-Quickexamples">Quick examples</A></LI>
<UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-Bundlestodeploytousejunit4osgi">Bundles to deploy to use junit4osgi</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-TheremixedJUnitexample">The remixed JUnit example</A></LI>
</UL>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-AnOSGibasedJUnitexample">An OSGi-based JUnit example</A></LI>
    <LI><A href="#apache-felix-ipojo-junit4osgi-tutorial-Simpleright%253F">Simple right?</A></LI>
</UL></DIV></DIV>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-GettingJUnit4OSGi"></A>Getting JUnit4OSGi</H2>

<P>The JUnit4OSGi framework is available from the <A href="http://felix.apache.org/site/downloads.cgi" class="external-link" rel="nofollow">Felix downloads</A>. Source code is also available in the iPOJO sub-project (<A href="download.html" title="Download">sources</A>). The JUnit4OSGi framework and the different launchers are built when you compile Felix.</P>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-Howtoruntest%3F"></A>How to run test?</H2>
<P>Firs of all to execute test you must deploy in your OSGi container:</P>
<OL>
	<LI>Your tests</LI>
	<LI>The junit4osgi runtime (executing tests)</LI>
	<LI>A runner launching tests</LI>
</OL>


<P>Several runner are available:</P>
<UL>
	<LI>You can use the JUnit4OSGi immediate-runner, which run tests contained in all the test-bundles. The results are displayed in the framework console output.</LI>
	<LI>The JUnit4OSGi Felix Command (available only for the Apache Felix OSGi framework), allows you to run tests contained in a specific bundle. Test results are also displayed in the framework console output. The syntax of the command is very simple :
	<UL>
		<LI>To run tests contained in the bundle with the given id :{{
<DIV class="preformatted panel" style="border-width: 1px;"><DIV class="preformattedContent panelContent">
<PRE>junit &lt;bundle id&gt;</PRE>
</DIV></DIV>
<P>}}</P></LI>
		<LI>To run tests contained in all the test-bundles installed in the framework :<TT>junit all</TT></LI>
	</UL>
	</LI>
	<LI>The JUnit4OSGi Swing GUI lets you select the test cases and test suites to execute and shows you graphically the result of the tests. You can double-click on a test case result to show its details.</LI>
</UL>


<P><SPAN class="image-wrap" style=""><IMG src="http://felix.apache.org/site/apache-felix-ipojo-junit4osgi.data/screenshot-junit4ogsi-swing-runner.PNG" style="border: 0px solid black"></SPAN></P>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-TestCase%2CTestSuite"></A>TestCase, TestSuite </H2>
<P>A test case is an environment (made of conditions and variables) under which a tester will check that a requirement is satisfied. For JUnit, test cases are classes that define several test methods ; each test method tests an aspect of the targeted requirement. Test cases are often collected into test suites. A test suite aggregates several test cases (and even other test suites), including the notion of test hierarchy. Tests can be organized according to the different requirements they try to validate. The skeleton of a JUnit <TT>TestCase</TT> and <TT>TestSuite</TT> is shown just above :</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
/**
 * The skeleton of a JUnit test <SPAN class="code-keyword">case</SPAN>
 */
<SPAN class="code-keyword">public</SPAN> class MyTestCase <SPAN class="code-keyword">extends</SPAN> junit.framework.TestCase {
    ...

 <SPAN class="code-keyword">public</SPAN> void setUp() {
    <SPAN class="code-comment">// Performs actions BEFORE running any test <SPAN class="code-keyword">case</SPAN>.
</SPAN> }

 <SPAN class="code-keyword">public</SPAN> void testSomething() <SPAN class="code-keyword">throws</SPAN> AnyException {
    <SPAN class="code-comment">// A test method
</SPAN>    ...
    assertTrue(myTest);
    assertEquals(myValue, expectedValue);
    ...
 }

 <SPAN class="code-keyword">public</SPAN> void testAnotherThing() {
    <SPAN class="code-comment">// Another test method
</SPAN>    ...
 }


 <SPAN class="code-keyword">public</SPAN> void tearDown() {
    <SPAN class="code-comment">// Performs actions AFTER running all test cases.
</SPAN> }
}
</PRE>
</DIV></DIV>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
/**
 * The skeleton of a JUnit test suite
 */
<SPAN class="code-keyword">public</SPAN> class MyTestSuite <SPAN class="code-keyword">extends</SPAN> junit.framework.TestSuite {
 /**
 * The skeleton of a JUnit test suite
 */
 <SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> Test suite() {
    TestSuite suite = <SPAN class="code-keyword">new</SPAN> TestSuite(<SPAN class="code-quote">&quot;The name of the test suite&quot;</SPAN>);
    suite.addTestSuite(MyTestCase.class);
    suite.addTestSuite(AnotherTestCase.class);
    ...
    <SPAN class="code-keyword">return</SPAN> suite;
 }
}
</PRE>
</DIV></DIV>

<P>First, tests methods are declared in the test case. Their name must begin with &quot;test&quot;, so JUnit will execute them on demand. The test are expressed in terms of JUnit assertions ; the <TT>assert*()</TT> methods causes JUnit test failure if the given assertion is false. The setUp() and tearDown() methods perform specific actions before and after test cases are run. Then, the test suite collect various test cases. It must implement the <TT>suite()</TT> method that returns the global (and organized) test suite to JUnit.</P>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-OSGiTestCaseandOSGiTestSuite"></A>OSGiTestCase and OSGiTestSuite </H2>
<P>An OSGi test case, is a test case that runs in an OSGi context. <TT>OSGiTestCase</TT> is the class that all the OSGi test cases you write must extend. This class is a kind of bridge between the JUnit TestCase class and the OSGi environment. The only thing the <TT>OSGiTestCase</TT> class adds is the access to the bundle context of the bundle containing tests, and some utility methods, giving an easy access to other bundles and services registered in the OSGi framework.</P>

<P>The structure of an <TT>OSGiTestCase</TT> is exactly the same as a classic JUnit <TT>TestCase</TT> :</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
 /**
  * The structure of an OSGiTestCase
  */
 <SPAN class="code-keyword">public</SPAN> class MyOSGiTestCase <SPAN class="code-keyword">extends</SPAN> OSGiTestCase {
    <SPAN class="code-keyword">public</SPAN> void setUp() {...}
    <SPAN class="code-keyword">public</SPAN> void testSomething() { 
        <SPAN class="code-comment">// You can access here the bundle context through 
</SPAN>        <SPAN class="code-comment">// the 'getContext()' method 
</SPAN>        getContext().getServiceReference(...); 

        ...
    }
 <SPAN class="code-keyword">public</SPAN> void testAnotherThing() {...}
 ...
 <SPAN class="code-keyword">public</SPAN> void tearDown() {...}
 }
</PRE>
</DIV></DIV>

<P>By extension, OSGi test suites are collections of OSGi test cases. But you can also add classic JUnit test cases inside your <TT>OSGiTestSuite</TT>. The skeleton of an OSGiTestSuite is globally the same as a TestSuite, except the fact that a reference to the bundle context is passed :</P>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">public</SPAN> class MyOSGiTestSuite {
 /**
  * This method returns the suite of tests to run.
 */
 <SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> Test suite(BundleContext bc) {
    OSGiTestSuite suite = <SPAN class="code-keyword">new</SPAN> OSGiTestSuite(<SPAN class="code-quote">&quot;My OSGi test suite&quot;</SPAN>, bc);
    suite.addTestSuite(MyFirstTest.class);
    suite.addTestSuite(MySecondTest.class);
    ...
    <SPAN class="code-comment">// Here, we add a sub test suite in <SPAN class="code-keyword">this</SPAN> test suite.
</SPAN>    suite.addTest(AnotherTestSuite.suite(bc));
    ...
    <SPAN class="code-keyword">return</SPAN> suite;
 }
}
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-Howtodeclaretestsuites"></A>How to declare test suites </H2>
<P>This section explains how to declare your test suites in order to expose them to the JUnit4OSGi bundle.</P>

<P>The written OSGi test suites must be declared by the bundle containing them. To do so, you define add the Test-Suite property in your bundle's header. The following snippets show you how to configure your bundle generation tool to add this property in the header. You can even declare test cases in it. The Junit4OSGi bundle will detect such an header in installed bundle (using the extender pattern) and execute contained tests on demand.</P>

<P>With the maven-bundle-plugin, add the following lines in your project's pom :</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-xml">
<SPAN class="code-tag">&lt;plugin&gt;</SPAN>
  <SPAN class="code-tag">&lt;groupId&gt;</SPAN>org.apache.felix<SPAN class="code-tag">&lt;/groupId&gt;</SPAN>
  <SPAN class="code-tag">&lt;artifactId&gt;</SPAN>maven-bundle-plugin<SPAN class="code-tag">&lt;/artifactId&gt;</SPAN>
  ...
  <SPAN class="code-tag">&lt;extensions&gt;</SPAN>true<SPAN class="code-tag">&lt;/extensions&gt;</SPAN>
  <SPAN class="code-tag">&lt;configuration&gt;</SPAN>
  <SPAN class="code-tag">&lt;instructions&gt;</SPAN>
     ...
      <SPAN class="code-tag"><SPAN class="code-comment">&lt;!-- Declare here the test cases and test suites of your bundle --&gt;</SPAN></SPAN>
      <SPAN class="code-tag">&lt;Test-Suite&gt;</SPAN>
       a.package.MyFirstTestSuite,
       yet.another.package.MySingleTestCase
       ...
      <SPAN class="code-tag">&lt;/Test-Suite&gt;</SPAN>
  <SPAN class="code-tag">&lt;/instructions&gt;</SPAN>
  <SPAN class="code-tag">&lt;/configuration&gt;</SPAN>
<SPAN class="code-tag">&lt;/plugin&gt;</SPAN>
</PRE>
</DIV></DIV>

<P>With the aQute Bnd Ant task, add the following lines in your project bnd file:</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Test-Suite: a.<SPAN class="code-keyword">package</SPAN>.MyFirstTestSuite, yet.another.<SPAN class="code-keyword">package</SPAN>.MySingleTestCase, ...
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-Quickexamples"></A>Quick examples</H2>
<P>The following examples show you how to perform unitary tests on your OSGi platform. The first example recovers the example given in the JUnit Cookbook, &quot;bundlizes&quot; it so tests can be run in an OSGi environment. None of the JUnit4OSGi specific features is used, but it shows how to adapt classic JUnit tests. The second example is more OSGi-oriented, and shows how a unitary test can access to the framework via its bundle context.</P>

<P>These examples can be downloaded <A href="http://people.apache.org/~clement/ipojo/tutorials/junit4osgi/junit4osgi-tutorial.zip" class="external-link" rel="nofollow">here</A>.</P>

<H3><A name="apache-felix-ipojo-junit4osgi-tutorial-Bundlestodeploytousejunit4osgi"></A>Bundles to deploy to use junit4osgi</H3>

<P>If you don't use the archive, you can deploy the junit4osgi framework manually. Here is the list of the bundles to deploy and start:</P>
<UL>
	<LI>org.apache.felix.ipojo-1.6.0.jar: iPOJO Core bundle</LI>
	<LI>org.apache.felix.ipojo.handler.extender-1.6.0.jar: iPOJO Extender pattern handler</LI>
	<LI>org.apache.felix.ipojo.junit4osgi-1.1.0-SNAPSHOT.jar: the JUnit4OSGi framework</LI>
	<LI>org.apache.felix.ipojo.junit4osgi.felix-command-1.1.0-SNAPSHOT.jar: the command line junit4osgi runner</LI>
</UL>



<H3><A name="apache-felix-ipojo-junit4osgi-tutorial-TheremixedJUnitexample"></A>The remixed JUnit example </H3>
<P>This example is a simple conversion of a classic JUnit example derived from the JUnit Cookbook. The test case and the test suite are shown to remind you JUnit principles.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> junit.example;
<SPAN class="code-keyword">import</SPAN> junit.framework.TestCase;
<SPAN class="code-keyword">import</SPAN> junit.money.Money;

<SPAN class="code-keyword">public</SPAN> class SimpleTestCase <SPAN class="code-keyword">extends</SPAN> TestCase {
    <SPAN class="code-keyword">private</SPAN> Money f12CHF;
    <SPAN class="code-keyword">private</SPAN> Money f14CHF;
    <SPAN class="code-keyword">public</SPAN> void setUp() {
        f12CHF= <SPAN class="code-keyword">new</SPAN> Money(12, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>);
		f14CHF= <SPAN class="code-keyword">new</SPAN> Money(14, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>);
	}
	<SPAN class="code-keyword">public</SPAN> void testEquals() {
		assertTrue(!f12CHF.equals(<SPAN class="code-keyword">null</SPAN>));
		assertEquals(f12CHF, f12CHF);
		assertEquals(f12CHF, <SPAN class="code-keyword">new</SPAN> Money(12, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>));
		assertTrue(!f12CHF.equals(f14CHF));
	}
	<SPAN class="code-keyword">public</SPAN> void testSimpleAdd() {
		Money expected= <SPAN class="code-keyword">new</SPAN> Money(26, <SPAN class="code-quote">&quot;CHF&quot;</SPAN>);
		Money result= f12CHF.add(f14CHF);
		assertTrue(expected.equals(result));
	}
}
</PRE>
</DIV></DIV>

<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> junit.example;
<SPAN class="code-keyword">import</SPAN> junit.framework.Test;
<SPAN class="code-keyword">import</SPAN> junit.framework.TestSuite;
<SPAN class="code-keyword">public</SPAN> class SimpleTestSuite {
	<SPAN class="code-keyword">public</SPAN> <SPAN class="code-keyword">static</SPAN> Test suite() {
		TestSuite suite = <SPAN class="code-keyword">new</SPAN> TestSuite(<SPAN class="code-quote">&quot;Money Simple Test Suite&quot;</SPAN>);
		suite.addTestSuite(SimpleTestCase.class);
		<SPAN class="code-keyword">return</SPAN> suite;
	}
}
</PRE>
</DIV></DIV>


<P>The following bnd file declares the test suite in the target bundle's header :</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
Private-Package: junit.money, junit.example
Test-Suite: junit.example.SimpleTestSuite
</PRE>
</DIV></DIV>

<P>Once built, the bundle must be deployed in the provided Felix framework, and tests can be performed using the <TT>'junit'</TT> command :</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
	-&gt; ps
	START LEVEL 1
	ID State Level Name
	...
	[ 12] [Active ] [ 1] Junit-Example (0)
	...
	-&gt; junit 12
	Executing [Money Simple Test Suite]
	..
	Time: 0
	OK (2 tests)
-&gt;
</PRE>
</DIV></DIV>

<P>As you can see above, all tests have been correctly executed !</P>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-AnOSGibasedJUnitexample"></A>An OSGi-based JUnit example </H2>
<P>This example shows you how to interact with the OSGi framework within your tests. The test bundle provide a service (HelloService) and tests its work normally. To get the service reference of the HelloService, it uses the bundle context field of the OSGiTestCase class (named <TT>'context'</TT>) and interacts with it like any other OSGi bundle does.</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
<SPAN class="code-keyword">package</SPAN> junit.example;

<SPAN class="code-keyword">import</SPAN> junit.service.hello.HelloService;

<SPAN class="code-keyword">import</SPAN> org.apache.felix.ipojo.junit4osgi.OSGiTestCase;
<SPAN class="code-keyword">import</SPAN> org.osgi.framework.ServiceReference;

<SPAN class="code-keyword">public</SPAN> class SimpleTestCase <SPAN class="code-keyword">extends</SPAN> OSGiTestCase {
    
    <SPAN class="code-keyword">public</SPAN> void testHelloAvailability() {
        ServiceReference ref = getServiceReference(HelloService.class.getName());
        assertNotNull(<SPAN class="code-quote">&quot;Assert Availability&quot;</SPAN>, ref);
    }
    
    <SPAN class="code-keyword">public</SPAN> void testHelloAvailability2() {
        ServiceReference ref = getServiceReference(HelloService.class.getName(), <SPAN class="code-keyword">null</SPAN>);
        assertNotNull(<SPAN class="code-quote">&quot;Assert Availability&quot;</SPAN>, ref);
    }
    
    <SPAN class="code-keyword">public</SPAN> void testHelloMessage() {
        ServiceReference ref = getServiceReference(HelloService.class.getName());
        assertNotNull(<SPAN class="code-quote">&quot;Assert Availability&quot;</SPAN>, ref);
        HelloService hs = (HelloService) getContext().getService(ref);
        <SPAN class="code-object">String</SPAN> message = hs.getHelloMessage();
        assertNotNull(<SPAN class="code-quote">&quot;Check the message existence&quot;</SPAN>, message);
        assertEquals(<SPAN class="code-quote">&quot;Check the message&quot;</SPAN>, <SPAN class="code-quote">&quot;hello&quot;</SPAN>, message);
        <SPAN class="code-comment">// Don't need to unget references, they are unget by junit4osgi
</SPAN>    }
    
    <SPAN class="code-keyword">public</SPAN> void testHelloMessage2() {
    	assertTrue(<SPAN class="code-quote">&quot;Check availability of the service&quot;</SPAN>, 
    	    isServiceAvailable(HelloService.class.getName()));
        HelloService hs = (HelloService) getServiceObject(HelloService.class.getName(), <SPAN class="code-keyword">null</SPAN>);
        <SPAN class="code-object">String</SPAN> message = hs.getHelloMessage();
        assertNotNull(<SPAN class="code-quote">&quot;Check the message existence&quot;</SPAN>, message);
        assertEquals(<SPAN class="code-quote">&quot;Check the message&quot;</SPAN>, <SPAN class="code-quote">&quot;hello&quot;</SPAN>, message);
    }
}
</PRE>
</DIV></DIV>

<P>The performed tests give out the following results :</P>
<DIV class="code panel" style="border-width: 1px;"><DIV class="codeContent panelContent">
<PRE class="code-java">
-&gt; ps
START LEVEL 1
ID State Level Name
...
[ 17] [Active ] [ 1] Junit-OSGi-Example (0)
...
-&gt; services 17
Junit-OSGi-Example (17) provides:
---------------------------------
objectClass = junit.service.hello.HelloService
service.id = 36
-&gt; junit 17
Executing [Hello Service Test Suite]
..
Time: 0,015
OK (4 tests)
-&gt;
</PRE>
</DIV></DIV>

<H2><A name="apache-felix-ipojo-junit4osgi-tutorial-Simpleright%3F"></A>Simple right?</H2>

<P>So now you know everything required to run test inside OSGi. You can start developing your own test. To help you a little bit, junit4osgi provides <A href="apache-felix-ipojo-junit4osgi-methods.html" title="apache-felix-ipojo-junit4osgi-methods">utilities methods</A> greatly reducing the amount of code to write in your tests. Moreover, if you're a Maven user, the <A href="apache-felix-ipojo-junit4osgi-maven.html" title="apache-felix-ipojo-junit4osgi-maven">maven-junit4osgi-plugin</A> is made for you. It just runs your test directly during the maven build process.
<BR class="atl-forced-newline">
<BR class="atl-forced-newline"></P>

 </DIV>
        <IMG src="http://felix.apache.org/ipojo/site/footer.png" class="footer">
</DIV>

<SCRIPT type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</SCRIPT>
<SCRIPT type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-1518442-4");
pageTracker._trackPageview();
} catch(err) {}
</SCRIPT>

        <DIV class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
Last modified by clement.escoffier on 2010-05-17 12:11:58.0
        </DIV>
        <DIV class="trademarkFooter">
Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project logo are trademarks of The Apache Software Foundation. All other marks mentioned may be trademarks or registered trademarks of their respective owners.
        </DIV>
    </DIV>
  </BODY>
</HTML>
