<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Apache Felix Log</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>    </p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>
      </div>

      <h1>Apache Felix Log</h1>
      <h1 id="apache-felix-log">Apache Felix Log</h1>
<p>The OSGi Service Compendium specification defines a general purpose Log Service for the OSGi Platform. It is a very simple specification that doesn't provide all the functionality commonly available in enterprise-level logging tools, but its extensible service model can be used to build fairly sophisticated logging solutions.</p>
<p>The Log Service specification defines four main entities:</p>
<ul>
<li><em><code>org.osgi.service.log.LogService</code></em> - service interface to log information, including log level, message, exception, and <code>ServiceReference</code> that generated the log.</li>
<li><em><code>org.osgi.service.log.LogReaderService</code></em> - service interface to add and remove <code>LogListener</code> instances and to retrieve recent log entries.</li>
<li><em><code>org.osgi.service.log.LogEntry</code></em> - interface defining a log entry.</li>
<li><em><code>org.osgi.service.log.LogListener</code></em> - interface defining a listener for log entries, which is notified about new log entries.</li>
</ul>
<h2 id="accessing-the-log-service">Accessing the log service</h2>
<p>To access a <code>LogService</code> instance it is necessary to look it up in the OSGi service registry as demonstrated in the following code snippet:</p>
<div class="codehilite"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">Activator</span> <span class="n">implements</span> <span class="n">BundleActivator</span>
<span class="p">{</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">start</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="p">)</span> <span class="n">throws</span> <span class="n">Exception</span> 
    <span class="p">{</span>   
        <span class="n">ServiceReference</span> <span class="n">ref</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getServiceReference</span><span class="p">(</span><span class="n">LogService</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ref</span> !<span class="p">=</span> <span class="n">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">LogService</span> <span class="nb">log</span> <span class="p">=</span> <span class="p">(</span><span class="n">LogService</span><span class="p">)</span> <span class="n">context</span><span class="p">.</span><span class="n">getService</span><span class="p">(</span><span class="n">ref</span><span class="p">);</span>

            <span class="o">//</span> <span class="n">Use</span> <span class="n">the</span> <span class="nb">log</span><span class="p">...</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="o">//</span><span class="p">..</span>
</pre></div>


<p>It is possible, and advisable, to use more sophisticated service acquisition mechanisms like a Service Tracker, Dynamic Services or iPOJO.</p>
<h2 id="using-the-log-service">Using the log service</h2>
<p>The <code>LogService</code> interface provides four methods for logging:</p>
<div class="codehilite"><pre><span class="n">public</span> <span class="n">interface</span> <span class="n">LogService</span>
<span class="p">{</span>
    <span class="o">//</span><span class="p">..</span>

    <span class="o">//</span> <span class="n">Log</span> <span class="n">a</span> <span class="n">message</span> <span class="n">specifying</span> <span class="n">a</span> <span class="nb">log</span> <span class="n">level</span>
    <span class="n">public</span> <span class="nb">log</span><span class="p">(</span><span class="n">int</span> <span class="n">level</span><span class="p">,</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span>

    <span class="o">//</span> <span class="n">Log</span> <span class="n">an</span> <span class="n">exception</span>
    <span class="n">public</span> <span class="nb">log</span><span class="p">(</span><span class="n">int</span> <span class="n">level</span><span class="p">,</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">Throwable</span> <span class="n">exception</span><span class="p">)</span>

    <span class="o">//</span> <span class="n">Log</span> <span class="n">a</span> <span class="n">message</span> <span class="n">specifying</span> <span class="n">the</span> <span class="n">ServiceReference</span> <span class="n">that</span> <span class="n">generated</span> <span class="n">it</span>
    <span class="n">public</span> <span class="nb">log</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="n">sr</span><span class="p">,</span> <span class="n">int</span> <span class="n">level</span><span class="p">,</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span>

    <span class="o">//</span> <span class="n">Log</span> <span class="n">a</span> <span class="n">message</span> <span class="n">specifying</span> <span class="n">the</span> <span class="n">ServiceReference</span> <span class="n">and</span> <span class="n">exception</span>
    <span class="n">public</span> <span class="nb">log</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="n">sr</span><span class="p">,</span> <span class="n">int</span> <span class="n">level</span><span class="p">,</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">Throwable</span> <span class="n">exception</span><span class="p">)</span>  
<span class="p">}</span>
</pre></div>


<p>Log levels are defined in the same interface:</p>
<ul>
<li><code>LogService.LOG_DEBUG</code></li>
<li><code>LogService.LOG_INFO</code></li>
<li><code>LogService.LOG_WARNING</code></li>
<li><code>LogService.LOG_ERROR</code></li>
</ul>
<h2 id="retrieving-log-entries">Retrieving log entries</h2>
<p>The <code>LogReaderService</code> provides a <code>getLog()</code> method to retrieve an <code>Enumeration</code> of the latest log entries. The following code snippets demonstrates how to retrieve it from the service registry and use it:</p>
<div class="codehilite"><pre><span class="n">ServiceReference</span> <span class="n">ref</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getServiceReference</span><span class="p">(</span><span class="n">LogReaderService</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ref</span> !<span class="p">=</span> <span class="n">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LogReaderService</span> <span class="n">reader</span> <span class="p">=</span> <span class="p">(</span><span class="n">LogReaderService</span><span class="p">)</span> <span class="n">context</span><span class="p">.</span><span class="n">getService</span><span class="p">(</span><span class="n">ref</span><span class="p">);</span>   
    <span class="n">Enumeration</span><span class="o">&lt;</span><span class="n">LogEntry</span><span class="o">&gt;</span> <span class="n">latestLogs</span> <span class="p">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">getLog</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<h2 id="creating-and-registering-a-loglistener">Creating and registering a <code>LogListener</code></h2>
<p>The Log Service specification doesn't define any particular entity to store, display, or write log entries; it's up to the developer to implement this functionality or to choose an available implementation capable of doing that. To create such a bundle, the first step is to create an implementation of the <code>LogListener</code> interface. The following code shows a simple implementation that echoes the log message:</p>
<div class="codehilite"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">LogWriter</span> <span class="n">implements</span> <span class="n">LogListener</span>
<span class="p">{</span>
    <span class="o">//</span> <span class="n">Invoked</span> <span class="n">by</span> <span class="n">the</span> <span class="nb">log</span> <span class="n">service</span> <span class="n">implementation</span> <span class="k">for</span> <span class="n">each</span> <span class="nb">log</span> <span class="n">entry</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">logged</span><span class="p">(</span><span class="n">LogEntry</span> <span class="n">entry</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">getMessage</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The only method to implement is <code>logged()</code> method, which is called every time a log entry is created in the associated logging service. A <code>LogListener</code> implementation must be registered with the <code>LogReaderService</code> so it can start receiving log entries, as demonstrated in the following code snippet:</p>
<div class="codehilite"><pre><span class="n">ServiceReference</span> <span class="n">ref</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">getServiceReference</span><span class="p">(</span><span class="n">LogReaderService</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ref</span> !<span class="p">=</span> <span class="n">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LogReaderService</span> <span class="n">reader</span> <span class="p">=</span> <span class="p">(</span><span class="n">LogReaderService</span><span class="p">)</span> <span class="n">context</span><span class="p">.</span><span class="n">getService</span><span class="p">(</span><span class="n">ref</span><span class="p">);</span>
    <span class="n">reader</span><span class="p">.</span><span class="n">addLogListener</span><span class="p">(</span><span class="n">new</span> <span class="n">LogWriter</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>


<h2 id="setup-of-apache-felix-log-service">Setup of Apache Felix Log Service</h2>
<p>The Apache Felix Log Service bundle doesn't have any specific dependency on Felix, so it can run on any OSGi container. For its configuration, it will use the following optional system properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>org.apache.felix.log.maxSize</code></td>
<td>100</td>
<td>The maximum size of the log history. A value of -1 means the log has no maximum size; a value of 0 means that no historical information is maintained</td>
</tr>
<tr>
<td><code>org.apache.felix.log.storeDebug</code></td>
<td>false</td>
<td>Determines whether or not debug messages will be stored in the history</td>
</tr>
</tbody>
</table>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1422427 by fmeschbe on Sun, 16 Dec 2012 00:36:51 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
