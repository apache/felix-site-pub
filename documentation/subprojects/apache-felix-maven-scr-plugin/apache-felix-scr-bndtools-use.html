<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Apache Felix SCR Annotations BndTools Use</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="https://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="https://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p><a href="/news.html">News</a>  <br />
<a href="/license.html">License</a>  <br />
<a href="/downloads.cgi">Downloads</a>  <br />
<a href="/documentation.html">Documentation</a>  <br />
<a href="/documentation/community/project-info.html">Project Info</a>  <br />
<a href="/documentation/community/contributing.html">Contributing</a>  <br />
<a href="/sitemap.html">Site Map</a>  <br />
<a href="https://www.apache.org/">ASF</a>  <br />
<a href="https://www.apache.org/security/">Security</a>  <br />
<a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>  <br />
<a href="https://www.apache.org/foundation/thanks.html">Sponsors</a>    </p>
<iframe
    src="https://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-maven-scr-plugin.html">Apache Felix Maven SCR Plugin</a>
      </div>

      <h1>Apache Felix SCR Annotations BndTools Use</h1>
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p>The org.apache.felix.scrplugin.bnd.SCRDescriptorBndPlugin is a bnd plugin allowing to generate SCR annotations and metatype descriptors in the Eclipse BndTools environment.
This page describes how to install the plugin in BndTools and also provides a simple tutorial, which won't be very fascinating, but will make it easy
to demonstrate the use of Apache SCR annotations within BndTools.</p>
<p>If you are not yet familiar with BndTools or if you have not already installed it, you can take a look at <a href="http://bndtools.org/">BndTools homepage</a>.</p>
<p>This tutorial has been made with Eclipse Kepler and with the latest BndTools development version.
It is assumed that the eclipse workspace is currently set to ~/workspace/BNDTOOLS</p>
<h2 id="installing-scr-bnd-plugin-in-bndtools">Installing SCR Bnd plugin in BndTools<a class="headerlink" href="#installing-scr-bnd-plugin-in-bndtools" title="Permanent link">&para;</a></h2>
<p><strong>Create the cnf project</strong>:</p>
<p>If the BndTools "cnf" project does not already exist in your workspace, then create it:</p>
<ul>
<li>In the Eclipse Windows menu, click on Preference -&gt; BndTools OSGi</li>
<li>Click on "Configuration Project/Check Now". This will create the "cnf" bndtools project.</li>
</ul>
<p><strong>Compile the SCR annotations bnd plugin and copy it in cnf project</strong>:</p>
<p>Now you have to copy the SCR annotations bnd plugin into the cnf project of your current workspace ("BNDTOOLS" in this example). 
For now, the plugin is not yet released, but you can build it yourself like this:</p>
<div class="codehilite"><pre><span class="nv">$ </span>svn checkout http://svn.apache.org/repos/asf/felix/trunk/scrplugin scrplugin
<span class="nv">$ </span><span class="nb">cd </span>scrplugin
<span class="nv">$ </span>mvn clean install
<span class="nv">$ </span>mkdir ~/workspace/BNDTOOLS/cnf/plugins/org.apache.felix.scr.bnd/
<span class="nv">$ </span>cp scrplugin/bnd-scr-plugin/target/org.apache.felix.scr.bnd-X.Y.Z-SNAPSHOT.jar ~/workspace/BNDTOOLS/cnf/plugins/org.apache.felix.scr.bnd/
</pre></div>


<p><strong>Configure the default BndTools plugin path</strong>:</p>
<p>In order to let BndTools load the SCR annotations bnd plugin, you can configure the default BndTools plugin path:</p>
<p>First, if you have not yet opened the BndTools perspective, then open it: go to Window Menu -&gt; Open Perspective -&gt; BndTools.</p>
<p>Now, in BndTools menu, click on "BndTools Open ext/pluginpaths.bnd", then click on "Source"
and append the SCR bnd plugin (${plugin-dir}/org.apache.felix.scr.bnd/org.apache.felix.scr.bnd-X.Y.Z-SNAPSHOT.jar) to the current plugin path. 
For example:</p>
<div class="codehilite"><pre>-pluginpath: <span class="cp">${</span><span class="n">plugin</span><span class="o">-</span><span class="nb">dir</span><span class="cp">}</span>/biz.aQute.repository/biz.aQute.repository-2.1.0.jar, \
    <span class="cp">${</span><span class="n">plugin</span><span class="o">-</span><span class="nb">dir</span><span class="cp">}</span>/org.apache.felix.scr.bnd/org.apache.felix.scr.bnd-1.0.0-SNAPSHOT.jar
</pre></div>


<p>You have installed the SCR annotations bnd plugin in Eclipse BndTools, and you can now start using it (see the following Tutorial).</p>
<h2 id="tutorial">Tutorial<a class="headerlink" href="#tutorial" title="Permanent link">&para;</a></h2>
<p>In this tutorial, we'll create a "greeting" project, which provides a simple Greeting service with a "sayHello" method, and the
implementation will use the Apache Felix SCR annotations:</p>
<p>From the File menu, select New -&gt; Bndtools OSGi Project for creating an empty project, and call it "greeting".</p>
<p>Then click on bnd.bnd file of the greeting project, then click on Source, and add the following (and then save the file)</p>
<div class="codehilite"><pre>-buildpath: <span class="cp">${</span><span class="n">plugin</span><span class="o">-</span><span class="nb">dir</span><span class="cp">}</span>/org.apache.felix.scr.bnd/org.apache.felix.scr.bnd-1.0.0-SNAPSHOT.jar;version=file
-plugin: org.apache.felix.scrplugin.bnd.SCRDescriptorBndPlugin
Private-Package: greeting.impl
Export-Package: greeting.api
</pre></div>


<p>Create the greeting.api.Greeting interface:</p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="n">greeting</span><span class="o">.</span><span class="na">api</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Greeting</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<p>And create the greeting.impl.GreetingImpl class:</p>
<div class="codehilite"><pre><span class="kn">package</span> <span class="n">greeting</span><span class="o">.</span><span class="na">impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">greeting.api.Greeting</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.felix.scr.annotations.Activate</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.felix.scr.annotations.Component</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.felix.scr.annotations.Service</span><span class="o">;</span>

<span class="nd">@Component</span><span class="o">(</span><span class="n">immediate</span><span class="o">=</span><span class="kc">true</span><span class="o">)</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GreetingImpl</span> <span class="kd">implements</span> <span class="n">Greeting</span> <span class="o">{</span>
    <span class="nd">@Activate</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Starting Greeting Service&quot;</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sayHello</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Now, click on bnd.bnd and rebuild the project. you have created your first bndtools project using SCR annotations. </p>
<p>Create a Run descriptor (call it "run") with Apache Felix 4 With Gogo Shell.</p>
<p>In Run requirement, add the greeting project, as well as Apache Felix SCR from Bnd HUB.</p>
<p>Then Run the project: you should see in the console the "Starting Greeting Service" message displayed from the start() method.</p>
<h2 id="plugin-options">Plugin Options<a class="headerlink" href="#plugin-options" title="Permanent link">&para;</a></h2>
<p>You can possibly add some optional parameters in the plugin bnd directive (each one separated by a semicolon).
For example:</p>
<div class="codehilite"><pre><span class="o">-</span><span class="n">plugin</span><span class="p">:</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">felix</span><span class="p">.</span><span class="n">scrplugin</span><span class="p">.</span><span class="n">bnd</span><span class="p">.</span><span class="n">SCRDescriptorBndPlugin</span><span class="p">;</span><span class="nb">log</span><span class="p">=</span><span class="n">debug</span><span class="p">;</span><span class="n">generateAccessors</span><span class="p">=</span><span class="n">false</span>
</pre></div>


<p>Here is the list of options:</p>
<hr />
<p><strong><code>log</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: <code>warn</code> <br />
The plugin enabled log level. You can select either one of "error", "warn", "info", or "debug". Plugin logs are written in ${java.io.tmpdir}/scrplugin/BSN.log (BSN is the Bundle Symbolic Name of the bundle being analyzed by the plugin).</p>
<hr />
<p><strong><code>destdir</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: <code>bin</code> <br />
The name of the directory where the descriptor files are generated into. This is also used as the directory where the compiled classes are generated by bndtools.</p>
<hr />
<p><strong><code>generateAccessors</code></strong>  <br />
<em>Required</em>:  No  <br />
<em>Default</em>: <code>true</code>  <br />
If this switch is turned on, the bind and unbind methods for unary references are automatically generated by the plugin.</p>
<hr />
<p><strong><code>strictMode</code></strong>  <br />
<em>Required</em>:  No  <br />
<em>Default</em>:  <code>false</code>  <br />
If set to true, a warning will be considered as an error and the build will fail with warnings generated by this task.</p>
<hr />
<p><strong><code>specVersion</code></strong>  <br />
<em>Required</em>:  No  <br />
<em>Default</em>: --<br />
The plugin will generate a descriptor for the Declarative Service version (e.g. 1.0, 1.1, or 1.2). If no value is specified, the plugin will detect the version and only use 1.1 if features from this version are used.</p>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1524023 by pderop on Tue, 17 Sep 2013 12:54:45 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
