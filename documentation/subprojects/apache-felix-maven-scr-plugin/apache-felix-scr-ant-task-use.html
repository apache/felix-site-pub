<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Apache Felix SCR Ant Task Use</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>  <br />
</p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-maven-scr-plugin.html">Apache Felix Maven SCR Plugin</a>
      </div>

      
      
      <h1>Apache Felix SCR Ant Task Use</h1>
      <p>The SCR Ant Task is implemented in the <code>org.apache.felix.scr.ant</code> library which must be registered as an Ant Task in the build file as follows:</p>
<div class="codehilite"><pre><span class="nt">&lt;project</span> <span class="err">...</span><span class="nt">&gt;</span>

  <span class="nt">&lt;taskdef</span>
    <span class="na">resource=</span><span class="s">&quot;scrtask.properties&quot;</span>
    <span class="na">classpath=</span><span class="s">&quot;org.apache.felix.scr.ant-1.1.4.jar&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</pre></div>


<p>Of course the value you set in the <code>classpath</code> attribute depends on the actual location of the <code>org.apache.felix.scr.ant</code> JAR file.</p>
<p>The SCR Ant Task is available for download from the Apache Felix <a href="http://felix.apache.org/site/downloads.cgi">Downloads</a> page.</p>
<p><strong>Notes</strong>:</p>
<ul>
<li>The name of the task is <code>scr</code></li>
<li>The task requires that the source files have already been compiled</li>
</ul>
<p>The task only generates the descriptor file(s). If you want to use the Declarative Services descriptor -- by default generated in the <code>OSGI-INF/serviceComponents.xml</code> -- you must make sure to add a <code>Service-Components</code> header to your bundle manifest. Unlike Maven plugin the Ant task cannot automatically generate this header.</p>
<h2 id="task-attributes">Task Attributes</h2>
<p>Like the standard <code>javac</code> Ant Task, the SCR Ant Task defines an implicit fileset which defines the source files to be scanned for Java 5 Annotations or JavaDoc Tags. In addition to the child elements available to Ant Fileset as defined for <a href="http://ant.apache.org/manual/dirtasks.html#directorybasedtasks">directory-based tasks</a> the following task attributes are supported:</p>
<hr />
<p><strong><code>scrdir</code></strong>  <br />
<em>Required</em>: Yes  <br />
<em>Default</em> --  <br />
The root directory of the implicitly defined fileset denoting the files to consider for annotation and/or JavaDoc tag processing.</p>
<hr />
<p><strong><code>destdir</code></strong>  <br />
<em>Required</em>: Yes  <br />
<em>Default</em>: --  <br />
The name of the directory where the descriptor files are generated into. This is also used as the directory where the compiled classes from the <code>srcdir</code> may be located. This directory is actually added as another element to the classpath as defined by <code>classpath</code> and <code>classpathRef</code>.</p>
<hr />
<p><strong><code>classpath</code></strong>  <br />
<em>Required</em>: No   <br />
<em>Default:</em>  --  <br />
The class path used to load classes from to analyse for the descriptor file generation. Generally this will be the same class path as the one used to compile the sources.</p>
<hr />
<p><strong><code>classpathRef</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --  <br />
A reference to a class path used to load classes from to analyse for the descriptor file generation. Generally this will be the same class path as the one used to compile the sources.</p>
<hr />
<p><strong><code>finalName</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: <code>serviceComponents.xml</code>  <br />
The name of the descriptor file to create. This file is always located inside the <code>OSGI-INF</code> folder in the <code>destdir</code>.</p>
<hr />
<p><strong><code>metaTypeName</code></strong>   <br />
<em>Required</em>:  No  <br />
<em>Default</em>:  <code>metatype.xml</code>  <br />
The name of the descriptor file to create. This file is always located inside the <code>OSGI-INF/metatype</code> folder in the <code>destdir</code>.</p>
<hr />
<p><strong><code>generateAccessors</code></strong>  <br />
<em>Required</em>:  No  <br />
<em>Default</em>: <code>true</code>  <br />
If this switch is turned on, the bind and unbind methods for unary references are automatically generated by the plugin.</p>
<hr />
<p><strong><code>annotationTagProviders</code></strong>  <br />
<em>Required</em>:  No  <br />
<em>Default</em>:  --  <br />
List of fully qualified class names providing more Annotation Tag Providers. As of version 1.4.0 of the SCR Annotations library this configuration element is optional if the SCR Annotations library comes with a proper SPI setup (see <a href="/documentation/subprojects/apache-felix-maven-scr-plugin/extending-scr-annotations.html">Extending SCR Annotations</a>)</p>
<hr />
<p><strong><code>specVersion</code></strong>  <br />
<em>Required</em>:  No  <br />
<em>Default</em>: Auto-Detected  <br />
The plugin will generate a descriptor for the Declarative Service version (e.g. 1.0, 1.1, or 1.2). If no value is specified, the plugin will detect the version and only use 1.1 if features from this version are used.</p>
<hr />
<p><strong><code>strictMode</code></strong>  <br />
<em>Required</em>:  No  <br />
<em>Default</em>:  <code>false</code>  <br />
If set to true, a warning will be considered as an error and the build will fail with warnings generated by this task.</p>
<hr />
<p><strong><code>parseJavadoc</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: <code>true</code>  <br />
If set to true, JavaDoc based annotations will be processed.</p>
<hr />
<p><strong><code>processAnnotations</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: <code>true</code>  <br />
If set to true, SCR annotations will be processed</p>
<hr />
<p>The <code>scr</code> task must be provided with the same class path as was used to compile the sources. The classes in the class path are used by the task to be able to load compiled classes (mostly for Java 5 annotation processing) and any base classes, which may be extended. The easiest way to share the class path is to define a class path property and refer to it with the <code>classpathref</code> attribute of the <code>scr</code> task.</p>
<h2 id="using-javadoc-tags">Using JavaDoc Tags</h2>
<p>JavaDoc tags are supported natively by the SCR Ant Task. No further configuration and/or libraries are needed.</p>
<h2 id="java-5-annotations">Java 5 Annotations</h2>
<p>To use Java 5 Annotations make sure the library defining the annotations is available on the class path for both the compilation in the <code>javac</code> task and for generating the descriptor in the <code>scr</code> task.</p>
<p>No further configuration is required as the SCR Ant Task automatically recognizes SCR Annotation definitions from libraries in the class path provided the annotations are provided in a JAR library with properly setup SPI configuration as documented in <a href="/documentation/subprojects/apache-felix-maven-scr-plugin/extending-scr-annotations.html">Extending SCR Annotations</a>.</p>
<h2 id="example">Example</h2>
<p>The following is very simple example build file based on the <a href="http://svn.apache.org/repos/asf/sling/trunk/bundles/jcr/webconsole">Apache Sling JCR WebConsole</a> bundle:</p>
<div class="codehilite"><pre><span class="nt">&lt;project</span> <span class="na">default=</span><span class="s">&quot;scr&quot;</span> <span class="na">basedir=</span><span class="s">&quot;.&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;taskdef</span> <span class="na">resource=</span><span class="s">&quot;scrtask.properties&quot;</span>
      <span class="na">classpath=</span><span class="s">&quot;org.apache.felix.scr.ant-1.0.0-SNAPSHOT.jar&quot;</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;src&quot;</span> <span class="na">value=</span><span class="s">&quot;src/main/java&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;classes&quot;</span> <span class="na">value=</span><span class="s">&quot;target/classes&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;m2Repo&quot;</span> <span class="na">value=</span><span class="s">&quot;${user.home}/.m2/repository&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;path</span> <span class="na">id=</span><span class="s">&quot;dependencies&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;fileset</span> <span class="na">dir=</span><span class="s">&quot;${m2Repo}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;javax/jcr/jcr/1.0/jcr-1.0.jar&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;org/apache/sling/org.apache.sling.jcr.api/2.0.6/org.apache.sling.jcr.api-2.0.6.jar&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;org/apache/felix/org.apache.felix.webconsole/3.0.0/org.apache.felix.webconsole-3.0.0.jar&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;javax/servlet/servlet-api/2.4/servlet-api-2.4.jar&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;include</span> <span class="na">name=</span><span class="s">&quot;org/apache/felix/org.apache.felix.scr.annotations/1.4.0/org.apache.felix.scr.annotations-1.4.0.jar&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/fileset&gt;</span>
    <span class="nt">&lt;/path&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;compile&quot;</span> <span class="na">depends=</span><span class="s">&quot;init&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;mkdir</span> <span class="na">dir=</span><span class="s">&quot;${classes}&quot;</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;javac</span> <span class="na">srcdir=</span><span class="s">&quot;${src}&quot;</span> <span class="na">destdir=</span><span class="s">&quot;${classes}&quot;</span> <span class="na">classpathref=</span><span class="s">&quot;dependencies&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;scr&quot;</span> <span class="na">depends=</span><span class="s">&quot;compile&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;scr</span> <span class="na">srcdir=</span><span class="s">&quot;${src}&quot;</span> <span class="na">destdir=</span><span class="s">&quot;${classes}&quot;</span> <span class="na">classpathref=</span><span class="s">&quot;dependencies&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

  <span class="nt">&lt;target</span> <span class="na">name=</span><span class="s">&quot;clean&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;delete</span> <span class="na">dir=</span><span class="s">&quot;target&quot;</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/target&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</pre></div>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1438983 by fmeschbe on Sat, 26 Jan 2013 22:54:42 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
