<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Apache Felix Logback</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="https://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="https://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p><a href="/news.html">News</a>  <br />
<a href="/license.html">License</a>  <br />
<a href="/downloads.cgi">Downloads</a>  <br />
<a href="/documentation.html">Documentation</a>  <br />
<a href="/documentation/community/project-info.html">Project Info</a>  <br />
<a href="/documentation/community/contributing.html">Contributing</a>  <br />
<a href="/sitemap.html">Site Map</a>  <br />
<a href="https://www.apache.org/">ASF</a>  <br />
<a href="https://www.apache.org/security/">Security</a>  <br />
<a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>  <br />
<a href="https://www.apache.org/foundation/thanks.html">Sponsors</a>    </p>
<iframe
    src="https://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>
      </div>

      <h1>Apache Felix Logback</h1>
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p><strong>Apache Felix Logback</strong> is a small integration of the <a href="https://logback.qos.ch/">Logback</a> backend with OSGi.</p>
<p>With <strong>OSGi R7</strong> the <strong>Log Service Specification 1.4</strong>  (Log 1.4) brings a slew of new features designed to improve the developer experience with logging, the details of which can be read about <a href="https://osgi.org/specification/osgi.cmpn/7.0.0/service.log.html">here</a>.</p>
<p>This project is intended to help bridge the last frontier of OSGi logging by leveraging many capabilities of <a href="https://logback.qos.ch/">Logback</a>, the new <strong>Log 1.4</strong> features to provide a <strong>unified backend</strong> where:</p>
<ol>
<li>all logging <em>can be</em> configured in one place</li>
<li>all log records are appended together (or at least all appenders are setup in one place)</li>
<li>support as many logging APIs as possible</li>
</ol>
<h2 id="depedencies">Depedencies<a class="headerlink" href="#depedencies" title="Permanent link">&para;</a></h2>
<p>To add Logback to an OSGi framework include the following dependencies</p>
<div class="codehilite"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.x<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>logback-core<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.2.x<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.7.x<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>


<p>These provide the <code>slf4j</code> logging API over the Logback backend.</p>
<h2 id="basic-configuration">Basic Configuration<a class="headerlink" href="#basic-configuration" title="Permanent link">&para;</a></h2>
<p>Configuring logback is most easily handled by setting the system property <code>logback.configurationFile</code> to point to a file on the file system.</p>
<p>This is an example using a <em>bndrun</em> file:</p>
<div class="codehilite"><pre><span class="na">-runproperties</span><span class="o">:</span> <span class="s">logback.configurationFile=file:${.}/logback.xml</span>
</pre></div>


<p>where in bnd <code>${.}</code> gives the path to the directory of the bndrun file.</p>
<p>Logback offers many features from it's configuration file, so make sure to look through the <a href="https://logback.qos.ch/documentation.html">documentation</a>.</p>
<h2 id="deployment-options">Deployment Options<a class="headerlink" href="#deployment-options" title="Permanent link">&para;</a></h2>
<p>There are at least two possible deployment scenarios.</p>
<h3 id="the-standard-approach">The Standard Approach<a class="headerlink" href="#the-standard-approach" title="Permanent link">&para;</a></h3>
<p>The <strong>standard approach</strong> is to install all bundles into the OSGi runtime.</p>
<p><strong>pros</strong>:</p>
<ul>
<li>this is the most understood and expected deployment scenario</li>
<li>bundles are managed through any OSGi management agent</li>
</ul>
<p><strong>cons</strong>:</p>
<ul>
<li>due to the fact that logging APIs are most commonly static there is an inevitable race condition which is exacerbated by aspects such as:</li>
<li>the order in which the bundles are started</li>
<li>which bundle makes the first call the static API that most-likely has the side effect of binding an implementation</li>
<li>buffering is required to collect the complete set of logs, but configuring the buffer to hold that many logs can cause memory issues, or if too small to lose records. Also, some logging frameworks simply don't provide such buffering, and some actually simply fail in this scenario.
    In the case of the OSGi Log Service this is handled by implementations that support Log 1.4, or perhaps earlier through proprietary means.</li>
</ul>
<h3 id="the-immediate-approach">The Immediate Approach<a class="headerlink" href="#the-immediate-approach" title="Permanent link">&para;</a></h3>
<p>The <strong>immediate approach</strong> overcomes the <strong>cons</strong> of <em>the standard approach</em> and initializes the log engine as early as possible in order to avoid buffering, binding issues, or losing records.</p>
<p><strong>pros</strong>:</p>
<ul>
<li>there's very little chance to miss any log records</li>
<li>there are no temporal issues for binding or bundle start order since the log engine is setup before most other application activities take place</li>
</ul>
<p><strong>cons</strong>:</p>
<ul>
<li>bundles on the framework class path are not installed into the framework so they cannot be managed through regular means. <em>On the other hand, logging is one of those infrastructural aspects that transcends the application and for which there are very few scenarios under which one would want to manage logging API or implementation bundles this way. Configuration? Sure!</em></li>
</ul>
<h2 id="unified-backend">Unified Backend<a class="headerlink" href="#unified-backend" title="Permanent link">&para;</a></h2>
<p>Of course adding Logback does not magically result in all logs being funneled into the same appenders, particularly the OSGi logs. However, it is quite common to assemble an OSGi application from a variety of bundles which use a variety of logging APIs. Many of these can already be mapped onto Logback.</p>
<p>Many examples of setting up the various logging APIs can be found in the integration tests of the project.</p>
<p>The following APIs are tested:</p>
<ul>
<li>JBoss Logging 3.3.x</li>
<li>Commons Logging 1.2</li>
<li>JUL (Java Util Logging)</li>
<li>Log4j 1</li>
<li>Log4j 2</li>
<li>Slf4j</li>
</ul>
<h2 id="mapping-of-osgi-events">Mapping of OSGi Events<a class="headerlink" href="#mapping-of-osgi-events" title="Permanent link">&para;</a></h2>
<p>The OSGi Log specification 1.4 describes events resulting in log records. <strong>Log 1.4</strong> defines logger names mapping to these events.</p>
<table class="table">
<thead>
<tr>
<th>Event</th>
<th>Logger Name</th>
<th>Events types</th>
</tr>
</thead>
<tbody>
<tr>
<td>Bundle event</td>
<td><code>Events.Bundle</code></td>
<td><code>INSTALLED</code> - BundleEvent INSTALLED<br /><code>STARTED</code> - BundleEvent STARTED<br /><code>STOPPED</code> - BundleEvent STOPPED<br /><code>UPDATED</code> - BundleEvent UPDATED<br /><code>UNINSTALLED</code> - BundleEvent UNINSTALLED<br /><code>RESOLVED</code> - BundleEvent RESOLVED<br /><code>UNRESOLVED</code> - BundleEvent UNRESOLVED</td>
</tr>
<tr>
<td>Service event</td>
<td><code>Events.Service</code></td>
<td><code>REGISTERED</code> - ServiceEvent REGISTERED<br /> <code>MODIFIED</code> - ServiceEvent MODIFIED<br /> <code>UNREGISTERING</code> - ServiceEvent UNREGISTERING</td>
</tr>
<tr>
<td>Framework event</td>
<td><code>Events.Framework</code></td>
<td><code>STARTED</code> - FrameworkEvent STARTED<br /><code>ERROR</code> - FrameworkEvent ERROR<br /><code>PACKAGES_REFRESHED</code> - FrameworkEvent PACKAGES REFRESHED<br /><code>STARTLEVEL_CHANGED</code> - FrameworkEvent STARTLEVEL CHANGED<br /><code>WARNING</code> - FrameworkEvent WARNING<br /><code>INFO</code> - FrameworkEvent INFO</td>
</tr>
<tr>
<td>Legacy Log Service events</td>
<td><code>LogService</code></td>
<td>any log events originating from bundles that used the original <code>LogService</code> logging API</td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> In order to improve the granularity of the logging associated with these events, <strong>Apache Felix Logback</strong> allows appending a period (<code>.</code>) followed by any number of segments (separated by periods) of the <code>Bundle-SymbolicName</code> for the logger names used in configuring the levels. This greatly improves the configurability.</p>
<p>Consider the following <code>logback.xml</code> example:</p>
<div class="codehilite"><pre><span class="nt">&lt;configuration&gt;</span>

    <span class="c">&lt;!-- defined a console append --&gt;</span>
    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">&quot;STDOUT&quot;</span> <span class="na">class=</span><span class="s">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>%d{HH:mm:ss.SSS} [%.15thread] %-5level %logger{36}:%line - %msg%n<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!-- log all Bundle events --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;Events.Bundle&quot;</span> <span class="na">level=</span><span class="s">&quot;TRACE&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- log WARN Framework service events of bundles whose BSN starts with `org.eclipse.osgi` (guess who that is?) --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;Events.Service.org.eclipse.osgi&quot;</span> <span class="na">level=</span><span class="s">&quot;WARN&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- turn OFF legacy Log Service records from bundles whose BSN starts with `org.baz` --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;LogService.org.baz&quot;</span> <span class="na">level=</span><span class="s">&quot;OFF&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- log DEBUG Service events for bundles whose BSN starts with `org.fum` --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;Events.Service.org.fum&quot;</span> <span class="na">level=</span><span class="s">&quot;DEBUG&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- log DEBUG from any log API using a logger name starting with `org.my.foo` --&gt;</span>
    <span class="nt">&lt;logger</span> <span class="na">name=</span><span class="s">&quot;org.my.foo&quot;</span> <span class="na">level=</span><span class="s">&quot;DEBUG&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">&quot;ERROR&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">&quot;STDOUT&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>


<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Apache Felix Logback</strong> supports Logback's <a href="https://logback.qos.ch/manual/configuration.html#autoScan">automatic reloading</a> upon file modification</li>
<li>When using <strong>equinox</strong> framework you may want to disable it's internal appenders using the system property <code>eclipse.log.enabled=false</code></li>
</ul>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1835281 by rotty3000 on Fri, 6 Jul 2018 20:50:28 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
