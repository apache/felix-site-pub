<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Dependency Manager Components Annotations</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>    </p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-dependency-manager.html">Apache Felix Dependency Manager</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-dependency-manager/apache-felix-dependency-manager-using-annotations.html">Dependency Manager Annotations</a>
      </div>

      
      <div class="tip">
           This page is a translated version of <a href="/site/dependencymanager-annotations-component.html" target="felix_cwiki">/site/dependencymanager-annotations-component.html</a>. In case of
           doubt you might want to refer to the old page.
      </div>
      
      
      <h1>Dependency Manager Components Annotations</h1>
      <p>This page describes the different types of Dependency Manager components:</p>
<ul>
<li><em>Component</em>: Components are the main building blocks for OSGi applications. They can publish themselves as a service, and/or they can have dependencies. These dependencies will influence their life cycle as component will only be activated when all required dependencies are available.</li>
<li><em>Aspect Service</em>: A service that provides a non-functional aspect on top of an existing service. In aspect oriented programming, an aspect, or interceptor can sit between a client and another target service used by the client. An Aspect Service first tracks a target service and is created once the target service is detected. Then the Aspect Service is provided, but with a higher  ranking, and the client is transparently updated with the aspect. Aspects can be chained and may apply to the same target service (and in this case, the ranking of the Aspect service is used to chain aspects in  the proper order).</li>
<li><em>Adapter Service</em>: A Service that adapts another existing service into a new one. Like with aspects, sometimes you want to create adapters for certain services, which add certain behavior that results in the publication of (in this case) a different service. Adapters can dynamically be added and removed and allow you to keep your basic services implementations clean and simple, adding extra features on top of them in a modular way.</li>
<li><em>Bundle Adapter Service</em>: creates an OSGi service a service on top of a given bundle.</li>
<li><em>Resource Adapter Service</em>: creates an OSGi service on top of a specific Resource.</li>
<li><em>Factory Configuration Adapter Service</em>: creates an OSGi service from ConfigAdmin, using a factoryPid, and a ManagedServiceFactory.</li>
</ul>
<h2 id="component">@Component</h2>
<p>This annotation annotates an implementation class that optionally publishes 
an OSGi service, and optionally has some dependencies, with a managed 
lifecycle. </p>
<h3 id="annotation-attributes">Annotation attributes</h3>
<hr />
<p><strong><code>provides</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: all implemented interfaces, if any.   </p>
<p>By default, the component is registered into the OSGi registry under all 
directly implemented interfaces. If no interfaces are implemented, then the 
component is not registered, but it still has a managed lifecycle, and may 
have some dependencies. If you need to  explicitly define the list of 
interfaces (or classes) under which the  component must be registered in the 
OSGi registry, then use the <em>provides</em> attribute. You can also set this 
property to an empty array of classes  if you don't want at all your component 
to be exposed in the OSGi  registry (even if it implements some interfaces).</p>
<hr />
<p><strong><code>properties</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --  </p>
<p>the <em>properties" attribute enumerates the list of properties that are part of 
the Service exposed by the component in the OSGi Registry. 
Each property is defined using the @Property annotation, which represents a<br />
key/value pair. When a value is actually an array of strings, 
then the </em>values* attribute of the @Property annotation can be used. 
This attribute  is not the only way to specify OSGi Service properties 
(see Setting Service properties in the lifecycle section).</p>
<hr />
<p><strong><code>factoryMethod</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --  </p>
<p>This attribute refers to a static method name from the annotated class which 
can be used to instantiate the component instance. Normally, DependencyManager 
instantiates the component using its class name, and with the default 
constructor of the class, but there are some cases where it is required to 
take control of  how the component is created. For instance, this method may 
be used to create the component as a dynamic proxy ...</p>
<hr />
<p><strong><code>factorySet</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --  </p>
<p>This attribute is the identifier for a component factory. By default, a 
component is automatically instantiated as a singleton when the bundle is 
started, and when all required dependencies are satisfied. But when a 
component must be created, configured, or disposed dynamically, and when 
multiple instances of the same component are needed, a factorySet should  be 
used. When you use this attribute, a java.util.Set<Dictionary>  object is 
registered into the OSGi regitry, with a specific <em>dm.factory.name</em> service 
property matching the ID you specify in the attribute. </p>
<p>This Set<Dictionary> will act as a Factory API, and another component may 
define a dependency on this Set and add some configuration dictionaries in it, 
in order to fire some component instantiation/activation. There is one 
component instantiated per added dictionary, which is passed to component 
instances via a configurable callback method (using the <em>factoryConfigure</em> 
attribute). All public properties will be propagated  along with eventual 
published service. A public property is a property  which does not start with 
a dot ("."). Properties starting with a dot are considered private to the 
component, and won't be propagated to published service. This model is 
actually similar to the Declarative Service "Component Factories" concept, 
except that you don't have a dependency on a specific API, but rather on a 
basic jdk class  (java.util.Set<Dictionary>). </p>
<p>Notice that, unlike in Declarative Service, the component factory is provided once the component 
bundle is started, even if required dependencies are not satisfied. This is 
useful when the component want  to dynamically configure its dependency 
filters. So, to summarize:</p>
<ul>
<li>Each time a new Dictionary is added into the Set, then a new instance of the annotated component will be instantiated, and this dictionary is passed to the component callback specified with the factoryConfigure attribute.</li>
<li>Each time an existing Dictionary is re-added into the Set, then the corresponding component instance is updated, and the updated dictionary is also passed to the callback specified in the factoryConfigure attribute.</li>
<li>Each time an existing Dictionary is removed from the Set, then the  corresponding component instance will be stopped and destroyed.</li>
</ul>
<hr />
<p><strong><code>factoryConfigure</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --  </p>
<p>This attributes sets the <em>configure</em> method name to be called with the factory 
configuration. This attribute only makes sense if the factorySet() attribute 
is used. If specified, then this attribute references a component callback 
method, which is called for providing the configuration supplied by the 
factory that instantiated this component. The current Service properties will 
be also updated with all public properties (which don't start with a dot).</p>
<p>Usage example:</p>
<div class="codehilite"><pre><span class="cm">/**</span>
<span class="cm">  * This component will be activated once the bundle is started and when all required dependencies</span>
<span class="cm">  * are available.</span>
<span class="cm">  */</span>
<span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">X</span> <span class="kd">implements</span> <span class="n">Z</span> <span class="o">{</span>
    <span class="nd">@ConfigurationDependency</span><span class="o">(</span><span class="n">pid</span><span class="o">=</span><span class="s">&quot;MyPid&quot;</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">Dictionary</span> <span class="n">conf</span><span class="o">)</span> <span class="o">{</span>
         <span class="c1">// Configure or reconfigure our service.</span>
    <span class="o">}</span>

    <span class="nd">@Start</span>
    <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// Our component is starting and is about to be registered in the OSGi registry as a Z service.</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doService</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Example using a factorySet, where the X component is instantiated/updated/disposed by another Y component:</p>
<div class="codehilite"><pre> <span class="nd">@Component</span><span class="o">(</span><span class="n">factorySet</span><span class="o">=</span><span class="s">&quot;MyComponentFactory&quot;</span><span class="o">,</span> <span class="n">factoryConfigure</span><span class="o">=</span><span class="s">&quot;configure&quot;</span><span class="o">)</span>
 <span class="kd">class</span> <span class="nc">X</span> <span class="kd">implements</span> <span class="n">Z</span> <span class="o">{</span>
     <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">Dictionary</span> <span class="n">conf</span><span class="o">)</span> <span class="o">{</span>
         <span class="c1">// Configure or reconfigure our component. The conf is provided by the factory,</span>
         <span class="c1">// and all public properties (which don&#39;t start with a dot) are propagated with the</span>
         <span class="c1">// Service properties eventually specified in the properties annotation attribute.</span>
     <span class="o">}</span>

     <span class="nd">@ServiceDependency</span>
     <span class="kt">void</span> <span class="nf">bindOtherService</span><span class="o">(</span><span class="n">OtherService</span> <span class="n">other</span><span class="o">)</span> <span class="o">{</span>
         <span class="c1">// store this require dependency</span>
     <span class="o">}</span>

     <span class="nd">@Start</span>
     <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
         <span class="c1">// Our component is starting and is about to be registered in the OSGi registry as a Z service.</span>
     <span class="o">}</span>

     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doService</span><span class="o">()</span> <span class="o">{</span>
         <span class="c1">// ... part of Z interface</span>
     <span class="o">}</span>
 <span class="o">}</span>

<span class="cm">/**</span>
<span class="cm">  * This class will instantiate some X component instances</span>
<span class="cm">  */</span>
<span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">Y</span> <span class="o">{</span>
     <span class="nd">@ServiceDependency</span><span class="o">(</span><span class="n">filter</span><span class="o">=</span><span class="s">&quot;(dm.factory.name=MyComponentFactory)&quot;</span><span class="o">)</span>
     <span class="n">Set</span><span class="o">&lt;</span><span class="n">Dictionary</span><span class="o">&gt;</span> <span class="n">_XFactory</span><span class="o">;</span> <span class="c1">// This Set acts as a Factory API for creating X component instances.</span>

     <span class="nd">@Start</span>
     <span class="kt">void</span> <span class="nf">start</span><span class="o">()</span> <span class="o">{</span>
         <span class="c1">// Instantiate a X component instance</span>
         <span class="n">Dictionary</span> <span class="n">x1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">()</span> <span class="o">;</span>
         <span class="n">_XFactory</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">x1</span><span class="o">);</span>

         <span class="c1">// Instantiate another X component instance</span>
         <span class="n">Dictionary</span> <span class="n">x2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">()</span> <span class="o">;</span>
         <span class="n">_XFactory</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">x2</span><span class="o">);</span>

         <span class="c1">// Update the first X component instance</span>
         <span class="n">x1</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="s">&quot;bar1_modified&quot;</span><span class="o">);</span>
         <span class="n">_XFactory</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">x1</span><span class="o">);</span>

         <span class="c1">// Destroy all components (Notice that invoking _XFactory.clear() also destroys every X instances)</span>
         <span class="n">_XFactory</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">x1</span><span class="o">);</span>
         <span class="n">_XFactory</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">x2</span><span class="o">);</span>
     <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<h2 id="aspectservice">@AspectService</h2>
<p>Aspects allow you to define an interceptor, or chain of interceptors for a service (to add features like caching or logging, etc ...). The dependency manager intercepts the original service, and allows you to execute some code before invoking the original service ... The aspect will be applied to any service that matches the specified interface and filter and will be registered with the same interface and properties as the original service, plus any extra properties you supply here. It will also inherit all dependencies, and if you declare the original service as a member it will be injected.</p>
<h3 id="annotation-attributes_1">Annotation attributes</h3>
<hr />
<p><strong><code>ranking</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --  </p>
<p>Sets the ranking of this aspect. Since aspects are chained, the ranking 
defines the order in which they are chained. Chain ranking is implemented as 
a service ranking so service lookups automatically retrieve the top of the 
chain.</p>
<hr />
<p><strong><code>service</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: all directly implemented interfaces.  </p>
<p>Sets the service interface to apply the aspect to. By default, the directly 
implemented interface is used.</p>
<hr />
<p><strong><code>filter</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --</p>
<p>Sets the filter condition to use with the service interface this aspect is 
applying to.</p>
<hr />
<p><strong><code>properties</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --</p>
<p>Sets Additional properties to use with the aspect service registration.</p>
<hr />
<p><strong><code>field</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --</p>
<p>Sets the field name where to inject the original service. By default, the original service is injected in any attributes in the aspect implementation that are of the same type as the aspect interface.</p>
<hr />
<p><strong><code>factoryMethod</code></strong>  <br />
<em>Required</em>: No  <br />
<em>Default</em>: --</p>
<p>Sets the static method used to create the aspect service implementation 
instance. The default constructor of the annotated class is used. 
The factoryMethod can be used to provide a specific aspect implements, 
like a DynamicProxy.</p>
<h3 id="usage-example">Usage example:</h3>
<div class="codehilite"><pre> <span class="p">@</span><span class="n">AspectService</span><span class="p">(</span><span class="n">ranking</span><span class="p">=</span>10<span class="p">),</span> <span class="k">properties</span><span class="p">={@</span><span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="p">=</span>&quot;<span class="n">param</span>&quot;<span class="p">,</span> <span class="n">value</span><span class="p">=</span>&quot;<span class="n">value</span>&quot;<span class="p">)})</span>
 <span class="n">class</span> <span class="n">AspectService</span> <span class="n">implements</span> <span class="n">InterceptedService</span> <span class="p">{</span>
     <span class="o">//</span> <span class="n">The</span> <span class="n">service</span> <span class="n">we</span> <span class="n">are</span> <span class="n">intercepting</span> <span class="p">(</span><span class="n">injected</span> <span class="n">by</span> <span class="n">reflection</span><span class="p">)</span>
     <span class="n">protected</span> <span class="n">InterceptedService</span> <span class="n">intercepted</span><span class="p">;</span>

     <span class="n">public</span> <span class="n">void</span> <span class="n">doWork</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">intercepted</span><span class="p">.</span><span class="n">doWork</span><span class="p">();</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>


<h2 id="adapterservice">@AdapterService</h2>
<p>Adapters, like with <em>@AspectService</em>, are used to "extend" existing services, 
and can publish different services based on the existing one. An example 
would be implementing a management interface for an existing service, 
etc .... When you annotate an adapter class with the <em>@AdapterService</em> 
annotation, it will be applied to any service that matches the implemented 
interface and filter. The adapter will be registered with the specified 
interface and existing properties from the original service plus any extra
properties you supply here. If you declare the original service as a member 
it will be injected. </p>
<h3 id="annotation-attributes_2">Annotation attributes:</h3>
<hr />
<p><strong><code>adapteeService</code></strong>  <br />
<em>Required</em>: True  <br />
<em>Default</em>: --</p>
<p>Sets the adaptee service interface this adapter is applying to.</p>
<hr />
<p><strong><code>provides</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: all directly implemented interfaces.</p>
<p>Sets the adapter service interface(s). By default, the directly implemented 
interface(s) is (are) used. </p>
<hr />
<p><strong><code>properties</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: All inherited adaptee service properties.</p>
<p>Sets some additional properties to use with the adapter service registration. 
By default, the adapter will inherit all adaptee service properties.</p>
<hr />
<p><strong><code>adapteeFilter</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Sets the filter condition to use with the adapted service interface.</p>
<hr />
<p><strong><code>factoryMethod</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Sets the static method used to create the adapter service implementation 
instance. By default, the default constructor of the annotated class is used.</p>
<h3 id="usage-example_1">Usage example</h3>
<p>Here, the AdapterService is registered into the OSGI registry each time an AdapteeService is found from the registry. The AdapterImpl class adapts the AdapteeService to the AdapterService. The AdapterService will also have a service property (param=value), and will also include eventual service properties found from the AdapteeService:</p>
<div class="codehilite"><pre> <span class="p">@</span><span class="n">AdapterService</span><span class="p">(</span><span class="n">adapteeService</span> <span class="p">=</span> <span class="n">AdapteeService</span><span class="p">.</span><span class="n">class</span><span class="p">,</span> <span class="k">properties</span><span class="p">={@</span><span class="n">Property</span><span class="p">(</span><span class="n">name</span><span class="p">=</span>&quot;<span class="n">param</span>&quot;<span class="p">,</span> <span class="n">value</span><span class="p">=</span>&quot;<span class="n">value</span>&quot;<span class="p">)})</span>
 <span class="n">class</span> <span class="n">AdapterImpl</span> <span class="n">implements</span> <span class="n">AdapterService</span> <span class="p">{</span>
     <span class="o">//</span> <span class="n">The</span> <span class="n">service</span> <span class="n">we</span> <span class="n">are</span> <span class="n">adapting</span> <span class="p">(</span><span class="n">injected</span> <span class="n">by</span> <span class="n">reflection</span><span class="p">)</span>
     <span class="n">protected</span> <span class="n">AdapteeService</span> <span class="n">adaptee</span><span class="p">;</span>

     <span class="n">public</span> <span class="n">void</span> <span class="n">doWork</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">adaptee</span><span class="p">.</span><span class="n">mehod1</span><span class="p">();</span>
        <span class="n">adaptee</span><span class="p">.</span><span class="n">method2</span><span class="p">();</span>
     <span class="p">}</span>
 <span class="p">}</span>
</pre></div>


<h2 id="bundleadapterservice">@BundleAdapterService</h2>
<p>Bundle adapters are similar to AdapterService, but instead of adapting a 
service, they adapt a bundle with a certain set of states (STARTED|INSTALLED|...), and provide a service on top of it.</p>
<p>The bundle adapter will be applied to any bundle that matches the specified 
bundle state mask and filter conditions, which may match some of the bundle 
OSGi manifest headers. For each matching bundle an adapter will be created 
based on the adapter implementation class. The adapter will be registered 
with the specified interface and with service properties found from the 
original bundle OSGi manifest headers plus any extra properties you supply 
here. If you declare the original bundle as a member it will be injected. </p>
<h3 id="annotation-attributes_3">Annotation attributes:</h3>
<hr />
<p><strong><code>filter</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>The filter used to match some OSGi manifest headers from a given bundle.</p>
<hr />
<p><strong><code>provides</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: all directly implemented interfaces.</p>
<p>The interface(s) to use when registering adapters.
By default, the interface(s) directly implemented by the annotated class is (are) used.</p>
<hr />
<p><strong><code>properties</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Additional properties to use with the service registration.</p>
<hr />
<p><strong><code>stateMask</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: INSTALLED | RESOLVED | ACTIVE</p>
<p>The bundle state mask to apply. The mask is made up of the flags provided by 
the org.osgi.framework.Bundle states 
(UNINSTALLED | INSTALLED | RESOLVED | STARTING | STARTED | ACTIVE).</p>
<hr />
<p><strong><code>propagate</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: true</p>
<p>Specifies if manifest headers from the bundle should be propagated to the 
exposed service properties.</p>
<hr />
<p><strong><code>factoryMethod</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Sets the static method used to create the BundleAdapterService implementation 
instance.</p>
<h3 id="usage-examples">Usage Examples</h3>
<p>In the following example, a "VideoPlayer" Service is registered into the OSGi registry each time an active bundle containing a "Video-Path" manifest header is detected:</p>
<div class="codehilite"><pre><span class="nd">@BundleAdapterService</span><span class="o">(</span><span class="n">filter</span> <span class="o">=</span> <span class="s">&quot;(Video-Path=*)&quot;</span><span class="o">,</span> <span class="n">stateMask</span> <span class="o">=</span> <span class="n">Bundle</span><span class="o">.</span><span class="na">ACTIVE</span><span class="o">,</span> <span class="n">propagate</span><span class="o">=</span><span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VideoPlayerImpl</span> <span class="kd">implements</span> <span class="n">VideoPlayer</span> <span class="o">{</span>
    <span class="n">Bundle</span> <span class="n">bundle</span><span class="o">;</span> <span class="c1">// Injected by reflection</span>

    <span class="kt">void</span> <span class="nf">play</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">URL</span> <span class="n">mpegFile</span> <span class="o">=</span> <span class="n">bundle</span><span class="o">.</span><span class="na">getEntry</span><span class="o">(</span><span class="n">bundle</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;Video-Path&quot;</span><span class="o">));</span>
        <span class="c1">// play the video provided by the bundle ...</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{}</span>
<span class="o">}</span>
</pre></div>


<h2 id="resourceadapterservice">@ResourceAdapterService</h2>
<p>Resource adapters are things that adapt a resource instead of a service, and 
provide an adapter service on top of this resource. Resources are an 
abstraction that is introduced by the dependency manager, represented as a URL. They can be implemented to serve resources embedded in bundles, somewhere on a file system or in an http content repository server, or database.</p>
<p>The adapter will be applied to any resource that matches the specified filter 
condition, which can match some part of the resource URL (with "path", 
"protocol", "port", or "host" filters). For each matching resource an 
adapter will be created based on the adapter implementation class. 
The adapter will be registered with the specified interface and with any 
extra service properties you supply here. Moreover, the following service 
properties will be propagated from the resource URL:</p>
<ul>
<li><em>host</em>: this property exposes the host part of the resource URL</li>
<li><em>path</em>: the resource URL path</li>
<li><em>protocol</em>: the resource URL protocol</li>
<li><em>port</em>: the resource URL port </li>
</ul>
<h3 id="annotation-attributes_4">Annotation attributes</h3>
<p>TBD</p>
<h3 id="usage-examples_1">Usage Examples:</h3>
<p>Here, the "VideoPlayer" service provides a video service on top of any movie 
resources, with service properties "host"/"port"/"protocol"/"path" extracted 
from the resource URL:</p>
<div class="codehilite"><pre><span class="nd">@ResourceAdapterService</span><span class="o">(</span><span class="n">filter</span> <span class="o">=</span> <span class="s">&quot;(&amp;(path=/videos/*.mkv)(host=localhost))&quot;</span><span class="o">,</span> <span class="n">propagate</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VideoPlayerImpl</span> <span class="kd">implements</span> <span class="n">VideoPlayer</span> <span class="o">{</span>
    <span class="c1">// Injected by reflection</span>
    <span class="n">URL</span> <span class="n">resource</span><span class="o">;</span>

    <span class="kt">void</span> <span class="nf">play</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// play video referenced by this.resource     </span>
    <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// stop playing the video</span>
    <span class="kt">void</span> <span class="nf">transcode</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>


<h2 id="factoryconfigurationadapterservice">@FactoryConfigurationAdapterService</h2>
<p>Annotates a class that acts as a Factory Configuration Adapter Service. 
For each new Config Admin factory configuration matching the specified 
factoryPid, an instance of this service will be created. The adapter will be 
registered with the specified interface, and with the specified adapter 
service properties. Depending on the propagate parameter, every public 
factory configuration properties (which don't start with ".") will be 
propagated along with the adapter service properties.</p>
<p>Like in @ConfigurationDependency, you can optionally specify the meta types of 
your configurations for Web Console GUI customization (configuration 
heading/descriptions/default values/etc ...). </p>
<h3 id="annotation-attributes_5">Annotation attributes:</h3>
<hr />
<p><strong><code>provides</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: all directly implemented interfaces.
The interface(s) to use when registering adapters. By default, directly implemented interfaces will be registered in the OSGi registry. </p>
<hr />
<p><strong><code>properties</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Adapter Service properties. Notice that public factory configuration is also 
registered in service properties, (only if propagate is true). 
Public factory configuration properties are those which don't starts with a 
dot (".").</p>
<hr />
<p><strong><code>factoryPid</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: The class name, including the package.</p>
<p>Returns the factory pid whose configurations will instantiate the 
annotated service class. 
(By default, the pid is the service class name). </p>
<hr />
<p><strong><code>updated</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: "updated"</p>
<p>The Update method to invoke (defaulting to "updated"), when a factory 
configuration is created or updated </p>
<hr />
<p><strong><code>propagate</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: false</p>
<p>Returns true if the configuration properties must be published 
along with the service. Any additional service properties specified directly 
are merged with these. </p>
<hr />
<p><strong><code>heading</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>The label used to display the tab name (or section) where the properties are 
displayed. Example: "Printer Service". </p>
<hr />
<p><strong><code>description</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>A human readable description of the PID this annotation is associated with. 
Example: "Configuration for the PrinterService bundle". </p>
<hr />
<p><strong><code>factoryMethod</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Sets the static method used to create the adapter instance.</p>
<hr />
<p><strong><code>metadata</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --
An array of "PropertyMetaData annotations, specifying property types used to 
expose properties in web console</p>
<h3 id="propertymetadata-anotation-attributes">PropertyMetaData anotation attributes:</h3>
<hr />
<p><strong><code>description</code></strong>  <br />
<em>Required</em>: True  <br />
<em>Default</em>: --
Returns the property description. The description may be localized and must 
describe the semantics of this type and any constraints. 
Example: "Select the log level for the Printer Service".</p>
<hr />
<p><strong><code>type</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: String</p>
<p>Return the property primitive type (java.lang.String.class by default). 
If must be either one of the following types:</p>
<ul>
<li>String.class</li>
<li>Long.class</li>
<li>Integer.class</li>
<li>Character.class</li>
<li>Byte.class</li>
<li>Double.class</li>
<li>Float.class</li>
<li>Boolean.class</li>
</ul>
<hr />
<p><strong><code>defaults</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Return a default for this property. The object must be of the appropriate 
type as defined by the cardinality and getType(). The return type is a list of 
String objects that can be converted to the appropriate type. 
The cardinality of the return array must follow the absolute cardinality of
this type. E.g. if the cardinality = 0, the array must contain 1 element. If 
the cardinality is 1, it must contain 0 or 1 elements. If it is -5, it must 
contain from 0 to max 5 elements. Note that the special case of a 0 
cardinality, meaning a single value, does not allow arrays or vectors of 0 
elements. </p>
<hr />
<p><strong><code>cardinality</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Returns the cardinality of this property (0 by default). The OSGi environment
handles multi valued properties in arrays or in Vector objects. 
The return value is defined as follows:</p>
<ul>
<li>x = Integer.MIN_VALUE:  no limit, but use Vector</li>
<li>x &lt; 0: -x = max occurrences, store in Vector</li>
<li>x &gt; 0: x = max occurrences, store in array <a href=""></a></li>
<li>x = Integer.MAX_VALUE: no limit, but use array <a href=""></a></li>
<li>x = 0: 1 occurrence required</li>
</ul>
<hr />
<p><strong><code>required</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: true</p>
<p>Tells if this property is required or not. </p>
<hr />
<p><strong><code>optionLabels</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Return a list of valid option labels for this property. The purpose of this 
method is to allow menus with localized labels. It is associated with the 
<em>optionValues</em> attribute. The labels returned here are ordered in the same 
way as the <em>optionValues</em> attribute values. </p>
<hr />
<p><strong><code>optionValues</code></strong>  <br />
<em>Required</em>: False  <br />
<em>Default</em>: --</p>
<p>Return a list of option values that this property can take. This list must be 
in the same sequence as the <em>optionLabels</em> attribute. </p>
<h3 id="usage-examples_2">Usage Examples</h3>
<p>Here, a "Dictionary" service instance is instantiated for each existing 
factory configuration instances matching the "DictionaryServiceFactory" 
factory pid:</p>
<div class="codehilite"><pre><span class="nd">@FactoryConfigurationAdapterService</span><span class="o">(</span><span class="n">factoryPid</span><span class="o">=</span><span class="s">&quot;DictionaryServiceFactory&quot;</span><span class="o">,</span> <span class="n">updated</span><span class="o">=</span><span class="s">&quot;updated&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DictionaryImpl</span> <span class="kd">implements</span> <span class="n">DictionaryService</span>
<span class="o">{</span>
    <span class="cm">/**</span>
<span class="cm">      * The key of our config admin dictionary language.</span>
<span class="cm">      */</span>
    <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">LANG</span> <span class="o">=</span> <span class="s">&quot;lang&quot;</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">      * The key of our config admin dictionary values.</span>
<span class="cm">      */</span>
    <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">WORDS</span> <span class="o">=</span> <span class="s">&quot;words&quot;</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">      * We store all configured words in a thread-safe data structure, because ConfigAdmin</span>
<span class="cm">      * may invoke our updated method at any time.</span>
<span class="cm">      */</span>
    <span class="kd">private</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m_words</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

    <span class="cm">/**</span>
<span class="cm">      * Our Dictionary language.</span>
<span class="cm">      */</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">m_lang</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updated</span><span class="o">(</span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">m_lang</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">LANG</span><span class="o">);</span>
        <span class="n">m_words</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">words</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">[])</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">WORDS</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">word</span> <span class="o">:</span> <span class="n">words</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">m_words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
        <span class="o">}</span>
     <span class="o">}</span>   
         <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>


<p>Here, this is the same example as above, but using meta types:</p>
<div class="codehilite"><pre><span class="nd">@FactoryConfigurationAdapterService</span><span class="o">(</span>
      <span class="n">factoryPid</span><span class="o">=</span><span class="s">&quot;DictionaryServiceFactory&quot;</span><span class="o">,</span> 
      <span class="n">propagate</span><span class="o">=</span><span class="kc">true</span><span class="o">,</span> 
      <span class="n">updated</span><span class="o">=</span><span class="s">&quot;updated&quot;</span><span class="o">,</span>
      <span class="n">heading</span><span class="o">=</span><span class="s">&quot;Dictionary Services&quot;</span><span class="o">,</span>
      <span class="n">description</span><span class="o">=</span><span class="s">&quot;Declare here some Dictionary instances, allowing to instantiates some DictionaryService services for a given dictionary language&quot;</span><span class="o">,</span>
      <span class="n">metadata</span><span class="o">={</span>
          <span class="nd">@PropertyMetaData</span><span class="o">(</span>
                 <span class="n">heading</span><span class="o">=</span><span class="s">&quot;Dictionary Language&quot;</span><span class="o">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="s">&quot;Declare here the language supported by this dictionary. &quot;</span> <span class="o">+</span>
                     <span class="s">&quot;This property will be propagated with the Dictionary Service properties.&quot;</span><span class="o">,</span>
                 <span class="n">defaults</span><span class="o">={</span><span class="s">&quot;en&quot;</span><span class="o">},</span>
                 <span class="n">id</span><span class="o">=</span><span class="n">DictionaryImpl</span><span class="o">.</span><span class="na">LANG</span><span class="o">,</span>
                 <span class="n">cardinality</span><span class="o">=</span><span class="mi">0</span><span class="o">),</span>
          <span class="nd">@PropertyMetaData</span><span class="o">(</span>
                 <span class="n">heading</span><span class="o">=</span><span class="s">&quot;Dictionary words&quot;</span><span class="o">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="s">&quot;Declare here the list of words supported by this dictionary. This properties starts with a Dot and won&#39;t be propagated with Dictionary OSGi service properties.&quot;</span><span class="o">,</span>
                 <span class="n">defaults</span><span class="o">={</span><span class="s">&quot;hello&quot;</span><span class="o">,</span> <span class="s">&quot;world&quot;</span><span class="o">},</span>
                 <span class="n">id</span><span class="o">=</span><span class="n">DictionaryImpl</span><span class="o">.</span><span class="na">WORDS</span><span class="o">,</span>
                 <span class="n">cardinality</span><span class="o">=</span><span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">)</span>
      <span class="o">}</span>
  <span class="o">)</span>  
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">DictionaryImpl</span> <span class="kd">implements</span> <span class="n">DictionaryService</span>
  <span class="o">{</span>
     <span class="cm">/**</span>
<span class="cm">       * The key of our config admin dictionary language.</span>
<span class="cm">       */</span>
     <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">LANG</span> <span class="o">=</span> <span class="s">&quot;lang&quot;</span><span class="o">;</span>

     <span class="cm">/**</span>
<span class="cm">       * The key of our config admin dictionary values.</span>
<span class="cm">       */</span>
     <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">WORDS</span> <span class="o">=</span> <span class="s">&quot;words&quot;</span><span class="o">;</span>

     <span class="cm">/**</span>
<span class="cm">       * We store all configured words in a thread-safe data structure, because ConfigAdmin</span>
<span class="cm">       * may invoke our updated method at any time.</span>
<span class="cm">       */</span>
     <span class="kd">private</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m_words</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CopyOnWriteArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>

     <span class="cm">/**</span>
<span class="cm">       * Our Dictionary language.</span>
<span class="cm">       */</span>
     <span class="kd">private</span> <span class="n">String</span> <span class="n">m_lang</span><span class="o">;</span>

     <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">updated</span><span class="o">(</span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="o">?&gt;</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
         <span class="n">m_lang</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">LANG</span><span class="o">);</span>
         <span class="n">m_words</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
         <span class="n">String</span><span class="o">[]</span> <span class="n">words</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">[])</span> <span class="n">config</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">WORDS</span><span class="o">);</span>
         <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">word</span> <span class="o">:</span> <span class="n">words</span><span class="o">)</span> <span class="o">{</span>
             <span class="n">m_words</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">word</span><span class="o">);</span>
         <span class="o">}</span>
     <span class="o">}</span>

     <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1525375 by pderop on Sun, 22 Sep 2013 15:19:30 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
