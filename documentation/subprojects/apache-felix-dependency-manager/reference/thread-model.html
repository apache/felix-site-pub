<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dependency Manager - Thread Model :: Apache Felix</title>
    <link rel="canonical" href="https://felix.apache.org/documentation/subprojects/apache-felix-dependency-manager/reference/thread-model.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="icon" href="../../../../_/img/favicon.png" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://felix.apache.org/index.html">
        <span>
          <img src="../../../../_/img/feather.svg">
        </span>
        <span>
          <img src="../../../../_/img/logo.png">
        </span>
        Apache Felix
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://felix.apache.org/index.html">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-dependency-manager.html">Dependency Manager</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-deployment-admin.html">Deployment Admin</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-event-admin.html">Event Admin</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-file-install.html">File Install</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-framework.html">Framework</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-gogo.html">Gogo Shell</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-healthchecks.html">Health Checks</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-inventory.html">Inventory</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-jaas.html">JAAS</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-log.html">Log</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-logback.html">Logback</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-maven-bundle-plugin.html">Maven bundle plugin</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-maven-scr-plugin.html">Maven SCR plugin</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-metatype-service.html">Metatype Service</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-preferences-service.html">Preferences Service</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-remote-shell.html">Remote Shell</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-script-console-plugin.html">Script console plugin</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-shell.html">Lightweight shell</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-shell-tui.html">Shell TUI</a>
            <a class="navbar-item" href="../../../documentation/subprojects/apache-felix-web-console.html">Web Console</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="../../../downloads/currentreleases.html">Downloads</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="documentation" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../../index.html">Documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../documentation.html">Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../downloads.html">Downloads</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../getting-started.html">Getting Started</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../news.html">News</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Community</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../community/project-info.html">Apache Felix Project Info</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../community/contributing.html">Contributing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../community/projects-using-felix.html">Projects Using Felix</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Development</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../development/coding-standards.html">Coding Standards</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../development/dependencies-file-template.html">DEPENDENCIES file template</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../development/provisional-osgi-api-policy.html">Provisional OSGi API Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../development/release-management-nexus.html">Release Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../development/site-how-to.html">Site How To</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../development/using-the-osgi-compliance-tests.html">Using the OSGi Compliance Tests</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../faqs.html">FAQS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faqs/apache-felix-bundle-plugin-faq.html">Apache Felix Bundle Plugin Frequently Asked Questions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../faqs/apache-felix-scr-plugin-faq.html">Apache Felix SCR Plugin Frequently Asked Questions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../subprojects.html">Subprojects</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../apache-felix-dependency-manager.html">Apache Felix Dependency Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/migrating-from-earlier-versions.html">Apache Felix Dependency Manager - Migrating from earlier versions</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/annotations.html">Dependency Manager - Annotations</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/background.html">Dependency Manager - Background</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/bundles-and-dependencies.html">Dependency Manager - Bundles and Dependencies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/design-patterns.html">Dependency Manager - Design Patterns</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/development.html">Dependency Manager - Development</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/history.html">Dependency Manager - History</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/javadocs.html">Dependency Manager - JavaDocs</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/migrating-from-other-solutions.html">Dependency Manager - Migrating from other solutions.</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/performance-tuning.html">Dependency Manager - Performance Tuning</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/resources.html">Dependency Manager - Resource adapters</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/whatsnew.html">Dependency Manager - What&#8217;s new in version 4?</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/dm-lambda.html">Dependency Manager Lambda</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../guides/whatsnew-r15.html">What&#8217;s New in R15</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="component-adapter.html">Dependency Manager - Adapter</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="component-aspect.html">Dependency Manager - Aspect</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="component-bundle-adapter.html">Dependency Manager - Bundle Adapter</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="dependency-bundle.html">Dependency Manager - Bundle Dependency</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="components.html">Dependency Manager - Components</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="dependency-configuration.html">Dependency Manager - Configuration Dependency</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="dependencies.html">Dependency Manager - Dependencies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="external-links.html">Dependency Manager - External Links</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="component-factory-configuration-adapter.html">Dependency Manager - Factory Configuration Adapter Service</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="component-resource-adapter.html">Dependency Manager - Resource Adapter</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="dependency-resource.html">Dependency Manager - Resource Dependency</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="dependency-service.html">Dependency Manager - Service Dependency</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="service-scopes.html">Dependency Manager - Service Scopes</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="component-singleton.html">Dependency Manager - Singleton Component</a>
  </li>
  <li class="nav-item is-current-page" data-depth="4">
    <a class="nav-link" href="thread-model.html">Dependency Manager - Thread Model</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="dm-annotations.html">Dependency Manager Annotations</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/working-with-annotations.html">Dependency Manager - Annotations</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/getting-started.html">Dependency Manager - Getting Started</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/leveraging-the-shell.html">Dependency Manager - Leveraging the shell</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../tutorials/sample-code.html">Dependency Manager sample projects</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-event-admin.html">Apache Felix Event Admin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-file-install.html">Apache Felix File Install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../apache-felix-framework.html">Apache Felix Framework</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-framework/apache-felix-framework-bundle-cache.html">Apache Felix Framework Bundle Cache</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-framework/apache-felix-framework-configuration-properties.html">Apache Felix Framework Configuration Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-framework/apache-felix-framework-faq.html">Apache Felix Framework Frequently Asked Questions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-framework/apache-felix-framework-launching-and-embedding.html">Apache Felix Framework Launching and Embedding</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-framework/apache-felix-framework-usage-documentation.html">Apache Felix Framework Usage Documentation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-framework-security.html">Apache Felix Framework Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../apache-felix-gogo.html">Apache Felix Gogo</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-gogo/rfc-147-overview.html">RFC 147 Overview</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-healthchecks.html">Apache Felix Health Checks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-inventory.html">Apache Felix Inventory Printer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-log.html">Apache Felix Log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-logback.html">Apache Felix Logback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-maven-bundle-plugin-bnd.html">Apache Felix Maven Bundle Plugin (BND)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-metatype-service.html">Apache Felix Metatype Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-osgi-bundle-repository.html">Apache Felix OSGi Bundle Repository (OBR)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-preferences-service.html">Apache Felix Preferences Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-remote-shell.html">Apache Felix Remote Shell</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-shell.html">Apache Felix Shell</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../apache-felix-shell-tui.html">Apache Felix Shell TUI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../apache-felix-web-console.html">Apache Felix Web Console</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-web-console/extending-the-apache-felix-web-console.html">Extending the Apache Felix Web Console</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-web-console/web-console-restful-api.html">Web Console RESTful API</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-web-console/web-console-security-provider.html">Web Console Security Provider</a>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../apache-felix-web-console/extending-the-apache-felix-web-console/branding-the-web-console.html">Branding the Web Console</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../apache-felix-web-console/extending-the-apache-felix-web-console/providing-resources.html">Providing Resources</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../apache-felix-web-console/extending-the-apache-felix-web-console/providing-web-console-plugins.html">Providing Web Console Plugins</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../apache-felix-web-console/extending-the-apache-felix-web-console/web-console-logging.html">Web Console Logging</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../../apache-felix-web-console/extending-the-apache-felix-web-console/web-console-output-templating.html">Web Console Output Templating</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Maven SCR plugin</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-maven-scr-plugin/apache-felix-maven-scr-plugin-use.html">Apache Felix Maven SCR Plugin Use</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-maven-scr-plugin/apache-felix-scr-bndtools-use.html">Apache Felix SCR Annotations BndTools Use</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-maven-scr-plugin/apache-felix-scr-ant-task-use.html">Apache Felix SCR Ant Task Use</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-maven-scr-plugin/extending-scr-annotations.html">Extending SCR Annotations Excerpt: How add new Annotations extending the base Annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-maven-scr-plugin/scr-annotations.html">SCR Annotations Excerpt: Using Java 5 Annotations to describe the component or service.</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../apache-felix-maven-scr-plugin/scr-javadoc-tags.html">SCR JavaDoc Tags Excerpt: Using JavaDoc Tags to describe the component or service.</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../../tutorials-examples-and-presentations.html">Tutorials</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-application-demonstration.html">Apache Felix Application Demonstration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial.html">Apache Felix OSGi Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-faq.html">OSGi Frequently Asked Questions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">OSGI Tutorial</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-1.html">Apache Felix Tutorial Example 1 - Service Event Listener Bundle</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-2.html">Apache Felix Tutorial Example 2</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-2b.html">Apache Felix Tutorial Example 2b</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-3.html">Apache Felix Tutorial Example 3</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-4.html">Apache Felix Tutorial Example 4</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-5.html">Apache Felix Tutorial Example 5</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-6.html">Example 6 - Spell Checker Service Bundle</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-7.html">Example 7 - Spell Checker Client Bundle</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-8.html">Example 8 - Spell Checker Service using Service Binder</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../../tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-9.html">Example 9 - Spell Checker Service using Declarative Services</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../license.html">Apache License 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../../site-map.html">Site map</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Documentation</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Documentation</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../../index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">Documentation</a></li>
    <li><a href="../../../subprojects.html">Subprojects</a></li>
    <li><a href="../../apache-felix-dependency-manager.html">Apache Felix Dependency Manager</a></li>
    <li>Reference</li>
    <li><a href="thread-model.html">Dependency Manager - Thread Model</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/felix-antora-site/edit/main/modules/ROOT/pages/subprojects/apache-felix-dependency-manager/reference/thread-model.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Dependency Manager - Thread Model</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section gives a brief overview of the default thread model used by Dependency Manager, and also explains how to start and handle components concurrently.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_default_thread_model"><a class="anchor" href="#_default_thread_model"></a>Default thread model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, Dependency Manager uses a lock-free/single thread model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When an external event that influence the state of a Component is taking place (for example, when a service dependency on which the Component is depending on is registered in the  registry by a given thread), then DependencyManager does not perform any locking for the handling of the event.
Instead of that, a job that will handle the event is inserted in an internal  lock-free Serial Queue which is internally maintained in each Component.</p>
</li>
<li>
<p>All jobs scheduled in the Serial Queue are then executed in FIFO order, by the first thread which has triggered the first event.
This avoid to use some blocking locks in DM internals, and  also it simplifies the development of DM components, because all lifecycle callbacks (init/start/stop/destroy) and dependency injections are scheduled through the Serial Queue: This means  that your component is not concurrently called in lifecycle callbacks and in dependency injection methods.</p>
</li>
<li>
<p>Now let&#8217;s describe which thread is executing the jobs scheduled in a Component Serial Queue: When a job (J1) is scheduled in the queue while it is empty, then the current thread becomes  the "master" and will immediately execute the Serial Queue tasks (synchronously).
And if another thread triggers another event concurrently while the "master" thread is executing the job J1,  then a job (J2) for this new event is just enqueued in the Serial Queue, but the other thread returns immediately to the caller, and the job J2 will then be executed by the "master" thread  (after J1).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This mechanism allows to serially handle all Component events (service dependencies) in FIFO order without maintaining any locks.</p>
</div>
<div class="paragraph">
<p>The following diagram illustrates the thread model we just described:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../_images/documentation/subprojects/apache-felix-dependency-manager/reference/diagrams/serial-queue.png" alt="Serial Queue" width="600">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_parallelism_with_a_componentexecutorfactory"><a class="anchor" href="#_enabling_parallelism_with_a_componentexecutorfactory"></a>Enabling parallelism with a <em>ComponentExecutorFactory</em></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As described above, all the external events that influence the state of a given component are handed by jobs scheduled in the Serial Queue of the Component, and the jobs are getting  executed serially by a single "master" thread.
So usually, bundles are started from a single thread, meaning that all Components are then activated synchronously.</p>
</div>
<div class="paragraph">
<p>But when you register in the OSGi service registry a ComponentExecutorFactory, that factory will be used by DependencyManager to create an Executor of your choice for each Component,  typically a shared threadpool configured by yourself.
And all the Component Serial Queues will be executed using the Executor returned by the getExecutorFor(Component) method.
However,  jobs scheduled in the Serial Queue of a given Component are still executed one at a time, in FIFO order and the Component remains single threaded, and independent Components may then each  be managed and activated concurrently with respect to each other.</p>
</div>
<div class="paragraph">
<p>Here is a diagram which illustrates all this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../../../_images/documentation/subprojects/apache-felix-dependency-manager/reference/diagrams/concurrent-serial-queue.png" alt="Concurrent Serial Queue" width="600">
</div>
</div>
<div class="paragraph">
<p>If you want to ensure that all Components are initialized after the ComponentExecutorFactory is registered in the OSGI registry, you can use the "org.apache.felix.dependencymanager.parallel"  OSGi system property which specifies the list of components which must wait for the ComponentExecutorFactory service.
This property value can be set to a wildcard ("*"), or a list of  components implementation class prefixes (comma separated).
So, all components whose class name starts with the specified prefixes will be cached until the ComponentExecutorFactory service  is registered (In this way, it is not necessary to use the StartLevel service if you want to ensure that all components are started concurrently).</p>
</div>
<div class="paragraph">
<p>Some class name prefixes can also be negated (using "!"), in order to exclude some components from the list of components using the ComponentExecutorFactory service.</p>
</div>
<div class="paragraph">
<p>Notice that if the ComponentExecutorFactory itself and all its dependent services are defined using the Dependency Manager API, then you have to list the package of such components with a  "!" prefix, in order to indicate that those components must not wait for a ComponentExecutorFactory service (since they are part of the ComponentExecutorFactory implementation !).</p>
</div>
<div class="sect2">
<h3 id="_examples_usage_of_the_org_apache_felix_dependencymanager_parallel_property"><a class="anchor" href="#_examples_usage_of_the_org_apache_felix_dependencymanager_parallel_property"></a>Examples usage of the <em>org.apache.felix.dependencymanager.parallel</em> property:</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">org.apache.felix.dependencymanager.parallel=*
     -&gt; means all components must be cached until a ComponentExecutorFactory comes up.

org.apache.felix.dependencymanager.parallel=foo.bar, foo.zoo
     -&gt; means only components whose implementation class names are starting with "foo.bar" or "foo.zoo"
     must be handled using an Executor returned by the ComponentExecutorFactory service. Other Components
     will be handled normally, as when there is no ComponentExecutorFactory available.

org.apache.felix.dependencymanager.parallel=!foo.threadpool, *
     -&gt; means all components must be delayed until the ComponentExecutorFactory comes up, except the
     components whose implementations class names are starting with "foo.threadpool" prefix).</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_examples_of_a_componentexecutorfactory_that_provides_a_shared_threadpool"><a class="anchor" href="#_examples_of_a_componentexecutorfactory_that_provides_a_shared_threadpool"></a>Examples of a ComponentExecutorFactory that provides a shared threadpool:</h3>
<div class="paragraph">
<p>First, we define the OSGi bundle context system property to enable parallelism for all DM Components excepts the one which declares the ComponentExecutorFactory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"> org.apache.felix.dependencymanager.parallel=!com.acme.management.threadpool, *</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, here is the Activator which declares the ComponentExecutorFactory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.acme.management.threadpool;
import org.apache.felix.dm.*;

public class Activator extends DependencyActivatorBase {
   public void init(BundleContext context, DependencyManager mgr) throws Exception {
      mgr.add(createComponent()
         .setInterface(ComponentExecutorFactory.class.getName(), null)
         .setImplementation(ComponentExecutorFactoryImpl.class)
         .add(createConfigurationDependency()
              .setPid("com.acme.management.threadpool.ComponentExecutorFactoryImpl")));
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the implementation for our ComponentExecutorFactory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">   package com.acme.management.threadpool;
   import org.apache.felix.dm.ComponentExecutorFactory;

   public class ComponentExecutorFactoryImpl implements ComponentExecutorFactory {
      volatile Executor sharedThreadPool;

      void updated(Dictionary conf) {
          int size = Integer.parseInt((String) conf.get("threadpool.size"));
          sharedThreadPool = Executors.newFixedThreadPool(size);
      }

      @Override
      public Executor getExecutorFor(Component component) {
          return sharedThreadPool; // Use a shared threadpool for all Components
      }
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will find a live example in the source distribution <a href="https://svn.apache.org/repos/asf/felix/trunk/dependencymanager/org.apache.felix.dependencymanager.samples/">sample codes</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://svn.apache.org/repos/asf/felix/trunk/dependencymanager/org.apache.felix.dependencymanager.samples/bnd.bnd">see the bnd.bnd</a> which configures the org.apache.felix.dependencymanager.parallel in the <em>-runproperties</em> option.</p>
</li>
<li>
<p><a href="https://svn.apache.org/repos/asf/felix/trunk/dependencymanager/org.apache.felix.dependencymanager.samples/src/org/apache/felix/dependencymanager/samples/tpool/">see the executor factory</a> sample code and README file to up-to-date informations.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>Content licensed under AL2. UI licensed under MPL-2.0 with extensions licensed under AL2</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
