<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Web Console Output Templating</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>    </p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-web-console.html">Apache Felix Web Console</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-web-console/extending-the-apache-felix-web-console.html">Extending the Apache Felix Web Console</a>
      </div>

      
      <div class="tip">
           This page is a translated version of <a href="/site/web-console-output-templating.html" target="felix_cwiki">/site/web-console-output-templating.html</a>. In case of
           doubt you might want to refer to the old page.
      </div>
      
      
      <h1>Web Console Output Templating</h1>
      <p>Templating and Internationalization support of the Web Console is based on Java Resource Bundles loaded from the plugin bundles and is transparent to the plugin itself.</p>
<h2 id="basic-mechanism">Basic Mechanism</h2>
<p>All requests handled by web console plugins are wrapped by response wrapper, which installs a Writer filter if the response is a <code>text/html</code> response. This writer filter recognizes variables of the pattern <code>$&amp;#123;name&amp;#125;</code> and tries to replace that part of the output with another string:</p>
<div class="codehilite"><pre><span class="o">*</span> <span class="n">If</span> <span class="n">a</span> <span class="n">variable</span> <span class="n">of</span> <span class="n">that</span> <span class="n">name</span> <span class="n">exists</span><span class="p">,</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">that</span> <span class="n">variable</span> <span class="n">is</span> <span class="n">used</span><span class="p">.</span> <span class="n">See</span> <span class="n">Variable</span> <span class="n">Resolution</span> <span class="n">below</span><span class="p">.</span>
<span class="o">*</span> <span class="n">Otherwise</span> <span class="k">if</span> <span class="n">a</span> <span class="n">resource</span> <span class="n">bundle</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">translated</span> <span class="n">string</span> <span class="k">for</span> <span class="n">the</span> <span class="n">name</span><span class="p">,</span> <span class="n">that</span> <span class="n">string</span> <span class="n">is</span> <span class="n">used</span><span class="p">.</span> <span class="n">See</span> <span class="n">Resource</span> <span class="n">Bundles</span> <span class="n">below</span><span class="p">.</span>
<span class="o">*</span> <span class="n">Otherwise</span> <span class="n">the</span> <span class="n">name</span> <span class="n">itself</span> <span class="n">is</span> <span class="n">just</span> <span class="n">placed</span> <span class="n">in</span> <span class="n">the</span> <span class="n">output</span><span class="p">.</span>
</pre></div>


<h3 id="example">Example</h3>
<p>Consider the plugin bundle provides a localization for the default german locale <code>de</code>:</p>
<p>{panel:title=OSGI-INF/l10n/bundle_de.properties}
Hello = Guten Tag
{panel}</p>
<p>And the plugin defines a variable replacement and writes output with the following code:</p>
<div class="codehilite"><pre>WebConsoleUtil.getVariableResolver().put(&quot;world&quot;, &quot;Schweiz&quot;);
response.getWriter().println(&quot;<span class="cp">${</span><span class="n">Hello</span><span class="cp">}</span> <span class="cp">${</span><span class="n">world</span><span class="cp">}</span>&quot;);
</pre></div>


<p>The response sent to the client whose primary locale is <code>de</code> is then filtered to be:</p>
<div class="codehilite"><pre><span class="n">Guten</span> <span class="n">Tag</span> <span class="n">Schweiz</span>
</pre></div>


<h2 id="variable-resolution">Variable Resolution</h2>
<p>Variable Resolution is based on a <code>org.apache.felix.webconsole.VariableResolver</code> object provided as a request attribute prior to calling the <code>ServletResponse.getWriter()</code> method. If no such resolver is provided in the request, an instance of the <code>org.apache.felix.webconsole.DefaultVariableResolver</code> is used and stored in the request. Replacing the <code>VariableResolver</code> after the <code>getWriter()</code> has been called has no effect for variable resolution. Variables may be added to the <code>VariableResolver</code> even after the <code>getWriter()</code> method has been called.</p>
<h2 id="resource-bundles">Resource Bundles</h2>
<p>Resources for the Resource Bundles is provided by the Web Console bundle on the one hand and by the bundle providing the plugin on the other hand. Resources are identified inside a bundle with the <code>Bundle-Localization</code> manifest header as described in Section 3.10 Localization in the Core Specification.</p>
<p>This also means, that additional translations may be provided by fragment bundles.</p>
<p>During request processing the <code>Locale</code> of the request (<code>ServletRequest.getLocale()</code>) is used to identify the actual resources to use. From this information a <code>ResourceBundle</code> is constructed from a collection of the resources provided by the plugin bundle and the resources provided by the Web Console.</p>
<h3 id="web-console-localization">Web Console Localization</h3>
<p>The Web Console contains a single localization file <code>OSGI-INF/l10n/bundle.properties</code>. Fragments attached to the Web Console bundle may provide translations for these resources. All plugins of the Web Console itself will use a ReosurceBundle, which is only based on the localization of the Web Console itself.</p>
<h2 id="using-templating">Using Templating</h2>
<p>To use the described templating, the plugin developer may provide the following:</p>
<ol>
<li>Use templated strings in the generated response. Such templated strings will be replaced with variable values or localization strings as available.</li>
<li>Set variable mappings in a <code>VariableResolver</code>. The simplest thing is to get a default <code>VariableResolver</code> calling the <code>WebConsoleUtil.getVariableResolver(ServletRequest)</code> method.</li>
<li>Provide localization files and optionally set the <code>Bundle-Localization</code> header if the base file name is not the default <code>OSGI-INF/l10n/bundle</code>.</li>
</ol>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1422427 by fmeschbe on Sun, 16 Dec 2012 00:36:51 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
