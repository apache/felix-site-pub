<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Apache Felix Framework and Google Android</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>  <br />
</p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-framework.html">Apache Felix Framework</a>
      </div>

      
      <div class="tip">
           This page is a translated version of <a href="/site/apache-felix-framework-and-google-android.html" target="felix_cwiki">/site/apache-felix-framework-and-google-android.html</a>. In case of
           doubt you might want to refer to the old page.
      </div>
      
      
      <h1>Apache Felix Framework and Google Android</h1>
      <h1 id="apache-felix-framework-and-google-android">Apache Felix Framework and Google Android</h1>
<p>The purpose of this document is to explain how to use <a href="http://felix.apache.org">Apache Felix</a> on Google's new mobile phone platform - [Android|http://code.google.com/android].</p>
<h2 id="dalvik-vm">Dalvik VM</h2>
<p>Google Android SDK allows developers to write Java code in order to create Android applications. Instead of a regular Java Virtual Machine that executes this code, a special-purpose virtual machine named Dalvik is being used in order to comply with mobile platform requirements. Dalvik does not use Java bytecode format, but, a tool named dx, included in the Android SDK, transforms the Java class files of Java classes compiled by a regular Java compiler into another class file format (the .dex format) (the conversion is not done at runtime).</p>
<h2 id="preparing-bundles">Preparing bundles</h2>
<p>Although Felix, since version 1.0.3, has built in support for Android, there are still some things needed to be done in order to successfully make use of it ( you will need to install <a href="http://code.google.com/android/download.html">Android SDK</a> and you should have <android*SDK*HOME>/tools added to system PATH variable). The zip file available for download has been created in the same manner.</p>
<p><em>Step 1</em>: Each JAR file you use, either as a Felix library or as a bundle, should contain its DEX equivalent. This means that you must first create a DEX file for your JAR:</p>
<div class="codehilite"><pre><span class="n">dx</span> <span class="o">--</span><span class="n">dex</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">classes</span><span class="o">.</span><span class="n">dex</span> <span class="n">JAR_file</span><span class="o">.</span><span class="n">jar</span>
</pre></div>


<p>Then you must add the DEX file to your JAR file:</p>
<div class="codehilite"><pre><span class="n">aapt</span> <span class="n">add</span> <span class="n">JAR_file</span><span class="o">.</span><span class="n">jar</span> <span class="n">classes</span><span class="o">.</span><span class="n">dex</span>
</pre></div>


<p><em>Step 2</em>: The processed JARs should be made available to Android by transferring them to the emulator:</p>
<div class="codehilite"><pre><span class="n">emulator</span> <span class="o">&amp;</span>
<span class="n">adb</span> <span class="nb">push</span> <span class="n">JAR_file</span><span class="o">.</span><span class="n">jar</span> <span class="n">path_emulator</span><span class="o">/</span><span class="n">JAR_file</span><span class="o">.</span><span class="n">jar</span>
</pre></div>


<p><em>Step 3</em>: Referring to the sample project for a concrete example, these steps are preformed:</p>
<div class="codehilite"><pre><span class="n">osgi</span><span class="o">-</span><span class="n">android:</span> <span class="o">/</span>
<span class="o">\-</span> <span class="n">bin</span>
<span class="o">\-</span> <span class="n">bundle</span>
<span class="o">\-</span> <span class="n">conf</span>
<span class="o">\-</span> <span class="n">felix</span><span class="o">.</span><span class="n">sh</span>
</pre></div>


<p>Prepare the Felix JAR:</p>
<div class="codehilite"><pre><span class="n">export</span> <span class="n">PATH</span><span class="o">=</span><span class="sr">&lt;path-to-android&gt;</span><span class="o">/</span><span class="n">tools:</span><span class="nv">$PATH</span>
<span class="n">cd</span> <span class="n">bin</span>
<span class="n">dx</span> <span class="o">--</span><span class="n">dex</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">classes</span><span class="o">.</span><span class="n">dex</span> <span class="n">felix</span><span class="o">.</span><span class="n">jar</span>
<span class="n">aapt</span> <span class="n">add</span> <span class="n">felix</span><span class="o">.</span><span class="n">jar</span> <span class="n">classes</span><span class="o">.</span><span class="n">dex</span>
</pre></div>


<p>Prepare the bundle JARS:</p>
<div class="codehilite"><pre><span class="n">cd</span> <span class="n">bundle</span>
<span class="n">dx</span> <span class="o">--</span><span class="n">dex</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">classes</span><span class="o">.</span><span class="n">dex</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="o">.</span><span class="n">shell</span><span class="o">-</span><span class="mf">1.0.0</span><span class="o">.</span><span class="n">jar</span>
<span class="n">aapt</span> <span class="n">add</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="o">.</span><span class="n">shell</span><span class="o">-</span><span class="mf">1.0.0</span><span class="o">.</span><span class="n">jar</span> <span class="n">classes</span><span class="o">.</span><span class="n">dex</span>
<span class="n">dx</span> <span class="o">--</span><span class="n">dex</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">classes</span><span class="o">.</span><span class="n">dex</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">tui</span><span class="o">-</span><span class="mf">1.0.0</span><span class="o">.</span><span class="n">jar</span>
<span class="n">aapt</span> <span class="n">add</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">tui</span><span class="o">-</span><span class="mf">1.0.0</span><span class="o">.</span><span class="n">jar</span> <span class="n">classes</span><span class="o">.</span><span class="n">dex</span>
<span class="n">dx</span> <span class="o">--</span><span class="n">dex</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">classes</span><span class="o">.</span><span class="n">dex</span> <span class="n">EnglishDictionary</span><span class="o">.</span><span class="n">jar</span>
<span class="n">aapt</span> <span class="n">add</span> <span class="n">EnglishDictionary</span><span class="o">.</span><span class="n">jar</span> <span class="n">classes</span><span class="o">.</span><span class="n">dex</span>
<span class="n">dx</span> <span class="o">--</span><span class="n">dex</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">classes</span><span class="o">.</span><span class="n">dex</span> <span class="n">FrenchDictionary</span><span class="o">.</span><span class="n">jar</span>
<span class="n">aapt</span> <span class="n">add</span> <span class="n">FrenchDictionary</span><span class="o">.</span><span class="n">jar</span> <span class="n">classes</span><span class="o">.</span><span class="n">dex</span>
<span class="n">dx</span> <span class="o">--</span><span class="n">dex</span> <span class="o">--</span><span class="n">output</span><span class="o">=</span><span class="n">classes</span><span class="o">.</span><span class="n">dex</span> <span class="n">SpellChecker</span><span class="o">.</span><span class="n">jar</span>
<span class="n">aapt</span> <span class="n">add</span> <span class="n">SpellChecker</span><span class="o">.</span><span class="n">jar</span> <span class="n">classes</span><span class="o">.</span><span class="n">dex</span>
</pre></div>


<p>Transfer all of them to the emulator (note that you need some kind of unix-like shell, such as the Mac OS X terminal or Linux):</p>
<div class="codehilite"><pre><span class="n">cd</span> <span class="n">osgi</span><span class="o">-</span><span class="n">android</span>
<span class="n">emulator</span> <span class="o">&amp;</span>
<span class="n">find</span> <span class="o">*</span> <span class="o">-</span><span class="n">type</span> <span class="n">f</span> <span class="o">-</span><span class="nb">exec</span> <span class="n">adb</span> <span class="nb">push</span> <span class="p">{}</span> <span class="sr">/data/</span><span class="n">felix</span><span class="o">/</span><span class="p">{}</span> <span class="o">\</span><span class="p">;</span>
</pre></div>


<h2 id="launching-felix">Launching Felix</h2>
<p>Once you've done that, you should be able to launch Felix and the bundles on Android: start emulator shell, change directory to the location of your Felix files and execute felix.sh.</p>
<div class="codehilite"><pre><span class="n">adb</span> <span class="n">shell</span>
<span class="n">cd</span> <span class="sr">/data/</span><span class="n">felix</span>
<span class="n">sh</span> <span class="n">felix</span><span class="o">.</span><span class="n">sh</span>
</pre></div>


<p><code>felix.sh</code> contains a Unix shell command that launches Felix main class using the actual runtime of the emulator.</p>
<div class="codehilite"><pre><span class="sr">/system/</span><span class="n">bin</span><span class="sr">/dalvikvm -Xbootclasspath:/s</span><span class="n">ystem</span><span class="sr">/framework/co</span><span class="n">re</span><span class="o">.</span><span class="n">jar</span> <span class="o">\</span>
  <span class="o">-</span><span class="n">classpath</span> <span class="n">bin</span><span class="o">/</span><span class="n">felix</span><span class="o">.</span><span class="n">jar</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">Main</span>
</pre></div>


<p>If all went well, you should see the Felix command line shell now. Type "help" for further instructions.</p>
<p>You may now install and launch EnglishDictionary, FrenchDictionary, and SpellChecker bundles to test how Felix is working. These are all examples from the Apache Felix OSGi tutorial and correspond to <a href="/documentation/tutorials-examples-and-presentations/apache-felix-osgi-tutorial/apache-felix-tutorial-example-2.html">Apache Felix Tutorial Example 2</a>, [Apache Felix Tutorial Example 2b], and [Apache Felix Tutorial Example 5] respectively.</p>
<div class="codehilite"><pre><span class="o">*</span> <span class="o">*</span><span class="n">EnglishDictionary</span><span class="o">*</span> <span class="o">-</span> <span class="n">supplies</span> <span class="n">a</span> <span class="n">Dictionary</span> <span class="n">service</span> <span class="n">implementation</span> <span class="n">with</span> <span class="n">the</span> <span class="n">following</span> <span class="n">collection</span> <span class="n">of</span> <span class="n">words</span> <span class="s">&quot;welcome&quot;</span><span class="p">,</span> <span class="s">&quot;to&quot;</span><span class="p">,</span> <span class="s">&quot;the&quot;</span><span class="p">,</span> <span class="s">&quot;osgi&quot;</span><span class="p">,</span> <span class="s">&quot;tutorial&quot;</span>
<span class="o">*</span> <span class="o">*</span><span class="n">FrenchDictionary</span><span class="o">*</span> <span class="o">-</span> <span class="n">supplies</span> <span class="n">a</span> <span class="n">Dictionary</span> <span class="n">service</span> <span class="n">implementation</span> <span class="n">with</span> <span class="n">the</span> <span class="n">following</span> <span class="n">collection</span> <span class="n">of</span> <span class="n">words</span> <span class="s">&quot;bienvenue&quot;</span><span class="p">,</span> <span class="s">&quot;au&quot;</span><span class="p">,</span> <span class="s">&quot;tutoriel&quot;</span><span class="p">,</span> <span class="s">&quot;osgi&quot;</span>
<span class="o">*</span> <span class="o">*</span><span class="n">SpellChecker</span><span class="o">*</span> <span class="o">-</span> <span class="n">supplies</span> <span class="n">a</span> <span class="n">spell</span> <span class="n">checker</span> <span class="n">that</span> <span class="n">retrieves</span> <span class="n">the</span> <span class="n">first</span> <span class="n">Dictionary</span> <span class="n">implementation</span> <span class="n">it</span> <span class="n">finds</span> <span class="ow">and</span> <span class="n">checks</span> <span class="k">if</span> <span class="n">the</span> <span class="n">word</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">entered</span> <span class="n">is</span> <span class="n">in</span> <span class="n">the</span> <span class="n">dictionary</span> <span class="ow">or</span> <span class="ow">not</span><span class="o">.</span>

<span class="n">start</span> <span class="n">file:bundle</span><span class="o">/</span><span class="n">EnglishDictionary</span><span class="o">.</span><span class="n">jar</span>
<span class="n">start</span> <span class="n">file:bundle</span><span class="o">/</span><span class="n">FrenchDictionary</span><span class="o">.</span><span class="n">jar</span>
<span class="n">start</span> <span class="n">file:bundle</span><span class="o">/</span><span class="n">SpellChecker</span><span class="o">.</span><span class="n">jar</span>
</pre></div>


<h2 id="embedding-felix">Embedding Felix</h2>
<p>Apache Felix can also be integrated with an Android application. To achieve this, you need to embed Felix into <code>onCreate()</code> method of your Activity class (see Android docs for more details on how to use an Activity) and process your bundles as shown above.</p>
<h2 id="download">Download</h2>
<p>The project zip file <a href="">osgi-android.zip</a></p>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1422427 by fmeschbe on Sun, 16 Dec 2012 00:36:51 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
