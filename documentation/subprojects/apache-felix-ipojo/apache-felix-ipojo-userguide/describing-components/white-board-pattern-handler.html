<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<head>
    <title>Apache Felix - White Board Pattern Handler</title>
    <link rel="icon" href="/res/favicon.ico">
    
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The most powerful component model for OSGi">

    
    <link href="/ipojo/web/bootstrap/css/bootstrap-cerulean.css" rel="stylesheet">
    <link href="/ipojo/web/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/ipojo/web/bootstrap/css/font-awesome.min.css" rel="stylesheet">
    <link href="/ipojo/web/style.css" rel="stylesheet">


    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/ipojo/web/bootstrap/js/bootstrap.min.js"></script>
    
</head>

<body data-spy="scroll" data-target=".subnav">
    <div class="navbar navbar-fixed-top navbar-inverse">
        <div class="navbar-inner">
            <div class="container">
               <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                 <span class="icon-bar"></span>
                 <span class="icon-bar"></span>
                 <span class="icon-bar"></span>
                </a>
                <a class="brand" href="/documentation/subprojects/apache-felix-ipojo.html">Apache Felix iPOJO</a>
         
                 <div class="nav-collapse" id="main-menu">
                    <ul class="nav" id="main-menu-left">
                        <li><a href="/documentation/subprojects/apache-felix-ipojo/ipojo-news.html">News</a></li>
                        <li><a href="http://felix.apache.org/downloads.cgi">Downloads</a></li>
                    
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Tutorials <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="tutorials-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-why-choose-ipojo.html">Why choose iPOJO</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-successstories.html">Success stories</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-feature-overview.html">Features</a></li>
                                <li class="divider"></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-in-10-minutes.html">iPOJO in 10 minutes</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/how-to-use-ipojo-annotations.html">Using Annotations</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-hello-word-maven-based-tutorial.html">Maven tutorial</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-advanced-tutorial.html ">Advanced tutorial</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/apache-felix-ipojo-dosgi.html">Using Distributed OSGi</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-composition-tutorial.html">Application Composition</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="user-guide-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/service-requirement-handler.html">Requiring a service</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/providing-osgi-services.html">Providing a service</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/lifecycle-callback-handler.html">Lifecycle management</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/configuration-handler.html">Configuration</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/architecture-handler.html">Introspection</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/controller-lifecycle-handler.html">Impacting the lifecycle</a></li>
                                <li class="divider"></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">External <em>handlers</em></a>
                                    <ul class="dropdown-menu">
                                        <li><a href="">Asynchronous communication</a></li>
                                        <li><a href="">JMX management</a></li>
                                        <li><a href="">Extender pattern</a></li>
                                        <li><a href="">Whiteboard pattern</a></li>
                                        <li><a href="">Temporal dependencies</a></li>
                                    </ul>
                                </li>                                            
                                <li class="divider"></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Advanced topics</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="">iPOJO and config admin</a></li>
                                        <li><a href="">Factories and Instances</a></li>
                                        <li><a href="">XML Schemas</a></li>
                                        <li><a href="">API</a></li>
                                        <li><a href="">Testing components</a></li>
                                        <li><a href="">Eclipse Integration</a></li>
                                        <li><a href="">FAQ</a></li>
                                        <li><a href="">Reference Card</a></li>
                                        <li class="divider"></li>
                                        <li><a href="">Handler development</a></li>
                                        <li><a href="">Manipulation Metadata </a></li>
                                        <li><a href="">Dive into the iPOJO Manipulation depths</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown" id="tools-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Tools <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="">Ant Task</a></li>
                                <li><a href="">Eclipse Plugin</a></li>
                                <li><a href="">Maven Plugin</a></li>
                                <li><a href="">`arch` shell command</a></li>
                                <li><a href="">Online Manipulator</a></li>
                                <li><a href="">Webconsole plugin</a></li>
                            </ul>
                        </li>

                        <li class="dropdown" id="community-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="">Support</a></li>
                                <li><a href="http://www.apache.org/">ASF</a></li>
                                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                <li><a href="http://www.apache.org/foundation/thanks.html">Sponsors</a></li>
                            </ul>
                        </li>

                        <li class="dropdown" id="misc-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Misc <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-supportedvms.html">Supported JVMs</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-supportedosgi.html">Supported OSGi Implementations</a></li>
                                <li><a href="">Article & Presentations</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav pull-right" id="main-menu-right">
                        <li><a rel="tooltip" target="_blank" href="http://felix.apache.org">Apache Felix <i class="icon-share-alt"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>    
    </div>

    <div class="container">
        <div class="content">
            <h1 id="the-white-board-pattern-handler">The white board pattern handler</h1>
<p>The objective of this handler is to simplify the development of white-board architecture. This architecture-style is based is very close to the extender architecture style but relies on services instead of bundles.</p>
<p>{div:class=toc}
[TOC]
{div}</p>
<div class="info" markdown="1">
**Change in the 1.2.0**
The 1.2.0 uses the namespace `org.apache.felix.ipojo.whiteboard` instead of `org.apache.felix.ipojo.white-board-pattern`
</div>

<div class="info" markdown="1">
** Change in the 1.7.0**
The 1.7.0 has introduced a new annotations allowing to declare several whiteboard patterns in the same class. The ``@Whiteboards}} annotation is not available in previous version.
</div>

<h2 id="the-whiteboard-pattern">The whiteboard pattern</h2>
<p>A whiteboard is based on two different roles:
<em> A consumer looking to special services or a services published with a special mark
</em> Looked services</p>
<p>More information on this pattern is available in this <a href="http://www.osgi.org/wiki/uploads/Links/whiteboard.pdf">document</a>
Implementing a white board pattern could be complex as the extender needs to track these services dynamically. Indeed looked services can be highly dynamic; they can arrive, leave or be modified at runtime. Several services specified in the OSGi specification use white board pattern such as the Device Access Manager.</p>
<h2 id="using-the-handler">Using the handler</h2>
<p>First of all, you need to configure the component type to use the handler such as:</p>
<div class="codehilite"><pre><span class="nt">&lt;ipojo</span> <span class="na">xmlns:wbp=</span><span class="s">&quot;org.apache.felix.ipojo.whiteboard&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;component</span> 
          <span class="na">className=</span><span class="s">&quot;org.apache.felix.ipojo.test.FooWhiteBoardPattern&quot;</span>
      <span class="nt">&gt;</span>
        <span class="nt">&lt;wbp:wbp</span> 
          <span class="na">filter=</span><span class="s">&quot;(my.property=1)&quot;</span> 
              <span class="na">onArrival=</span><span class="s">&quot;onArrival&quot;</span> 
              <span class="na">onDeparture=</span><span class="s">&quot;onDeparture&quot;</span> 
              <span class="na">onModification=</span><span class="s">&quot;onModification&quot;</span>
         <span class="nt">/&gt;</span>

      <span class="nt">&lt;/component&gt;</span>
</pre></div>


<p>Notice that, this handler is an external handler. So, it uses the "org.apache.felix.ipojo.whiteboard" namespace.
Once described, you can implement your component. The methods specified methods will be called when a matching services arrives or leaves or are modified. The modification callback is optional. A matching service is detected by confronting the service reference against the specified filter.
The filter can target specific service interface (with the objectclass property) or property values.
In the previous example, these methods could be: </p>
<div class="codehilite"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">FooWhiteBoardPattern</span> <span class="p">{</span>
    <span class="n">List</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">();</span>
    <span class="nb">int</span> <span class="n">modifications</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    
    <span class="n">public</span> <span class="n">synchronized</span> <span class="n">void</span> <span class="n">onArrival</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">ref</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="n">public</span> <span class="n">synchronized</span> <span class="n">void</span> <span class="n">onDeparture</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">ref</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="n">public</span> <span class="n">synchronized</span> <span class="n">void</span> <span class="n">onModification</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="sr">//</span> <span class="o">...</span>
    <span class="p">}</span>
</pre></div>


<p>All methods received the arriving, leaving or modified service reference.</p>
<p>You can also use annotation to declare the same component:</p>
<div class="codehilite"><pre><span class="nv">@Component</span>
<span class="nv">@Wbp</span><span class="p">(</span>
  <span class="n">filter</span><span class="o">=</span><span class="s">&quot;my.property=1&quot;</span><span class="p">,</span> 
  <span class="n">onArrival</span><span class="o">=</span><span class="s">&quot;onArrival&quot;</span> 
  <span class="n">onDeparture</span><span class="o">=</span><span class="s">&quot;onDeparture&quot;</span> 
  <span class="n">onModification</span><span class="o">=</span><span class="s">&quot;onModification&quot;</span><span class="p">)</span>
<span class="n">public</span> <span class="n">class</span> <span class="n">FooWhiteBoardPattern</span> <span class="p">{</span>
    <span class="n">List</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">();</span>

    <span class="n">public</span> <span class="n">synchronized</span> <span class="n">void</span> <span class="n">onArrival</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">ref</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="n">public</span> <span class="n">synchronized</span> <span class="n">void</span> <span class="n">onDeparture</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">ref</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="n">public</span> <span class="n">synchronized</span> <span class="n">void</span> <span class="n">onModification</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
       <span class="sr">//</span><span class="o">...</span>
    <span class="p">}</span>
</pre></div>


<h2 id="configuration">Configuration</h2>
<p>The handler has only three mandatory attributes:
<em> Filter: filter use to discover matching filter.
</em> onArrival: declaring the method to invoke when a matching service arrives
* onDeparture: declaring the method to invoke when a matching service leaves</p>
<p>The onModification attribute is optional. This method is called when an injected service reference is modified but stills valid against the filter.
<div class="note" markdown="1">
<strong>Notifications</strong>
The implementation will be notified of arrivals, modifications and departures, despite the instance is invalid. Indeed, the implementation must release all objects created from another bundle as soon it leaves.
</div></p>
<h2 id="configuring-the-handler-with-annotations">Configuring the handler with annotations</h2>
<p>It is possible to configure the handler with a simple annotation available in the annotation pack ('annotation' project in the iPOJO trunk). Here is an example of usage:
{code:java}
import org.apache.felix.ipojo.annotations.Component;
import org.osgi.framework.ServiceReference;</p>
<p>@Component
@org.apache.felix.ipojo.whiteboard.Wbp(filter="(foo=true)", 
        onArrival="onArrival", 
        onDeparture="onDeparture",
        onModification="onModification")
public class WhiteBoardExemple {</p>
<div class="codehilite"><pre><span class="n">public</span> <span class="n">void</span> <span class="n">onArrival</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
    <span class="sr">//</span> <span class="k">do</span> <span class="n">something</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">void</span> <span class="n">onDeparture</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
    <span class="sr">//</span> <span class="k">do</span> <span class="n">something</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">void</span> <span class="n">onModification</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
    <span class="sr">//</span> <span class="k">do</span> <span class="n">something</span>
<span class="p">}</span>
</pre></div>


<p>}</p>
<div class="codehilite"><pre><span class="n">The</span>  <span class="n">attribute</span> <span class="n">is</span> <span class="n">optional</span><span class="o">.</span><span class="n">The</span>  <span class="n">attribute</span> <span class="n">allows</span> <span class="n">setting</span> <span class="n">the</span> <span class="n">service</span> <span class="n">filter</span><span class="o">.</span>

<span class="n">In</span> <span class="n">the</span> <span class="mf">1.7.0</span><span class="p">,</span> <span class="n">a</span> <span class="k">new</span> <span class="n">annotation</span> <span class="n">was</span> <span class="n">introduced</span> <span class="n">to</span> <span class="n">support</span> <span class="n">the</span> <span class="n">declaration</span> <span class="n">of</span> <span class="n">several</span> <span class="n">whiteboard</span> <span class="n">patterns</span> <span class="n">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">component:</span>
</pre></div>


<p>@Component
@Whiteboards(whiteboards={
     @Wbp(filter="(foo=true)", 
        onArrival="onArrival", 
        onDeparture="onDeparture",
        onModification="onModification"),
     @Wbp(filter="(bar=true)", 
        onArrival="onArrival2", 
        onDeparture="onDeparture2")}
)
public class WhiteBoardExemple {</p>
<div class="codehilite"><pre><span class="sr">//</span> <span class="o">...</span>
</pre></div>


<p>}</p>
<h2 id="download">Download</h2>
<p>The handler is available on the <a href="/documentation/subprojects/apache-felix-ipojo/download.html">download</a> page.
Sources are available on the Felix trunk at the following location: <a href="http://svn.apache.org/repos/asf/felix/trunk/ipojo/handler/whiteboard">http://svn.apache.org/repos/asf/felix/trunk/ipojo/handler/whiteboard</a>.</p>
        </div>
    </div>

    <hr/>

    <div class="container">
        <footer id="footer">
            <div class="row">
                <div class="trademarkFooter span7"> 
                Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
                logo are trademarks of The Apache Software Foundation. All other marks mentioned
                may be trademarks or registered trademarks of their respective owners.
                </div>
                <div class="timestamp span3 offset2">
                Rev. 1441864 by fmeschbe on Sun, 3 Feb 2013 06:44:40 +0000
                </div>
            </div>
        </footer>           
    </div>
</body>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript">
    try{
        var pageTracker = _gat._getTracker("UA-1518442-4");
        pageTracker._trackPageview();
    } catch(err) {}
</script>

</html>
