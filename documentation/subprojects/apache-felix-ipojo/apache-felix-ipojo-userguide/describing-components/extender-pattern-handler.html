<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Extender Pattern Handler</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>  <br />
</p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-ipojo.html">Apache Felix iPOJO</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide.html">apache-felix-ipojo-userguide</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components.html">Describing components</a>
      </div>

      
      <div class="tip">
           This page is a translated version of <a href="/site/extender-pattern-handler.html" target="felix_cwiki">/site/extender-pattern-handler.html</a>. In case of
           doubt you might want to refer to the old page.
      </div>
      
      
      <h1>Extender Pattern Handler</h1>
      <p>{include:apache-felix-ipojo-header}</p>
<div class="content">

#  The extender pattern handler
*The objective of this handler is to simplify the development of extender-based architecture. This architecture-style is based on two different entities:*
* *The extender (also called host)* 
* *The extensions*

{div:class=toc}
[TOC]
{div}

## The Extender pattern

This architecture-style is based on two different roles:
* The extender 
* The extension

!extender.png!

The relation is basically a 1..n relation. The extender tracks extensions. The particularity of this architecture-style is that extensions are packaged in different bundles. An extension is detected by analyzing the bundle. Indeed these bundles can have a special mark in their manifest of a special file...
Implementing an extender pattern could be complex as the extender needs to track these marks dynamically. When a bundle starts, it needs to look at the mark. Then a bundle leave, the extender must release all object created from this bundle.
This handler tracks bundle for you based on the specified required mark. At each time a matching bundle appears or disappears, a callback is invoked. The mark is currently a header in the bundle manifest.
Nowadays, a lot of frameworks use this pattern such as iPOJO it-self (to find both bundles containing components and bundles adding a new implementation type), Spring-DM ...

## Using the handler
First of all, you need to configure the component type to use the handler such as:

    <ipojo xmlns:extender="org.apache.felix.ipojo.extender">
        <component
            classname="org.apache.felix.ipojo.extender.MyExtender">

                    <!-- Extender Pattern handler configuration -->
            <extender:extender 
                      extension="My-Extension"
                      onArrival="onBundleArrival" 
                      onDeparture="onBundleDeparture" 
                    />

            <callback transition="invalidate" method="stopping" />
            <callback transition="validate" method="starting" />
            <provides />
        </component>
    </ipojo>

Notice that, this handler is an external handler. So, it uses the "org.apache.felix.ipojo.extender" namespace.
You can also use annotations:

    @Component
    @Extender(
        onArrival="onBundleArrival",
        onDeparture="onBundleDeparture",
        extension="My-Extension")
    public class MyExtender {

        @Validate
        public void starting() {
          // ...
        }

        @Invalidate
        public void stopping {
          // ...
        }

        void onBundleArrival(Bundle bundle, String header) {
                 // Do something
        }

        void onBundleDeparture(Bundle bundle) {
                // Do something
        }
    }

The methods specified methods will be called when a matching bundle arrives or leaves.
In the previous example, these methods could be: 

    void onBundleArrival(Bundle bundle, String header) {
             // Do something
    }

    void onBundleDeparture(Bundle bundle) {
            // Do something
    }

Notice the different signatures of the methods. The arrival method is called with the arriving bundle and the matching header value (i.e. the value of the My-Extension header of the bundle manifest). The departure method just receives the leaving bundle.

## Configuration
The handler has only three mandatory attributes:
* Extension: declaring the looked manifest header.
* onArrival: declaring the method to invoke when a matching bundle arrives
* onDeparture: declaring the method to invoke when a matching bundle leaves

<div class="box">
    <div class="box-yellow-header">
    <div class="box-yellow-title">
        <img src="http://people.apache.org/~clement/ipojo/site/warning.gif"> <b>Called despite being invalid</b>
    </div>
    </div>
    <div class="box-yellow-content">
        The implementation will be notified of arrivals and departures despite the instance is invalid. Indeed, the implementation must release all objects created from another bundle as soon it leaves.
    </div>
    <div class="box-yellow-footer"></div>
</div>

## Download
The handler is available on the [download](/documentation/subprojects/apache-felix-ipojo/download.html) page.
Sources are available on the Felix trunk at the following location: [http://svn.apache.org/repos/asf/felix/trunk/ipojo/handler/extender/](http://svn.apache.org/repos/asf/felix/trunk/ipojo/handler/extender/)

## Configuring the handler with annotations

It is possible to configure the handler with a simple annotation available in the annotation pack ('annotation' project in the iPOJO trunk). Here is an example of usage:
{code:java}
import org.apache.felix.ipojo.annotations.Component;
import org.osgi.framework.Bundle;

@Component
@org.apache.felix.ipojo.extender.Extender(extension="foo", onArrival="onArrival", onDeparture="onDeparture")
public class Extender {

    public void onArrival(Bundle bundle, String foo) {
        // do something
    }

    public void onDeparture(Bundle bundle) {
        // do something
    }
}

    The  attribute allows setting the bundle filter.

    h2. A more realistic example
    The Junit4OSGi framework, available [here|https://svn.apache.org/repos/asf/felix/trunk/ipojo/examples/junit4osgi] , uses this handler to track Junit Test Suite offered by the installed bundles. The Junit4Osgi bundle has a component using this handler to be notified when a bundle with the  header appears or leaves.
    \\
    \\
    {include:apache-felix-ipojo-footer}
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1422427 by fmeschbe on Sun, 16 Dec 2012 00:36:51 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
