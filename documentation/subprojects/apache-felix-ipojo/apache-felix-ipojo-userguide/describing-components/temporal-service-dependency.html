<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<head>
    <title>Apache Felix - Temporal Service Dependency</title>
    <link rel="icon" href="/res/favicon.ico">
    
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The most powerful component model for OSGi">

    
    <link href="/ipojo/web/bootstrap/css/bootstrap-cerulean.css" rel="stylesheet">
    <link href="/ipojo/web/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/ipojo/web/bootstrap/css/font-awesome.min.css" rel="stylesheet">
    <link href="/ipojo/web/style.css" rel="stylesheet">


    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/ipojo/web/bootstrap/js/bootstrap.min.js"></script>
    
</head>

<body data-spy="scroll" data-target=".subnav">
    <div class="navbar navbar-fixed-top navbar-inverse">
        <div class="navbar-inner">
            <div class="container">
               <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                 <span class="icon-bar"></span>
                 <span class="icon-bar"></span>
                 <span class="icon-bar"></span>
                </a>
                <a class="brand" href="/documentation/subprojects/apache-felix-ipojo.html">Apache Felix iPOJO</a>
         
                 <div class="nav-collapse" id="main-menu">
                    <ul class="nav" id="main-menu-left">
                        <li><a href="/documentation/subprojects/apache-felix-ipojo/ipojo-news.html">News</a></li>
                        <li><a href="http://felix.apache.org/downloads.cgi">Downloads</a></li>
                    
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Tutorials <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="tutorials-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-why-choose-ipojo.html">Why choose iPOJO</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-successstories.html">Success stories</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-feature-overview.html">Features</a></li>
                                <li class="divider"></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-in-10-minutes.html">iPOJO in 10 minutes</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/how-to-use-ipojo-annotations.html">Using Annotations</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-hello-word-maven-based-tutorial.html">Maven tutorial</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-advanced-tutorial.html ">Advanced tutorial</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/apache-felix-ipojo-dosgi.html">Using Distributed OSGi</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-composition-tutorial.html">Application Composition</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="user-guide-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/service-requirement-handler.html">Requiring a service</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/providing-osgi-services.html">Providing a service</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/lifecycle-callback-handler.html">Lifecycle management</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/configuration-handler.html">Configuration</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/architecture-handler.html">Introspection</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/controller-lifecycle-handler.html">Impacting the lifecycle</a></li>
                                <li class="divider"></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">External <em>handlers</em></a>
                                    <ul class="dropdown-menu">
                                        <li><a href="">Asynchronous communication</a></li>
                                        <li><a href="">JMX management</a></li>
                                        <li><a href="">Extender pattern</a></li>
                                        <li><a href="">Whiteboard pattern</a></li>
                                        <li><a href="">Temporal dependencies</a></li>
                                    </ul>
                                </li>                                            
                                <li class="divider"></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Advanced topics</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="">iPOJO and config admin</a></li>
                                        <li><a href="">Factories and Instances</a></li>
                                        <li><a href="">XML Schemas</a></li>
                                        <li><a href="">API</a></li>
                                        <li><a href="">Testing components</a></li>
                                        <li><a href="">Eclipse Integration</a></li>
                                        <li><a href="">FAQ</a></li>
                                        <li><a href="">Reference Card</a></li>
                                        <li class="divider"></li>
                                        <li><a href="">Handler development</a></li>
                                        <li><a href="">Manipulation Metadata </a></li>
                                        <li><a href="">Dive into the iPOJO Manipulation depths</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown" id="tools-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Tools <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="">Ant Task</a></li>
                                <li><a href="">Eclipse Plugin</a></li>
                                <li><a href="">Maven Plugin</a></li>
                                <li><a href="">`arch` shell command</a></li>
                                <li><a href="">Online Manipulator</a></li>
                                <li><a href="">Webconsole plugin</a></li>
                            </ul>
                        </li>

                        <li class="dropdown" id="community-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="">Support</a></li>
                                <li><a href="http://www.apache.org/">ASF</a></li>
                                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                <li><a href="http://www.apache.org/foundation/thanks.html">Sponsors</a></li>
                            </ul>
                        </li>

                        <li class="dropdown" id="misc-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Misc <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-supportedvms.html">Supported JVMs</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-supportedosgi.html">Supported OSGi Implementations</a></li>
                                <li><a href="">Article & Presentations</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav pull-right" id="main-menu-right">
                        <li><a rel="tooltip" target="_blank" href="http://felix.apache.org">Apache Felix <i class="icon-share-alt"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>    
    </div>

    <div class="container">
        <div class="content">
            <h1 id="the-temporal-dependency-handler">The temporal dependency handler</h1>
<p><em>Regular service dependencies participate to the instance lifecycle. Moreover, the injected service object is either available or not available. A temporal dependency handler is a little different and provides a different resolution pattern. Indeed, the temporal dependency does not invalidate the instance. Moreover, if not available, the temporal dependency waits (and so blocks the current thread) for a provider. Of course, the maximum waiting time can be specified. If a timeout occurs, the handler throws a Runtime Exception.</em></p>
<p>{div:class=toc}
[TOC]
{div}</p>
<h2 id="using-the-handler">Using the handler</h2>
<p>First of all, you need to configure the component type to use the handler such as:</p>
<div class="codehilite"><pre><span class="nt">&lt;iPOJO</span> <span class="na">xmlns:temporal=</span><span class="s">&quot;org.apache.felix.ipojo.handler.temporal&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;component</span>
    <span class="na">className=</span><span class="s">&quot;org.apache.felix.ipojo.example.Temporal&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Temporal dependency configuration --&gt;</span>
    <span class="nt">&lt;temporal:requires</span> <span class="na">field=</span><span class="s">&quot;mytemporal&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;provides/&gt;</span>

<span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/iPOJO&gt;</span>
</pre></div>


<p>Notice that, this handler is an external handler. So, it uses the "org.apache.felix.ipojo.handler.temporal" namespace.
Once described, you can implement your component. The specified field will be mapped to the temporal dependency. As for regular field injection, aggregation, targeted service specification (i.e. interface) is discovered automatically. Filter, comparator and binding policy are also supported. However, the optional attribute is not supported. In fact, this attribute is meaningless in the case of a temporal dependency.
Using the field in your code will try to find a matching service provider. If a provider is available, the field receives the service object immediately. Else, the thread is stopped and waits for a provider. The default wait time is 3s (you can also specify this time). If no provider is available after this time, the thread throws a RuntimeException. If a provider becomes available during this time, the field receives immediately the value and the execution can continue.</p>
<p>You can also use annotations:</p>
<div class="codehilite"><pre><span class="nv">@Component</span>
<span class="n">public</span> <span class="n">class</span> <span class="n">Temporal</span> <span class="p">{</span>

    <span class="nv">@Temporal</span> <span class="sr">//</span> <span class="n">was</span> <span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="o">.</span><span class="n">ipojo</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">temporal</span><span class="o">.</span><span class="n">Requires</span> <span class="n">before</span> <span class="n">the</span> <span class="mf">1.7.0</span>
    <span class="n">private</span> <span class="n">FooService</span> <span class="n">mytemporal</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>


<h2 id="configuration">Configuration</h2>
<p>The handler has only one mandatory attributes:
* Field: the implementation field supporting the dependency (not needed with annotations)</p>
<p>The handler supports on specific optional attributes:
<em> Timeout: the maximum time waited in order to find a provider (default: 3s). For an infinite timeout, the timeout value is either "infinite" or "-1".
</em> OnTimeout: specifies the action to do when the timeout occurs. Four actions are supported: null, nullable, empty-array, default-implementation. By default, no action is specified, and an exception occurs when the timeout is reached.</p>
<p>The attributes from "regular" dependencies are also supported (like filter).
OnTimeout actions</p>
<p>When a timeout occurs, you can specify what the handler must do. By default, it throws a runtime exception. However, four others actions can be set in the 'onTimeout' attribute.
<em> The null action (onTimeout="null") will return "null" instead of the service object.
</em> The "nullable" action (onTimeout="nullable") will return a "Nullable" object instead of the service object. This object is a fake but can be used a regular service object. However, invoking actions on this object will do nothing. In the case of aggregate dependency, an array containing a "nullable" object is returned.
<em> The empty action is only supported for aggregate dependency (the field must be an array). In this case, an empty-array is returned. (In the 1.2.0 version, the <code>empty-array</code> attribute became <code>empty</code>)
</em> The default-implementation action is a little different. Instead of specifying the action, you need to specify the default-implementation (the qualified class name) that you want to use. For example onTimeout="o.a.f.i.MyDefaultLogServiceImpl". In this case, the handler will inject an instance of this object instead of a real service object. On aggregate dependency, an array with one default-implementation object is returned.</p>
<div class="codehilite"><pre><span class="nt">&lt;iPOJO</span> <span class="na">xmlns:temporal=</span><span class="s">&quot;org.apache.felix.ipojo.handler.temporal&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;component</span>
    <span class="na">className=</span><span class="s">&quot;org.apache.felix.ipojo.example.Temporal&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Temporal dependency configuration --&gt;</span>
    <span class="nt">&lt;temporal:requires</span> <span class="na">field=</span><span class="s">&quot;fs&quot;</span> <span class="na">timeout=</span><span class="s">&quot;300&quot;</span> <span class="na">ontimeout=</span><span class="s">&quot;nullable&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;provides/&gt;</span>

<span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/iPOJO&gt;</span>
</pre></div>


<p>This is equivalent to:</p>
<div class="codehilite"><pre><span class="nv">@Component</span>
<span class="n">public</span> <span class="n">class</span> <span class="n">Temporal</span> <span class="p">{</span>

    <span class="nv">@Temporal</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">ontimeout</span><span class="o">=</span><span class="s">&quot;nullable&quot;</span><span class="p">)</span>
    <span class="n">private</span> <span class="n">FooService</span> <span class="n">mytemporal</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>


<h2 id="collection-injection">Collection injection</h2>
<p>Temporal dependencies can also be injected inside Collection. To achieve this, the 'specification' attribute must indicates the looked specification, and the field must be a Collection.</p>
<div class="codehilite"><pre><span class="nt">&lt;iPOJO</span> <span class="na">xmlns:temporal=</span><span class="s">&quot;org.apache.felix.ipojo.handler.temporal&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;component</span>
    <span class="na">className=</span><span class="s">&quot;org.apache.felix.ipojo.example.Temporal&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Temporal dependency configuration --&gt;</span>
    <span class="nt">&lt;temporal:requires</span> <span class="na">field=</span><span class="s">&quot;mycollection&quot;</span> <span class="na">specification=</span><span class="s">&quot;my.service.specification&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;provides/&gt;</span>

<span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/iPOJO&gt;</span>
</pre></div>


<p>This is equivalent to:</p>
<div class="codehilite"><pre><span class="nv">@Component</span>
<span class="n">public</span> <span class="n">class</span> <span class="n">Temporal</span> <span class="p">{</span>

    <span class="nv">@Temporal</span><span class="p">(</span><span class="n">specification</span><span class="o">=</span><span class="s">&quot;my.service.specification&quot;</span><span class="p">)</span>
    <span class="n">private</span> <span class="n">List</span><span class="sr">&lt;FooService&gt;</span> <span class="n">mycollection</span><span class="p">;</span>

<span class="p">}</span>
</pre></div>


<h2 id="proxy-injection">Proxy injection</h2>
<p>Temporal dependencies can also be injected as proxies. So it is possible to give the temporal dependency to helper object.
On 'scalar' dependencies, the service lookup is executed during an operation invocation. Timeout policies are also executed is the lookup failed.
On aggregate dependencies (necessary Collection), the service lookup is executed when the iterator(), and toArray(...) methods are invoked. Timeout policies 
are also executed if the lookup failed. Proxies are enabled by default since the 1.7.0 version.</p>
<p>To set a temporal dependency as a proxy, just add the <code>proxy</code> attribute as follows:</p>
<div class="codehilite"><pre><span class="nt">&lt;iPOJO</span> <span class="na">xmlns:temporal=</span><span class="s">&quot;org.apache.felix.ipojo.handler.temporal&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;component</span>
    <span class="na">className=</span><span class="s">&quot;org.apache.felix.ipojo.example.Temporal&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- Temporal dependencies configuration --&gt;</span>
    <span class="nt">&lt;temporal:requires</span> <span class="na">proxy=</span><span class="s">&quot;true&quot;</span> <span class="na">field=</span><span class="s">&quot;fs&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;temporal:requires</span> <span class="na">proxy=</span><span class="s">&quot;true&quot;</span> <span class="na">field=</span><span class="s">&quot;mycollection&quot;</span> <span class="na">specification=</span><span class="s">&quot;my.service.specification&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;provides/&gt;</span>

<span class="nt">&lt;/component&gt;</span>
<span class="nt">&lt;/iPOJO&gt;</span>
</pre></div>


<p>By default, proxies are <em>enabled</em>. Setting proxy to <code>false</code> disables them.</p>
<h2 id="download">Download</h2>
<p>The handler is available on the <a href="/documentation/subprojects/apache-felix-ipojo/download.html">download</a> page.
Sources are available on the Felix trunk at the following location: <a href="http://svn.apache.org/repos/asf/felix/trunk/ipojo/handler/temporal">http://svn.apache.org/repos/asf/felix/trunk/ipojo/handler/temporal</a>.</p>
        </div>
    </div>

    <hr/>

    <div class="container">
        <footer id="footer">
            <div class="row">
                <div class="trademarkFooter span7"> 
                Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
                logo are trademarks of The Apache Software Foundation. All other marks mentioned
                may be trademarks or registered trademarks of their respective owners.
                </div>
                <div class="timestamp span3 offset2">
                Rev. 1441864 by fmeschbe on Sun, 3 Feb 2013 06:44:40 +0000
                </div>
            </div>
        </footer>           
    </div>
</body>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript">
    try{
        var pageTracker = _gat._getTracker("UA-1518442-4");
        pageTracker._trackPageview();
    } catch(err) {}
</script>

</html>
