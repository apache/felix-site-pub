<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--
    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->

<head>
    <title>Apache Felix - iPOJO FAQ</title>
    <link rel="icon" href="/res/favicon.ico">
    
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The most powerful component model for OSGi">

    
    <link href="/ipojo/web/bootstrap/css/bootstrap-cerulean.css" rel="stylesheet">
    <link href="/ipojo/web/bootstrap/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="/ipojo/web/bootstrap/css/font-awesome.min.css" rel="stylesheet">
    <link href="/ipojo/web/style.css" rel="stylesheet">


    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/ipojo/web/bootstrap/js/bootstrap.min.js"></script>
    
</head>

<body data-spy="scroll" data-target=".subnav">
    <div class="navbar navbar-fixed-top navbar-inverse">
        <div class="navbar-inner">
            <div class="container">
               <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                 <span class="icon-bar"></span>
                 <span class="icon-bar"></span>
                 <span class="icon-bar"></span>
                </a>
                <a class="brand" href="/documentation/subprojects/apache-felix-ipojo.html">Apache Felix iPOJO</a>
         
                 <div class="nav-collapse" id="main-menu">
                    <ul class="nav" id="main-menu-left">
                        <li><a href="/documentation/subprojects/apache-felix-ipojo/ipojo-news.html">News</a></li>
                        <li><a href="http://felix.apache.org/downloads.cgi">Downloads</a></li>
                    
                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Tutorials <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="tutorials-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-why-choose-ipojo.html">Why choose iPOJO</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-successstories.html">Success stories</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-feature-overview.html">Features</a></li>
                                <li class="divider"></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-in-10-minutes.html">iPOJO in 10 minutes</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/how-to-use-ipojo-annotations.html">Using Annotations</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-hello-word-maven-based-tutorial.html">Maven tutorial</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-advanced-tutorial.html ">Advanced tutorial</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/apache-felix-ipojo-dosgi.html">Using Distributed OSGi</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-gettingstarted/ipojo-composition-tutorial.html">Application Composition</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Documentation <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="user-guide-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/service-requirement-handler.html">Requiring a service</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/providing-osgi-services.html">Providing a service</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/lifecycle-callback-handler.html">Lifecycle management</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/configuration-handler.html">Configuration</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/architecture-handler.html">Introspection</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-userguide/describing-components/controller-lifecycle-handler.html">Impacting the lifecycle</a></li>
                                <li class="divider"></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">External <em>handlers</em></a>
                                    <ul class="dropdown-menu">
                                        <li><a href="">Asynchronous communication</a></li>
                                        <li><a href="">JMX management</a></li>
                                        <li><a href="">Extender pattern</a></li>
                                        <li><a href="">Whiteboard pattern</a></li>
                                        <li><a href="">Temporal dependencies</a></li>
                                    </ul>
                                </li>                                            
                                <li class="divider"></li>
                                <li class="dropdown-submenu">
                                    <a tabindex="-1" href="#">Advanced topics</a>
                                    <ul class="dropdown-menu">
                                        <li><a href="">iPOJO and config admin</a></li>
                                        <li><a href="">Factories and Instances</a></li>
                                        <li><a href="">XML Schemas</a></li>
                                        <li><a href="">API</a></li>
                                        <li><a href="">Testing components</a></li>
                                        <li><a href="">Eclipse Integration</a></li>
                                        <li><a href="">FAQ</a></li>
                                        <li><a href="">Reference Card</a></li>
                                        <li class="divider"></li>
                                        <li><a href="">Handler development</a></li>
                                        <li><a href="">Manipulation Metadata </a></li>
                                        <li><a href="">Dive into the iPOJO Manipulation depths</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown" id="tools-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Tools <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="">Ant Task</a></li>
                                <li><a href="">Eclipse Plugin</a></li>
                                <li><a href="">Maven Plugin</a></li>
                                <li><a href="">`arch` shell command</a></li>
                                <li><a href="">Online Manipulator</a></li>
                                <li><a href="">Webconsole plugin</a></li>
                            </ul>
                        </li>

                        <li class="dropdown" id="community-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Community <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="">Support</a></li>
                                <li><a href="http://www.apache.org/">ASF</a></li>
                                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                <li><a href="http://www.apache.org/foundation/thanks.html">Sponsors</a></li>
                            </ul>
                        </li>

                        <li class="dropdown" id="misc-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#">Misc <b class="caret"></b></a>
                            <ul class="dropdown-menu" id="swatch-menu">
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-supportedvms.html">Supported JVMs</a></li>
                                <li><a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-supportedosgi.html">Supported OSGi Implementations</a></li>
                                <li><a href="">Article & Presentations</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav pull-right" id="main-menu-right">
                        <li><a rel="tooltip" target="_blank" href="http://felix.apache.org">Apache Felix <i class="icon-share-alt"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>    
    </div>

    <div class="container">
        <div class="content">
            <h1 id="apache-felix-ipojo-faq">Apache Felix iPOJO FAQ</h1>
<p>{div:class=toc}
[TOC]
{div}</p>
<h2 id="injecting-the-bundle-context-in-a-pojo">Injecting the bundle context in a POJO</h2>
<p>It is sometimes useful to inject the bundle context in your POJO. Then, your POJO is able to deal with the OSGi environment as <em>regular</em> OSGi applications. It is possible to a POJO to get its <code>BundleContext</code>. A POJO can receive its bundle context as an argument of its constructor. The next code snippet shows an example:
{code:java}
public class ASimplePOJO{
    private BundleContext context;
    public ASimplePOJO(BundleContext bc) {
        context = bc;
        // do something...
    }}</p>
<div class="codehilite"><pre><span class="n">As</span> <span class="n">you</span> <span class="n">see</span> <span class="n">on</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">snippet</span><span class="p">,</span> <span class="n">the</span> <span class="n">bundle</span> <span class="n">context</span> <span class="n">is</span> <span class="n">injected</span> <span class="n">in</span> <span class="n">the</span> <span class="n">POJO</span><span class="o">.</span> <span class="n">Then</span> <span class="n">the</span> <span class="n">POJO</span> <span class="n">can</span> <span class="k">use</span> <span class="n">it</span> <span class="n">as</span> <span class="n">a</span> <span class="s">&#39;normal&#39;</span> <span class="n">bundle</span> <span class="n">context</span><span class="o">.</span> <span class="n">The</span> <span class="n">POJO</span> <span class="n">code</span> <span class="n">can:</span>
<span class="o">*</span> <span class="n">load</span> <span class="n">classes</span>
<span class="o">*</span> <span class="n">register</span> <span class="o">/</span> <span class="n">unregister</span> <span class="n">services</span>
<span class="o">*</span> <span class="n">discover</span><span class="p">,</span> <span class="n">track</span> <span class="ow">and</span> <span class="k">use</span> <span class="n">services</span>

<span class="n">However</span><span class="p">,</span> <span class="n">all</span> <span class="n">these</span> <span class="n">interactions</span> <span class="n">are</span> <span class="nb">no</span> <span class="n">more</span> <span class="n">managed</span> <span class="n">by</span> <span class="n">the</span> <span class="n">iPOJO</span> <span class="n">container</span><span class="o">.</span> <span class="n">So</span><span class="p">,</span> <span class="n">be</span> <span class="n">careful</span> <span class="n">to</span> <span class="n">manage</span> <span class="n">the</span> <span class="n">dynamism</span><span class="p">,</span> <span class="n">synchronization</span><span class="p">,</span> <span class="n">listeners</span><span class="o">...</span>

<span class="n">h2</span><span class="o">.</span> <span class="n">Accessing</span> <span class="n">services</span> <span class="n">inside</span> <span class="n">inner</span> <span class="ow">and</span> <span class="n">anonymous</span> <span class="n">classes</span>

<span class="n">An</span> <span class="n">inner</span> <span class="n">class</span> <span class="n">is</span> <span class="n">a</span> <span class="n">class</span> <span class="nb">defined</span> <span class="n">inside</span> <span class="n">another</span> <span class="n">class</span><span class="o">.</span>  <span class="n">This</span> <span class="n">mechanism</span> <span class="n">is</span> <span class="n">useful</span> <span class="n">in</span> <span class="n">order</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">creating</span> <span class="n">a</span> <span class="n">bunch</span> <span class="n">of</span> <span class="n">small</span> <span class="n">files</span><span class="o">.</span> <span class="n">So</span><span class="p">,</span> <span class="n">it</span> <span class="n">is</span> <span class="n">common</span> <span class="n">when</span> <span class="n">creating</span> <span class="n">threads</span><span class="p">,</span> <span class="n">Swing</span> <span class="n">listeners</span> <span class="o">...</span> <span class="n">Generally</span> <span class="n">speaking</span><span class="p">,</span> <span class="n">inner</span> <span class="n">classes</span> <span class="n">are</span> <span class="n">regular</span> <span class="n">classes</span> <span class="n">treated</span> <span class="n">as</span> <span class="n">separate</span> <span class="n">classes</span><span class="o">.</span> <span class="n">However</span> <span class="n">this</span> <span class="n">is</span> <span class="n">an</span> <span class="n">oversimplification</span><span class="o">.</span> <span class="n">Some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">information</span> <span class="n">about</span> <span class="n">an</span> <span class="n">inner</span> <span class="n">class</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">in</span> <span class="n">its</span> <span class="n">class</span> <span class="n">file</span><span class="o">.</span>  <span class="n">See</span> <span class="n">section</span> <span class="mf">4.7.5</span> <span class="k">for</span> <span class="n">further</span> <span class="n">details:</span>
<span class="p">[</span><span class="n">http:</span><span class="sr">//</span><span class="n">java</span><span class="o">.</span><span class="n">sun</span><span class="o">.</span><span class="n">com</span><span class="sr">/docs/</span><span class="n">books</span><span class="sr">/jvms/s</span><span class="n">econd_edition</span><span class="sr">/html/</span><span class="n">ClassFile</span><span class="o">.</span><span class="n">doc</span><span class="o">.</span><span class="n">html</span><span class="p">]</span>

<span class="n">An</span> <span class="n">inner</span> <span class="n">class</span> <span class="n">can</span> <span class="n">access</span> <span class="n">fields</span> <span class="n">of</span> <span class="n">its</span> <span class="n">outer</span> <span class="n">class</span><span class="o">.</span> <span class="n">Since</span> <span class="n">the</span> <span class="n">iPOJO</span> <span class="mf">1.0.0</span> <span class="n">version</span><span class="p">,</span> <span class="n">fields</span> <span class="n">managed</span> <span class="n">by</span> <span class="n">iPOJO</span><span class="p">,</span> <span class="n">such</span> <span class="n">as</span> <span class="n">a</span> <span class="n">service</span> <span class="n">dependencies</span> <span class="ow">and</span> <span class="n">properties</span><span class="p">,</span> <span class="n">are</span> <span class="n">also</span> <span class="n">available</span> <span class="n">from</span> <span class="n">the</span> <span class="n">inner</span> <span class="n">class</span><span class="o">.</span> <span class="n">Indeed</span><span class="p">,</span> <span class="n">iPOJO</span> <span class="n">manipulation</span> <span class="n">also</span> <span class="n">manipulates</span> <span class="n">inner</span> <span class="ow">and</span> <span class="n">nested</span> <span class="n">classes</span><span class="p">,</span> <span class="ow">and</span> <span class="n">accesses</span> <span class="n">to</span> <span class="n">outer</span> <span class="n">class</span> <span class="n">fields</span> <span class="n">are</span> <span class="n">correctly</span> <span class="n">managed</span><span class="o">.</span>

<span class="n">h2</span><span class="o">.</span> <span class="n">Using</span> <span class="n">a</span> <span class="n">different</span> <span class="n">version</span> <span class="n">of</span> <span class="n">the</span> <span class="n">manipulator</span> <span class="n">during</span> <span class="n">the</span> <span class="n">manipulation</span>

<span class="n">You</span> <span class="n">can</span> <span class="n">configure</span> <span class="n">the</span> <span class="n">version</span> <span class="n">of</span> <span class="n">the</span> <span class="n">manipulator</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="k">use</span> <span class="n">when</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">using</span> <span class="n">the</span> <span class="n">maven</span><span class="o">-</span><span class="n">ipojo</span><span class="o">-</span><span class="n">plugin</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">iPOJO</span> <span class="n">ant</span> <span class="n">task</span><span class="o">.</span> <span class="n">This</span> <span class="n">allows</span> <span class="n">to</span> <span class="n">benefit</span> <span class="n">latest</span> <span class="n">improvements</span><span class="o">.</span>

<span class="n">For</span> <span class="n">Maven</span><span class="p">,</span> <span class="n">Just</span> <span class="n">declare</span> <span class="n">a</span> <span class="n">dependency</span> <span class="n">on</span> <span class="n">the</span> <span class="n">manipulator</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="k">use</span> <span class="n">in</span> <span class="n">the</span> <span class="n">maven</span><span class="o">-</span><span class="n">ipojo</span><span class="o">-</span><span class="n">plugin</span> <span class="n">plugin</span> <span class="n">section:</span>
<span class="p">{</span><span class="n">code:xml</span><span class="o">|</span><span class="n">title</span><span class="o">=</span><span class="n">Maven</span><span class="p">}</span>
<span class="sr">&lt;plugin&gt;</span>
        <span class="sr">&lt;groupId&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="sr">&lt;/groupId&gt;</span>
        <span class="sr">&lt;artifactId&gt;</span><span class="n">maven</span><span class="o">-</span><span class="n">ipojo</span><span class="o">-</span><span class="n">plugin</span><span class="sr">&lt;/artifactId&gt;</span>
        <span class="sr">&lt;executions&gt;</span>
          <span class="sr">&lt;execution&gt;</span>
            <span class="sr">&lt;goals&gt;</span>
              <span class="sr">&lt;goal&gt;</span><span class="n">ipojo</span><span class="o">-</span><span class="n">bundle</span><span class="sr">&lt;/goal&gt;</span>
            <span class="sr">&lt;/goals&gt;</span>
          <span class="sr">&lt;/execution&gt;</span>
        <span class="sr">&lt;/executions&gt;</span>
        <span class="sr">&lt;dependencies&gt;</span>
            <span class="sr">&lt;dependency&gt;</span>
                <span class="sr">&lt;groupId&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="sr">&lt;/groupId&gt;</span>
                <span class="sr">&lt;artifactId&gt;</span><span class="n">org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="o">.</span><span class="n">ipojo</span><span class="o">.</span><span class="n">manipulator</span><span class="sr">&lt;/artifactId&gt;</span>
                <span class="sr">&lt;version&gt;</span><span class="mf">1.6.2</span><span class="sr">&lt;/version&gt;</span>
            <span class="sr">&lt;/dependency&gt;</span>
        <span class="sr">&lt;/dependencies&gt;</span>
      <span class="sr">&lt;/plugin&gt;</span>
</pre></div>


<p>For Ant, just configure the classpath of the iPOJO ant task with the Manipulator that you want to use:
{code:xml|title=Ant}
<taskdef name="ipojo"
        classname="org.apache.felix.ipojo.task.IPojoTask"
                classpath="../ipojo/manipulator/org.apache.felix.ipojo.manipulator-1.7.0-SNAPSHOT.jar; lib/org.apache.felix.ipojo.ant-1.7.0-SNAPSHOT.jar;" />
 /&gt;</p>
<div class="codehilite"><pre><span class="n">h2</span><span class="o">.</span> <span class="n">Callbacks</span> <span class="n">order</span><span class="o">.</span>

<span class="n">A</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">handlers</span> <span class="n">define</span> <span class="n">callbacks</span> <span class="n">to</span> <span class="n">notify</span> <span class="n">the</span> <span class="n">implementation</span> <span class="n">class</span><span class="o">.</span> <span class="n">The</span> <span class="s">&#39;core&#39;</span> <span class="n">callbacks</span> <span class="n">are</span> <span class="n">called</span> <span class="n">in</span> <span class="n">the</span> <span class="n">following</span> <span class="n">order:</span>
<span class="p">{</span><span class="n">code:java</span><span class="p">}</span>
<span class="nv">@Component</span>
<span class="nv">@Provides</span>
<span class="n">public</span> <span class="n">class</span> <span class="n">CallbacksOrder</span> <span class="n">implements</span> <span class="n">MyService</span> <span class="p">{</span>

    <span class="n">public</span> <span class="n">CallbacksOrder</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;1 Constructor&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">@Bind</span>
    <span class="n">public</span> <span class="n">void</span> <span class="nb">bind</span><span class="p">(</span><span class="n">LogService</span> <span class="nb">log</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;2 Bind &quot;</span> <span class="o">+</span> <span class="nb">log</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">@Property</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;prop&quot;</span><span class="p">)</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">setProp</span><span class="p">(</span><span class="n">String</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;3 Set prop &quot;</span> <span class="o">+</span> <span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">@Validate</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">validate</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;4 Validate&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">@PostRegistration</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">registered</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;5 Registered&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sr">//</span> <span class="o">---</span> <span class="n">On</span> <span class="n">Service</span> <span class="n">Departure</span> <span class="o">---</span>

    <span class="nv">@Unbind</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">unbind</span><span class="p">(</span><span class="n">LogService</span> <span class="nb">log</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;6 Unbind &quot;</span> <span class="o">+</span> <span class="nb">log</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sr">//</span> <span class="n">Remaining</span> <span class="n">of</span> <span class="n">the</span> <span class="n">flow</span>

    <span class="nv">@PostUnregistration</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">unregistered</span><span class="p">(</span><span class="n">ServiceReference</span> <span class="nb">ref</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;7 Unregistered&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">@Invalidate</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">invalidate</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;8 Invalidate&quot;</span><span class="p">);</span>
    <span class="p">}</span>

        <span class="sr">//</span> <span class="o">---</span> <span class="n">End</span> <span class="n">of</span> <span class="n">the</span> <span class="n">callback</span> <span class="n">order</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">doNothing</span><span class="p">()</span> <span class="p">{</span>
        <span class="sr">//</span> <span class="n">Do</span> <span class="n">nothing</span><span class="o">...</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>


<h2 id="disabling-proxies-in-ipojo-1643">Disabling proxies in iPOJO 1.6+</h2>
<p>iPOJO 1.6.0 has generalized the proxy usage. However this mechanism can be disabled.</p>
<p>To disable the proxies on the entire framework, just set the property <code>ipojo.proxy</code> to <code>disabled</code> (this set the default 'proxy' value). This property is either a system property (<code>\-Dipojo.proxy=disabled</code> in the command line) or a framework property (given to the framework during its initialization).</p>
<p>You can also disable proxies for specific dependencies by using the <code>proxy</code> attribute:
{code:java}
@Requires(proxy=false)
private LogService log</p>
<div class="codehilite"><pre><span class="ow">or</span>
<span class="p">{</span><span class="n">code:xml</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">requires</span> <span class="n">field</span><span class="o">=</span><span class="s">&quot;log&quot;</span> <span class="n">proxy</span><span class="o">=</span><span class="s">&quot;false&quot;</span><span class="o">/&gt;</span>
</pre></div>


<p>The default value of the <code>proxy</code> attribute is the value of the <code>ipojo.proxy</code> property.</p>
<h2 id="use-dynamic-proxies-instead-of-smart-proxies">Use dynamic proxies instead of smart proxies</h2>
<p>Smart proxies are generated on the fly using bytecode generation. However this mechanism may not be always supported by the VM (like Dalvik (Android)). To disabled smart proxies (used by default) and use dynamic proxy instead, set the property <code>ipojo.proxy.type</code> to <code>dynamic-proxy</code>. This property is either a system property or a framework property.</p>
<h2 id="can-i-use-ipojo-with-other-osgi-implementations">Can I use iPOJO with other OSGi implementations?</h2>
<p>iPOJO relies on the OSGi R4.1 specification, so works on any compliant implementation. Moreover, iPOJO is weekly tested on Apache Felix, Eclipse Equinox and Knopflerfish..
For further information, refer to the <a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-supportedosgi.html">supported OSGi implementations</a> page and on this [blog|http://ipojo-dark-side.blogspot.com/2008/11/lessons-learned-from-ipojo-testing.html] post.</p>
<h2 id="detecting-optional-service-unavailability">Detecting optional service unavailability</h2>
<p>Sometimes it is useful to check if an optional service dependency is fulfilled or not. In order to propose a pretty simple development model, iPOJO injects proxies by default which avoid such check (Because proxies hide such details). By disabling proxies, you can easily check to unavailability.</p>
<ul>
<li>
<p>First, disable the proxy injection:
{code:java}
@Requires(proxy=false)
private LogService log;</p>
<ul>
<li>The injected object will be a direct reference. By default, iPOJO injects a  object, on which you can call service method without checking for . To detect Nullable objects, just use 
{code:java}
@Requires(proxy=false)
private LogService log;</li>
</ul>
<p>public void doSomething() {
    if (log instanceof Nullable) {
        // Service unavailable
    } else {
       // Service available
    }
}</p>
</li>
<li>
<p>If you prefer injecting <code>null</code> instead of a <code>Nullable</code>, just disable Nullable injection too. However, be care to check for <code>null</code> before each invocation.
{code:java}
@Requires(proxy=false, nullable=false)
private LogService log;</p>
</li>
</ul>
<p>public void doSomething() {
    if (log == null) {
        // Service unavailable
    } else {
       // Service available
    }
}</p>
<div class="codehilite"><pre><span class="n">h2</span><span class="o">.</span> <span class="n">Setting</span> <span class="n">the</span> <span class="n">iPOJO</span> <span class="nb">log</span> <span class="n">level</span>

<span class="n">By</span> <span class="n">default</span><span class="p">,</span> <span class="n">iPOJO</span> <span class="n">logs</span> <span class="n">only</span> <span class="n">warning</span> <span class="ow">and</span> <span class="n">error</span> <span class="n">messages</span><span class="o">.</span> <span class="n">There</span> <span class="n">are</span> <span class="n">two</span> <span class="n">different</span> <span class="n">methods</span> <span class="n">to</span> <span class="n">configure</span> <span class="n">the</span> <span class="nb">log</span> <span class="n">level</span><span class="o">.</span> <span class="n">First</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">set</span> <span class="n">the</span> <span class="n">global</span> <span class="nb">log</span> <span class="n">level</span> <span class="n">by</span> <span class="n">setting</span> <span class="n">the</span> <span class="n">_ipojo</span><span class="o">.</span><span class="nb">log</span><span class="o">.</span><span class="n">level_</span> <span class="nb">system</span> <span class="n">property</span><span class="o">.</span> <span class="n">This</span> <span class="n">replaces</span> <span class="n">the</span> <span class="n">default</span> <span class="nb">log</span> <span class="n">level</span> <span class="p">(</span><span class="n">warning</span><span class="p">)</span><span class="o">.</span> <span class="n">All</span> <span class="n">iPOJO</span> <span class="n">instances</span> <span class="n">will</span> <span class="n">be</span> <span class="n">impacted</span><span class="o">.</span>  <span class="n">However</span><span class="p">,</span> <span class="nb">each</span> <span class="n">bundle</span> <span class="n">containing</span> <span class="n">component</span> <span class="n">types</span> <span class="n">can</span> <span class="n">specify</span> <span class="n">a</span> <span class="n">different</span> <span class="nb">log</span> <span class="n">level</span><span class="o">.</span> <span class="n">To</span> <span class="n">set</span> <span class="n">this</span> <span class="n">level</span><span class="p">,</span> <span class="n">add</span> <span class="n">the</span> <span class="n">_ipojo</span><span class="o">-</span><span class="nb">log</span><span class="o">-</span><span class="n">level_</span> <span class="n">header</span> <span class="n">in</span> <span class="n">your</span> <span class="n">manifest</span><span class="o">.</span> <span class="n">The</span> <span class="n">possible</span> <span class="nb">values</span> <span class="k">for</span> <span class="n">these</span> <span class="n">two</span> <span class="n">properties</span> <span class="n">are:</span>
<span class="o">*</span> <span class="n">info</span>
<span class="o">*</span> <span class="n">debug</span>
<span class="o">*</span> <span class="n">warning</span> <span class="p">(</span><span class="n">default</span><span class="p">)</span>
<span class="o">*</span> <span class="n">error</span>

<span class="n">h2</span><span class="o">.</span> <span class="n">Installing</span> <span class="n">iPOJO</span> <span class="n">in</span> <span class="n">Service</span> <span class="n">Mix</span> <span class="n">Kernel</span>

<span class="n">You</span> <span class="n">can</span> <span class="k">use</span> <span class="n">iPOJO</span> <span class="n">in</span> <span class="n">Service</span> <span class="n">Mix</span> <span class="n">Kernel</span><span class="o">.</span> <span class="n">To</span> <span class="n">deploy</span> <span class="ow">and</span> <span class="n">start</span> <span class="n">it</span><span class="p">,</span> <span class="n">just</span> <span class="n">execute</span> <span class="n">the</span> <span class="n">following</span> <span class="n">command</span> <span class="n">line</span> <span class="n">in</span> <span class="n">the</span> <span class="n">ServiceMix</span> <span class="n">Kernel</span> <span class="n">Shell</span><span class="o">.</span>
<span class="p">{</span><span class="n">code:xml</span><span class="p">}</span>
<span class="n">osgi</span> <span class="n">install</span> <span class="o">-</span><span class="n">s</span> <span class="n">mvn:org</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">felix</span><span class="sr">/org.apache.felix.ipojo/</span><span class="mf">1.2.0</span>
</pre></div>


<p>The iPOJO bundle is downloaded from the central maven repository.</p>
<h2 id="ipojo-and-file-install">iPOJO and File Install</h2>
<p>Thanks to File install you can create, disposed and reconfigure instances from <em>cfg</em> files. You can also reconfiguring a creatged instance (configured to expose a <a href="http://felix.apache.org/site/configuration-handler.html#ConfigurationHandler-ExposingaManagedService">ManagedService</a>) with <em>cfg</em> files too. More information about this topic is available [here|http://ipojo-dark-side.blogspot.com/2009/04/ipojo-and-file-install-configuring.html].</p>
<h2 id="ipojo-handler-start-level">iPOJO handler <em>start</em> level</h2>
<p>iPOJO Handlers have a <em>start</em> level. This is <em>not</em> the <code>OSGi Start Level</code>. This level is used to determine in which order handler are configured, started and stopped. Handlers with a low level are configured and started before handlers with a high level. Moreover they are stopped after handlers with a high level. By default, handlers have no level. It means that they have the maximum level (<code>Integer.MAX</code>).</p>
<p>Here are the levels of core handlers:
<em> Service Dependency: 0 (minimum level)
</em> Lifecycle Callback: 1
<em> Configuration Properties: 1
</em> Service Providing: 3
<em> Controller Handler: no level (Integer.MAX)
</em> Architecture Handler: no level (Integer.MAX)</p>
<p>From these levels, we can see that bind methods will be called before set methods from configuration properties. So, when a POJO objects, callback are called in this order:
1. bind methods
1. validate method
1. setter methods from instance configuration</p>
<div class="info" markdown="1">
**Changes in the 1.3.0-SNAPSHOT**
iPOJO 1.3.0-SNAPSHOT sets the lifecycle callback handler level to 2. So, setter methods from instance properties are called before the validate method.
</div>

<h2 id="why-does-my-bundle-import-unused-packages">Why does my bundle import unused packages?</h2>
<p>If you check iPOJO bundle imported packages, you will see that some packages where added:
<em> org.apache.felix.ipojo;version= 1.2.0
</em> org.apache.felix.ipojo.architecture;version= 1.2.0
<em> org.osgi.service.cm;version=1.2
</em> org.osgi.service.log;version=1.3</p>
<p>The <code>org.apache.felix.ipojo</code> package is the main iPOJO package. Manipulated class use it to get access to injected values. The <code>org.apache.felix.ipojo.architecture</code> package is used to expose <em>Architecture</em> service (allowing instance introspection). This service is exposed with the bundle context from the bundle declaring the component type.
The <code>org.osgi.service.cm</code> package is imported to publish <em>ManagedService</em> and <em>ManagedServiceFactory</em> with the bundle context from the bundle declaring the component type. So, if you look for services exposed by a bundle declaring component types, you will see <em>ManagedServiceFactory</em> services.
Finally, the <code>org.osgi.service.log</code> is imported because iPOJO delegates log to a log service (if available). This service is get from the bundle context from the bundle declaring the component type. So, to get this service, the package of the service interface is imported.  Then, according to implementations, log services may get the bundle logging the message.</p>
<h2 id="how-does-ipojo-compare-to-declarative-services-or-blueprint">How does iPOJO compare to Declarative Services or Blueprint?</h2>
<p>The following table highlights some of the features of each system, it does not attempt to highlight every feature of each.</p>
<table>
<thead>
<tr>
<th>Dependency injection</th>
<th>Declarative Services</th>
<th>Blueprint</th>
<th>iPOJO</th>
</tr>
</thead>
<tbody>
<tr>
<td>Callback injection</td>
<td>Yes</td>
<td>Yes (public method only)</td>
<td>Yes</td>
</tr>
<tr>
<td>Constructor injection</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Field injection</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Setter injection</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Proxy injection</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>List injection</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Nullable injection</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Lifecycle</td>
<td>Declarative Services</td>
<td>Blueprint</td>
<td>iPOJO</td>
</tr>
<tr>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
</tr>
<tr>
<td>Callbacks (activate/deactivate)</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Factory pattern</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Lazy initialization</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Damping</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Field synchronization</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Component lifecycle control</td>
<td>Yes</td>
<td>Partial</td>
<td>Yes</td>
</tr>
<tr>
<td>Service lifecycle control</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Configuration</td>
<td>Declarative Services</td>
<td>Blueprint</td>
<td>iPOJO</td>
</tr>
<tr>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
</tr>
<tr>
<td>Property configuration</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Field configuration</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Configuration Admin</td>
<td>Yes</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Services</td>
<td>Declarative Services</td>
<td>Blueprint</td>
<td>iPOJO</td>
</tr>
<tr>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
</tr>
<tr>
<td>Custom attribute type</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Lazy initialization</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Composite services</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Component description</td>
<td>Declarative Services</td>
<td>Blueprint</td>
<td>iPOJO</td>
</tr>
<tr>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
</tr>
<tr>
<td>XML</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td>Java annotations</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>API</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td>Nonfunctional</td>
<td>Declarative Services</td>
<td>Blueprint</td>
<td>iPOJO</td>
</tr>
<tr>
<td>--</td>
<td>--</td>
<td>--</td>
<td>--</td>
</tr>
<tr>
<td>Multiple providers</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
</tr>
</tbody>
</table>
        </div>
    </div>

    <hr/>

    <div class="container">
        <footer id="footer">
            <div class="row">
                <div class="trademarkFooter span7"> 
                Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
                logo are trademarks of The Apache Software Foundation. All other marks mentioned
                may be trademarks or registered trademarks of their respective owners.
                </div>
                <div class="timestamp span3 offset2">
                Rev. 1441864 by fmeschbe on Sun, 3 Feb 2013 06:44:40 +0000
                </div>
            </div>
        </footer>           
    </div>
</body>

<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script type="text/javascript">
    try{
        var pageTracker = _gat._getTracker("UA-1518442-4");
        pageTracker._trackPageview();
    } catch(err) {}
</script>

</html>
