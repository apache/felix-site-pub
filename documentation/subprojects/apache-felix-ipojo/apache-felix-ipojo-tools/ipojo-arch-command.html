<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - iPOJO-Arch-Command</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>  <br />
</p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-ipojo.html">Apache Felix iPOJO</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects/apache-felix-ipojo/apache-felix-ipojo-tools.html">apache-felix-ipojo-tools</a>
      </div>

      
      <div class="tip">
           This page is a translated version of <a href="/site/ipojo-arch-command.html" target="felix_cwiki">/site/ipojo-arch-command.html</a>. In case of
           doubt you might want to refer to the old page.
      </div>
      
      
      <h1>iPOJO-Arch-Command</h1>
      <p>{include:apache-felix-ipojo-header}</p>
<div class="content">

# iPOJO `Arch` command
*Architecture introspection is required when the system doesn't work as expected. In this case, having a quick access to instances states and interconnection is a stringent requirement. The `arch` command allows getting these data from the Felix Shell, from the Equinox shell and Gogo.*

*Note* : The Gogo commands are not yet released but are available from the iPOJO trunk.

{div:class=toc}
[TOC]
{div}

## Download
The Felix commands is available from the [download](/documentation/subprojects/apache-felix-ipojo/download.html) page.
The Equinox command sources are available [http://svn.apache.org/repos/asf/felix/sandbox/clement/ipojo-utils/arch-equinox/](http://svn.apache.org/viewvc/felix/sandbox/clement/ipojo-utils/arch-equinox/). To compile sources, just launch the `mvn clean install` and deploy the resulting bundle.

## Installation
Once you get the bundle, just install and start it in the OSGi Framework shell:
{code:xml|title=Felix}
start file:/BUNDLE_URL.jar

    {code:xml|title=Equinox}
    install file:/BUNDLE_URL.jar
    Bundle X installed
    start X

{code:xml|title=Gogo}
install file:/ARCH*GOGO*URL.jar
Bundle X installed
start X

    h2. Equinox and Felix Shells

    Then, you can use it to introspect the system by launching the  command.

arch => displays instances name & state (equivalent to arch \-instances)
arch -instance $instance*name => displays complete information about the instance $instance*name
arch -factories => display the list of available factories
arch -factory $factory*name => display complete information about the factory $factory*name
arch -handlers => list available handlers

    h2. Gogo Shell Commands
    The set of commands available from Gogo is a little bit different:
    *  (or just ) lists the instances and state
    *  (or just ) displays the complete information about the specified $instance_name
    *  (or just ) lists the available public factories
    *  (or just ) displays complete information about the factory $factory_name
    *  (or just  lists available handlers

    h2. Reading instance architecture 
    When you launch the  command (or  on Gogo), the list of created instances (enabling architecture introspection) is displayed.
    {code:title=Felix or Equinox}
    -> arch
    Instance ArchCommand -> valid
    Instance spell.english.EnglishDictionary-0 -> valid
    Instance spell.checker.SpellCheck-0 -> valid
    Instance spell.gui.SpellCheckerGui-0 -> valid

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Gogo</B></DIV><DIV class="codeContent panelContent">
    $ instances
    Instance ArchCommand -> valid
    Instance spell.english.EnglishDictionary-0 -> valid
    Instance spell.checker.SpellCheck-0 -> valid
    Instance spell.gui.SpellCheckerGui-0 -> valid

To get more information on an instance, launch `arch -instance the*instance*name` (or `instance the*instance*name` on Gogo)
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Felix or Equinox</B></DIV><DIV class="codeContent panelContent">
    -> arch -instance spell.checker.SpellCheck-0                                    
    instance component.type="spell.checker.SpellCheck" state="valid" bundle="8" name="spell.checker.SpellCheck-0"
        handler state="valid" name="org.apache.felix.ipojo.handlers.dependency.DependencyHandler"
            requires optional="false" aggregate="false" state="resolved" binding-policy="dynamic" specification="spell.services.DictionaryService"
        handler state="valid" name="org.apache.felix.ipojo.handlers.providedservice.ProvidedServiceHandler"
            provides service.id="36" state="registered" specifications="[spell.services.SpellChecker]"
                property value="spell.checker.SpellCheck" name="factory.name"
                property value="spell.checker.SpellCheck-0" name="instance.name"
        handler state="valid" name="org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler"

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Gogo</B></DIV><DIV class="codeContent panelContent">
    $ipojo:instance spell.checker.SpellCheck-0                                    
    instance component.type="spell.checker.SpellCheck" state="valid" bundle="8" name="spell.checker.SpellCheck-0"
        handler state="valid" name="org.apache.felix.ipojo.handlers.dependency.DependencyHandler"
            requires optional="false" aggregate="false" state="resolved" binding-policy="dynamic" specification="spell.services.DictionaryService"
        handler state="valid" name="org.apache.felix.ipojo.handlers.providedservice.ProvidedServiceHandler"
            provides service.id="36" state="registered" specifications="[spell.services.SpellChecker]"
                property value="spell.checker.SpellCheck" name="factory.name"
                property value="spell.checker.SpellCheck-0" name="instance.name"
        handler state="valid" name="org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler"

Instance architecture is organized as follows:
On the first line, are displayed the component type (i.e. factory), the instance state (`valid` or `invalid`), the bundle from which the instance is created, and the instance name.
Then, the information is organized handler by handler (a piece of container). For each handler plugged on the instance can participate to the instance architecture. For each handler its name (such as ` org.apache.felix.ipojo.handlers.dependency.DependencyHandler` for iPOJO service dependencies, ` org.apache.felix.ipojo.handlers.providedservice.ProvidedServiceHandler` for iPOJO service providing...) and the state (either `valid` or `invalid` are displayed. Remember that an instance is valid only and only if all plugged handlers are valid. 
The `org.apache.felix.ipojo.handlers.dependency.DependencyHandler` provides data on service dependencies and more precisely on the state of service dependencies. In the previous example, the dependency on ` spell.services.DictionaryService` was resolved. On the following example, the same dependency is no more resolved:

    instance component.type="spell.checker.SpellCheck" state="invalid" bundle="8" name="spell.checker.SpellCheck-0"
        handler state="invalid" name="org.apache.felix.ipojo.handlers.dependency.DependencyHandler"
            requires optional="false" aggregate="false" state="unresolved" binding-policy="dynamic" specification="spell.services.DictionaryService"
        handler state="valid" name="org.apache.felix.ipojo.handlers.providedservice.ProvidedServiceHandler"
            provides state="unregistered" specifications="[spell.services.SpellChecker]"
                property value="spell.checker.SpellCheck" name="factory.name"
                property value="spell.checker.SpellCheck-0" name="instance.name"
        handler state="valid" name="org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler" 

Notes that, the instance also becomes invalid and that the provided service is unregistered.
If the provider comes back, the dependency becomes `resolved` and the instance becomes `valid`
If an instance begins to use a service, the bound providers are described in the instance architecture:
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Felix or Equinox</B></DIV><DIV class="codeContent panelContent">
    -> arch -instance spell.checker.SpellCheck-0 
    instance component.type="spell.checker.SpellCheck" state="valid" bundle="8" name="spell.checker.SpellCheck-0"
        object name="spell.checker.SpellCheck@e222eb"
        handler state="valid" name="org.apache.felix.ipojo.handlers.dependency.DependencyHandler"
            requires optional="false" aggregate="false" state="resolved" binding-policy="dynamic" specification="spell.services.DictionaryService"
                uses service.id="41" instance.name="spell.english.EnglishDictionary-0"
        handler state="valid" name="org.apache.felix.ipojo.handlers.providedservice.ProvidedServiceHandler"
            provides service.id="42" state="registered" specifications="[spell.services.SpellChecker]"
                property value="spell.checker.SpellCheck" name="factory.name"
                property value="spell.checker.SpellCheck-0" name="instance.name"
        handler state="valid" name="org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler"

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Gogo</B></DIV><DIV class="codeContent panelContent">
    $instance spell.checker.SpellCheck-0 
    instance component.type="spell.checker.SpellCheck" state="valid" bundle="8" name="spell.checker.SpellCheck-0"
        object name="spell.checker.SpellCheck@e222eb"
        handler state="valid" name="org.apache.felix.ipojo.handlers.dependency.DependencyHandler"
            requires optional="false" aggregate="false" state="resolved" binding-policy="dynamic" specification="spell.services.DictionaryService"
                uses service.id="41" instance.name="spell.english.EnglishDictionary-0"
        handler state="valid" name="org.apache.felix.ipojo.handlers.providedservice.ProvidedServiceHandler"
            provides service.id="42" state="registered" specifications="[spell.services.SpellChecker]"
                property value="spell.checker.SpellCheck" name="factory.name"
                property value="spell.checker.SpellCheck-0" name="instance.name"
        handler state="valid" name="org.apache.felix.ipojo.handlers.architecture.ArchitectureHandler"

In the previous case, the dependency on ` spell.services.DictionaryService` use the service 41 from the iPOJO instance named ` spell.english.EnglishDictionary-0`
You can also check created POJO objects (implementation class objet). Here, only one object was created (`spell.checker.SpellCheck@e222eb`).

## List available factories
To list available factories (i.e. component types), launch the `arch -factories` command (or `factories` on Gogo):
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Felix or Equinox</B></DIV><DIV class="codeContent panelContent">
    -> arch -factories
    Factory spell.checker.SpellCheck (VALID)
    Factory spell.gui.SpellCheckerGui (VALID)
    Factory spell.english.EnglishDictionary (VALID)

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Gogo</B></DIV><DIV class="codeContent panelContent">
    $factories
    Factory spell.checker.SpellCheck (VALID)
    Factory spell.gui.SpellCheckerGui (VALID)
    Factory spell.english.EnglishDictionary (VALID)

For each available (public) factories,the name and the sate are displayed. A factory is valid if and only if all required handlers are available. To get more information on a factory launch the `arch -factory factory*name` (or `factory factory*name` on Gogo) command:

    factory implementation-class="spell.english.EnglishDictionary" state="valid" bundle="7" name="spell.english.EnglishDictionary"
        provides specification="spell.services.DictionaryService"
        missinghandlers list="[]"
        requiredhandlers list="[org.apache.felix.ipojo:provides, org.apache.felix.ipojo:architecture]"

On the first line, you get the implementation class of the type, the state of the factory, the bundle declaring the type and the name of the type. You also get the list of required and missing handlers.
## List available handlers
You can also list available handlers with the `arch -handlers` (or `handlers` on Gogo) command.
<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Felix or Equinox</B></DIV><DIV class="codeContent panelContent">
    -> arch -handlers
    Handler org.apache.felix.ipojo:controller (VALID)
    Handler org.apache.felix.ipojo:callback (VALID)
    Handler org.apache.felix.ipojo:requires (VALID)
    Handler org.apache.felix.ipojo:provides (VALID)
    Handler org.apache.felix.ipojo:properties (VALID)
    Handler org.apache.felix.ipojo:architecture (VALID)
    Handler org.apache.felix.ipojo.handler.whiteboard:wbp (VALID)

<DIV class="code panel" style="border-style: solid;border-width: 1px;"><DIV class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><B>Gogo</B></DIV><DIV class="codeContent panelContent">
    $handlers
    Handler org.apache.felix.ipojo:controller (VALID)
    Handler org.apache.felix.ipojo:callback (VALID)
    Handler org.apache.felix.ipojo:requires (VALID)
    Handler org.apache.felix.ipojo:provides (VALID)
    Handler org.apache.felix.ipojo:properties (VALID)
    Handler org.apache.felix.ipojo:architecture (VALID)
    Handler org.apache.felix.ipojo.handler.whiteboard:wbp (VALID)

Handlers with the `org.apache.felix.ipojo` namespace (section before `:`) are core handlers (provided by the iPOJO core bundles). Others are external handlers (provided by others bundles).

{include:apache-felix-ipojo-footer}
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1422427 by fmeschbe on Sun, 16 Dec 2012 00:36:51 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
