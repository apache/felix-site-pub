<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Apache Felix Configuration Admin Service</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="https://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="https://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p><a href="/news.html">News</a>  <br />
<a href="/license.html">License</a>  <br />
<a href="/downloads.cgi">Downloads</a>  <br />
<a href="/documentation.html">Documentation</a>  <br />
<a href="/mailinglists.html">Mailing Lists</a>  <br />
<a href="/documentation/community/contributing.html">Contributing</a>  <br />
<a href="/sitemap.html">Site Map</a>  <br />
<a href="https://www.apache.org/">ASF</a>  <br />
<a href="https://www.apache.org/security/">Security</a>  <br />
<a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>  <br />
<a href="https://www.apache.org/foundation/thanks.html">Sponsors</a>    </p>
<iframe
    src="https://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/subprojects.html">Apache Felix Subproject Documentation</a>
      </div>

      <h1>Apache Felix Configuration Admin Service</h1>
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p>The OSGi Componendium Configuration Admin Service specifies a service, which allows for easy management of configuration data for configurable components. Basicaly configuration is a list of name-value pairs. Configuration is managed by management applications by asking the Configuration Admin Service for such configuration. After updating the configuration, it is sent back to the Configuration Admin Service. The Configuration Admin Service is like a central hub, which cares for persisting this configuration and also for distributing the configuration to interested parties. One class of such parties are the components to be configured. These are registered as <code>ManagedService</code> services. There is also a notion of <code>ManagedServiceFactory</code>, which allows for multiple configurations of the same kind to be applied.</p>
<p>For more information, I suggest you read Chapter 104, Configuration Admin Service Specification, of the OSGi Compendium Services Specification book. IMHO this is worth reading.</p>
<p>For a starter this page sets out to describe how you can create a component, which is interested in some configuration. As such this page is at its very beginning just highlighting the simplest of all cases: A single component being interested in its configuration.</p>
<h2 id="managedservice-example"><code>ManagedService</code> Example<a class="headerlink" href="#managedservice-example" title="Permanent link">&para;</a></h2>
<p>Consider you have requirement for some configuration, say the line length of a pretty printer. You want to have this configurable through configuration admin.</p>
<p>You need the following parts:</p>
<ul>
<li>A service PID identifying the configuration</li>
<li>A <code>ManagedService</code> to receive the configuration</li>
<li>Name(s) for the configuration property/ies</li>
</ul>
<p>The PID is just a string, which must be globally unique. Assuming a simple case where your PrettyPrinter configurator receives the configuration has a unique class name, you may well use that name. So lets assume, our <code>ManagedService</code> is called <code>org.sample.PrettyPrinterConfigurator</code> and that name is also used as the PID. For more information on the Service PID, refer to Section 104.3, The Persistent Identity of the OSGi Compendium Services Specification.</p>
<p>The class would be:</p>
<div class="codehilite"><pre>   <span class="n">package</span> <span class="n">org</span><span class="p">.</span><span class="n">sample</span><span class="p">;</span>
   <span class="n">class</span> <span class="n">PrettyPrinterConfigurator</span> <span class="n">implements</span> <span class="n">ManagedService</span> <span class="p">{</span>
       <span class="n">public</span> <span class="n">void</span> <span class="n">update</span><span class="p">(</span><span class="n">Dictionary</span> <span class="n">props</span><span class="p">)</span>
           <span class="n">throws</span> <span class="n">ConfigurationException</span> <span class="p">{</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">props</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
               <span class="o">//</span> <span class="n">no</span> <span class="n">configuration</span> <span class="n">from</span> <span class="n">configuration</span> <span class="n">admin</span>
               <span class="o">//</span> <span class="n">or</span> <span class="n">old</span> <span class="n">configuration</span> <span class="n">has</span> <span class="n">been</span> <span class="n">deleted</span>
           <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
               <span class="o">//</span> <span class="n">apply</span> <span class="n">configuration</span> <span class="n">from</span> <span class="n">config</span> <span class="n">admin</span>
           <span class="p">}</span>
       <span class="p">}</span>
   <span class="p">}</span>
</pre></div>


<p>Now, in your bundle activator's start() method you register the <code>PrettyPrinterConfigurator</code> as a <code>ManagedService</code>:</p>
<div class="codehilite"><pre><span class="p">...</span>
<span class="n">private</span> <span class="n">ServiceRegistration</span> <span class="n">ppcService</span><span class="p">;</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">start</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Dictionary</span> <span class="n">props</span> <span class="p">=</span> <span class="n">new</span> <span class="n">Hashtable</span><span class="p">();</span>
    <span class="n">props</span><span class="p">.</span><span class="n">put</span><span class="p">(</span>&quot;<span class="n">service</span><span class="p">.</span><span class="n">pid</span>&quot;<span class="p">,</span> &quot;<span class="n">org</span><span class="p">.</span><span class="n">sample</span><span class="p">.</span><span class="n">PrettyPrinterConfigurator</span>&quot;<span class="p">);</span>
    <span class="n">ppcService</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">registerService</span><span class="p">(</span><span class="n">ManagedService</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">(),</span>
        <span class="n">new</span> <span class="n">PrettyPrinterConfigurator</span><span class="p">(),</span> <span class="n">props</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">stop</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ppcService</span> !<span class="p">=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ppcService</span><span class="p">.</span><span class="n">unregister</span><span class="p">();</span>
        <span class="n">ppcService</span> <span class="p">=</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>


<p>That's more or less it. You may now go on to use your favourite tool to create and edit the configuration for the <code>PrettyPrinterConfigurator</code>, for example something like this:</p>
<div class="codehilite"><pre><span class="n">Configuration</span> <span class="n">config</span> <span class="p">=</span> <span class="n">configurationAdmin</span><span class="p">.</span><span class="n">getConfiguration</span><span class="p">(</span>
    &quot;<span class="n">org</span><span class="p">.</span><span class="n">sample</span><span class="p">.</span><span class="n">PrettyPrinterConfigurator</span>&quot;<span class="p">);</span>
<span class="n">Dictionary</span> <span class="n">props</span> <span class="p">=</span> <span class="n">config</span><span class="p">.</span><span class="n">getProperties</span><span class="p">();</span>

<span class="o">//</span> <span class="k">if</span> <span class="n">null</span><span class="p">,</span> <span class="n">the</span> <span class="n">configuration</span> <span class="n">is</span> <span class="n">new</span>
<span class="k">if</span> <span class="p">(</span><span class="n">props</span> <span class="o">==</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">props</span> <span class="p">=</span> <span class="n">new</span> <span class="n">Hashtable</span><span class="p">();</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">set</span> <span class="n">some</span> <span class="k">properties</span>
<span class="n">props</span><span class="p">.</span><span class="n">put</span><span class="p">(...,</span> <span class="p">...);</span>

<span class="o">//</span> <span class="n">update</span> <span class="n">the</span> <span class="n">configuration</span>
<span class="n">config</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">props</span><span class="p">);</span>
</pre></div>


<p>After the call to <code>update</code> the Configuration Admin service persists the new configuration data and sends an update to the <code>ManagedService</code> registered with the service PID <code>org.sample.PrettyPrinterConfigurator</code>, which happens to be our <code>PrettyPrinterConfigurator</code> class as expected.</p>
<h2 id="managedservicefactory-example">ManagedServiceFactory example<a class="headerlink" href="#managedservicefactory-example" title="Permanent link">&para;</a></h2>
<p>Registering a service as ManagedServiceFactory means that it will be able to receive several different configuration dictionaries; that's particularly useful when we want to create a Service Factory, that is, a service responsible for creating multiple instances of a specific service.</p>
<p>A ManagedServiceFactory service needs to implement the ManagedServiceFactory interface, as showed in the example.</p>
<div class="codehilite"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">SmsSenderFactory</span> <span class="n">implements</span> <span class="n">ManagedServiceFactory</span>
<span class="p">{</span>   
    <span class="n">Map</span> <span class="n">existingServices</span> <span class="p">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="p">();</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">updated</span><span class="p">(</span><span class="n">String</span> <span class="n">pid</span><span class="p">,</span> <span class="n">Dictionary</span> <span class="n">dictionary</span><span class="p">)</span> <span class="n">throws</span> <span class="n">ConfigurationException</span> 
    <span class="p">{</span>
        <span class="o">//</span> <span class="n">invoked</span> <span class="n">when</span> <span class="n">a</span> <span class="n">new</span> <span class="n">configuration</span> <span class="n">dictionary</span> <span class="n">is</span> <span class="n">assigned</span>
        <span class="o">//</span> <span class="n">to</span> <span class="n">service</span> <span class="s">&#39;pid&#39;</span><span class="p">.</span> 
        <span class="k">if</span> <span class="p">(</span><span class="n">existingServices</span><span class="p">.</span><span class="n">containsKey</span><span class="p">(</span><span class="n">pid</span><span class="p">))</span>  <span class="o">//</span><span class="n">the</span> <span class="n">service</span> <span class="n">already</span> <span class="n">exists</span>
        <span class="p">{</span>
            <span class="n">MyService</span> <span class="n">service</span> <span class="p">=</span> <span class="p">(</span><span class="n">MyService</span><span class="p">)</span> <span class="n">existingServices</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">pid</span><span class="p">);</span>
            <span class="n">service</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">dictionary</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="o">//</span><span class="n">configuration</span> <span class="n">dictionary</span> <span class="k">for</span> <span class="n">a</span> <span class="n">new</span> <span class="n">service</span>
        <span class="p">{</span>
            <span class="n">MyService</span> <span class="n">service</span> <span class="p">=</span> <span class="n">createNewServiceInstance</span><span class="p">();</span>
            <span class="n">service</span><span class="p">.</span><span class="n">configure</span><span class="p">(</span><span class="n">dictionary</span><span class="p">);</span>
            <span class="n">existingServices</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">service</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">deleted</span><span class="p">(</span><span class="n">String</span> <span class="n">pid</span><span class="p">)</span> 
    <span class="p">{</span>
        <span class="o">//</span> <span class="n">invoked</span> <span class="n">when</span> <span class="n">the</span> <span class="n">service</span> <span class="s">&#39;pid&#39;</span> <span class="n">is</span> <span class="n">deleted</span>
        <span class="n">existingServices</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pid</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="n">String</span> <span class="n">getName</span><span class="p">()</span> 
    <span class="p">{</span>
        <span class="k">return</span> &quot;<span class="n">test</span><span class="p">.</span><span class="n">smssenderfactory</span>&quot;<span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The example above shows that, differently from the ManagedService, the ManagedServiceFactory is designed to manage multiple instances of a service. In fact, the <code>update</code> method accept a <code>pid</code> and a <code>Dictionary</code> as arguments, thus allowing to associate a certain configuration dictionary to a particular service instance (identified by the <code>pid</code>).</p>
<p>Note also that the ManagedServiceFactory interface requires to implement (besides the <code>getName</code> method) a <code>delete</code> method: this method is invoked when the Configuration Admin Service asks the ManagedServiceFactory to delete a specific service instance.</p>
<p>The registration of a <code>ManagedServiceFactory</code> follows the same steps of the <code>ManagedService</code> example:</p>
<div class="codehilite"><pre><span class="n">private</span> <span class="n">ServiceRegistration</span> <span class="n">factoryService</span><span class="p">;</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">start</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Dictionary</span> <span class="n">props</span> <span class="p">=</span> <span class="n">new</span> <span class="n">Hashtable</span><span class="p">();</span>
    <span class="n">props</span><span class="p">.</span><span class="n">put</span><span class="p">(</span>&quot;<span class="n">service</span><span class="p">.</span><span class="n">pid</span>&quot;<span class="p">,</span> &quot;<span class="n">test</span><span class="p">.</span><span class="n">smssenderfactory</span>&quot;<span class="p">);</span>
    <span class="n">factoryService</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">registerService</span><span class="p">(</span><span class="n">ManagedServiceFactory</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">(),</span>
        <span class="n">new</span> <span class="n">SmsSenderFactory</span><span class="p">(),</span> <span class="n">props</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">stop</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">factoryService</span> !<span class="p">=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">factoryService</span><span class="p">.</span><span class="n">unregister</span><span class="p">();</span>
        <span class="n">factoryService</span> <span class="p">=</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>


<p>Finally, using the ConfigurationAdmin interface, it is possible to send new or updated configuration dictionaries to the newly created ManagedServiceFactory:</p>
<div class="codehilite"><pre><span class="n">public</span> <span class="n">class</span> <span class="n">Activator</span> <span class="n">implements</span> <span class="n">BundleActivator</span> 
<span class="p">{</span>   
    <span class="n">private</span> <span class="n">List</span> <span class="n">configurationList</span> <span class="p">=</span> <span class="n">new</span> <span class="n">ArrayList</span><span class="p">();</span>

    <span class="n">public</span> <span class="n">void</span> <span class="n">start</span><span class="p">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="p">)</span> <span class="n">throws</span> <span class="n">Exception</span> 
    <span class="p">{</span>  
        <span class="n">ServiceReference</span> <span class="n">configurationAdminReference</span> <span class="p">=</span> 
            <span class="n">bundleContext</span><span class="p">.</span><span class="n">getServiceReference</span><span class="p">(</span><span class="n">ConfigurationAdmin</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getName</span><span class="p">());</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">configurationAdminReference</span> !<span class="p">=</span> <span class="n">null</span><span class="p">)</span> 
        <span class="p">{</span>  
            <span class="n">ConfigurationAdmin</span> <span class="n">confAdmin</span> <span class="p">=</span> <span class="p">(</span><span class="n">ConfigurationAdmin</span><span class="p">)</span> <span class="n">bundleContext</span><span class="p">.</span><span class="n">getService</span><span class="p">(</span><span class="n">configurationAdminReference</span><span class="p">);</span>

            <span class="n">Configuration</span> <span class="n">configuration</span> <span class="p">=</span> <span class="n">confAdmin</span><span class="p">.</span><span class="n">createFactoryConfiguration</span><span class="p">(</span>&quot;<span class="n">test</span><span class="p">.</span><span class="n">smssenderfactory</span>&quot;<span class="p">,</span> <span class="n">null</span><span class="p">);</span>  
            <span class="n">Dictionary</span> <span class="k">properties</span> <span class="p">=</span> <span class="n">createServiceProperties</span><span class="p">();</span>
            <span class="n">configuration</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="k">properties</span><span class="p">);</span>

            <span class="o">//</span><span class="n">Store</span> <span class="n">in</span> <span class="n">the</span> <span class="n">configurationList</span> <span class="n">the</span> <span class="n">configuration</span> <span class="n">object</span><span class="p">,</span> <span class="n">the</span> <span class="n">dictionary</span> <span class="n">object</span>
            <span class="o">//</span><span class="n">or</span> <span class="n">configuration</span><span class="p">.</span><span class="n">getPid</span><span class="p">()</span>  <span class="k">for</span> <span class="n">future</span> <span class="n">use</span>  
            <span class="n">configurationList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">configuration</span><span class="p">);</span>  
        <span class="p">}</span>  
    <span class="p">}</span>   
<span class="p">}</span>
</pre></div>


<h2 id="apache-felix-implementation-details">Apache Felix Implementation Details<a class="headerlink" href="#apache-felix-implementation-details" title="Permanent link">&para;</a></h2>
<p>The Apache Felix implementation of the Configuration Admin Service specification has a few specialities, which may be of interest when deploying it. These are described here.</p>
<h3 id="configuration-properties">Configuration Properties<a class="headerlink" href="#configuration-properties" title="Permanent link">&para;</a></h3>
<p>The Apache Felix implementation is configurable with Framework properties. Here is a short table listing the properties. Please refer to the later sections for a description of these properties.</p>
<table class="table">
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>felix.cm.loglevel</code></td>
<td>int</td>
<td><code>2</code></td>
<td>Logging level to use in the absence of an OSGi LogService. See the <em>Logging</em> section below.</td>
</tr>
<tr>
<td><code>felix.cm.dir</code></td>
<td>String</td>
<td><code>BundleContext.getDataFile("config")</code></td>
<td>Location of the Configuration Admin configuration files. See the <em>Configuration Files</em> section below.</td>
</tr>
</tbody>
</table>
<h3 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">&para;</a></h3>
<p>Logging goes to the OSGi LogService if such a service is registered int the OSGi framework. If no OSGi LogService is registered, the log output is directed to the Java platform standard error output (<code>System.err</code>).</p>
<p>To limit the output in the absence of an OSGi LogService, the <code>felix.cm.loglevel</code> framework property may be set to an integer value limiting the level of the log messages actually written: Only messages whose level is lower than or equal to the limit is actually written. All other messages are discarded.</p>
<p>The log levels correspond to the predefined log levels of the OSGi Log Service Specification as listed in the following table:</p>
<table class="table">
<thead>
<tr>
<th>Level Number</th>
<th>LogService Constant</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>LOG_ERROR</td>
<td>Used for error messages</td>
</tr>
<tr>
<td>2</td>
<td>LOG_WARNING</td>
<td>Used for warning messages. This is the default value of the <code>felix.cm.loglevel</code> property if it is not set or if the value cannot be converted to an integer.</td>
</tr>
<tr>
<td>3</td>
<td>LOG_INFO</td>
<td>Used for informational messages</td>
</tr>
<tr>
<td>4</td>
<td>LOG_DEBUG</td>
<td>Used for debug messages</td>
</tr>
</tbody>
</table>
<p><em>Note</em>: The <code>felix.cm.loglevel</code> property is ignored if an OSGi LogService is actually used for logging because it is then the responsibility of the LogService to limit the actual log output.</p>
<h3 id="configuration-files">Configuration Files<a class="headerlink" href="#configuration-files" title="Permanent link">&para;</a></h3>
<p>By default the Apache Felix Configuration Admin Implementation stores the configuration data in the platform filesystem. The location of the configuration data can be configured with the <code>felix.cm.dir</code> framework property.</p>
<p>The resolution of the location using the <code>felix.cm.dir</code> and the <code>BundleContext</code> is implemented according to the following algorithm.</p>
<ol>
<li>If the <code>felix.cm.dir</code> property is not set, a directory named <code>config</code> is used inside the persistent storage area of the Apache Felix Configuration Admin Service bundle is used. This is the default behaviour.</li>
<li>If the <code>felix.cm.dir</code> property is not set and the framework does not support persistent storage area for bundles in the filesystem, the <code>config</code> directory is used in the current working directory as specified in the <code>user.dir</code> system property is assumed.</li>
<li>Otherwise the <code>felix.cm.dir</code> property value is used as the directory name to take the configuration data.</li>
</ol>
<p>The result of these steps may be a relative file. In this case and if the framework provides access to persistent storage area, the directory name is resolved as being inside the persistent storage area. Otherwise the directory name is resolved to an absolute path calling the File.getAbsoluteFile() method.</p>
<p>If a non-directory file exists as the location found in the previous step or the named directory (including any parent directories) cannot be created, the configuration data cannot be stored in the filesystem. Generally this will result in failure to store configuration data at all, except if there is a <code>org.apache.felix.cm.PersistenceManager</code> service registered, which is then used.</p>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1498422 by fmeschbe on Mon, 1 Jul 2013 13:03:05 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
