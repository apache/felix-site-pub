<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       https://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Apache Felix Tutorial Example 8</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="https://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="https://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<p><a href="/news.html">News</a>  <br />
<a href="/license.html">License</a>  <br />
<a href="/downloads.cgi">Downloads</a>  <br />
<a href="/documentation.html">Documentation</a>  <br />
<a href="/mailinglists.html">Mailing Lists</a>  <br />
<a href="/documentation/community/contributing.html">Contributing</a>  <br />
<a href="/sitemap.html">Site Map</a>  <br />
<a href="https://www.apache.org/">ASF</a>  <br />
<a href="https://www.apache.org/security/">Security</a>  <br />
<a href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>  <br />
<a href="https://www.apache.org/foundation/thanks.html">Sponsors</a>    </p>
<iframe
    src="https://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/tutorials-examples-and-presentations.html">Tutorials, Examples, and Presentations</a>&nbsp;&raquo&nbsp;<a href="/documentation/tutorials-examples-and-presentations/apache-felix-osgi-tutorial.html">Apache Felix OSGi Tutorial</a>
      </div>

      <h1>Apache Felix Tutorial Example 8</h1>
      <style type="text/css">
/* The following code is added by mdx_elementid.py
   It was originally lifted from http://subversion.apache.org/style/site.css */
/*
 * Hide class="elementid-permalink", except when an enclosing heading
 * has the :hover property.
 */
.headerlink, .elementid-permalink {
  visibility: hidden;
}
h2:hover > .headerlink, h3:hover > .headerlink, h1:hover > .headerlink, h6:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, dt:hover > .elementid-permalink { visibility: visible }</style>
<h1 id="example-8-spell-checker-service-using-service-binder">Example 8 - Spell Checker Service using Service Binder<a class="headerlink" href="#example-8-spell-checker-service-using-service-binder" title="Permanent link">&para;</a></h1>
<p><em>[Note: The Service Binder was the original project to attempt to automate service dependency management for the OSGi platform and was the inspiration for Declarative Services introduced in OSGi R4. The Service Binder is no longer under active development, but this example is kept in the tutorial for historical purposes. New projects should consider using one of the other dependency injection technologies (e.g., Declarative Services, Dependency Manager, or iPOJO).]()</em></p>
<p>The purpose of this example is to re-implement the spell checker service in Example 6, but to do so using the Service Binder; to complete this, we must download the <a href="">Service Binder</a> bundle. The Service Binder bundle is needed to compile the example and at run time to execute the example.</p>
<p>The spell checker service of Example 6 was complex because it needed to aggregate all available dictionary services and monitor their dynamic availability. In addition, the spell checker service's own availability was dependent upon the availability of dictionary services; in other words, the spell checker service had a dynamic, one-to-many dependency on dictionary services. As it turns out, service dependencies are not managed at all by the OSGi framework and end up being the responsibility of the application developer. The Service Binder tries to eliminate complex and error-prone service dependency handling by automating it. To do this, the Service Binder replaces the BundleActivator code with a generic bundle activator that parses an XML file that describes the instances we want to create and their service dependencies. Instead of writing a lot of complex code, we simply write a declarative XML file. For an example, consider the following code for the new service's bundle activator in a file called <code>Activator.java</code>:</p>
<div class="codehilite"><pre><span class="cm">/*</span>
<span class="cm"> * Apache Felix OSGi tutorial.</span>
<span class="cm">**/</span>

<span class="kn">package</span> <span class="n">tutorial</span><span class="p">.</span><span class="n">example8</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">felix</span><span class="p">.</span><span class="n">servicebinder</span><span class="p">.</span><span class="n">GenericActivator</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * This example re-implements the spell checker service of</span>
<span class="cm"> * Example 6 using the Service Binder. The Service Binder</span>
<span class="cm"> * greatly simplifies creating OSGi applications by</span>
<span class="cm"> * essentially eliminating the need to write OSGi-related</span>
<span class="cm"> * code; instead of writing OSGi code for your bundle, you</span>
<span class="cm"> * create a simple XML file to describe your bundle&#39;s service</span>
<span class="cm"> * dependencies. This class extends the generic bundle activator;</span>
<span class="cm"> * it does not provide any additional functionality. All</span>
<span class="cm"> * functionality for service-related tasks, such as look-up and</span>
<span class="cm"> * binding, is handled by the generic activator base class using</span>
<span class="cm"> * data from the metadata.xml file. All application</span>
<span class="cm"> * functionality is defined in the SpellCheckerImpl.java</span>
<span class="cm"> * file.</span>
<span class="cm">**/</span>

<span class="n">public</span> <span class="k">class</span> <span class="n">Activator</span> <span class="k">extends</span> <span class="n">GenericActivator</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>


<p>All custom functionality has been removed from the bundle activator, it is only necessary to subclass the generic activator exported by the Service Binder. The generic activator performs its task by parsing an XML meta-data file that describes what instances should be created and what their service dependencies are; for our example, we create a file called <code>metadata.xml</code> that contains the instance and service dependency meta-data:</p>
<div class="codehilite"><pre><span class="cp">&lt;?</span><span class="nx">xml</span> <span class="nx">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="nx">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="cp">?&gt;</span>
<span class="o">&lt;</span><span class="nx">bundle</span><span class="o">&gt;</span>
  <span class="c">&lt;!--</span>
    <span class="o">--</span> <span class="nx">This</span> <span class="nx">meta</span><span class="o">-</span><span class="nx">data</span> <span class="nx">file</span> <span class="nx">instructs</span> <span class="nx">the</span> <span class="nx">Service</span> <span class="nx">Binder</span> <span class="nx">to</span>
    <span class="o">--</span> <span class="nx">create</span> <span class="nx">one</span> <span class="nx">instance</span> <span class="nx">of</span> <span class="s2">&quot;SpellCheckerImpl&quot;</span><span class="p">.</span> <span class="nx">It</span> <span class="nx">also</span>
    <span class="o">--</span> <span class="nx">tells</span> <span class="nx">the</span> <span class="nx">generic</span> <span class="nx">activator</span> <span class="nx">that</span> <span class="k">this</span> <span class="nx">instance</span> <span class="kr">implements</span> <span class="nx">the</span>
    <span class="o">--</span> <span class="s2">&quot;SpellChecker&quot;</span> <span class="nx">service</span> <span class="kr">interface</span> <span class="nx">and</span> <span class="nx">that</span> <span class="nx">it</span> <span class="nx">has</span> <span class="nx">an</span>
    <span class="o">--</span> <span class="nx">aggregate</span> <span class="nx">dependency</span> <span class="nx">on</span> <span class="s2">&quot;DictionaryService&quot;</span> <span class="nx">services</span><span class="p">.</span> <span class="nx">Since</span>
    <span class="o">--</span> <span class="nx">the</span> <span class="nx">service</span> <span class="nx">dependency</span> <span class="nx">on</span> <span class="nx">dictionary</span> <span class="nx">services</span> <span class="nx">has</span> <span class="nx">a</span> <span class="nx">lower</span>
    <span class="o">--</span> <span class="nx">cardinality</span> <span class="nx">of</span> <span class="nx">one</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">generic</span> <span class="nx">activator</span> <span class="nx">will</span> <span class="nx">create</span> <span class="nx">the</span> <span class="nx">instance</span>
    <span class="o">--</span> <span class="nx">and</span> <span class="nx">offer</span> <span class="nx">its</span> <span class="nx">spell</span> <span class="nx">checker</span> <span class="nx">service</span> <span class="nx">only</span> <span class="nx">when</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">at</span> <span class="nx">least</span>
    <span class="o">--</span> <span class="nx">one</span> <span class="nx">dictionary</span> <span class="nx">service</span> <span class="nx">available</span><span class="p">.</span> <span class="nx">The</span> <span class="nx">service</span> <span class="nx">dependency</span> <span class="nx">is</span>
    <span class="o">--</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> <span class="nx">which</span> <span class="nx">means</span> <span class="nx">that</span> <span class="nx">dictionary</span> <span class="nx">service</span> <span class="nx">availability</span>
    <span class="o">--</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">monitored</span> <span class="nx">dynamically</span> <span class="nx">at</span> <span class="nx">runtime</span> <span class="nx">and</span> <span class="nx">it</span> <span class="nx">also</span> <span class="nx">tells</span> <span class="nx">the</span>
    <span class="o">--</span> <span class="nx">generic</span> <span class="nx">activator</span> <span class="nx">which</span> <span class="nx">methods</span> <span class="nx">to</span> <span class="nx">call</span> <span class="nx">when</span> <span class="nx">adding</span> <span class="nx">and</span> <span class="nx">removing</span>
    <span class="o">--</span> <span class="nx">dictionary</span> <span class="nx">services</span><span class="p">.</span>
    <span class="o">--&gt;</span>
  <span class="o">&lt;</span><span class="nx">instance</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;tutorial.example8.SpellCheckerImpl&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">service</span> <span class="kr">interface</span><span class="o">=</span><span class="s2">&quot;tutorial.example6.service.SpellChecker&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="nx">requires</span>
      <span class="nx">service</span><span class="o">=</span><span class="s2">&quot;tutorial.example2.service.DictionaryService&quot;</span>
      <span class="nx">filter</span><span class="o">=</span><span class="s2">&quot;(Language=*)&quot;</span>
      <span class="nx">cardinality</span><span class="o">=</span><span class="s2">&quot;1..n&quot;</span>
      <span class="nx">policy</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span>
      <span class="nx">bind</span><span class="o">-</span><span class="nx">method</span><span class="o">=</span><span class="s2">&quot;addDictionary&quot;</span>
      <span class="nx">unbind</span><span class="o">-</span><span class="nx">method</span><span class="o">=</span><span class="s2">&quot;removeDictionary&quot;</span>
    <span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="err">/instance&gt;</span>
<span class="o">&lt;</span><span class="err">/bundle&gt;</span>
</pre></div>


<p>The above meta-data tells the generic activator to create one instance of <code>tutorial.example8.SpellCheckerImpl</code>, which we will define next. The meta-data also tells the generic activator that the instance has an aggregate service dependency (in this case, one-to-many) on dictionary services and that the services should be tracked dynamically. It also specifies the bind and unbind methods that should be called on the instance when dictionary services appear and disappear. It is important to understand that the generic activator is constantly trying to maintain the instances defined in the meta-data file. At any given point in time, a specific instance may be valid (if all service dependencies are satisfied) or invalid (if any service dependencies are unsatisfied), but at all times the generic activator is trying to get the declared instances into a valid state. The code for our new spell checker service is very similar to the implementation in Example 6, but it is no longer implemented as an inner class of the activator. We define the new spell checker service in a file called <code>SpellCheckerImpl.java</code> as follows:</p>
<div class="codehilite"><pre><span class="cm">/*</span>
<span class="cm"> * Apache Felix OSGi tutorial.</span>
<span class="cm">**/</span>

<span class="kn">package</span> <span class="n">tutorial</span><span class="p">.</span><span class="n">example8</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">BufferedReader</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">InputStreamReader</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">StringTokenizer</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">tutorial</span><span class="p">.</span><span class="n">example2</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">DictionaryService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">tutorial</span><span class="p">.</span><span class="n">example6</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">SpellChecker</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * This class re-implements the spell checker service of Example 6.</span>
<span class="cm"> * This service implementation behaves exactly like the one in</span>
<span class="cm"> * Example 6, specifically, it aggregates all available dictionary</span>
<span class="cm"> * services, monitors their dynamic availability, and only offers</span>
<span class="cm"> * the spell checker service if there are dictionary services</span>
<span class="cm"> * available. The service implementation is greatly simplified,</span>
<span class="cm"> * though, by using the Service Binder. Notice that there is no OSGi</span>
<span class="cm"> * references in the application code; instead, the metadata.xml</span>
<span class="cm"> * file describes the service dependencies, which is read by the</span>
<span class="cm"> * Service Binder to automatically manage the dependencies and</span>
<span class="cm"> * register the spell checker service as appropriate.</span>
<span class="cm">**/</span>
<span class="n">public</span> <span class="k">class</span> <span class="n">SpellCheckerImpl</span> <span class="n">implements</span> <span class="n">SpellChecker</span>
<span class="p">{</span>
    <span class="c1">// List of service objects.</span>
    <span class="n">private</span> <span class="n">ArrayList</span> <span class="n">m_svcObjList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">();</span>

    <span class="cm">/**</span>
<span class="cm">     * This method is used by the Service Binder to add</span>
<span class="cm">     * new dictionaries to the spell checker service.</span>
<span class="cm">     * @param dictionary the dictionary to add to the spell</span>
<span class="cm">     *                   checker service.</span>
<span class="cm">    **/</span>
    <span class="n">public</span> <span class="k">void</span> <span class="n">addDictionary</span><span class="p">(</span><span class="n">DictionaryService</span> <span class="n">dictionary</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Lock list and add service object.</span>
        <span class="n">synchronized</span> <span class="p">(</span><span class="n">m_svcObjList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_svcObjList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">dictionary</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * This method is used by the Service Binder to remove</span>
<span class="cm">     * dictionaries from the spell checker service.</span>
<span class="cm">     * @param dictionary the dictionary to remove from the spell</span>
<span class="cm">     *                   checker service.</span>
<span class="cm">    **/</span>
    <span class="n">public</span> <span class="k">void</span> <span class="n">removeDictionary</span><span class="p">(</span><span class="n">DictionaryService</span> <span class="n">dictionary</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Lock list and remove service object.</span>
        <span class="n">synchronized</span> <span class="p">(</span><span class="n">m_svcObjList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">m_svcObjList</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dictionary</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * Checks a given passage for spelling errors. A passage is any</span>
<span class="cm">     * number of words separated by a space and any of the following</span>
<span class="cm">     * punctuation marks: comma (,), period (.), exclamation mark (!),</span>
<span class="cm">     * question mark (?), semi-colon (;), and colon(:).</span>
<span class="cm">     * @param passage the passage to spell check.</span>
<span class="cm">     * @return An array of misspelled words or null if no</span>
<span class="cm">     *         words are misspelled.</span>
<span class="cm">    **/</span>
    <span class="n">public</span> <span class="n">String</span><span class="p">[]</span> <span class="n">check</span><span class="p">(</span><span class="n">String</span> <span class="n">passage</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// No misspelled words for an empty string.</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">passage</span> <span class="o">==</span> <span class="k">null</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">passage</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">ArrayList</span> <span class="n">errorList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">();</span>

        <span class="c1">// Tokenize the passage using spaces and punctionation.</span>
        <span class="n">StringTokenizer</span> <span class="n">st</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringTokenizer</span><span class="p">(</span><span class="n">passage</span><span class="p">,</span> <span class="s">&quot; ,.!?;:&quot;</span><span class="p">);</span>

        <span class="c1">// Lock the service list.</span>
        <span class="n">synchronized</span> <span class="p">(</span><span class="n">m_svcObjList</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Loop through each word in the passage.</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">st</span><span class="p">.</span><span class="n">hasMoreTokens</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">String</span> <span class="n">word</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">nextToken</span><span class="p">();</span>

                <span class="n">boolean</span> <span class="n">correct</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>

                <span class="c1">// Check each available dictionary for the current word.</span>
                <span class="k">for</span> <span class="p">(</span><span class="k">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="p">(</span><span class="o">!</span><span class="n">correct</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">m_svcObjList</span><span class="p">.</span><span class="n">size</span><span class="p">());</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">DictionaryService</span> <span class="n">dictionary</span> <span class="o">=</span>
                        <span class="p">(</span><span class="n">DictionaryService</span><span class="p">)</span> <span class="n">m_svcObjList</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">dictionary</span><span class="p">.</span><span class="n">checkWord</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="n">correct</span> <span class="o">=</span> <span class="n">true</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="c1">// If the word is not correct, then add it</span>
                <span class="c1">// to the incorrect word list.</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">correct</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">errorList</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">word</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Return null if no words are incorrect.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">errorList</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mh">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Return the array of incorrect words.</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">String</span><span class="p">[])</span> <span class="n">errorList</span><span class="p">.</span><span class="n">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">[</span><span class="n">errorList</span><span class="p">.</span><span class="n">size</span><span class="p">()]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>Notice how much simpler this service implementation is when compared to the same service implemented in Example 6. There are no references to OSGi interfaces in our application code and all tricky and complex code dealing with monitoring of services is handled for us. We must still create a <code>manifest.mf</code> file that contains the meta-data for the bundle; the manifest file is as follows:</p>
<div class="codehilite"><pre><span class="n">Bundle</span><span class="o">-</span><span class="n">Activator</span><span class="p">:</span> <span class="n">tutorial</span><span class="p">.</span><span class="n">example8</span><span class="p">.</span><span class="n">Activator</span>
<span class="n">Import</span><span class="o">-</span><span class="n">Package</span><span class="p">:</span> <span class="n">tutorial</span><span class="p">.</span><span class="n">example2</span><span class="p">.</span><span class="n">service</span><span class="p">,</span> <span class="n">tutorial</span><span class="p">.</span><span class="n">example6</span><span class="p">.</span><span class="n">service</span><span class="p">,</span>
 <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">felix</span><span class="p">.</span><span class="n">servicebinder</span>
<span class="n">Bundle</span><span class="o">-</span><span class="n">Name</span><span class="p">:</span> <span class="n">Service</span> <span class="n">Binder</span> <span class="n">Spell</span> <span class="n">checker</span> <span class="n">service</span>
<span class="n">Bundle</span><span class="o">-</span><span class="n">Description</span><span class="p">:</span> <span class="n">A</span> <span class="n">bundle</span> <span class="n">that</span> <span class="n">implements</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">spell</span> <span class="n">checker</span> <span class="n">service</span>
<span class="n">Bundle</span><span class="o">-</span><span class="n">Vendor</span><span class="p">:</span> <span class="n">Apache</span> <span class="n">Felix</span>
<span class="n">Bundle</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span> 1<span class="p">.</span>0<span class="p">.</span>0
<span class="n">Metadata</span><span class="o">-</span><span class="n">Location</span><span class="p">:</span> <span class="n">tutorial</span><span class="o">/</span><span class="n">example8</span><span class="o">/</span><span class="n">metadata</span><span class="p">.</span><span class="n">xml</span>
</pre></div>


<p>We specify which class is used to activate the bundle via the <code>Bundle-Activator</code> attribute and also specify that the bundle imports the spell checker, dictionary, and Service Binder packages. (Note: Make sure your manifest file ends in a trailing carriage return or else the last line will be ignored.)</p>
<p>To compile the source code, we must include the <code>felix.jar</code> file (found in Felix' <code>lib</code> directory), the servicebinder.jar file, the example2.jar file, and the example6.jar file in the class path. We compile the source file using a command like:</p>
<div class="codehilite"><pre><span class="n">javac</span> <span class="o">-</span><span class="n">d</span> <span class="n">c</span><span class="p">:</span><span class="o">\</span><span class="n">classes</span> <span class="o">*</span><span class="p">.</span><span class="n">java</span>
</pre></div>


<p>This command compiles all source files and outputs the generated classes into a subdirectory of the <code>c:\classes</code> directory; this subdirectory is <code>tutorial\example8</code>, named after the package we specified in the source file. For the above command to work, the <code>c:\classes</code> directory must exist.</p>
<p>Before we can create our bundle JAR file, we must copy the bundle's service dependency meta-data file, called <code>metadata.xml</code> above, into the example class' package. Assuming that we used the above command to compile the bundle, then we should copy the <code>metadata.xml</code> file into <code>c:\classes\tutorial\example8</code>. Now we can create the JAR file for our bundle using the following command:</p>
<div class="codehilite"><pre><span class="n">jar</span> <span class="n">cfm</span> <span class="n">example8</span><span class="p">.</span><span class="n">jar</span> <span class="n">manifest</span><span class="p">.</span><span class="n">mf</span> <span class="o">-</span><span class="n">C</span> <span class="n">c</span><span class="p">:</span><span class="o">\</span><span class="n">classes</span> <span class="n">tutorial</span><span class="o">\</span><span class="n">example8</span>
</pre></div>


<p>This command creates a JAR file using the manifest file we created and includes all of the classes and resources in the <code>tutorial\example8</code> directory inside of the <code>c:\classes</code> directory. Once the JAR file is created, we are ready to install and start the bundle.</p>
<p>To run Felix, we follow the instructions described in usage.html. When we start Felix, it asks for a profile name, we will put all of our bundles in a profile named <code>tutorial</code>. After running Felix, we should stop all tutorial bundles except for the service bundles. Use the <code>lb</code> command to make sure that only the bundles from Example 2 and Example 2b are active; use the <code>start</code> and <code>stop</code> commands as appropriate to start and stop the various tutorial bundles, respectively. (Note: Felix uses some bundles to provide its command shell, so do not stop these bundles.) We must also install the <code>servicebinder.jar</code> bundle that we downloaded at the beginning of this example. Assuming that we saved the bundle in our tutorial directory, we install the bundle using the following command:</p>
<div class="codehilite"><pre><span class="n">install</span> <span class="n">file</span><span class="p">:</span><span class="o">/</span><span class="n">c</span><span class="p">:</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="n">servicebinder</span><span class="p">.</span><span class="n">jar</span>
</pre></div>


<p>We do not need to start the Service Binder bundle, because it is only a library. Now we can install and start our spell checker service bundle. Assuming that we created our bundle in the directory <code>c:\tutorial</code>, we can install and start it in Felix' shell using the following command:</p>
<div class="codehilite"><pre><span class="n">start</span> <span class="n">file</span><span class="p">:</span><span class="o">/</span><span class="n">c</span><span class="p">:</span><span class="o">/</span><span class="n">tutorial</span><span class="o">/</span><span class="n">example8</span><span class="p">.</span><span class="n">jar</span>
</pre></div>


<p>The above command installs and starts the bundle in a single step; it is also possible to install and start the bundle in two steps by using the Felix <code>install</code> and <code>start</code> shell commands. To stop the bundle, use the Felix <code>stop</code> shell command. Use the Felix shell <code>lb</code> command to get the bundle identifier number for the spell checker service bundle to stop and restart it at will using the <code>stop</code> and <code>start</code> commands, respectively. Using the <code>services</code> command, we can see which services are currently available in the OSGi framework, including our dictionary and spell checker services. We can experiment with our spell checker service's dynamic availability by stopping the dictionary service bundles; when both dictionary services are stopped, the services command will reveal that our bundle is no longer offering its spell checker service. Likewise, when the dictionary services comeback, so will our spell checker service. This bundle will work with the spell checker client bundle that we created in Example 7, so feel free to experiment. To exit Felix, use the <code>shutdown</code> command.</p>
<p><em>[Note: The spell checker client bundle in Example 7 could also be re-implemented using the Service Binder approach outlined in this example. The spell checker client has a one-to-one, dynamic service dependency on the spell checker service. Further, an entire application of instances could be described in a single <code>metadata.xml</code> in a single bundle or across a collection of bundles and the Service Binder will automatically manage the service dependencies among them.]()</em></p>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1700393 by cziegeler on Tue, 1 Sep 2015 06:04:06 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
