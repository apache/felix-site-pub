<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
  <head>
    <title>Apache Felix - Using the OSGi Compliance Tests</title>
    <link rel="icon" href="/res/favicon.ico">
    <link rel="stylesheet" href="/res/site.css" type="text/css" media="all">
    <link rel="stylesheet" href="/res/codehilite.css" type="text/css" media="all">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  </head>
  <body>
    <div class="title">
      <div class="logo">
        <a href="http://felix.apache.org/">
          <img border="0" alt="Apache Felix" src="/res/logo.png">
        </a>
      </div>
      <div class="header">
        <a href="http://www.apache.org/">
          <img border="0" alt="Apache" src="/res/apache.png">
        </a>
      </div>
    </div>
    
    <div class="menu"> 
      <p><a href="/news.html">news</a>  <br />
<a href="/license.html">license</a>  <br />
<a href="/downloads.cgi">downloads</a>  <br />
<a href="/documentation.html">documentation</a>  <br />
<a href="/mailinglists.html">mailing lists</a>  <br />
<a href="/documentation/community/contributing.html">contributing</a>  <br />
<a href="/sitemap.html">site map</a>  <br />
<a href="http://www.apache.org/">asf</a>  <br />
<a href="http://www.apache.org/security/">security</a>  <br />
<a href="http://www.apache.org/foundation/sponsorship.html">sponsorship</a>  <br />
<a href="http://www.apache.org/foundation/thanks.html">sponsors</a>    </p>
<iframe
    src="http://www.apache.org/ads/button.html"
    style="border-width:0; float: left"
    frameborder="0"
    scrolling="no"
    width="135"
    height="135">
</iframe>
    </div>
    
    <div class="main">
      <div class="breadcrump" style="font-size: 80%;">
        <a href="/">Home</a>&nbsp;&raquo&nbsp;<a href="/documentation.html">Documentation</a>&nbsp;&raquo&nbsp;<a href="/documentation/development.html">Development</a>
      </div>

      <h1>Using the OSGi Compliance Tests</h1>
      <p>The OSGi Alliance provides Apache committers access to its Compliance Tests (CT). This
page describes how to get access to the CTs and how to use them with Felix subprojects.</p>
<h2 id="gaining-access-to-osgi-cts">Gaining Access to OSGi CTs</h2>
<p>The general process is to send a request to the jcp-open@apache.org mailing requesting
access. Since redistributing the OSGi CTs is not allowed, you will need to submit an 
<a href="http://www.apache.org/jcp/ApacheNDA.pdf">NDA</a> to be granted access to the 
<a href="https://svn.apache.org/repos/tck/osgi-cts">SVN repo</a> containing the binaries.</p>
<h2 id="osgi-ct-overview">OSGi CT Overview</h2>
<p>The CT is delivered as three JAR files, one for the core CT, one of the enterprise CT and one for the compendium CT.
Each JAR file is composed of several other JAR files, which are the actual compliance
tests. Typically, there is one JAR per specification, except for the OSGi framework. The
CT uses BND as its testing harness, which in turn uses the OSGi framework launching
and embedding API to configure, launch, and install test bundles. Each test JAR file has
an associated BND file which supplies the configuration BND needs to run the associated tests.</p>
<h2 id="modifying-the-bnd-files">Modifying the BND files</h2>
<p>Modifying the BND files is fairly straightforward. A typical BND file looks like this:</p>
<div class="codehilite"><pre><span class="c"># bnd pack for project org.osgi.test.cases.startlevel</span>
<span class="c"># Mon Aug 31 18:50:18 EDT 2009</span>
<span class="n">build</span><span class="p">=.</span>

<span class="o">-</span><span class="n">target</span> <span class="p">=</span> <span class="o">\</span>
    <span class="n">jar</span><span class="o">/</span><span class="n">org</span><span class="p">.</span><span class="n">osgi</span><span class="p">.</span><span class="nb">test</span><span class="p">.</span><span class="n">cases</span><span class="p">.</span><span class="n">startlevel</span><span class="o">-</span>4<span class="p">.</span>2<span class="p">.</span>0<span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="nb">version</span><span class="p">=</span><span class="n">file</span><span class="p">,</span>

<span class="o">-</span><span class="n">runpath</span> <span class="p">=</span> <span class="o">\</span>
    <span class="n">jar</span><span class="o">/</span><span class="n">org</span><span class="p">.</span><span class="n">eclipse</span><span class="p">.</span><span class="n">osgi</span><span class="o">-</span>3<span class="p">.</span>5<span class="p">.</span>1<span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="nb">version</span><span class="p">=</span><span class="n">file</span><span class="p">,</span> <span class="o">\</span>
    <span class="n">jar</span><span class="o">/</span><span class="n">com</span><span class="p">.</span><span class="n">springsource</span><span class="p">.</span><span class="n">junit</span><span class="o">-</span>3<span class="p">.</span>8<span class="p">.</span>2<span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="nb">version</span><span class="p">=</span><span class="n">file</span><span class="p">;</span><span class="n">export</span><span class="p">=</span><span class="s">&quot;junit.framework;version=3.8&quot;</span>

<span class="o">-</span><span class="n">runbundles</span>

<span class="o">-</span><span class="n">runproperties</span> <span class="p">=</span> <span class="o">\</span>
<span class="n">report</span><span class="p">=</span><span class="s">&quot;true&quot;</span><span class="p">,</span> <span class="o">\</span>
<span class="n">osgi</span><span class="p">.</span><span class="n">compatibility</span><span class="p">.</span><span class="n">bootdelegation</span><span class="p">=</span><span class="s">&quot;false&quot;</span><span class="p">,</span> <span class="o">\</span>
<span class="n">osgi</span><span class="p">.</span><span class="n">resolverMode</span><span class="p">=</span><span class="s">&quot;strict&quot;</span>
</pre></div>


<p>The important parts are the following settings:</p>
<ul>
<li><code>-target</code> specifies the bundles containing the tests.</li>
<li><code>-runpath</code> specifies the class path used to run the tests.</li>
<li><code>-runbundles</code> specifies the bundles to install for the tests.</li>
<li><code>-runproperties</code> specifies configuration properties to pass into the framework.</li>
</ul>
<p>The following two examples show how to edit these files for the Felix framework and Felix
bundle subprojects.</p>
<h2 id="testing-the-felix-framework">Testing the Felix framework</h2>
<p>The Felix framework is tested against the core CT. The first thing to do is extract the core
CT JAR file, which includes test suites for:</p>
<h3 id="core-functionality">Core functionality</h3>
<ul>
<li>Framework core (<code>org.osgi.test.cases.framework.bnd</code>)</li>
<li>Framework launching (<code>org.osgi.test.cases.framework.launch.bnd</code>)</li>
<li>Tracker Specification (<code>org.osgi.test.cases.tracker.bnd</code>)</li>
<li>URL Handlers (<code>org.osgi.test.cases.url.bnd</code>)</li>
</ul>
<p>While the Tracker and URL Handler specifications are optional as per the OSGi Specification, they are implemented by the 
Felix Framework and therefore the tests should be run and pass.</p>
<p>The following CT tests from the Compendium/Enterprise CT also pass with the Felix framework:</p>
<ul>
<li>XML Parser Specification (<code>org.osgi.test.cases.xml.bnd</code>) </li>
</ul>
<h3 id="security-components">Security components</h3>
<p>OSGi Security components are optional. They are supported by Felix but require
security support to be enabled. See the <a href="#security">Security</a> section below for more details.</p>
<ul>
<li>Framework security (<code>org.osgi.test.cases.framework.secure.bnd</code>)</li>
<li>Framework launching security (<code>org.osgi.test.cases.framework.launch.secure.bnd</code>)</li>
<li>Permission Admin (<code>org.osgi.test.cases.permissionadmin.bnd</code>)</li>
<li>Conditional Permission Admin (<code>org.osgi.test.cases.condpermadmin.bnd</code>)</li>
</ul>
<p>With security correctly enabled in Felix all the above security CT suites should pass.</p>
<h3 id="running-the-tests">Running the tests</h3>
<p>For each of the associated BND files, the <code>-runpath</code> needs to be edited to refer to the Felix
framework. The easiest way to do this is by modifying the <code>shared.inc</code> file which is included by 
all BND files. It should look something like this after editing:</p>
<div class="codehilite"><pre><span class="o">-</span><span class="n">runpath</span> <span class="p">=</span> <span class="o">\</span>
    <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">felix</span><span class="o">/</span><span class="n">framework</span><span class="o">/</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">felix</span><span class="p">.</span><span class="n">framework</span><span class="o">-</span>4<span class="p">.</span>4<span class="p">.</span>1<span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="n">version</span><span class="p">=</span><span class="n">file</span><span class="p">,</span> <span class="o">\</span>
    <span class="n">jar</span><span class="o">/</span><span class="n">com</span><span class="p">.</span><span class="n">springsource</span><span class="p">.</span><span class="n">junit</span><span class="o">-</span>3<span class="p">.</span>8<span class="p">.</span>2<span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="n">version</span><span class="p">=</span><span class="n">file</span><span class="p">;</span><span class="n">export</span><span class="p">=</span>&quot;<span class="n">junit</span><span class="p">.</span><span class="n">framework</span><span class="p">;</span><span class="n">version</span><span class="p">=</span>3<span class="p">.</span>8&quot;
</pre></div>


<p>Typically, it is not necessary to change anything else in the BND files and it is normal that
the <code>-runbundles</code> setting is empty, since there are no additional bundles associated with
testing the framework. </p>
<p>After editing the BND files, run the tests using:</p>
<div class="codehilite"><pre><span class="n">source</span> <span class="n">runtests</span>
</pre></div>


<p>This will run all test suites for all BND files. To run a specific test suite, do the following:</p>
<div class="codehilite"><pre><span class="nv">$ </span>java -jar jar/bnd.jar runtests --title osgi.ct &lt;bnd-file&gt;
</pre></div>


<p>Where <code>&lt;bnd-file&gt;</code> specifies one or more BND files associated with the desired test suites.</p>
<div class="note" markdown="1">
<b>Be Aware</b>
Tests for native code loading will fail on Java 6, so do not use this JDK for testing the
framework.
</div>

<p>Reports for the tests suites are generated in the <code>reports/</code> subdirectory and are named
after the appropriate test suite.</p>
<h3 id="wzxhzdk11wzxhzdk12security"><a id="security"></a>Security</h3>
<p><strong><em>TODO this section is unfinished.</em></strong></p>
<p>The exception to this is for the framework test suites for security.
To test with security enabled, you will need to add the framework security provider in
<code>-runbundles</code> like this:</p>
<div class="codehilite"><pre><span class="o">-</span><span class="n">runbundles</span> <span class="p">=</span> <span class="o">\</span>
    <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">felix</span><span class="o">/</span><span class="n">framework</span><span class="p">.</span><span class="n">security</span><span class="o">/</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">felix</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">security</span><span class="o">-</span>1<span class="p">.</span>0<span class="p">.</span>0<span class="p">.</span><span class="n">jar</span><span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="n">version</span><span class="p">=</span><span class="n">file</span>
</pre></div>


<h3 id="deviations">Deviations</h3>
<h4 id="core-r5">Core R5</h4>
<p>When running the Core R5 CT the following error appears:</p>
<div class="codehilite"><pre><span class="n">testEERequirement</span>
<span class="n">junit</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">AssertionFailedError</span><span class="p">:</span> <span class="n">Required</span> <span class="n">Execution</span> <span class="n">Environment</span> <span class="n">is</span> <span class="n">available</span><span class="p">:</span> <span class="n">Unresolved</span> <span class="n">constraint</span> <span class="n">in</span> <span class="n">bundle</span> <span class="n">org</span><span class="p">.</span><span class="n">osgi</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">cases</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">tb7a</span> <span class="p">[</span>214<span class="p">]:</span> <span class="n">Unable</span> <span class="n">to</span> <span class="n">resolve</span> 214<span class="p">.</span>0<span class="p">:</span> <span class="n">missing</span> <span class="n">requirement</span> <span class="p">[</span>214<span class="p">.</span>0<span class="p">]</span> <span class="n">osgi</span><span class="p">.</span><span class="n">ee</span><span class="p">;</span> <span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">osgi</span><span class="p">.</span><span class="n">ee</span><span class="p">=</span><span class="n">div</span><span class="o">/</span><span class="n">tb7a</span><span class="p">)(</span><span class="n">osgi</span><span class="p">.</span><span class="n">ee</span><span class="p">=</span><span class="n">div</span><span class="o">/</span><span class="n">tb7b</span><span class="p">))</span>
<span class="n">at</span> <span class="n">org</span><span class="p">.</span><span class="n">osgi</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">OSGiTestCase</span><span class="p">.</span><span class="n">fail</span><span class="p">(</span><span class="n">OSGiTestCase</span><span class="p">.</span><span class="n">java</span><span class="p">:</span>70<span class="p">)</span>
<span class="n">at</span> <span class="n">org</span><span class="p">.</span><span class="n">osgi</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">cases</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">div</span><span class="p">.</span><span class="n">DivTests</span><span class="p">.</span><span class="n">testEERequirement</span><span class="p">(</span><span class="n">DivTests</span><span class="p">.</span><span class="n">java</span><span class="p">:</span>253<span class="p">)</span>
</pre></div>


<p>This is a known deviation in the Core R5 CT and can be ignored.</p>
<h4 id="core-r6">Core R6</h4>
<p>When running the Core R6 CT the following error appears:</p>
<div class="codehilite"><pre><span class="n">testArrayServiceReferenceDTO</span>
<span class="n">junit</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">AssertionFailedError</span><span class="p">:</span> <span class="n">ServiceReferenceDTO</span><span class="p">[]</span> <span class="k">for</span> <span class="n">stopped</span> <span class="n">bundle</span> <span class="n">is</span> <span class="n">null</span>
<span class="n">at</span> <span class="n">junit</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">Assert</span><span class="p">.</span><span class="n">fail</span><span class="p">(</span><span class="n">Assert</span><span class="p">.</span><span class="n">java</span><span class="p">:</span>47<span class="p">)</span>
<span class="n">at</span> <span class="n">junit</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">Assert</span><span class="p">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">Assert</span><span class="p">.</span><span class="n">java</span><span class="p">:</span>20<span class="p">)</span>
<span class="n">at</span> <span class="n">junit</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">Assert</span><span class="p">.</span><span class="n">assertNotNull</span><span class="p">(</span><span class="n">Assert</span><span class="p">.</span><span class="n">java</span><span class="p">:</span>217<span class="p">)</span>
<span class="n">at</span> <span class="n">org</span><span class="p">.</span><span class="n">osgi</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">cases</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">dto</span><span class="p">.</span><span class="n">DTOTestCase</span><span class="p">.</span><span class="n">testArrayServiceReferenceDTO</span><span class="p">(</span><span class="n">DTOTestCase</span><span class="p">.</span><span class="n">java</span><span class="p">:</span>429<span class="p">)</span>
</pre></div>


<p>This is a known deviation in the Core R6 CT and can be ignored.</p>
<h2 id="testing-a-felix-bundle">Testing a Felix bundle</h2>
<p>The core CT tests the framework implementation and its related services. The compendium CT
tests the various non-framework-related specifications, which are implemented as bundles. For
the most part, testing a bundle is similar to testing the framework.</p>
<p>Extract the compendium CT JAR file to access the individual test suites. Since most compendium
service specification test suites require security, it is necessary to use a framework
implementation that supports security. For the Felix framework, you will have to add the
security provider to the <code>-runbundles</code> to enable security. </p>
<p>For example, to test Felix' Event Admin bundle, edit the <code>-runbundles</code> setting in
<code>org.osgi.test.cases.event.bnd</code> to look something like this:</p>
<div class="codehilite"><pre><span class="o">-</span><span class="n">runbundles</span> <span class="p">=</span> <span class="o">\</span>
    <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">felix</span><span class="o">/</span><span class="n">eventadmin</span><span class="o">/</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">felix</span><span class="p">.</span><span class="n">eventadmin</span><span class="o">-</span>1<span class="p">.</span>0<span class="p">.</span>0<span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="n">version</span><span class="p">=</span><span class="n">file</span><span class="p">,</span><span class="o">\</span>
    <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">felix</span><span class="o">/</span><span class="n">framework</span><span class="p">.</span><span class="n">security</span><span class="o">/</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">felix</span><span class="p">.</span><span class="n">framework</span><span class="p">.</span><span class="n">security</span><span class="o">-</span>1<span class="p">.</span>0<span class="p">.</span>0<span class="p">.</span><span class="n">jar</span><span class="p">.</span><span class="n">jar</span><span class="p">;</span><span class="n">version</span><span class="p">=</span><span class="n">file</span>
</pre></div>


<p>After editing the BND files to refer to the appropriate bundles, run the tests using:</p>
<div class="codehilite"><pre><span class="n">source</span> <span class="n">runtests</span>
</pre></div>


<p>This will run all test suites for all BND files. To run a specific test suite, do the following:</p>
<div class="codehilite"><pre><span class="nv">$ </span>java -jar jar/bnd.jar runtests --title osgi.ct &lt;bnd-file&gt;
</pre></div>


<p>Where <code>&lt;bnd-file&gt;</code> specifies one or more BND files associated with the desired test suites.
Reports for the tests suites are generated in the <code>reports/</code> subdirectory and are named
after the appropriate test suite.</p>
<h2 id="feedback">Feedback</h2>
<p>For any questions or feedback, subscribe to the Felix developers mailing list by sending a
message to <a href="mailto:dev-subscribe@felix-apache-org">dev-subscribe@felix.apache.org</a>; after
subscribing, email questions or feedback to <a href="mailto:dev@felix.apache.org">dev@felix.apache.org</a>.</p>
      <div class="timestamp" style="margin-top: 30px; font-size: 80%; text-align: right;">
        Rev. 1644614 by davidb on Thu, 11 Dec 2014 12:34:03 +0000
      </div>
      <div class="trademarkFooter"> 
        Apache Felix, Felix, Apache, the Apache feather logo, and the Apache Felix project
        logo are trademarks of The Apache Software Foundation. All other marks mentioned
        may be trademarks or registered trademarks of their respective owners.
      </div>
    </div>
  </body>
</html>
